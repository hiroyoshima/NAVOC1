OBJECT Table 225 Post Code
{
  OBJECT-PROPERTIES
  {
    Date=10/15/18;
    Time=12:15:48 PM;
    Modified=Yes;
    Version List=NAVW19.00.00.49741,+,DMS,AU07;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               // PHP Start
               IF "Entry Type" = "Entry Type"::"Project Site Name" THEN
                 InsertPermittingDocsInIncomingDocument;
               // PHP End
             END;

    OnModify=VAR
               DDR@1001 : Record 50005;
               IncomingDoc@1000 : Record 130;
             BEGIN
             END;

    OnDelete=VAR
               DDR@1000 : Record 50005;
               IncomingDoc@1001 : Record 130;
             BEGIN
               // PHP Start
               IF "Entry Type" = "Entry Type"::"Project Site Name" THEN
                 DeleteRelatedRecord;
               // PHP End
             END;

    OnRename=VAR
               IncDocs@1000 : Record 130;
               DDR@1001 : Record 50005;
             BEGIN
               // PHP START
               IF "Entry Type" = "Entry Type"::"Project Site Name" THEN BEGIN
                 DDR.SETRANGE("Post Code", xRec.Code);
                 DDR.SETRANGE(City, xRec.City);
                 IF DDR.FINDSET THEN BEGIN
                   REPEAT
                    DDR."Post Code" := Code;
                    DDR.City := City;
                    DDR."Country/Region Code" := "Country/Region Code";
                    DDR.MODIFY;
                   UNTIL DDR.NEXT = 0;
                 END;
               //  IF DDR.FINDFIRST THEN
               //   ERROR(ErrMsg001, Rec.FIELDCAPTION(Code), Code, Rec.FIELDCAPTION(City), City, DDR.TABLECAPTION);

                 IncDocs.SETRANGE("Post Code", xRec.Code);
                 IncDocs.SETRANGE(City, xRec.City);
                 IF IncDocs.FINDSET THEN BEGIN
                   REPEAT
                    IncDocs."Post Code" := Code;
                    IncDocs.City := City;
                    IncDocs."Country/Region Code" := "Country/Region Code";
                    IncDocs.MODIFY;
                   UNTIL IncDocs.NEXT = 0;
                 END;

               END;
               // PHP END
             END;

    CaptionML=ENU=Post Code;
    LookupPageID=Page367;
  }
  FIELDS
  {
    { 1   ;   ;Code                ;Code20        ;OnValidate=VAR
                                                                PostCode@1000 : Record 225;
                                                              BEGIN
                                                                PostCode.SETCURRENTKEY("Search City");
                                                                PostCode.SETRANGE("Search City","Search City");
                                                                PostCode.SETRANGE(Code,Code);
                                                                IF PostCode.FINDFIRST THEN
                                                                  ERROR(Text000,FIELDCAPTION(Code),Code);
                                                              END;

                                                   CaptionML=ENU=Code;
                                                   NotBlank=Yes }
    { 2   ;   ;City                ;Text30        ;OnValidate=VAR
                                                                PostCode@1000 : Record 225;
                                                              BEGIN
                                                                TESTFIELD(Code);
                                                                "Search City" := City;
                                                                IF xRec."Search City" <> "Search City" THEN BEGIN
                                                                  PostCode.SETCURRENTKEY("Search City");
                                                                  PostCode.SETRANGE("Search City","Search City");
                                                                  PostCode.SETRANGE(Code,Code);
                                                                  IF PostCode.FINDFIRST THEN
                                                                    ERROR(Text000,FIELDCAPTION(City),City);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=City;
                                                   NotBlank=Yes }
    { 3   ;   ;Search City         ;Code30        ;CaptionML=ENU=Search City }
    { 4   ;   ;Country/Region Code ;Code10        ;TableRelation=Country/Region;
                                                   OnValidate=VAR
                                                                IncDocs@1000 : Record 130;
                                                              BEGIN
                                                                // PHP Start
                                                                UpdateDDRCountryRegion;
                                                                UpdateIncomingDocumentCountryRegion;
                                                                // PHP End
                                                              END;

                                                   CaptionML=ENU=Country/Region Code }
    { 5   ;   ;County              ;Text30        ;CaptionML=ENU=County }
    { 50002;  ;Name                ;Text50         }
    { 50003;  ;Address             ;Text50         }
    { 50004;  ;Address 2           ;Text50         }
    { 50005;  ;Type                ;Option        ;OptionCaptionML=ENU=" ,Greenfield_Indoor,Greenfield_Outdoor,In-Building_Indoor,In-Building_Outdoor,Rooftop_Indoor";
                                                   OptionString=[ ,Greenfield_Indoor,Greenfield_Outdoor,In-Building_Indoor,In-Building_Outdoor,Rooftop_Indoor] }
    { 50006;  ;Config              ;Option        ;OptionCaptionML=ENU=" ,IDDG,IDoDG,ODDG,ODoDG,INBoDG";
                                                   OptionString=[ ,IDDG,IDoDG,ODDG,ODoDG,INBoDG] }
    { 50007;  ;Site Class          ;Option        ;OptionCaptionML=ENU=" ,A,B,C";
                                                   OptionString=[ ,A,B,C] }
    { 50008;  ;Change Category     ;Option        ;OptionCaptionML=ENU=" ,Change Site,Change Site Name, Change Site and Site Name, Change PLAID";
                                                   OptionString=[ ,Change Site,Change Site Name, Change Site and Site Name, Change PLAID] }
    { 50009;  ;Date Changed        ;Date           }
    { 50161;  ;Pending Installation;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist(Issues WHERE (Post Code=FIELD(Code),
                                                                                   City=FIELD(City),
                                                                                   Country/Region Code=FIELD(Country/Region Code),
                                                                                   Type of Issue=CONST(Installation),
                                                                                   Service Order Type No.=FILTER(<>''),
                                                                                   Resolved=CONST(No)));
                                                   Editable=No }
    { 50165;  ;Site Status         ;Option        ;OptionCaptionML=ENU=FSS,TSSR,RFI,ATP,WIP,PAT,PAC,NATP;
                                                   OptionString=FSS,TSSR,RFI,ATP,WIP,PAT,PAC,NATP;
                                                   Editable=No }
    { 50166;  ;Project Status      ;Option        ;OptionCaptionML=ENU=FSS,TSSR,RFI,ATP,WIP,WIP-CUSTOMER,PAT,PAC,NATP,Cancelled,WIPV,WIPCV;
                                                   OptionString=FSS,TSSR,RFI,ATP,WIP,WIP-CUSTOMER,PAT,PAC,NATP,Cancelled,WIPV,WIPCV;
                                                   Editable=No }
    { 50170;  ;Energy Config       ;Option        ;OptionCaptionML=ENU=" ,Grid Only,Gen Only,Grid-Gen,Solar-Gen";
                                                   OptionString=[ ,Grid Only,Gen Only,Grid-Gen,Solar-Gen] }
    { 50175;  ;Comm                ;Option        ;OptionCaptionML=ENU=" ,CommOk,NoComm";
                                                   OptionString=[ ,CommOk,NoComm] }
    { 50180;  ;NATP                ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Max("Daily Deployment Report"."Date of Activity" WHERE (Post Code=FIELD(Code),
                                                                                                                       City=FIELD(City),
                                                                                                                       Country/Region Code=FIELD(Country/Region Code),
                                                                                                                       NOC ATP=CONST(Done),
                                                                                                                       Type of Activity=FILTER(Installation|'Commissioning & Testing')));
                                                   Editable=No }
    { 50185;  ;PAT                 ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Max("Daily Deployment Report"."Date of Activity" WHERE (Post Code=FIELD(Code),
                                                                                                                       City=FIELD(City),
                                                                                                                       Country/Region Code=FIELD(Country/Region Code),
                                                                                                                       Type of Activity=CONST(PAT)));
                                                   Editable=No }
    { 50190;  ;Punchlist           ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist(Issues WHERE (Post Code=FIELD(Code),
                                                                                   City=FIELD(City),
                                                                                   Country/Region Code=FIELD(Country/Region Code),
                                                                                   Type of Issue=CONST(Punchlist),
                                                                                   Service Order Type No.=FILTER(<>''),
                                                                                   Resolved=CONST(No)));
                                                   Editable=No }
    { 50195;  ;Customer Issues     ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist(Issues WHERE (Post Code=FIELD(Code),
                                                                                   City=FIELD(City),
                                                                                   Country/Region Code=FIELD(Country/Region Code),
                                                                                   Service Order Type No.=FILTER(<>''),
                                                                                   Resolved=CONST(No),
                                                                                   Type of Issue=CONST(Customer Issue)));
                                                   Editable=No }
    { 50200;  ;Internal Issues     ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist(Issues WHERE (Post Code=FIELD(Code),
                                                                                   City=FIELD(City),
                                                                                   Country/Region Code=FIELD(Country/Region Code),
                                                                                   Service Order Type No.=FILTER(<>''),
                                                                                   Resolved=CONST(No),
                                                                                   Type of Issue=CONST(" ")));
                                                   Editable=No }
    { 500150; ;Entry Type          ;Option        ;OptionCaptionML=ENU=" ,Project Site Name";
                                                   OptionString=[ ,Project Site Name] }
    { 500155; ;TSSR Status         ;Option        ;CaptionML=ENU=Technical Site Survey Status;
                                                   OptionCaptionML=ENU=" ,Not Yet Submitted by PIE/Surveyor Incharge,Awaits Approval from Technical,Awaits Approval from Customer,Approved by Customer";
                                                   OptionString=[ ,Not Yet Submitted by PIE/Surveyor Incharge,Awaits Approval from Technical,Awaits Approval from Customer,Approved by Customer];
                                                   Editable=No }
    { 500160; ;RAAWA Status        ;Option        ;OptionCaptionML=ENU=" ,Await Approval from Customer,Approved,Soon To Expire,Expired";
                                                   OptionString=[ ,Await Approval from Customer,Approved,Soon To Expire,Expired];
                                                   Editable=No }
    { 500165; ;FIO Status          ;Option        ;OptionCaptionML=ENU=" ,Not Available,Deferred,Awaits Approval from Customer,Approved";
                                                   OptionString=[ ,Not Available,Deferred,Awaits Approval from Customer,Approved];
                                                   Editable=No }
    { 500170; ;Access Letter Status;Option        ;OptionCaptionML=ENU=" ,Awaits Approval from Customer,N/A (Not Applicable),Approved,Soon To Expire,Expired";
                                                   OptionString=[ ,Awaits Approval from Customer,N/A (Not Applicable),Approved,Soon To Expire,Expired];
                                                   Editable=No }
    { 500175; ;Bldg. Permit Status ;Option        ;OptionCaptionML=ENU=" ,Awaits Approval from Customer,N/A (Not Applicable),Approved,Soon To Expire,Expired";
                                                   OptionString=[ ,Awaits Approval from Customer,N/A (Not Applicable),Approved,Soon To Expire,Expired];
                                                   Editable=No }
    { 500180; ;SO Status           ;Option        ;CaptionML=ENU=Service Order Status;
                                                   OptionCaptionML=ENU=" ,Awaits Approval from Customer,Approved,Soon To Expire,Expired";
                                                   OptionString=[ ,Awaits Approval from Customer,Approved,Soon To Expire,Expired];
                                                   Editable=No }
    { 500185; ;Stages              ;Option        ;OnValidate=BEGIN
                                                                CASE Stages OF
                                                                  Stages::" ":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::FSS);
                                                                      VALIDATE("Project Status","Project Status"::FSS);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::FSS);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::FSS);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::FSS);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::"Survey-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::TSSR);
                                                                      VALIDATE("Project Status", "Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"Survey-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::TSSR);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"Survey-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::TSSR);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::TSSR);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::Survey:
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::TSSR);
                                                                        VALIDATE("Project Status", "Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::TSSR);
                                                                        VALIDATE("Project Status", "Project Status"::TSSR);
                                                                      END;
                                                                    END;
                                                                  Stages::"TSSR Approved":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::RFI);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::RFI);
                                                                        VALIDATE("Project Status","Project Status"::RFI);
                                                                      END;
                                                                    END;
                                                                  Stages::"Dependency Checklist-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::RFI);
                                                                      VALIDATE("Project Status","Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"Dependency Checklist-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::RFI);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"Dependency Checklist-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::RFI);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::RFI);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::"Dependency Checklist":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::WIP);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::WIP);
                                                                        VALIDATE("Project Status","Project Status"::WIP);
                                                                      END;
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"Transport Test-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::WIP);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"Transport Test-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::WIP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::WIP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::"Transport Test":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::ATP);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::WIP);
                                                                        VALIDATE("Project Status","Project Status"::WIP);
                                                                      END;
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"Installation Progress-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::WIP);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"Installation Progress-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::WIP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::WIP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::"Installation Progress":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::ATP);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::WIP);
                                                                        VALIDATE("Project Status","Project Status"::WIP);
                                                                      END;
                                                                    END;
                                                                  Stages::"PowerPower-Tapping-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status","Site Status"::WIP);
                                                                      VALIDATE("Project Status","Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"Power-Tapping-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::WIP);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"Power-Tapping-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::WIP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::WIP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::"Power-Tapping":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::NATP);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::WIP);
                                                                        VALIDATE("Project Status","Project Status"::WIP);
                                                                      END;
                                                                    END;
                                                                  Stages::"ATP-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status","Site Status"::ATP);
                                                                      VALIDATE("Project Status","Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"ATP-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::ATP);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"ATP-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::ATP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::ATP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::ATP:
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::ATP);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::ATP);
                                                                        VALIDATE("Project Status","Project Status"::ATP);
                                                                      END;
                                                                    END;

                                                                  Stages::"NOC ATP-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::NATP);
                                                                      VALIDATE("Project Status","Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"NOC ATP-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::NATP);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"NOC ATP-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::NATP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::NATP);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::"NOC ATP":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::NATP);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::NATP);
                                                                        VALIDATE("Project Status","Project Status"::NATP);
                                                                      END;
                                                                    END;
                                                                  Stages::"Gen. Baselining":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::PAT);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::PAT);
                                                                        VALIDATE("Project Status","Project Status"::PAT);
                                                                      END;
                                                                    END;
                                                                  Stages::"PAT-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status","Site Status"::PAT);
                                                                      VALIDATE("Project Status","Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"PAT-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::PAT);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"PAT-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::PAT);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::PAT);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::PAT:
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status","Site Status"::PAT);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status","Site Status"::PAT);
                                                                        VALIDATE("Project Status","Project Status"::PAT);
                                                                      END;
                                                                    END;
                                                                  Stages::"PAC-WIP":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::PAC);
                                                                      VALIDATE("Project Status","Project Status"::WIP);
                                                                    END;
                                                                  // PHP Start
                                                                  // additional DMS stages
                                                                  Stages::"PAC-Cancelled":
                                                                    BEGIN
                                                                      VALIDATE("Site Status", "Site Status"::PAC);
                                                                      VALIDATE("Project Status", "Project Status"::Cancelled);
                                                                    END;
                                                                  Stages::"PAC-WIPCV":
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::PAC);
                                                                        VALIDATE("Project Status", "Project Status"::WIPCV);
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::PAC);
                                                                        VALIDATE("Project Status", "Project Status"::WIPV);
                                                                      END;
                                                                    END;
                                                                  // PHP End
                                                                  Stages::PAC:
                                                                    BEGIN
                                                                      IF WithCustomerIssues THEN BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::PAC);
                                                                        VALIDATE("Project Status","Project Status"::"WIP-CUSTOMER");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Site Status", "Site Status"::PAC);
                                                                        VALIDATE("Project Status","Project Status"::PAC);
                                                                      END;
                                                                    END;
                                                                END;
                                                              END;

                                                   OptionCaptionML=ENU=" ,Survey,TSSR Approved,Dependency Checklist,Transport Test,Installation Progress,Power-Tapping,ATP,NOC ATP,Gen. Baselining,PAT,PAC,Survey-WIP,Dependency Checklist-WIP,PowerPower-Tapping-WIP,ATP-WIP,Installation Progress-WIP,NOC ATP-WIP,PAT-WIP,PAC-WIP,-Cancelled,-WIPCV,Survey-Cancelled,Survey-WIPCV";
                                                   OptionString=[ ,Survey,TSSR Approved,Dependency Checklist,Transport Test,Installation Progress,Power-Tapping,ATP,NOC ATP,Gen. Baselining,PAT,PAC,Survey-WIP,Dependency Checklist-WIP,PowerPower-Tapping-WIP,ATP-WIP,Installation Progress-WIP,NOC ATP-WIP,PAT-WIP,PAC-WIP,-Cancelled,-WIPCV,Survey-Cancelled,Survey-WIPCV,Dependency Checklist-Cancelled,Dependency Checklist-WIPCV,Transport Test-Cancelled,Transport Test-WIPCV,Installation Progress-Cancelled,Installation Progress-WIPCV,Power-Tapping-Cancelled,Power-Tapping-WIPCV,ATP-Cancelled,ATP-WIPCV,NOC ATP-Cancelled,NOC ATP-WIPCV,PAT-Cancelled,PAT-WIPCV,PAC-Cancelled,PAC-WIPCV];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Code,City                               ;Clustered=Yes }
    {    ;City,Code                                }
    {    ;Search City                              }
    {    ;Country/Region Code                      }
    {    ;Entry Type                               }
    {    ;Name                                     }
    {    ;Address                                  }
    {    ;Address 2                                }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;Code,City,Search City,Country/Region Code,County,Name,Address }
    { 2   ;Brick               ;Code,City,County,Country/Region Code     }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=%1 %2 already exists.';
      Issues@1001 : Record 50011;
      DailyDeploymentReport@1002 : Record 50005;
      IncomingDoc@1003 : Record 130;
      ErrMsg001@1004 : TextConst 'ENU=You cannot rename %1 %2 %3 %4 because there is at least one %5 linked to this record.';

    PROCEDURE ValidateCity@5(VAR City@1000 : Text[30];VAR PostCode@1001 : Code[20];VAR County@1006 : Text[30];VAR CountryCode@1005 : Code[10];UseDialog@1007 : Boolean);
    VAR
      PostCodeRec@1002 : Record 225;
      PostCodeRec2@1004 : Record 225;
      SearchCity@1003 : Code[30];
    BEGIN
      IF NOT GUIALLOWED THEN
        EXIT;

      IF City <> '' THEN BEGIN
        SearchCity := City;
        PostCodeRec.SETCURRENTKEY("Search City");
        IF STRPOS(SearchCity,'*') = STRLEN(SearchCity) THEN
          PostCodeRec.SETFILTER("Search City",SearchCity)
        ELSE
          PostCodeRec.SETRANGE("Search City",SearchCity);
        IF NOT PostCodeRec.FINDFIRST THEN
          EXIT;

        IF CountryCode <> '' THEN BEGIN
          PostCodeRec.SETRANGE("Country/Region Code",CountryCode);
          IF NOT PostCodeRec.FINDFIRST THEN
            PostCodeRec.SETRANGE("Country/Region Code");
        END;

        PostCodeRec2.COPY(PostCodeRec);
        IF UseDialog AND (PostCodeRec2.NEXT = 1) THEN
          IF PAGE.RUNMODAL(PAGE::"Post Codes",PostCodeRec,PostCodeRec.Code) <> ACTION::LookupOK THEN
            EXIT;
        PostCode := PostCodeRec.Code;
        City := PostCodeRec.City;
        CountryCode := PostCodeRec."Country/Region Code";
        County := PostCodeRec.County;
      END;
    END;

    PROCEDURE ValidatePostCode@6(VAR City@1001 : Text[30];VAR PostCode@1000 : Code[20];VAR County@1005 : Text[30];VAR CountryCode@1006 : Code[10];UseDialog@1004 : Boolean);
    VAR
      PostCodeRec@1002 : Record 225;
      PostCodeRec2@1003 : Record 225;
    BEGIN
      IF PostCode <> '' THEN BEGIN
        IF STRPOS(PostCode,'*') = STRLEN(PostCode) THEN
          PostCodeRec.SETFILTER(Code,PostCode)
        ELSE
          PostCodeRec.SETRANGE(Code,PostCode);
        IF NOT PostCodeRec.FINDFIRST THEN
          EXIT;

        IF CountryCode <> '' THEN BEGIN
          PostCodeRec.SETRANGE("Country/Region Code",CountryCode);
          IF NOT PostCodeRec.FINDFIRST THEN
            PostCodeRec.SETRANGE("Country/Region Code");
        END;

        PostCodeRec2.COPY(PostCodeRec);
        IF UseDialog AND (PostCodeRec2.NEXT = 1) AND GUIALLOWED THEN
          IF PAGE.RUNMODAL(PAGE::"Post Codes",PostCodeRec,PostCodeRec.Code) <> ACTION::LookupOK THEN
            EXIT;
        PostCode := PostCodeRec.Code;
        City := PostCodeRec.City;
        CountryCode := PostCodeRec."Country/Region Code";
        County := PostCodeRec.County;
      END;
    END;

    LOCAL PROCEDURE WithCustomerIssues@2() : Boolean;
    BEGIN
      Issues.SETRANGE("Post Code",Code);
      Issues.SETRANGE(City, City);
      Issues.SETRANGE(Resolved, FALSE);
      Issues.SETFILTER("Service Order Type No.", '<>''''');
      Issues.SETRANGE("Type of Issue", Issues."Type of Issue"::"Customer Issue");

      EXIT(Issues.FINDFIRST);
    END;

    LOCAL PROCEDURE UpdateDDRCountryRegion@3();
    BEGIN
      // PHP START
      IF "Entry Type" = "Entry Type"::"Project Site Name" THEN BEGIN
        DailyDeploymentReport.SETFILTER("Post Code", Code);
        DailyDeploymentReport.SETFILTER(City, City);
        IF DailyDeploymentReport.FINDSET THEN BEGIN
          REPEAT
            DailyDeploymentReport.VALIDATE("Country/Region Code", "Country/Region Code");
            DailyDeploymentReport.MODIFY(TRUE);
          UNTIL DailyDeploymentReport.NEXT = 0;
        END;
      END;
      // PHP END
    END;

    LOCAL PROCEDURE UpdateIncomingDocumentCountryRegion@8();
    VAR
      IncDocs@1000 : Record 130;
    BEGIN
      // PHP START
      IF "Entry Type" = "Entry Type"::"Project Site Name" THEN BEGIN
        IncDocs.SETRANGE("Post Code",Code);
        IncDocs.SETRANGE(City,City);

        IF IncDocs.FINDSET THEN BEGIN
        REPEAT
          IncDocs."Country/Region Code" := "Country/Region Code";
          IncDocs.MODIFY;
        UNTIL IncDocs.NEXT = 0;
        END;
      END;
      // PHP END
    END;

    PROCEDURE UpdateStage@4(ProjectStage@1000 : Option);
    BEGIN
      VALIDATE(Stages,ProjectStage);
      MODIFY(TRUE);
    END;

    LOCAL PROCEDURE DeleteRelatedRecord@1();
    BEGIN
      // PHP START
      IF "Entry Type" = "Entry Type"::"Project Site Name" THEN BEGIN
        DailyDeploymentReport.SETRANGE("Post Code", Code);
        DailyDeploymentReport.SETRANGE(City, City);
        DailyDeploymentReport.DELETEALL(TRUE);

        IncomingDoc.SETRANGE("Post Code", Code);
        IncomingDoc.SETRANGE(City, City);
        IncomingDoc.DELETEALL(TRUE);
      END;
      // PHP END
    END;

    PROCEDURE InsertPermittingDocsInIncomingDocument@7();
    VAR
      IncomingDocs@1004 : Record 130;
      CheckIncomingDocs@1010 : Record 130;
      RecRef@1003 : RecordRef;
      FieldRef@1002 : FieldRef;
      IncDocEntryNo@1000 : Integer;
      RecClassOptStr@1001 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.String";
      RecClassVals@1006 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Array";
      Separator@1007 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.String";
      Value@1008 : Text;
      DocName@1005 : Text[50];
      i@1009 : Integer;
    BEGIN
      IF IncomingDocs.FINDLAST THEN
        IncDocEntryNo := IncomingDocs."Entry No."
      ELSE
        IncDocEntryNo := 1;

      RecRef.OPEN(DATABASE::"Incoming Document");
      FieldRef := RecRef.FIELD(50500); // Field No of Record Class in Incoming Document Table
      RecClassOptStr := FORMAT(FieldRef.OPTIONSTRING);
      Separator := ',';
      RecClassVals := RecClassOptStr.Split(Separator.ToCharArray);

      FOREACH Value IN RecClassVals DO BEGIN
        IF (i <> 0) AND (i <> 2) THEN BEGIN // Exclude the Blank and RAAWA for the auto generation of Permitting documents
           IncDocEntryNo += 1;
           DocName := Value + ' ' + Code;
           IncomingDocs.INIT;
           IncomingDocs."Entry No." := IncDocEntryNo;
           IncomingDocs."Record Type" := IncomingDocs."Record Type"::Document;
           IncomingDocs.VALIDATE(Description, DocName);
           IncomingDocs."Post Code" := Code;
           IncomingDocs.City := City;
           IncomingDocs."Record Class" := i;
           CASE i OF
            IncomingDocs."Record Class"::TSSR:
              IncomingDocs."TSSR Status":= "TSSR Status"::"Not Yet Submitted by PIE/Surveyor Incharge";
           END;
           IncomingDocs.INSERT(TRUE);
        END;
        i += 1;
      END;
    END;

    PROCEDURE InsertMultiplePermittingDocsInIncomingDocument@9(VAR PostCode@1011 : Record 225);
    VAR
      IncomingDocs@1004 : Record 130;
      CheckPermittingDocs@1010 : Record 130;
      RecRef@1003 : RecordRef;
      FieldRef@1002 : FieldRef;
      IncDocEntryNo@1000 : Integer;
      RecClassOptStr@1001 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.String";
      RecClassVals@1006 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Array";
      Separator@1007 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.String";
      Value@1008 : Text;
      DocName@1005 : Text[50];
      i@1009 : Integer;
      Err001@1012 : TextConst 'ENU=Do you want to manually generate the permitting documents?';
      ProgressBar@1013 : Codeunit 8615;
      Msg001@1014 : TextConst 'ENU=Generating Permitting Document';
    BEGIN
      IF NOT CONFIRM(Err001, FALSE) THEN
        EXIT;

      WITH PostCode DO BEGIN
        PostCode.SETRANGE("Entry Type", PostCode."Entry Type"::"Project Site Name");
        IF PostCode.FINDSET THEN BEGIN
          ProgressBar.Init(PostCode.COUNT, 1,Msg001);
          REPEAT
            i := 0;
            RecRef.OPEN(DATABASE::"Incoming Document");
            FieldRef := RecRef.FIELD(50500); // Field No of Record Class in Incoming Document Table
            RecClassOptStr := FORMAT(FieldRef.OPTIONSTRING);
            Separator := ',';
            RecClassVals := RecClassOptStr.Split(Separator.ToCharArray);
            RecRef.CLOSE;
            IF IncomingDocs.FINDLAST THEN
              IncDocEntryNo := IncomingDocs."Entry No."
            ELSE
              IncDocEntryNo := 1;

            ProgressBar.Update(PostCode.TABLENAME);
            FOREACH Value IN RecClassVals DO BEGIN
              IF (i <> 0) AND (i <> 2) THEN BEGIN // Exclude the Blank and RAAWA for the auto generation of Permitting documents
                CheckPermittingDocs.RESET;
                CheckPermittingDocs.SETRANGE("Post Code", PostCode.Code);
                CheckPermittingDocs.SETRANGE(City, PostCode.City);
                CheckPermittingDocs.SETRANGE("Record Class", i);
                IF NOT CheckPermittingDocs.FINDFIRST THEN BEGIN
                   IncDocEntryNo += 1;
                   DocName := Value + ' ' + PostCode.Code;
                   IncomingDocs.INIT;
                   IncomingDocs."Entry No." := IncDocEntryNo;
                   IncomingDocs."Record Type" := IncomingDocs."Record Type"::Document;
                   IncomingDocs.VALIDATE(Description, DocName);
                   IncomingDocs."Post Code" := PostCode.Code;
                   IncomingDocs.City := PostCode.City;
                   IncomingDocs."Record Class" := i;
                   CASE i OF
                    IncomingDocs."Record Class"::TSSR:
                      IncomingDocs."TSSR Status":= "TSSR Status"::"Not Yet Submitted by PIE/Surveyor Incharge";
                   END;
                   IncomingDocs.INSERT(TRUE);
                END;
              END;
              i += 1;
            END;
          UNTIL PostCode.NEXT = 0;
          ProgressBar.Close;
        END;
      END;
    END;

    BEGIN
    END.
  }
}

