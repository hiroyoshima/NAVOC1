OBJECT Table 1003 Job Planning Line
{
  OBJECT-PROPERTIES
  {
    Date=08/16/18;
    Time=[ 4:42:00 PM];
    Modified=Yes;
    Version List=NAVW19.00.00.49146,NAVOC1.00.02;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               LOCKTABLE;
               GetJob;
               IF Job.Blocked = Job.Blocked::All THEN
                 Job.TestBlocked;
               JobTask.GET("Job No.","Job Task No.");
               JobTask.TESTFIELD("Job Task Type",JobTask."Job Task Type"::Posting);
               InitJobPlanningLine;
               IF Quantity <> 0 THEN
                 UpdateReservation(0);

               IF Job.Blocked = Job.Blocked::Editing THEN
                 Job.TestBlocked;

               // PHP Start
               "Created By" := USERID;
               // PHP End
             END;

    OnModify=BEGIN
               "Last Date Modified" := TODAY;
               "User ID" := USERID;
               "Modified By" := USERID;
               IF ((Quantity <> 0) OR (xRec.Quantity <> 0)) AND ItemExists(xRec."No.") THEN
                 UpdateReservation(0);

               Job.GET("Job No.");
               IF Job.Blocked = Job.Blocked::All THEN
                 Job.TestBlocked;
             END;

    OnDelete=VAR
               JobUsageLink@1000 : Record 1020;
             BEGIN
               ValidateModification(TRUE);
               CheckRelatedJobPlanningLineInvoice;

               IF "Usage Link" THEN BEGIN
                 JobUsageLink.SETRANGE("Job No.","Job No.");
                 JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
                 JobUsageLink.SETRANGE("Line No.","Line No.");
                 IF JobUsageLink.FINDFIRST THEN
                   ERROR(Text007,TABLECAPTION);
               END;

               IF (Quantity <> 0) AND ItemExists("No.") THEN BEGIN
                 JobPlanningLineReserve.DeleteLine(Rec);
                 CALCFIELDS("Reserved Qty. (Base)");
                 TESTFIELD("Reserved Qty. (Base)",0);
               END;

               Job.GET("Job No.");
               IF Job.Blocked = Job.Blocked::All THEN
                 Job.TestBlocked;

               // PHP Start
               Job.TestJobStatus;
               // PHP End


               // IF "Line No." <> 0 THEN BEGIN
               //  JobPlanningLine2.RESET;
               //  JobPlanningLine2.SETRANGE("Job No.", "Job No.");
               //  JobPlanningLine2.SETRANGE("Job Task No.", "Job Task No.");
               //  JobPlanningLine2.SETRANGE("Attached to Line No.", "Line No.");
               //  JobPlanningLine2.SETFILTER("Line No.", '<>%1', "Line No.");
               //  JobPlanningLine2.DELETEALL(TRUE);
               // END;

               // PHP Start
               AutoCalculateFixedCost(TRUE);
               // PHP End
             END;

    OnRename=BEGIN
               ERROR(Text002,FIELDCAPTION("Job No."),FIELDCAPTION("Job Task No."),TABLECAPTION);
             END;

    CaptionML=ENU=Job Planning Line;
    LookupPageID=Page1007;
    DrillDownPageID=Page1007;
  }
  FIELDS
  {
    { 1   ;   ;Line No.            ;Integer       ;CaptionML=ENU=Line No.;
                                                   Editable=No }
    { 2   ;   ;Job No.             ;Code20        ;TableRelation=Job;
                                                   CaptionML=ENU=Job No.;
                                                   NotBlank=Yes }
    { 3   ;   ;Planning Date       ;Date          ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Planning Date" <> "Planning Date");

                                                                VALIDATE("Document Date","Planning Date");
                                                                IF ("Currency Date" = 0D) OR ("Currency Date" = xRec."Planning Date") THEN
                                                                  VALIDATE("Currency Date","Planning Date");
                                                                IF (Type <> Type::Text) AND ("No." <> '') THEN
                                                                  UpdateAllAmounts;
                                                                IF "Planning Date" <> 0D THEN
                                                                  CheckItemAvailable(FIELDNO("Planning Date"));
                                                                IF CurrFieldNo = FIELDNO("Planned Delivery Date") THEN
                                                                  UpdateReservation(CurrFieldNo)
                                                                ELSE
                                                                  UpdateReservation(FIELDNO("Planning Date"));
                                                                "Planned Delivery Date" := "Planning Date";
                                                              END;

                                                   CaptionML=ENU=Planning Date }
    { 4   ;   ;Document No.        ;Code20        ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Document No." <> "Document No.");
                                                              END;

                                                   CaptionML=ENU=Document No. }
    { 5   ;   ;Type                ;Option        ;OnValidate=BEGIN
                                                                ValidateModification(xRec.Type <> Type);

                                                                // PHP Start
                                                                IF "Parent Item  No." <> '' THEN
                                                                  ERROR(ErrMsg001, FIELDCAPTION(Type));

                                                                IF Type <> xRec.Type THEN
                                                                  CLEAR("Cash Advance Account");
                                                                // PHP End
                                                                UpdateReservation(FIELDNO(Type));

                                                                VALIDATE("No.",'');
                                                                IF Type = Type::Item THEN BEGIN
                                                                  GetLocation("Location Code");
                                                                  Location.TESTFIELD("Directed Put-away and Pick",FALSE);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Type;
                                                   OptionCaptionML=ENU=Resource,Item,G/L Account,Text;
                                                   OptionString=Resource,Item,G/L Account,Text }
    { 7   ;   ;No.                 ;Code20        ;TableRelation=IF (Type=CONST(Resource)) Resource
                                                                 ELSE IF (Type=CONST(Item)) Item
                                                                 ELSE IF (Type=CONST(G/L Account)) "G/L Account"
                                                                 ELSE IF (Type=CONST(Text)) "Standard Text";
                                                   OnValidate=BEGIN
                                                                ValidateModification(xRec."No." <> "No.");

                                                                CheckUsageLinkRelations;

                                                                UpdateReservation(FIELDNO("No."));

                                                                // PHP Start
                                                                IF "Parent Item  No." <> '' THEN
                                                                  ERROR(ErrMsg001, FIELDCAPTION("No."));
                                                                // PHP End

                                                                IF ("No." = '') OR ("No." <> xRec."No.") THEN BEGIN
                                                                  Description := '';
                                                                  "Unit of Measure Code" := '';
                                                                  "Qty. per Unit of Measure" := 1;
                                                                  "Variant Code" := '';
                                                                  "Work Type Code" := '';
                                                                  "Gen. Bus. Posting Group" := '';
                                                                  "Gen. Prod. Posting Group" := '';
                                                                  DeleteAmounts;
                                                                  "Cost Factor" := 0;
                                                                  // PHP Start
                                                                  CLEAR("Cash Advance Account");
                                                                  CLEAR(FSA);
                                                                //  IF "Service Type" = "Service Type"::" " THEN
                                                                //    AutoCalculateFixedCost(TRUE);
                                                                  // PHP End
                                                                  IF "No." = '' THEN
                                                                    EXIT;
                                                                END;

                                                                GetJob;
                                                                "Customer Price Group" := Job."Customer Price Group";

                                                                CASE Type OF
                                                                  Type::Resource:
                                                                    BEGIN
                                                                      Res.GET("No.");
                                                                      Res.TESTFIELD(Blocked,FALSE);
                                                                      // PHP Start
                                                                      Res.TESTFIELD("Base Unit of Measure");
                                                                      Res.TESTFIELD("Gen. Prod. Posting Group");
                                                                      Res.TESTFIELD("VAT Prod. Posting Group");
                                                                      VALIDATE(FSA, Res."As-Built Account");
                                                                      // PHP End
                                                                      Description := Res.Name;
                                                                      "Description 2" := Res."Name 2";
                                                                      "Gen. Prod. Posting Group" := Res."Gen. Prod. Posting Group";
                                                                      "Resource Group No." := Res."Resource Group No.";
                                                                      VALIDATE("Unit of Measure Code",Res."Base Unit of Measure");
                                                                    END;
                                                                  Type::Item:
                                                                    BEGIN
                                                                      GetItem;
                                                                      Item.TESTFIELD(Blocked,FALSE);
                                                                      // PHP Start
                                                                      Item.TESTFIELD("Base Unit of Measure");
                                                                      Item.TESTFIELD("Gen. Prod. Posting Group");
                                                                      Item.TESTFIELD("VAT Prod. Posting Group");
                                                                      // PHP End
                                                                      Description := Item.Description;
                                                                      "Description 2" := Item."Description 2";
                                                                      IF Job."Language Code" <> '' THEN
                                                                        GetItemTranslation;
                                                                      "Gen. Prod. Posting Group" := Item."Gen. Prod. Posting Group";
                                                                      VALIDATE("Unit of Measure Code",Item."Base Unit of Measure");
                                                                      // PHP START
                                                                      VALIDATE("Cash Advance Account", Item."Cash Advance Account");
                                                                      VALIDATE("Service Type", Item."Service Type");
                                                                      VALIDATE(FSA, Item."As-Built Account");
                                                                      // PHP END
                                                                      IF "Usage Link" THEN
                                                                        IF Item.Reserve = Item.Reserve::Optional THEN
                                                                          Reserve := Job.Reserve
                                                                        ELSE
                                                                          Reserve := Item.Reserve;
                                                                    END;
                                                                  Type::"G/L Account":
                                                                    BEGIN
                                                                      GLAcc.GET("No.");
                                                                      GLAcc.CheckGLAcc;
                                                                      GLAcc.TESTFIELD("Direct Posting",TRUE);
                                                                      Description := GLAcc.Name;
                                                                      "Gen. Bus. Posting Group" := GLAcc."Gen. Bus. Posting Group";
                                                                      "Gen. Prod. Posting Group" := GLAcc."Gen. Prod. Posting Group";
                                                                      "Unit of Measure Code" := '';
                                                                      "Direct Unit Cost (LCY)" := 0;
                                                                      "Unit Cost (LCY)" := 0;
                                                                      "Unit Price" := 0;
                                                                      // PHP START
                                                                      VALIDATE("Cash Advance Account", GLAcc."CA Account");
                                                                      // PHP END
                                                                    END;
                                                                  Type::Text:
                                                                    BEGIN
                                                                      StdTxt.GET("No.");
                                                                      Description := StdTxt.Description;
                                                                    END;
                                                                END;

                                                                IF Type <> Type::Text THEN
                                                                  VALIDATE(Quantity);
                                                              END;

                                                   CaptionML=ENU=No. }
    { 8   ;   ;Description         ;Text50        ;OnValidate=BEGIN
                                                                ValidateModification(xRec.Description <> Description);
                                                              END;

                                                   CaptionML=ENU=Description }
    { 9   ;   ;Quantity            ;Decimal       ;OnValidate=VAR
                                                                Delta@1000 : Decimal;
                                                                ResCounter@1004 : Integer;
                                                                ResTotalNoToSplit@1003 : Integer;
                                                                ResTotalNoToSplitRemaining@1005 : Integer;
                                                                BaseQtyToSplit@1007 : Integer;
                                                                JobPlanningLines_@1001 : Record 1003;
                                                                Resource_@1002 : Record 156;
                                                                LastPlannedDeliveryDate@1006 : Date;
                                                              BEGIN
                                                                IF "Usage Link" THEN
                                                                  IF NOT BypassQtyValidation THEN BEGIN
                                                                    IF ("Qty. Posted" > 0) AND (Quantity < "Qty. Posted") THEN
                                                                      ERROR(Text005,FIELDCAPTION(Quantity),FIELDCAPTION("Qty. Posted"));
                                                                    IF ("Qty. Posted" < 0) AND (Quantity > "Qty. Posted") THEN
                                                                      ERROR(Text015,FIELDCAPTION(Quantity),FIELDCAPTION("Qty. Posted"));
                                                                  END;

                                                                CALCFIELDS("Qty. Transferred to Invoice");
                                                                IF ("Qty. Transferred to Invoice" > 0) AND (Quantity < "Qty. Transferred to Invoice") THEN
                                                                  ERROR(Text005,FIELDCAPTION(Quantity),FIELDCAPTION("Qty. Transferred to Invoice"));
                                                                IF ("Qty. Transferred to Invoice" < 0) AND (Quantity > "Qty. Transferred to Invoice") THEN
                                                                  ERROR(Text015,FIELDCAPTION(Quantity),FIELDCAPTION("Qty. Transferred to Invoice"));

                                                                CASE Type OF
                                                                  Type::Item:
                                                                    IF NOT Item.GET("No.") THEN
                                                                      ERROR(Text004,Type,Item.FIELDCAPTION("No."));
                                                                  Type::Resource:
                                                                    IF NOT Res.GET("No.") THEN
                                                                      ERROR(Text004,Type,Res.FIELDCAPTION("No."));
                                                                  Type::"G/L Account":
                                                                    IF NOT GLAcc.GET("No.") THEN
                                                                      ERROR(Text004,Type,GLAcc.FIELDCAPTION("No."));
                                                                END;


                                                                "Quantity (Base)" := CalcBaseQty(Quantity);


                                                                // PHP START
                                                                IF (Type = Type::Resource) AND (Quantity <> 0 ) THEN BEGIN
                                                                  GetJob;
                                                                  IF (Job."Automatic Split Resource Qty." = TRUE) AND (Job."Res. Base Unit of Measure" <> '') AND (Job."Res. Base Qty. to Split" > 0)
                                                                    AND (Resource_.GET("No.")) AND (Resource_."Base Unit of Measure" = Job."Res. Base Unit of Measure") THEN BEGIN

                                                                      ResTotalNoToSplit := ROUND("Quantity (Base)",1) DIV Job."Res. Base Qty. to Split";
                                                                      BaseQtyToSplit := Job."Res. Base Qty. to Split";
                                                                      ResTotalNoToSplitRemaining := ROUND("Quantity (Base)",1) MOD Job."Res. Base Qty. to Split";
                                                                      IF (ResTotalNoToSplit >= 1) AND ("Quantity (Base)" > BaseQtyToSplit) THEN BEGIN
                                                                        FOR ResCounter := 1 TO ResTotalNoToSplit DO BEGIN
                                                                          IF ResCounter = 1 THEN BEGIN
                                                                            LastPlannedDeliveryDate := CALCDATE('1D', "Planned Delivery Date");
                                                                          END ELSE BEGIN
                                                                            IF ResCounter = 2 THEN BEGIN
                                                                              LastPlannedDeliveryDate := CALCDATE('0D', LastPlannedDeliveryDate);
                                                                            END ELSE BEGIN
                                                                              LastPlannedDeliveryDate := CALCDATE('1D', LastPlannedDeliveryDate);
                                                                            END;
                                                                            JobPlanningLines_.INIT;
                                                                            JobPlanningLines_."Line No." := SetJobPlanningLineNo;
                                                                            JobPlanningLines_."Job No." := Job."No.";
                                                                            JobPlanningLines_."Line Type" := "Line Type";
                                                                            JobPlanningLines_."Job Task No." := "Job Task No.";
                                                                            JobPlanningLines_.Type := JobPlanningLines_.Type::Resource;
                                                                            JobPlanningLines_.VALIDATE("No.", "No.");
                                                                            JobPlanningLines_.VALIDATE(Quantity, BaseQtyToSplit);
                                                                            JobPlanningLines_.VALIDATE("Planned Delivery Date", LastPlannedDeliveryDate);
                                                                            JobPlanningLines_.VALIDATE("Location Code", "Location Code");
                                                                            JobPlanningLines_.INSERT(TRUE);
                                                                          END;
                                                                        END;
                                                                        IF ResTotalNoToSplitRemaining >= 1 THEN BEGIN
                                                                          IF ResTotalNoToSplit >= 2 THEN
                                                                            LastPlannedDeliveryDate := CALCDATE('1D', LastPlannedDeliveryDate);
                                                                          JobPlanningLines_.INIT;
                                                                          JobPlanningLines_."Line No." := SetJobPlanningLineNo;
                                                                          JobPlanningLines_."Job No." := Job."No.";
                                                                          JobPlanningLines_."Line Type" := "Line Type";
                                                                          JobPlanningLines_."Job Task No." := "Job Task No.";
                                                                          JobPlanningLines_.Type := JobPlanningLines_.Type::Resource;
                                                                          JobPlanningLines_.VALIDATE("No.", "No.");
                                                                          JobPlanningLines_.VALIDATE(Quantity, ResTotalNoToSplitRemaining);
                                                                          JobPlanningLines_.VALIDATE("Planned Delivery Date", LastPlannedDeliveryDate);
                                                                          JobPlanningLines_.VALIDATE("Location Code", "Location Code");
                                                                          JobPlanningLines_.INSERT(TRUE);
                                                                        END;
                                                                      VALIDATE(Quantity, 0);
                                                                      VALIDATE("Unit of Measure Code", Job."Res. Base Unit of Measure");
                                                                      VALIDATE(Quantity, Job."Res. Base Qty. to Split");
                                                                      END;
                                                                  END;
                                                                END;

                                                                IF "Usage Link" AND (xRec."No." = "No.") THEN BEGIN
                                                                  Delta := Quantity - xRec.Quantity;
                                                                  VALIDATE("Remaining Qty.","Remaining Qty." + Delta);
                                                                  VALIDATE("Qty. to Transfer to Journal","Qty. to Transfer to Journal" + Delta);
                                                                END;

                                                                UpdateQtyToTransfer;
                                                                UpdateQtyToInvoice;

                                                                CheckItemAvailable(FIELDNO(Quantity));
                                                                UpdateReservation(FIELDNO(Quantity));

                                                                UpdateAllAmounts;
                                                                BypassQtyValidation := FALSE;

                                                                // PHP Start
                                                                // IF "Service Type" = "Service Type"::" " THEN
                                                                // AutoCalculateFixedCost(FALSE);
                                                                // PHP End
                                                              END;

                                                   CaptionML=ENU=Quantity;
                                                   DecimalPlaces=0:5 }
    { 11  ;   ;Direct Unit Cost (LCY);Decimal     ;CaptionML=ENU=Direct Unit Cost (LCY);
                                                   AutoFormatType=2 }
    { 12  ;   ;Unit Cost (LCY)     ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Unit Cost (LCY)" <> "Unit Cost (LCY)");

                                                                IF (Type = Type::Item) AND
                                                                   Item.GET("No.") AND
                                                                   (Item."Costing Method" = Item."Costing Method"::Standard)
                                                                THEN
                                                                  UpdateAllAmounts
                                                                ELSE BEGIN
                                                                  InitRoundingPrecisions;
                                                                  "Unit Cost" := ROUND(
                                                                      CurrExchRate.ExchangeAmtLCYToFCY(
                                                                        "Currency Date","Currency Code",
                                                                        "Unit Cost (LCY)","Currency Factor"),
                                                                      UnitAmountRoundingPrecisionFCY);
                                                                  UpdateAllAmounts;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Unit Cost (LCY);
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 13  ;   ;Total Cost (LCY)    ;Decimal       ;CaptionML=ENU=Total Cost (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 14  ;   ;Unit Price (LCY)    ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Unit Price (LCY)" <> "Unit Price (LCY)");

                                                                InitRoundingPrecisions;
                                                                "Unit Price" := ROUND(
                                                                    CurrExchRate.ExchangeAmtLCYToFCY(
                                                                      "Currency Date","Currency Code",
                                                                      "Unit Price (LCY)","Currency Factor"),
                                                                    UnitAmountRoundingPrecisionFCY);
                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Unit Price (LCY);
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 15  ;   ;Total Price (LCY)   ;Decimal       ;CaptionML=ENU=Total Price (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 16  ;   ;Resource Group No.  ;Code20        ;TableRelation="Resource Group";
                                                   CaptionML=ENU=Resource Group No.;
                                                   Editable=No }
    { 17  ;   ;Unit of Measure Code;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.))
                                                                 ELSE IF (Type=CONST(Resource)) "Resource Unit of Measure".Code WHERE (Resource No.=FIELD(No.))
                                                                 ELSE "Unit of Measure";
                                                   OnValidate=VAR
                                                                Resource@1000 : Record 156;
                                                              BEGIN
                                                                ValidateModification(xRec."Unit of Measure Code" <> "Unit of Measure Code");

                                                                // PHP Start
                                                                IF "Parent Item  No." <> '' THEN
                                                                  ERROR(ErrMsg001, FIELDCAPTION("Unit of Measure Code"));
                                                                // PHP End

                                                                GetGLSetup;
                                                                CASE Type OF
                                                                  Type::Item:
                                                                    BEGIN
                                                                      Item.GET("No.");
                                                                      "Qty. per Unit of Measure" :=
                                                                        UOMMgt.GetQtyPerUnitOfMeasure(Item,"Unit of Measure Code");
                                                                    END;
                                                                  Type::Resource:
                                                                    BEGIN
                                                                      IF CurrFieldNo <> FIELDNO("Work Type Code") THEN
                                                                        IF "Work Type Code" <> '' THEN BEGIN
                                                                          WorkType.GET("Work Type Code");
                                                                          IF WorkType."Unit of Measure Code" <> '' THEN
                                                                            TESTFIELD("Unit of Measure Code",WorkType."Unit of Measure Code");
                                                                        END ELSE
                                                                          TESTFIELD("Work Type Code",'');
                                                                      IF "Unit of Measure Code" = '' THEN BEGIN
                                                                        Resource.GET("No.");
                                                                        "Unit of Measure Code" := Resource."Base Unit of Measure";
                                                                      END;
                                                                      ResUnitofMeasure.GET("No.","Unit of Measure Code");
                                                                      "Qty. per Unit of Measure" := ResUnitofMeasure."Qty. per Unit of Measure";
                                                                      "Quantity (Base)" := Quantity * "Qty. per Unit of Measure";
                                                                    END;
                                                                  Type::"G/L Account":
                                                                    "Qty. per Unit of Measure" := 1;
                                                                END;
                                                                CheckItemAvailable(FIELDNO("Unit of Measure Code"));
                                                                UpdateReservation(FIELDNO("Unit of Measure Code"));
                                                                VALIDATE(Quantity);
                                                              END;

                                                   CaptionML=ENU=Unit of Measure Code }
    { 20  ;   ;Location Code       ;Code10        ;TableRelation=Location WHERE (Use As In-Transit=CONST(No));
                                                   OnValidate=BEGIN
                                                                ValidateModification(xRec."Location Code" <> "Location Code");

                                                                "Bin Code" := '';
                                                                IF Type = Type::Item THEN BEGIN
                                                                  GetLocation("Location Code");
                                                                  Location.TESTFIELD("Directed Put-away and Pick",FALSE);
                                                                  CheckItemAvailable(FIELDNO("Location Code"));
                                                                  UpdateReservation(FIELDNO("Location Code"));
                                                                  VALIDATE(Quantity);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Location Code }
    { 29  ;   ;Last Date Modified  ;Date          ;CaptionML=ENU=Last Date Modified;
                                                   Editable=No }
    { 30  ;   ;User ID             ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserMgt@1000 : Codeunit 418;
                                                            BEGIN
                                                              UserMgt.LookupUserID("User ID");
                                                            END;

                                                   TestTableRelation=No;
                                                   CaptionML=ENU=User ID;
                                                   Editable=No }
    { 32  ;   ;Work Type Code      ;Code10        ;TableRelation="Work Type";
                                                   OnValidate=BEGIN
                                                                ValidateModification(xRec."Work Type Code" <> "Work Type Code");
                                                                TESTFIELD(Type,Type::Resource);

                                                                VALIDATE("Line Discount %",0);
                                                                IF ("Work Type Code" = '') AND (xRec."Work Type Code" <> '') THEN BEGIN
                                                                  Res.GET("No.");
                                                                  "Unit of Measure Code" := Res."Base Unit of Measure";
                                                                  VALIDATE("Unit of Measure Code");
                                                                END;
                                                                IF WorkType.GET("Work Type Code") THEN
                                                                  IF WorkType."Unit of Measure Code" <> '' THEN BEGIN
                                                                    "Unit of Measure Code" := WorkType."Unit of Measure Code";
                                                                    IF ResUnitofMeasure.GET("No.","Unit of Measure Code") THEN
                                                                      "Qty. per Unit of Measure" := ResUnitofMeasure."Qty. per Unit of Measure";
                                                                  END ELSE BEGIN
                                                                    Res.GET("No.");
                                                                    "Unit of Measure Code" := Res."Base Unit of Measure";
                                                                    VALIDATE("Unit of Measure Code");
                                                                  END;
                                                                VALIDATE(Quantity);
                                                              END;

                                                   CaptionML=ENU=Work Type Code }
    { 33  ;   ;Customer Price Group;Code10        ;TableRelation="Customer Price Group";
                                                   OnValidate=BEGIN
                                                                IF (Type = Type::Item) AND ("No." <> '') THEN
                                                                  UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Customer Price Group }
    { 79  ;   ;Country/Region Code ;Code10        ;TableRelation=Country/Region;
                                                   CaptionML=ENU=Country/Region Code;
                                                   Editable=No }
    { 80  ;   ;Gen. Bus. Posting Group;Code10     ;TableRelation="Gen. Business Posting Group";
                                                   CaptionML=ENU=Gen. Bus. Posting Group;
                                                   Editable=No }
    { 81  ;   ;Gen. Prod. Posting Group;Code10    ;TableRelation="Gen. Product Posting Group";
                                                   CaptionML=ENU=Gen. Prod. Posting Group }
    { 83  ;   ;Document Date       ;Date          ;CaptionML=ENU=Document Date }
    { 1000;   ;Job Task No.        ;Code20        ;TableRelation="Job Task"."Job Task No." WHERE (Job No.=FIELD(Job No.));
                                                   CaptionML=ENU=Job Task No.;
                                                   NotBlank=Yes }
    { 1001;   ;Line Amount (LCY)   ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Line Amount (LCY)" <> "Line Amount (LCY)");

                                                                InitRoundingPrecisions;
                                                                "Line Amount" := ROUND(
                                                                    CurrExchRate.ExchangeAmtLCYToFCY(
                                                                      "Currency Date","Currency Code",
                                                                      "Line Amount (LCY)","Currency Factor"),
                                                                    AmountRoundingPrecisionFCY);
                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Line Amount (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1002;   ;Unit Cost           ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Unit Cost" <> "Unit Cost");

                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Unit Cost;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 1003;   ;Total Cost          ;Decimal       ;CaptionML=ENU=Total Cost;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1004;   ;Unit Price          ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Unit Price" <> "Unit Price");

                                                                UpdateAllAmounts;

                                                                // PHP Start
                                                                // IF "Service Type" = "Service Type"::" " THEN
                                                                // AutoCalculateFixedCost(FALSE);
                                                                // PHP End
                                                              END;

                                                   CaptionML=ENU=Unit Price;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 1005;   ;Total Price         ;Decimal       ;CaptionML=ENU=Total Price;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1006;   ;Line Amount         ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Line Amount" <> "Line Amount");

                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Line Amount;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1007;   ;Line Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Line Discount Amount" <> "Line Discount Amount");

                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Line Discount Amount;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1008;   ;Line Discount Amount (LCY);Decimal ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Line Discount Amount (LCY)" <> "Line Discount Amount (LCY)");

                                                                InitRoundingPrecisions;
                                                                "Line Discount Amount" := ROUND(
                                                                    CurrExchRate.ExchangeAmtLCYToFCY(
                                                                      "Currency Date","Currency Code",
                                                                      "Line Discount Amount (LCY)","Currency Factor"),
                                                                    AmountRoundingPrecisionFCY);
                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Line Discount Amount (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1015;   ;Cost Factor         ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Cost Factor" <> "Cost Factor");

                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Cost Factor;
                                                   Editable=No }
    { 1019;   ;Serial No.          ;Code20        ;CaptionML=ENU=Serial No.;
                                                   Editable=No }
    { 1020;   ;Lot No.             ;Code20        ;CaptionML=ENU=Lot No.;
                                                   Editable=No }
    { 1021;   ;Line Discount %     ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Line Discount %" <> "Line Discount %");

                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Line Discount %;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 1022;   ;Line Type           ;Option        ;OnValidate=BEGIN
                                                                "Schedule Line" := TRUE;
                                                                "Contract Line" := TRUE;
                                                                IF "Line Type" = "Line Type"::Schedule THEN
                                                                  "Contract Line" := FALSE;
                                                                IF "Line Type" = "Line Type"::Contract THEN
                                                                  "Schedule Line" := FALSE;

                                                                IF NOT "Contract Line" AND (("Qty. Transferred to Invoice" <> 0) OR ("Qty. Invoiced" <> 0)) THEN
                                                                  ERROR(Text009,TABLECAPTION,FIELDCAPTION("Line Type"),"Line Type");

                                                                ControlUsageLink;
                                                              END;

                                                   CaptionML=ENU=Line Type;
                                                   OptionCaptionML=ENU=Schedule,Contract,Both Schedule and Contract;
                                                   OptionString=Schedule,Contract,Both Schedule and Contract }
    { 1023;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                ValidateModification(xRec."Currency Code" <> "Currency Code");

                                                                UpdateCurrencyFactor;
                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Currency Code;
                                                   Editable=No }
    { 1024;   ;Currency Date       ;Date          ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Currency Date" <> "Currency Date");

                                                                UpdateCurrencyFactor;
                                                                IF (CurrFieldNo <> FIELDNO("Planning Date")) AND ("No." <> '') THEN
                                                                  UpdateFromCurrency;
                                                              END;

                                                   AccessByPermission=TableData 4=R;
                                                   CaptionML=ENU=Currency Date }
    { 1025;   ;Currency Factor     ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Currency Factor" <> "Currency Factor");

                                                                IF ("Currency Code" = '') AND ("Currency Factor" <> 0) THEN
                                                                  FIELDERROR("Currency Factor",STRSUBSTNO(Text001,FIELDCAPTION("Currency Code")));
                                                                UpdateAllAmounts;
                                                              END;

                                                   CaptionML=ENU=Currency Factor;
                                                   DecimalPlaces=0:15;
                                                   MinValue=0;
                                                   Editable=No }
    { 1026;   ;Schedule Line       ;Boolean       ;InitValue=Yes;
                                                   CaptionML=ENU=Schedule Line;
                                                   Editable=No }
    { 1027;   ;Contract Line       ;Boolean       ;CaptionML=ENU=Contract Line;
                                                   Editable=No }
    { 1030;   ;Job Contract Entry No.;Integer     ;CaptionML=ENU=Job Contract Entry No.;
                                                   Editable=No }
    { 1035;   ;Invoiced Amount (LCY);Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Planning Line Invoice"."Invoiced Amount (LCY)" WHERE (Job No.=FIELD(Job No.),
                                                                                                                              Job Task No.=FIELD(Job Task No.),
                                                                                                                              Job Planning Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Invoiced Amount (LCY);
                                                   Editable=No }
    { 1036;   ;Invoiced Cost Amount (LCY);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Planning Line Invoice"."Invoiced Cost Amount (LCY)" WHERE (Job No.=FIELD(Job No.),
                                                                                                                                   Job Task No.=FIELD(Job Task No.),
                                                                                                                                   Job Planning Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Invoiced Cost Amount (LCY);
                                                   Editable=No }
    { 1037;   ;VAT Unit Price      ;Decimal       ;CaptionML=ENU=VAT Unit Price }
    { 1038;   ;VAT Line Discount Amount;Decimal   ;CaptionML=ENU=VAT Line Discount Amount }
    { 1039;   ;VAT Line Amount     ;Decimal       ;CaptionML=ENU=VAT Line Amount }
    { 1041;   ;VAT %               ;Decimal       ;CaptionML=ENU=VAT % }
    { 1042;   ;Description 2       ;Text50        ;CaptionML=ENU=Description 2 }
    { 1043;   ;Job Ledger Entry No.;Integer       ;TableRelation="Job Ledger Entry";
                                                   CaptionML=ENU=Job Ledger Entry No.;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1048;   ;Status              ;Option        ;InitValue=Order;
                                                   CaptionML=ENU=Status;
                                                   OptionCaptionML=ENU=Planning,Quote,Order,Completed;
                                                   OptionString=Planning,Quote,Order,Completed;
                                                   Editable=No }
    { 1050;   ;Ledger Entry Type   ;Option        ;CaptionML=ENU=Ledger Entry Type;
                                                   OptionCaptionML=ENU=" ,Resource,Item,G/L Account";
                                                   OptionString=[ ,Resource,Item,G/L Account] }
    { 1051;   ;Ledger Entry No.    ;Integer       ;TableRelation=IF (Ledger Entry Type=CONST(Resource)) "Res. Ledger Entry"
                                                                 ELSE IF (Ledger Entry Type=CONST(Item)) "Item Ledger Entry"
                                                                 ELSE IF (Ledger Entry Type=CONST(G/L Account)) "G/L Entry";
                                                   CaptionML=ENU=Ledger Entry No.;
                                                   BlankZero=Yes }
    { 1052;   ;System-Created Entry;Boolean       ;CaptionML=ENU=System-Created Entry }
    { 1053;   ;Usage Link          ;Boolean       ;OnValidate=BEGIN
                                                                IF "Usage Link" AND ("Line Type" = "Line Type"::Contract) THEN
                                                                  ERROR(Text014,FIELDCAPTION("Usage Link"),TABLECAPTION,FIELDCAPTION("Line Type"),"Line Type");

                                                                ControlUsageLink;

                                                                CheckItemAvailable(FIELDNO("Usage Link"));
                                                                UpdateReservation(FIELDNO("Usage Link"));
                                                              END;

                                                   CaptionML=ENU=Usage Link }
    { 1060;   ;Remaining Qty.      ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Remaining Qty. (Base)",CalcBaseQty("Remaining Qty."));
                                                              END;

                                                   CaptionML=ENU=Remaining Qty.;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1061;   ;Remaining Qty. (Base);Decimal      ;CaptionML=ENU=Remaining Qty. (Base);
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1062;   ;Remaining Total Cost;Decimal       ;CaptionML=ENU=Remaining Total Cost;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1063;   ;Remaining Total Cost (LCY);Decimal ;CaptionML=ENU=Remaining Total Cost (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1064;   ;Remaining Line Amount;Decimal      ;CaptionML=ENU=Remaining Line Amount;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1065;   ;Remaining Line Amount (LCY);Decimal;CaptionML=ENU=Remaining Line Amount (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1070;   ;Qty. Posted         ;Decimal       ;CaptionML=ENU=Qty. Posted;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1071;   ;Qty. to Transfer to Journal;Decimal;OnValidate=BEGIN
                                                                // PHP Start - Limit user to transfer to journal Qty to Transfer to Journal is more than the Qty.
                                                                IF "Qty. to Transfer to Journal" = 0 THEN
                                                                  EXIT;
                                                                // IF Quantity = "Qty. Posted" THEN
                                                                //  ERROR(ErrMsg003, "Line No.");

                                                                IF ("Qty. to Transfer to Journal" > (Quantity - "Qty. Posted")) THEN
                                                                  ERROR(Text015,FIELDCAPTION("Qty. to Transfer to Journal"),Quantity - "Qty. Posted");

                                                                // IF(Quantity + "Qty. to Transfer to Journal" + "Qty. Posted") < Quantity THEN
                                                                //   ERROR(Text010,FIELDCAPTION("Qty. to Transfer to Journal"),(-1 * "Qty. Posted"),(-1 * "Qty. Posted"));
                                                                // PHP End
                                                              END;

                                                   CaptionML=ENU=Qty. to Transfer to Journal;
                                                   DecimalPlaces=0:5 }
    { 1072;   ;Posted Total Cost   ;Decimal       ;CaptionML=ENU=Posted Total Cost;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1073;   ;Posted Total Cost (LCY);Decimal    ;CaptionML=ENU=Posted Total Cost (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1074;   ;Posted Line Amount  ;Decimal       ;CaptionML=ENU=Posted Line Amount;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 1075;   ;Posted Line Amount (LCY);Decimal   ;CaptionML=ENU=Posted Line Amount (LCY);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1080;   ;Qty. Transferred to Invoice;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Planning Line Invoice"."Quantity Transferred" WHERE (Job No.=FIELD(Job No.),
                                                                                                                             Job Task No.=FIELD(Job Task No.),
                                                                                                                             Job Planning Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Qty. Transferred to Invoice;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1081;   ;Qty. to Transfer to Invoice;Decimal;OnValidate=BEGIN
                                                                IF "Qty. to Transfer to Invoice" = 0 THEN
                                                                  EXIT;

                                                                IF "Contract Line" THEN BEGIN
                                                                  IF Quantity = "Qty. Transferred to Invoice" THEN
                                                                    ERROR(Text013,TABLECAPTION);

                                                                  IF Quantity > 0 THEN BEGIN
                                                                    IF ("Qty. to Transfer to Invoice" > 0) AND ("Qty. to Transfer to Invoice" > (Quantity - "Qty. Transferred to Invoice")) OR
                                                                       ("Qty. to Transfer to Invoice" < 0)
                                                                    THEN
                                                                      ERROR(Text010,FIELDCAPTION("Qty. to Transfer to Invoice"),0,Quantity - "Qty. Transferred to Invoice");
                                                                  END ELSE BEGIN
                                                                    IF ("Qty. to Transfer to Invoice" > 0) OR
                                                                       ("Qty. to Transfer to Invoice" < 0) AND ("Qty. to Transfer to Invoice" < (Quantity - "Qty. Transferred to Invoice"))
                                                                    THEN
                                                                      ERROR(Text010,FIELDCAPTION("Qty. to Transfer to Invoice"),Quantity - "Qty. Transferred to Invoice",0);
                                                                  END;
                                                                END ELSE
                                                                  ERROR(Text012,FIELDCAPTION("Qty. to Transfer to Invoice"),TABLECAPTION,"Line Type");
                                                              END;

                                                   CaptionML=ENU=Qty. to Transfer to Invoice;
                                                   DecimalPlaces=0:5 }
    { 1090;   ;Qty. Invoiced       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Planning Line Invoice"."Quantity Transferred" WHERE (Job No.=FIELD(Job No.),
                                                                                                                             Job Task No.=FIELD(Job Task No.),
                                                                                                                             Job Planning Line No.=FIELD(Line No.),
                                                                                                                             Document Type=FILTER(Posted Invoice|Posted Credit Memo)));
                                                   CaptionML=ENU=Qty. Invoiced;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1091;   ;Qty. to Invoice     ;Decimal       ;CaptionML=ENU=Qty. to Invoice;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1100;   ;Reserved Quantity   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Reservation Entry".Quantity WHERE (Source Type=CONST(1003),
                                                                                                        Source Subtype=FIELD(Status),
                                                                                                        Source ID=FIELD(Job No.),
                                                                                                        Source Ref. No.=FIELD(Job Contract Entry No.),
                                                                                                        Reservation Status=CONST(Reservation)));
                                                   AccessByPermission=TableData 27=R;
                                                   CaptionML=ENU=Reserved Quantity;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1101;   ;Reserved Qty. (Base);Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Reservation Entry"."Quantity (Base)" WHERE (Source Type=CONST(1003),
                                                                                                                 Source Subtype=FIELD(Status),
                                                                                                                 Source ID=FIELD(Job No.),
                                                                                                                 Source Ref. No.=FIELD(Job Contract Entry No.),
                                                                                                                 Reservation Status=CONST(Reservation)));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure");
                                                                UpdatePlanned;
                                                              END;

                                                   AccessByPermission=TableData 27=R;
                                                   CaptionML=ENU=Reserved Qty. (Base);
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1102;   ;Reserve             ;Option        ;OnValidate=BEGIN
                                                                IF Reserve <> Reserve::Never THEN BEGIN
                                                                  TESTFIELD(Type,Type::Item);
                                                                  TESTFIELD("No.");
                                                                  TESTFIELD("Usage Link");
                                                                END;
                                                                CALCFIELDS("Reserved Qty. (Base)");
                                                                IF (Reserve = Reserve::Never) AND ("Reserved Qty. (Base)" > 0) THEN
                                                                  TESTFIELD("Reserved Qty. (Base)",0);

                                                                IF xRec.Reserve = Reserve::Always THEN BEGIN
                                                                  GetItem;
                                                                  IF Item.Reserve = Item.Reserve::Always THEN
                                                                    TESTFIELD(Reserve,Reserve::Always);
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 27=R;
                                                   CaptionML=ENU=Reserve;
                                                   OptionCaptionML=ENU=Never,Optional,Always;
                                                   OptionString=Never,Optional,Always }
    { 1103;   ;Planned             ;Boolean       ;CaptionML=ENU=Planned;
                                                   Editable=No }
    { 5402;   ;Variant Code        ;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Variant".Code WHERE (Item No.=FIELD(No.));
                                                   OnValidate=BEGIN
                                                                ValidateModification(xRec."Variant Code" <> "Variant Code");

                                                                IF "Variant Code" = '' THEN BEGIN
                                                                  IF Type = Type::Item THEN BEGIN
                                                                    Item.GET("No.");
                                                                    Description := Item.Description;
                                                                    "Description 2" := Item."Description 2";
                                                                    GetItemTranslation;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  TESTFIELD(Type,Type::Item);

                                                                  ItemVariant.GET("No.","Variant Code");
                                                                  Description := ItemVariant.Description;
                                                                  "Description 2" := ItemVariant."Description 2";
                                                                END;
                                                                VALIDATE(Quantity);
                                                                CheckItemAvailable(FIELDNO("Variant Code"));
                                                                UpdateReservation(FIELDNO("Variant Code"));
                                                              END;

                                                   CaptionML=ENU=Variant Code }
    { 5403;   ;Bin Code            ;Code20        ;TableRelation=Bin.Code WHERE (Location Code=FIELD(Location Code));
                                                   OnValidate=BEGIN
                                                                ValidateModification(xRec."Bin Code" <> "Bin Code");

                                                                TESTFIELD("Location Code");
                                                                CheckItemAvailable(FIELDNO("Bin Code"));
                                                                UpdateReservation(FIELDNO("Bin Code"));
                                                              END;

                                                   CaptionML=ENU=Bin Code }
    { 5404;   ;Qty. per Unit of Measure;Decimal   ;InitValue=1;
                                                   CaptionML=ENU=Qty. per Unit of Measure;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5410;   ;Quantity (Base)     ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE(Quantity,"Quantity (Base)");
                                                              END;

                                                   CaptionML=ENU=Quantity (Base);
                                                   DecimalPlaces=0:5 }
    { 5790;   ;Requested Delivery Date;Date       ;OnValidate=BEGIN
                                                                IF ("Requested Delivery Date" <> xRec."Requested Delivery Date") AND
                                                                   ("Promised Delivery Date" <> 0D)
                                                                THEN
                                                                  ERROR(
                                                                    Text028,
                                                                    FIELDCAPTION("Requested Delivery Date"),
                                                                    FIELDCAPTION("Promised Delivery Date"));

                                                                IF "Requested Delivery Date" <> 0D THEN
                                                                  VALIDATE("Planned Delivery Date","Requested Delivery Date")
                                                              END;

                                                   CaptionML=ENU=Requested Delivery Date }
    { 5791;   ;Promised Delivery Date;Date        ;OnValidate=BEGIN
                                                                IF "Promised Delivery Date" <> 0D THEN
                                                                  VALIDATE("Planned Delivery Date","Promised Delivery Date")
                                                                ELSE
                                                                  VALIDATE("Requested Delivery Date");
                                                              END;

                                                   CaptionML=ENU=Promised Delivery Date }
    { 5794;   ;Planned Delivery Date;Date         ;OnValidate=BEGIN
                                                                VALIDATE("Planning Date","Planned Delivery Date");
                                                              END;

                                                   CaptionML=ENU=Planned Delivery Date }
    { 5900;   ;Service Order No.   ;Code20        ;CaptionML=ENU=Service Order No. }
    { 5901;   ;Created By          ;Text50        ;Description=JOB01;
                                                   Editable=No }
    { 5902;   ;Modified By         ;Text50        ;Description=JOB01;
                                                   Editable=No }
    { 5903;   ;Vendor No.          ;Code20        ;TableRelation=IF (Type=CONST(Item)) Vendor
                                                                 ELSE IF (Type=CONST(G/L Account)) Vendor }
    { 5904;   ;Vendor Name         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor No.)));
                                                   Editable=No }
    { 50050;  ;Part No.            ;Code50        ;TableRelation=IF (Type=CONST(Item)) "Item Cross Reference".Description WHERE (Item No.=FIELD(No.));
                                                   ValidateTableRelation=Yes }
    { 50055;  ;Attached to Line No.;Integer        }
    { 50060;  ;Resource Group Name ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource Group".Name WHERE (No.=FIELD(Resource Group No.)));
                                                   Editable=No }
    { 50065;  ;Parent Item  No.    ;Code20        ;TableRelation=Item;
                                                   Editable=No }
    { 50066;  ;FSA                 ;Boolean       ;Description=As Built Account;
                                                   Editable=No }
    { 50069;  ;Job Description     ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Job No.)));
                                                   Editable=No }
    { 50070;  ;Job Task            ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Job Task".Description WHERE (Job No.=FIELD(Job No.),
                                                                                                    Job Task No.=FIELD(Job Task No.)));
                                                   Editable=No }
    { 50075;  ;Cash Advance Account;Boolean       ;Editable=No }
    { 50080;  ;Service Type        ;Option        ;OptionCaptionML=ENU=" ,Cash Advance,OSP As Built Account,Request for Payment Account,Fixed Cost,Variable Cost,Communication Account,OSP Inhouse Benefits Account,Backroom Support";
                                                   OptionString=[ ,Cash Advance,OSP As Built Account,Request for Payment Account,Fixed Cost,Variable Cost,Communication Account,OSP Inhouse Benefits Account,Backroom Support];
                                                   Description=Part of Item }
    { 50090;  ;Job Posting Group ID;Code10        ;TableRelation="Job Posting Group" }
    { 50100;  ;Communication Cost  ;Decimal       ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Communication Cost" <> "Communication Cost");

                                                                UpdateAllAmounts;
                                                              END;

                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 50105;  ;Total Communication Cost;Decimal   ;Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 50130;  ;Backroom Support Cost;Decimal      ;OnValidate=BEGIN
                                                                ValidateModification(xRec."Backroom Support Cost" <> "Backroom Support Cost");

                                                                UpdateAllAmounts;
                                                              END;

                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 50135;  ;Total Backroom Support Cost;Decimal;Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 50140;  ;In-House Benefits Cost;Decimal     ;OnValidate=BEGIN
                                                                ValidateModification(xRec."In-House Benefits Cost" <> "In-House Benefits Cost");

                                                                UpdateAllAmounts;
                                                              END;

                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 50145;  ;Total In-House Benefits Cost;Decimal;
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
  }
  KEYS
  {
    {    ;Job No.,Job Task No.,Line No.           ;Clustered=Yes }
    {    ;Job No.,Job Task No.,Schedule Line,Planning Date;
                                                   SumIndexFields=Total Price (LCY),Total Cost (LCY),Line Amount (LCY),Remaining Total Cost (LCY),Remaining Line Amount (LCY) }
    {    ;Job No.,Job Task No.,Contract Line,Planning Date;
                                                   SumIndexFields=Line Amount (LCY),Total Price (LCY),Total Cost (LCY) }
    {    ;Job No.,Job Task No.,Schedule Line,Currency Date }
    {    ;Job No.,Job Task No.,Contract Line,Currency Date }
    {    ;Job No.,Schedule Line,Type,No.,Planning Date;
                                                   SumIndexFields=Quantity (Base) }
    {    ;Job No.,Schedule Line,Type,Resource Group No.,Planning Date;
                                                   SumIndexFields=Quantity (Base) }
    {    ;Status,Schedule Line,Type,No.,Planning Date;
                                                   SumIndexFields=Quantity (Base) }
    {    ;Status,Schedule Line,Type,Resource Group No.,Planning Date;
                                                   SumIndexFields=Quantity (Base) }
    {    ;Job No.,Contract Line                    }
    {    ;Job Contract Entry No.                   }
    {    ;Type,No.,Job No.,Job Task No.,Usage Link,System-Created Entry }
    {    ;Status,Type,No.,Variant Code,Location Code,Planning Date;
                                                   SumIndexFields=Remaining Qty. (Base) }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      GLAcc@1018 : Record 15;
      Location@1013 : Record 14;
      Item@1014 : Record 27;
      JobTask@1001 : Record 1001;
      ItemVariant@1004 : Record 5401;
      Res@1006 : Record 156;
      ResCost@1007 : Record 202;
      WorkType@1009 : Record 200;
      Job@1002 : Record 167;
      ResUnitofMeasure@1010 : Record 205;
      CurrExchRate@1025 : Record 330;
      SKU@1022 : Record 5700;
      StdTxt@1030 : Record 7;
      ItemTranslation@1032 : Record 30;
      GLSetup@1015 : Record 98;
      UserSetup@1042 : Record 91;
      JobPlanningLine@1045 : Record 1003;
      JobPlanningLine2@1046 : Record 1003;
      JobsSetup@1051 : Record 315;
      JobPlanningLineReserve@1011 : Codeunit 1032;
      UOMMgt@1017 : Codeunit 5402;
      ResFindUnitCost@1008 : Codeunit 220;
      ItemCheckAvail@1012 : Codeunit 311;
      Text001@1020 : TextConst 'ENU=cannot be specified without %1';
      Text002@1024 : TextConst 'ENU=You cannot change the %1 or %2 of this %3.';
      JobManagement@1044 : Codeunit 50572;
      CurrencyDate@1023 : Date;
      Text004@1031 : TextConst 'ENU=You must specify %1 %2 in planning line.';
      HasGotGLSetup@1016 : Boolean;
      UnitAmountRoundingPrecision@1019 : Decimal;
      AmountRoundingPrecision@1028 : Decimal;
      Text005@1027 : TextConst 'ENU=%1 cannot be less than %2.';
      Text006@1029 : TextConst 'ENU=The %1 must be a %2 and %3 must be enabled, because linked Job Ledger Entries exist.';
      Text007@1034 : TextConst 'ENU=This %1 cannot be deleted because linked job ledger entries exist.';
      BypassQtyValidation@1035 : Boolean;
      Text008@1033 : TextConst 'ENU=You cannot change this value because linked job ledger entries exist.';
      Text009@1003 : TextConst '@@@=The Job Planning Line cannot be of Line Type Schedule, because it is transferred to an invoice.;ENU=The %1 cannot be of %2 %3 because it is transferred to an invoice.';
      Text010@1005 : TextConst 'ENU=%1 may not be lower than %2 and may not exceed %3.';
      Text011@1040 : TextConst 'ENU=Automatic reservation is not possible.\Do you want to reserve items manually?';
      Text012@1021 : TextConst 'ENU=%1 cannot be set on a %2 of type %3.';
      Text013@1038 : TextConst 'ENU=The %1 has already been completely transferred.';
      Text014@1039 : TextConst '@@@=Usage Link cannot be enabled on a Job Planning Line with Line Type Schedule;ENU=%1 cannot be enabled on a %2 with %3 %4.';
      Text015@1041 : TextConst 'ENU=%1 cannot be higher than %2.';
      Text028@1026 : TextConst 'ENU=You cannot change the %1 when the %2 has been filled in.';
      UnitAmountRoundingPrecisionFCY@1036 : Decimal;
      AmountRoundingPrecisionFCY@1037 : Decimal;
      NotPossibleJobPlanningLineErr@1000 : TextConst 'ENU=It is not possible to deleted job planning line transferred to an invoice.';
      AccessDeniedMsg@1043 : TextConst 'ENU=You are not autorized to modify the %1.';
      ErrMsg001@1047 : TextConst 'ENU=You''re not allowed to modify the %1 when assembly BOM is implemented.';
      ErrMsg002@1048 : TextConst 'ENU=You''re not allowed to delete %1 %2  when assembly BOM is implemented.';
      ErrMsg003@1049 : TextConst 'ENU=The %1 has already been completely posted.';
      Msg001@1050 : TextConst 'ENU=Cash Advance Account has been successfully updated.';

    LOCAL PROCEDURE CalcBaseQty@14(Qty@1000 : Decimal) : Decimal;
    BEGIN
      TESTFIELD("Qty. per Unit of Measure");
      EXIT(ROUND(Qty * "Qty. per Unit of Measure",0.00001));
    END;

    LOCAL PROCEDURE CheckItemAvailable@5(CalledByFieldNo@1000 : Integer);
    BEGIN
      IF CurrFieldNo <> CalledByFieldNo THEN
        EXIT;
      IF Reserve = Reserve::Always THEN
        EXIT;
      IF (Type <> Type::Item) OR ("No." = '') THEN
        EXIT;
      IF Quantity <= 0 THEN
        EXIT;
      IF NOT (Status IN [Status::Order]) THEN
        EXIT;

      IF ItemCheckAvail.JobPlanningLineCheck(Rec) THEN
        ItemCheckAvail.RaiseUpdateInterruptedError;
    END;

    LOCAL PROCEDURE GetLocation@7300(LocationCode@1000 : Code[10]);
    BEGIN
      IF LocationCode = '' THEN
        CLEAR(Location)
      ELSE
        IF Location.Code <> LocationCode THEN
          Location.GET(LocationCode);
    END;

    LOCAL PROCEDURE GetJob@2();
    BEGIN
      IF ("Job No." <> Job."No.") AND ("Job No." <> '') THEN
        Job.GET("Job No.");
    END;

    PROCEDURE UpdateCurrencyFactor@17();
    BEGIN
      IF "Currency Code" <> '' THEN BEGIN
        IF "Currency Date" = 0D THEN
          CurrencyDate := WORKDATE
        ELSE
          CurrencyDate := "Currency Date";
        "Currency Factor" := CurrExchRate.ExchangeRate(CurrencyDate,"Currency Code");
      END ELSE
        "Currency Factor" := 0;
    END;

    LOCAL PROCEDURE ItemExists@54(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      Item2@1001 : Record 27;
    BEGIN
      IF Type = Type::Item THEN
        IF NOT Item2.GET(ItemNo) THEN
          EXIT(FALSE);
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetItem@19();
    BEGIN
      IF "No." <> Item."No." THEN
        IF NOT Item.GET("No.") THEN
          CLEAR(Item);
    END;

    LOCAL PROCEDURE GetSKU@5806() : Boolean;
    BEGIN
      IF (SKU."Location Code" = "Location Code") AND
         (SKU."Item No." = "No.") AND
         (SKU."Variant Code" = "Variant Code")
      THEN
        EXIT(TRUE);

      IF SKU.GET("Location Code","No.","Variant Code") THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE InitRoundingPrecisions@23();
    VAR
      Currency@1000 : Record 4;
    BEGIN
      IF (AmountRoundingPrecision = 0) OR
         (UnitAmountRoundingPrecision = 0) OR
         (AmountRoundingPrecisionFCY = 0) OR
         (UnitAmountRoundingPrecisionFCY = 0)
      THEN BEGIN
        CLEAR(Currency);
        Currency.InitRoundingPrecision;
        AmountRoundingPrecision := Currency."Amount Rounding Precision";
        UnitAmountRoundingPrecision := Currency."Unit-Amount Rounding Precision";

        IF "Currency Code" <> '' THEN BEGIN
          Currency.GET("Currency Code");
          Currency.TESTFIELD("Amount Rounding Precision");
          Currency.TESTFIELD("Unit-Amount Rounding Precision");
        END;

        AmountRoundingPrecisionFCY := Currency."Amount Rounding Precision";
        UnitAmountRoundingPrecisionFCY := Currency."Unit-Amount Rounding Precision";
      END;
    END;

    PROCEDURE Caption@8() : Text[250];
    VAR
      Job@1000 : Record 167;
      JobTask@1001 : Record 1001;
    BEGIN
      IF NOT Job.GET("Job No.") THEN
        EXIT('');
      IF NOT JobTask.GET("Job No.","Job Task No.") THEN
        EXIT('');
      EXIT(STRSUBSTNO('%1 %2 %3 %4',
          Job."No.",
          Job.Description,
          JobTask."Job Task No.",
          JobTask.Description));
    END;

    PROCEDURE SetUpNewLine@9(LastJobPlanningLine@1000 : Record 1003);
    BEGIN
      "Document Date" := LastJobPlanningLine."Planning Date";
      "Document No." := LastJobPlanningLine."Document No.";
      Type := LastJobPlanningLine.Type;
      VALIDATE("Line Type",LastJobPlanningLine."Line Type");
      GetJob;
      "Currency Code" := Job."Currency Code";
      UpdateCurrencyFactor;
      IF LastJobPlanningLine."Planning Date" <> 0D THEN
        VALIDATE("Planning Date",LastJobPlanningLine."Planning Date");
    END;

    PROCEDURE InitJobPlanningLine@4();
    VAR
      JobJnlManagement@1000 : Codeunit 1020;
    BEGIN
      GetJob;
      IF "Planning Date" = 0D THEN
        VALIDATE("Planning Date",WORKDATE);
      "Currency Code" := Job."Currency Code";
      UpdateCurrencyFactor;
      "VAT Unit Price" := 0;
      "VAT Line Discount Amount" := 0;
      "VAT Line Amount" := 0;
      "VAT %" := 0;
      "Job Contract Entry No." := JobJnlManagement.GetNextEntryNo;
      "User ID" := USERID;
      "Last Date Modified" := 0D;
      Status := Job.Status;
      ControlUsageLink;
    END;

    LOCAL PROCEDURE DeleteAmounts@10();
    BEGIN
      Quantity := 0;
      "Quantity (Base)" := 0;

      "Direct Unit Cost (LCY)" := 0;
      "Unit Cost (LCY)" := 0;
      "Unit Cost" := 0;

      "Total Cost (LCY)" := 0;
      "Total Cost" := 0;

      "Unit Price (LCY)" := 0;
      "Unit Price" := 0;

      "Total Price (LCY)" := 0;
      "Total Price" := 0;

      "Line Amount (LCY)" := 0;
      "Line Amount" := 0;

      "Line Discount %" := 0;

      "Line Discount Amount (LCY)" := 0;
      "Line Discount Amount" := 0;

      "Remaining Qty." := 0;
      "Remaining Qty. (Base)" := 0;
      "Remaining Total Cost" := 0;
      "Remaining Total Cost (LCY)" := 0;
      "Remaining Line Amount" := 0;
      "Remaining Line Amount (LCY)" := 0;

      "Qty. Posted" := 0;
      "Qty. to Transfer to Journal" := 0;
      "Posted Total Cost" := 0;
      "Posted Total Cost (LCY)" := 0;
      "Posted Line Amount" := 0;
      "Posted Line Amount (LCY)" := 0;

      "Qty. to Transfer to Invoice" := 0;
      "Qty. to Invoice" := 0;

      // PHP Start
      "Communication Cost" := 0;
      "Total Communication Cost" := 0;

      "Backroom Support Cost" := 0;
      "Total Backroom Support Cost" := 0;

      "In-House Benefits Cost" := 0;
      "Total In-House Benefits Cost" := 0;

      IF "Service Type" = "Service Type"::" " THEN
        AutoCalculateFixedCost(TRUE);
      // PHP End
    END;

    LOCAL PROCEDURE UpdateFromCurrency@1();
    BEGIN
      UpdateAllAmounts;
    END;

    LOCAL PROCEDURE GetItemTranslation@42();
    BEGIN
      GetJob;
      IF ItemTranslation.GET("No.","Variant Code",Job."Language Code") THEN BEGIN
        Description := ItemTranslation.Description;
        "Description 2" := ItemTranslation."Description 2";
      END;
    END;

    LOCAL PROCEDURE GetGLSetup@6();
    BEGIN
      IF HasGotGLSetup THEN
        EXIT;
      GLSetup.GET;
      HasGotGLSetup := TRUE;
    END;

    PROCEDURE UpdateAllAmounts@11();
    BEGIN
      InitRoundingPrecisions;

      UpdateUnitCost;
      UpdateTotalCost;
      FindPriceAndDiscount(Rec,CurrFieldNo);
      HandleCostFactor;
      UpdateUnitPrice;
      UpdateTotalPrice;
      UpdateAmountsAndDiscounts;
      UpdateRemainingCostsAndAmounts;
      // PHP Start
      IF "Service Type" = "Service Type"::" " THEN
        AutoCalculateFixedCost(FALSE);
      // PHP End
      IF Type = Type::Text THEN
        FIELDERROR(Type);
    END;

    LOCAL PROCEDURE UpdateUnitCost@20();
    VAR
      RetrievedCost@1000 : Decimal;
      RetrievedCommunicationCost@1001 : Decimal;
      RetrievedBackroomSupportCost@1003 : Decimal;
      RetrievedInHouseBenefitsCost@1004 : Decimal;
    BEGIN
      GetJob;
      IF (Type = Type::Item) AND Item.GET("No.") THEN BEGIN
        IF Item."Costing Method" = Item."Costing Method"::Standard THEN BEGIN
          IF RetrieveCostPrice THEN BEGIN
            IF GetSKU THEN
              "Unit Cost (LCY)" := ROUND(SKU."Unit Cost" * "Qty. per Unit of Measure",UnitAmountRoundingPrecision)
            ELSE
              "Unit Cost (LCY)" := ROUND(Item."Unit Cost" * "Qty. per Unit of Measure",UnitAmountRoundingPrecision);
            "Unit Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  "Unit Cost (LCY)","Currency Factor"),
                UnitAmountRoundingPrecisionFCY);
          END ELSE
            RecalculateAmounts(Job."Exch. Calculation (Cost)",xRec."Unit Cost","Unit Cost","Unit Cost (LCY)");
        END ELSE BEGIN
          IF RetrieveCostPrice THEN BEGIN
            IF GetSKU THEN
              RetrievedCost := SKU."Unit Cost" * "Qty. per Unit of Measure"
            ELSE
              RetrievedCost := Item."Unit Cost" * "Qty. per Unit of Measure";
            "Unit Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);
            "Unit Cost (LCY)" := ROUND(RetrievedCost,UnitAmountRoundingPrecision);
            JobManagement.SetUnitCostToZeroBOQ(Rec); // PHP Start Remove the auto fill in of Unit Cost
            // PHP END
          END ELSE
            RecalculateAmounts(Job."Exch. Calculation (Cost)",xRec."Unit Cost","Unit Cost","Unit Cost (LCY)");

        END;
      END ELSE
        IF (Type = Type::Resource) AND Res.GET("No.") THEN BEGIN
          IF RetrieveCostPrice THEN BEGIN
            ResCost.INIT;
            ResCost.Code := "No.";
            ResCost."Work Type Code" := "Work Type Code";
            ResFindUnitCost.RUN(ResCost);
            "Direct Unit Cost (LCY)" := ROUND(ResCost."Direct Unit Cost" * "Qty. per Unit of Measure",UnitAmountRoundingPrecision);
            RetrievedCost := ResCost."Unit Cost" * "Qty. per Unit of Measure";
            // PHP Start
            RetrievedCommunicationCost := Res."Communication Cost" * "Qty. per Unit of Measure";
            RetrievedBackroomSupportCost := RetrievedCost * (Res."Backroom Suport %" / 100);
            RetrievedInHouseBenefitsCost := RetrievedCost * (Res."In-House Personnel Benefits %" / 100);
            // PHP End
            "Unit Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);
            // PHP Start
            "Communication Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedCommunicationCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);

            "Backroom Support Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedBackroomSupportCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);

            "In-House Benefits Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedInHouseBenefitsCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);
            // PHP End
            "Unit Cost (LCY)" := ROUND(RetrievedCost,UnitAmountRoundingPrecision);
            JobManagement.SetUnitCostToZeroBOQ(Rec); // PHP Start Remove the auto fill in of Unit Cost
          END ELSE BEGIN
            // PHP Start Update Backroom Support Unit Cost
            RetrievedBackroomSupportCost := "Unit Cost" * (Res."Backroom Suport %" / 100);
            "Backroom Support Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedBackroomSupportCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);

            RetrievedInHouseBenefitsCost := "Unit Cost" * (Res."In-House Personnel Benefits %" / 100);
            "In-House Benefits Cost" := ROUND(
                CurrExchRate.ExchangeAmtLCYToFCY(
                  "Currency Date","Currency Code",
                  RetrievedInHouseBenefitsCost,"Currency Factor"),
                UnitAmountRoundingPrecisionFCY);
            JobManagement.SetUnitCostToZeroBOQ(Rec); // PHP Start Remove the auto fill in of Unit Cost
            // PHP End
            RecalculateAmounts(Job."Exch. Calculation (Cost)",xRec."Unit Cost","Unit Cost","Unit Cost (LCY)");
          END;
        END ELSE
          RecalculateAmounts(Job."Exch. Calculation (Cost)",xRec."Unit Cost","Unit Cost","Unit Cost (LCY)");
    END;

    LOCAL PROCEDURE RetrieveCostPrice@13() : Boolean;
    BEGIN
      CASE Type OF
        Type::Item:
          IF ("No." <> xRec."No.") OR
             ("Location Code" <> xRec."Location Code") OR
             ("Variant Code" <> xRec."Variant Code") OR
             (NOT BypassQtyValidation AND (Quantity <> xRec.Quantity)) OR
             ("Unit of Measure Code" <> xRec."Unit of Measure Code")
          THEN
            EXIT(TRUE);
        Type::Resource:
          IF ("No." <> xRec."No.") OR
             ("Work Type Code" <> xRec."Work Type Code") OR
             ("Unit of Measure Code" <> xRec."Unit of Measure Code")
          THEN
            EXIT(TRUE);
        Type::"G/L Account":
          IF "No." <> xRec."No." THEN
            EXIT(TRUE);
        ELSE
          EXIT(FALSE);
      END;
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE UpdateTotalCost@24();
    BEGIN
      "Total Cost" := ROUND("Unit Cost" * Quantity,AmountRoundingPrecisionFCY);
      "Total Cost (LCY)" := ROUND(
          CurrExchRate.ExchangeAmtFCYToLCY(
            "Currency Date","Currency Code",
            "Total Cost","Currency Factor"),
          AmountRoundingPrecision);
      // PHP Start - Computing Unit Cost
      "Total Communication Cost" := ROUND("Communication Cost" * Quantity, AmountRoundingPrecisionFCY);
      // "Total Benefits Cost" := ROUND("Benefits Cost" * Quantity, AmountRoundingPrecisionFCY);
      "Total Backroom Support Cost" := ROUND("Backroom Support Cost" * Quantity, AmountRoundingPrecisionFCY);
      "Total In-House Benefits Cost" := ROUND("In-House Benefits Cost" * Quantity, AmountRoundingPrecisionFCY);
      // PHP End
    END;

    LOCAL PROCEDURE FindPriceAndDiscount@60(VAR JobPlanningLine@1000 : Record 1003;CalledByFieldNo@1001 : Integer);
    VAR
      SalesPriceCalcMgt@1002 : Codeunit 7000;
      PurchPriceCalcMgt@1003 : Codeunit 7010;
    BEGIN
      IF RetrieveCostPrice AND ("No." <> '') THEN BEGIN
        SalesPriceCalcMgt.FindJobPlanningLinePrice(JobPlanningLine,CalledByFieldNo);

        IF Type <> Type::"G/L Account" THEN
          PurchPriceCalcMgt.FindJobPlanningLinePrice(JobPlanningLine,CalledByFieldNo)
        ELSE BEGIN
          // Because the SalesPriceCalcMgt.FindJobJnlLinePrice function also retrieves costs for G/L Account,
          // cost and total cost need to get updated again.
          UpdateUnitCost;
          UpdateTotalCost;
        END;
      END;
    END;

    LOCAL PROCEDURE HandleCostFactor@22();
    BEGIN
      IF ("Cost Factor" <> 0) AND (("Unit Cost" <> xRec."Unit Cost") OR ("Cost Factor" <> xRec."Cost Factor")) THEN
        "Unit Price" := ROUND("Unit Cost" * "Cost Factor",UnitAmountRoundingPrecisionFCY)
      ELSE
        IF (Item."Price/Profit Calculation" = Item."Price/Profit Calculation"::"Price=Cost+Profit") AND
           (Item."Profit %" < 100) AND
           ("Unit Cost" <> xRec."Unit Cost")
        THEN
          "Unit Price" := ROUND("Unit Cost" / (1 - Item."Profit %" / 100),UnitAmountRoundingPrecisionFCY);
    END;

    LOCAL PROCEDURE UpdateUnitPrice@25();
    BEGIN
      GetJob;
      RecalculateAmounts(Job."Exch. Calculation (Price)",xRec."Unit Price","Unit Price","Unit Price (LCY)");
    END;

    LOCAL PROCEDURE RecalculateAmounts@35(JobExchCalculation@1003 : 'Fixed FCY,Fixed LCY';xAmount@1000 : Decimal;VAR Amount@1001 : Decimal;VAR AmountLCY@1002 : Decimal);
    BEGIN
      IF (xRec."Currency Factor" <> "Currency Factor") AND
         (Amount = xAmount) AND (JobExchCalculation = JobExchCalculation::"Fixed LCY")
      THEN
        Amount := ROUND(
            CurrExchRate.ExchangeAmtLCYToFCY(
              "Currency Date","Currency Code",
              AmountLCY,"Currency Factor"),
            UnitAmountRoundingPrecisionFCY)
      ELSE
        AmountLCY := ROUND(
            CurrExchRate.ExchangeAmtFCYToLCY(
              "Currency Date","Currency Code",
              Amount,"Currency Factor"),
            UnitAmountRoundingPrecision);
    END;

    LOCAL PROCEDURE UpdateTotalPrice@26();
    BEGIN
      "Total Price" := ROUND(Quantity * "Unit Price",AmountRoundingPrecisionFCY);
      "Total Price (LCY)" := ROUND(
          CurrExchRate.ExchangeAmtFCYToLCY(
            "Currency Date","Currency Code",
            "Total Price","Currency Factor"),
          AmountRoundingPrecision);
    END;

    LOCAL PROCEDURE UpdateAmountsAndDiscounts@31();
    BEGIN
      IF "Total Price" <> 0 THEN BEGIN
        IF ("Line Amount" <> xRec."Line Amount") AND ("Line Discount Amount" = xRec."Line Discount Amount") THEN BEGIN
          "Line Amount" := ROUND("Line Amount",AmountRoundingPrecisionFCY);
          "Line Discount Amount" := "Total Price" - "Line Amount";
          "Line Discount %" :=
            ROUND("Line Discount Amount" / "Total Price" * 100,0.00001);
        END ELSE
          IF ("Line Discount Amount" <> xRec."Line Discount Amount") AND ("Line Amount" = xRec."Line Amount") THEN BEGIN
            "Line Discount Amount" := ROUND("Line Discount Amount",AmountRoundingPrecisionFCY);
            "Line Amount" := "Total Price" - "Line Discount Amount";
            "Line Discount %" :=
              ROUND("Line Discount Amount" / "Total Price" * 100,0.00001);
          END ELSE
            IF ("Line Discount Amount" = xRec."Line Discount Amount") AND
               (("Line Amount" <> xRec."Line Amount") OR ("Line Discount %" <> xRec."Line Discount %") OR
                ("Total Price" <> xRec."Total Price"))
            THEN BEGIN
              "Line Discount Amount" :=
                ROUND("Total Price" * "Line Discount %" / 100,AmountRoundingPrecisionFCY);
              "Line Amount" := "Total Price" - "Line Discount Amount";
            END;
      END ELSE BEGIN
        "Line Amount" := 0;
        "Line Discount Amount" := 0;
      END;

      "Line Amount (LCY)" := ROUND(
          CurrExchRate.ExchangeAmtFCYToLCY(
            "Currency Date","Currency Code",
            "Line Amount","Currency Factor"),
          AmountRoundingPrecision);

      "Line Discount Amount (LCY)" := ROUND(
          CurrExchRate.ExchangeAmtFCYToLCY(
            "Currency Date","Currency Code",
            "Line Discount Amount","Currency Factor"),
          AmountRoundingPrecision);
    END;

    PROCEDURE Use@30(PostedQty@1001 : Decimal;PostedTotalCost@1000 : Decimal;PostedLineAmount@1002 : Decimal);
    BEGIN
      IF "Usage Link" THEN BEGIN
        InitRoundingPrecisions;
        // Update Quantity Posted
        VALIDATE("Qty. Posted","Qty. Posted" + PostedQty);

        // Update Posted Costs and Amounts.
        "Posted Total Cost" += ROUND(PostedTotalCost,AmountRoundingPrecisionFCY);
        "Posted Total Cost (LCY)" := ROUND(
            CurrExchRate.ExchangeAmtFCYToLCY(
              "Currency Date","Currency Code",
              "Posted Total Cost","Currency Factor"),
            AmountRoundingPrecision);

        "Posted Line Amount" += ROUND(PostedLineAmount,AmountRoundingPrecisionFCY);
        "Posted Line Amount (LCY)" := ROUND(
            CurrExchRate.ExchangeAmtFCYToLCY(
              "Currency Date","Currency Code",
              "Posted Line Amount","Currency Factor"),
            AmountRoundingPrecision);

        // Update Remaining Quantity
        IF (PostedQty >= 0) = ("Remaining Qty." >= 0) THEN BEGIN
          IF ABS(PostedQty) <= ABS("Remaining Qty.") THEN BEGIN
            VALIDATE("Remaining Qty.","Remaining Qty." - PostedQty);
          END ELSE BEGIN
            VALIDATE(Quantity,Quantity + PostedQty - "Remaining Qty.");
            VALIDATE("Remaining Qty.",0);
          END;
        END ELSE
          VALIDATE("Remaining Qty.","Remaining Qty." - PostedQty);

        // Update Remaining Costs and Amounts
        UpdateRemainingCostsAndAmounts;

        // Update Quantity to Post
        VALIDATE("Qty. to Transfer to Journal","Remaining Qty.");
      END ELSE BEGIN
        VALIDATE("Remaining Qty.",0);
        "Remaining Total Cost" := 0;
        "Remaining Total Cost (LCY)" := 0;
        "Remaining Line Amount" := 0;
        "Remaining Line Amount (LCY)" := 0;
        VALIDATE("Qty. Posted",0);
        VALIDATE("Qty. to Transfer to Journal",0);
        "Posted Total Cost" := 0;
        "Posted Total Cost (LCY)" := 0;
        "Posted Line Amount" := 0;
        "Posted Line Amount (LCY)" := 0;
      END;

      MODIFY(TRUE);
    END;

    LOCAL PROCEDURE UpdateRemainingCostsAndAmounts@3();
    BEGIN
      IF "Usage Link" THEN BEGIN
        InitRoundingPrecisions;
        "Remaining Total Cost" := ROUND("Unit Cost" * "Remaining Qty.",AmountRoundingPrecisionFCY);
        "Remaining Total Cost (LCY)" := ROUND(
            CurrExchRate.ExchangeAmtFCYToLCY(
              "Currency Date","Currency Code",
              "Remaining Total Cost","Currency Factor"),
            AmountRoundingPrecision);
        "Remaining Line Amount" := CalcLineAmount("Remaining Qty.");
        "Remaining Line Amount (LCY)" := ROUND(
            CurrExchRate.ExchangeAmtFCYToLCY(
              "Currency Date","Currency Code",
              "Remaining Line Amount","Currency Factor"),
            AmountRoundingPrecision);
      END ELSE BEGIN
        VALIDATE("Remaining Qty.",0);
        "Remaining Total Cost" := 0;
        "Remaining Total Cost (LCY)" := 0;
        "Remaining Line Amount" := 0;
        "Remaining Line Amount (LCY)" := 0;
        VALIDATE("Qty. Posted",0);
        VALIDATE("Qty. to Transfer to Journal",0);
        "Posted Total Cost" := 0;
        "Posted Total Cost (LCY)" := 0;
        "Posted Line Amount" := 0;
        "Posted Line Amount (LCY)" := 0;
      END;
    END;

    PROCEDURE UpdateQtyToTransfer@29();
    BEGIN
      IF "Contract Line" THEN BEGIN
        CALCFIELDS("Qty. Transferred to Invoice");
        VALIDATE("Qty. to Transfer to Invoice",Quantity - "Qty. Transferred to Invoice");
      END ELSE
        VALIDATE("Qty. to Transfer to Invoice",0);
    END;

    PROCEDURE UpdateQtyToInvoice@28();
    BEGIN
      IF "Contract Line" THEN BEGIN
        CALCFIELDS("Qty. Invoiced");
        VALIDATE("Qty. to Invoice",Quantity - "Qty. Invoiced")
      END ELSE
        VALIDATE("Qty. to Invoice",0);
    END;

    PROCEDURE UpdatePostedTotalCost@33(AdjustJobCost@1000 : Decimal;AdjustJobCostLCY@1001 : Decimal);
    BEGIN
      IF "Usage Link" THEN BEGIN
        InitRoundingPrecisions;
        "Posted Total Cost" += ROUND(AdjustJobCost,AmountRoundingPrecisionFCY);
        "Posted Total Cost (LCY)" += ROUND(AdjustJobCostLCY,AmountRoundingPrecision);
      END;
    END;

    LOCAL PROCEDURE ValidateModification@21(FieldChanged@1000 : Boolean);
    BEGIN
      IF FieldChanged THEN BEGIN
        CALCFIELDS("Qty. Transferred to Invoice");
        TESTFIELD("Qty. Transferred to Invoice",0);
      END;
    END;

    LOCAL PROCEDURE CheckUsageLinkRelations@7();
    VAR
      JobUsageLink@1000 : Record 1020;
    BEGIN
      JobUsageLink.SETRANGE("Job No.","Job No.");
      JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
      JobUsageLink.SETRANGE("Line No.","Line No.");
      IF NOT JobUsageLink.ISEMPTY THEN
        ERROR(Text008);
    END;

    LOCAL PROCEDURE ControlUsageLink@18();
    VAR
      JobUsageLink@1000 : Record 1020;
    BEGIN
      GetJob;

      IF Job."Apply Usage Link" THEN BEGIN
        IF "Schedule Line" THEN
          "Usage Link" := TRUE
        ELSE
          "Usage Link" := FALSE;
      END ELSE BEGIN
        IF NOT "Schedule Line" THEN
          "Usage Link" := FALSE;
      END;

      JobUsageLink.SETRANGE("Job No.","Job No.");
      JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
      JobUsageLink.SETRANGE("Line No.","Line No.");
      IF NOT JobUsageLink.ISEMPTY AND NOT "Usage Link" THEN
        ERROR(Text006,TABLECAPTION,FIELDCAPTION("Schedule Line"),FIELDCAPTION("Usage Link"));

      VALIDATE("Remaining Qty.",Quantity - "Qty. Posted");
      VALIDATE("Qty. to Transfer to Journal",Quantity - "Qty. Posted");
      UpdateRemainingCostsAndAmounts;

      UpdateQtyToTransfer;
      UpdateQtyToInvoice;
    END;

    LOCAL PROCEDURE CalcLineAmount@12(Qty@1000 : Decimal) : Decimal;
    VAR
      TotalPrice@1001 : Decimal;
    BEGIN
      InitRoundingPrecisions;
      TotalPrice := ROUND(Qty * "Unit Price",AmountRoundingPrecisionFCY);
      EXIT(TotalPrice - ROUND(TotalPrice * "Line Discount %" / 100,AmountRoundingPrecisionFCY));
    END;

    PROCEDURE Overdue@27() : Boolean;
    BEGIN
      IF ("Planning Date" < WORKDATE) AND ("Remaining Qty." > 0) THEN
        EXIT(TRUE);
      EXIT(FALSE);
    END;

    PROCEDURE SetBypassQtyValidation@32(Bypass@1000 : Boolean);
    BEGIN
      BypassQtyValidation := Bypass;
    END;

    LOCAL PROCEDURE UpdateReservation@15(CalledByFieldNo@1000 : Integer);
    VAR
      ReservationCheckDateConfl@1001 : Codeunit 99000815;
    BEGIN
      IF (CurrFieldNo <> CalledByFieldNo) AND (CurrFieldNo <> 0) THEN
        EXIT;
      CASE CalledByFieldNo OF
        FIELDNO("Planning Date"),FIELDNO("Planned Delivery Date"):
          IF (xRec."Planning Date" <> "Planning Date") AND
             (Quantity <> 0) AND
             (Reserve <> Reserve::Never)
          THEN
            ReservationCheckDateConfl.JobPlanningLineCheck(Rec,TRUE);
        FIELDNO(Quantity):
          JobPlanningLineReserve.VerifyQuantity(Rec,xRec);
        FIELDNO("Usage Link"):
          IF (Type = Type::Item) AND "Usage Link" THEN BEGIN
            GetItem;
            IF Item.Reserve = Item.Reserve::Optional THEN BEGIN
              GetJob;
              Reserve := Job.Reserve
            END ELSE
              Reserve := Item.Reserve;
          END ELSE
            Reserve := Reserve::Never;
      END;
      JobPlanningLineReserve.VerifyChange(Rec,xRec);
      UpdatePlanned;
    END;

    PROCEDURE ShowReservation@74();
    VAR
      Reservation@1000 : Page 498;
    BEGIN
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      TESTFIELD(Reserve);
      TESTFIELD("Usage Link");
      Reservation.SetJobPlanningLine(Rec);
      Reservation.RUNMODAL;
    END;

    PROCEDURE ShowReservationEntries@72(Modal@1000 : Boolean);
    VAR
      ReservEntry@1003 : Record 337;
      ReservEngineMgt@1001 : Codeunit 99000831;
    BEGIN
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      ReservEngineMgt.InitFilterAndSortingLookupFor(ReservEntry,TRUE);
      JobPlanningLineReserve.FilterReservFor(ReservEntry,Rec);
      IF Modal THEN
        PAGE.RUNMODAL(PAGE::"Reservation Entries",ReservEntry)
      ELSE
        PAGE.RUN(PAGE::"Reservation Entries",ReservEntry);
    END;

    PROCEDURE AutoReserve@73();
    VAR
      ReservMgt@1000 : Codeunit 99000845;
      FullAutoReservation@1001 : Boolean;
      QtyToReserve@1002 : Decimal;
      QtyToReserveBase@1003 : Decimal;
    BEGIN
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      IF Reserve = Reserve::Never THEN
        FIELDERROR(Reserve);
      JobPlanningLineReserve.ReservQuantity(Rec,QtyToReserve,QtyToReserveBase);
      IF QtyToReserveBase <> 0 THEN BEGIN
        ReservMgt.SetJobPlanningLine(Rec);
        TESTFIELD("Planning Date");
        ReservMgt.AutoReserve(FullAutoReservation,'',"Planning Date",QtyToReserve,QtyToReserveBase);
        FIND;
        IF NOT FullAutoReservation THEN BEGIN
          COMMIT;
          IF CONFIRM(Text011,TRUE) THEN BEGIN
            ShowReservation;
            FIND;
          END;
        END;
        UpdatePlanned;
      END;
    END;

    PROCEDURE ShowTracking@16();
    VAR
      OrderTrackingForm@1000 : Page 99000822;
    BEGIN
      OrderTrackingForm.SetJobPlanningLine(Rec);
      OrderTrackingForm.RUNMODAL;
    END;

    PROCEDURE ShowOrderPromisingLine@64();
    VAR
      OrderPromisingLine@1000 : Record 99000880;
      OrderPromisingLines@1001 : Page 99000959;
    BEGIN
      OrderPromisingLine.SETRANGE("Source Type",OrderPromisingLine."Source Type"::Job);
      OrderPromisingLine.SETRANGE("Source Type",OrderPromisingLine."Source Type"::Job);
      OrderPromisingLine.SETRANGE("Source ID","Job No.");
      OrderPromisingLine.SETRANGE("Source Line No.","Job Contract Entry No.");

      OrderPromisingLines.SetSourceType(OrderPromisingLine."Source Type"::Job);
      OrderPromisingLines.SETTABLEVIEW(OrderPromisingLine);
      OrderPromisingLines.RUNMODAL;
    END;

    PROCEDURE FilterLinesWithItemToPlan@70(VAR Item@1000 : Record 27);
    BEGIN
      RESET;
      SETCURRENTKEY(Status,Type,"No.","Variant Code","Location Code","Planning Date");
      SETRANGE(Status,Status::Order);
      SETRANGE(Type,Type::Item);
      SETRANGE("No.",Item."No.");
      SETFILTER("Variant Code",Item.GETFILTER("Variant Filter"));
      SETFILTER("Location Code",Item.GETFILTER("Location Filter"));
      SETFILTER("Planning Date",Item.GETFILTER("Date Filter"));
      SETFILTER("Remaining Qty. (Base)",'<>0');
    END;

    PROCEDURE FindLinesWithItemToPlan@68(VAR Item@1000 : Record 27) : Boolean;
    BEGIN
      FilterLinesWithItemToPlan(Item);
      EXIT(FIND('-'));
    END;

    PROCEDURE LinesWithItemToPlanExist@67(VAR Item@1000 : Record 27) : Boolean;
    BEGIN
      FilterLinesWithItemToPlan(Item);
      EXIT(NOT ISEMPTY);
    END;

    PROCEDURE DrillDownJobInvoices@34();
    VAR
      JobInvoices@1000 : Page 1029;
    BEGIN
      JobInvoices.SetShowDetails(FALSE);
      JobInvoices.SetPrJobPlanningLine(Rec);
      JobInvoices.RUN;
    END;

    LOCAL PROCEDURE CheckRelatedJobPlanningLineInvoice@36();
    VAR
      JobPlanningLineInvoice@1000 : Record 1022;
    BEGIN
      JobPlanningLineInvoice.SETRANGE("Job No.","Job No.");
      JobPlanningLineInvoice.SETRANGE("Job Task No.","Job Task No.");
      JobPlanningLineInvoice.SETRANGE("Job Planning Line No.","Line No.");
      IF NOT JobPlanningLineInvoice.ISEMPTY THEN
        ERROR(NotPossibleJobPlanningLineErr);
    END;

    PROCEDURE RowID1@44() : Text[250];
    VAR
      ItemTrackingMgt@1000 : Codeunit 6500;
    BEGIN
      EXIT(
        ItemTrackingMgt.ComposeRowID(DATABASE::"Job Planning Line",Status,
          "Job No.",'',0,"Job Contract Entry No."));
    END;

    PROCEDURE UpdatePlanned@37();
    BEGIN
      CALCFIELDS("Reserved Quantity");
      Planned := "Reserved Quantity" = "Remaining Qty.";
    END;

    PROCEDURE GetJobsSetup@39();
    BEGIN
      JobsSetup.GET;
    END;

    LOCAL PROCEDURE SetJobPlanningLineNo@96() : Integer;
    VAR
      JobPlanningLine_@1000 : Record 1003;
    BEGIN
      // PHP Start
      JobPlanningLine_.RESET;
      JobPlanningLine_.SETRANGE("Job No.", "Job No.");
      JobPlanningLine_.SETRANGE("Job Task No.", "Job Task No.");
      IF JobPlanningLine_.FINDLAST THEN
        EXIT(JobPlanningLine_."Line No." + 10000);

      EXIT(10000);
    END;

    LOCAL PROCEDURE CheckParentItemNo@40();
    BEGIN
      // PHP Start
      IF "Parent Item  No." <> '' THEN
        TESTFIELD("Parent Item  No.", '');
      // PHP End
    END;

    PROCEDURE CreateCashAdvance@41(VAR JobPlnLines@1000 : Record 1003);
    BEGIN

      JobPlnLines.COPY(JobPlnLines);
      InitCashAdvance(JobPlnLines);
      //Rec := JobPlnLines;
    END;

    LOCAL PROCEDURE InitCashAdvance@48(VAR JobPlnLines@1000 : Record 1003);
    VAR
      PurchHeader@1001 : Record 38;
      PurchLines@1002 : Record 39;
      PurchHeaderFilter@1004 : Record 38;
      JobPlnLinesTemp@1005 : TEMPORARY Record 1003;
      LineNos@1003 : Integer;
    BEGIN
      WITH JobPlnLines DO BEGIN
        IF NOT UserSetup.GET(USERID) THEN
          UserSetup.TESTFIELD("User ID", USERID);
        UserSetup.TESTFIELD("Vendor Individual No."); // Check User setup

        SETFILTER("Line Type", '%1|%2', "Line Type"::Schedule, "Line Type"::"Both Schedule and Contract");
        SETFILTER("No.", '<>''''');
        SETFILTER(Type, '%1|%2',Type::Item, Type::"G/L Account");

        JobPlnLinesTemp.DELETEALL;
        IF JobPlnLines.FINDSET THEN BEGIN
          REPEAT
            CheckJobPlanningLinesIsReadyForCashAdvance(JobPlnLines);
            CheckJobPlanningLinesIfAlreadyExistInPurchaseLine(JobPlnLines);

            JobPlnLinesTemp.SETFILTER("Vendor No.", JobPlnLines."Vendor No.");
            IF NOT JobPlnLinesTemp.FINDFIRST THEN BEGIN
              JobPlnLinesTemp.INIT;
              JobPlnLinesTemp := JobPlnLines;
              JobPlnLinesTemp.INSERT(TRUE);
            END;
          UNTIL JobPlnLines.NEXT = 0;
        END;

        CLEAR(JobPlnLinesTemp);
        IF JobPlnLinesTemp.FINDSET THEN BEGIN
          REPEAT
            // Initial Purchase Header
            GetJob;
            PurchHeader.INIT;
            PurchHeader."Document Type" := PurchHeader."Document Type"::Invoice;
            PurchHeader."Request Type" := PurchHeader."Request Type"::"Cash Advance";
            PurchHeader."Job Type" := PurchHeader."Job Type"::"Service Engineering";
            IF JobPlnLines."Vendor No." <> '' THEN
              PurchHeader.VALIDATE("Buy-from Vendor No.", JobPlnLines."Vendor No.")
            ELSE
              PurchHeader.VALIDATE("Buy-from Vendor No.", UserSetup."Vendor Individual No.");
            PurchHeader.VALIDATE("Purchaser Code", UserSetup."Salespers./Purch. Code");
            PurchHeader.VALIDATE("INTP No.", Job."INTP No.");
            PurchHeader.INSERT(TRUE);
            PurchHeader.VALIDATE("INTP No.", Job."INTP No.");
            PurchHeader.MODIFY(TRUE);
            IF JobPlnLines.FINDSET THEN BEGIN
              REPEAT
                CheckJobPlanningLinesIsReadyForCashAdvance(JobPlnLines);
                CheckJobPlanningLinesIfAlreadyExistInPurchaseLine(JobPlnLines);

                LineNos += 10000;
                PurchLines.INIT;
                PurchLines."Document Type" := PurchHeader."Document Type";
                PurchLines."Document No." := PurchHeader."No.";
                PurchLines."Line No." := LineNos;
                CASE Type OF
                  Type::Item:
                    PurchLines.VALIDATE(Type, PurchLines.Type::Item);
                  Type::"G/L Account":
                    PurchLines.VALIDATE(Type, PurchLines.Type::"G/L Account");
                END;
                PurchLines.VALIDATE("No.", "No.");
                PurchLines.VALIDATE(Description, Description);
                PurchLines.VALIDATE("Unit of Measure Code", "Unit of Measure Code");
                PurchLines.VALIDATE(Quantity, "Qty. to Transfer to Journal");
                PurchLines.VALIDATE("Direct Unit Cost", "Unit Cost");
                PurchLines.VALIDATE("INTP No.", Job."INTP No.");
                PurchLines.VALIDATE("Job No.", "Job No.");
                PurchLines.VALIDATE("Job Task No.", "Job Task No.");
                PurchLines.VALIDATE("Job Planning Line No.", "Line No.");
                PurchLines."Job Created Entry" := TRUE;
                PurchLines."Request Type" := PurchLines."Request Type"::"Cash Advance";
                PurchLines.INSERT;
              UNTIL JobPlnLines.NEXT = 0;
              // Open created Cash Advance
              PAGE.RUN(PAGE::"Cash Advance", PurchHeader);
            END;
          UNTIL JobPlnLinesTemp.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckJobPlanningLinesIsReadyForCashAdvance@47(VAR JobPlnLines@1000 : Record 1003);
    VAR
      Item@1001 : Record 27;
      GLAccount@1002 : Record 15;
    BEGIN
      WITH JobPlnLines DO BEGIN
        TESTFIELD("Usage Link", TRUE);
        TESTFIELD("No.");
        CASE Type OF
          Type::Item:
              IF Item.GET("No.") THEN BEGIN
                Item.TESTFIELD(Type, Item.Type::Service);
                Item.TESTFIELD("Cash Advance Account", TRUE);
              END;
          Type::"G/L Account":
            IF GLAccount.GET("No.") THEN
              GLAccount.TESTFIELD("CA Account", TRUE);
        END;
        TESTFIELD("Unit of Measure Code");
        IF Quantity < 0 THEN
          FIELDERROR(Quantity);
        IF "Qty. to Transfer to Journal" <= 0 THEN
          FIELDERROR("Qty. to Transfer to Journal");
        IF "Qty. to Transfer to Journal" > (Quantity - "Qty. Posted") THEN
          FIELDERROR("Qty. to Transfer to Journal");
      END;
    END;

    PROCEDURE CreateRequestForPayment@45(VAR JobPlnLines@1000 : Record 1003);
    BEGIN
      JobPlnLines.COPY(JobPlnLines);
      InitRequestForPayment(JobPlnLines);
      Rec := JobPlnLines;
    END;

    LOCAL PROCEDURE InitRequestForPayment@111(VAR JobPlnLines@1000 : Record 1003);
    VAR
      PurchHeader@1001 : Record 38;
      PurchLines@1002 : Record 39;
      JobPlnLinesTemp@1004 : TEMPORARY Record 1003;
      LineNos@1003 : Integer;
    BEGIN
      WITH JobPlnLines DO BEGIN
        IF NOT UserSetup.GET(USERID) THEN
          UserSetup.TESTFIELD("User ID", USERID);

        SETFILTER("Line Type", '%1|%2', "Line Type"::Schedule, "Line Type"::"Both Schedule and Contract");
        SETFILTER("No.", '<>''''');
        SETFILTER(Type, '%1|%2',Type::Item, Type::"G/L Account");

        JobPlnLinesTemp.DELETEALL;
        IF JobPlnLines.FINDSET THEN BEGIN
          REPEAT
            CheckJobPlanningLinesIsReadyForRequestForPayment(JobPlnLines);
            CheckJobPlanningLinesIfAlreadyExistInPurchaseLine(JobPlnLines);

            JobPlnLinesTemp.SETFILTER("Vendor No.", JobPlnLines."Vendor No.");
            IF NOT JobPlnLinesTemp.FINDFIRST THEN BEGIN
              JobPlnLinesTemp.INIT;
              JobPlnLinesTemp := JobPlnLines;
              JobPlnLinesTemp.INSERT(TRUE);
            END;
          UNTIL JobPlnLines.NEXT = 0;
        END;

        CLEAR(JobPlnLinesTemp);
        IF JobPlnLinesTemp.FINDSET THEN BEGIN
          REPEAT
            // Initial Purchase Header
            GetJob;
            CLEAR(PurchHeader);
            PurchHeader.INIT;
            PurchHeader."Document Type" := PurchHeader."Document Type"::Invoice;
            PurchHeader."Request Type" := PurchHeader."Request Type"::"Request for Payment";
            PurchHeader.VALIDATE("Buy-from Vendor No.", JobPlnLinesTemp."Vendor No.");
            PurchHeader.VALIDATE("INTP No.", Job."INTP No.");
            PurchHeader.INSERT(TRUE);
            JobPlnLines.SETRANGE("Vendor No.", JobPlnLinesTemp."Vendor No.");
            IF JobPlnLines.FINDSET THEN BEGIN
              REPEAT
                CheckJobPlanningLinesIsReadyForRequestForPayment(JobPlnLines);
                CheckJobPlanningLinesIfAlreadyExistInPurchaseLine(JobPlnLines);
                LineNos += 10000;
                PurchLines.INIT;
                PurchLines."Document Type" := PurchHeader."Document Type";
                PurchLines."Document No." := PurchHeader."No.";
                PurchLines."Line No." := LineNos;
                CASE Type OF
                  Type::Item:
                    PurchLines.VALIDATE(Type, PurchLines.Type::Item);
                  Type::"G/L Account":
                    PurchLines.VALIDATE(Type, PurchLines.Type::"G/L Account");
                END;
                PurchLines.VALIDATE("No.", "No.");
                PurchLines.VALIDATE(Description, Description);
                PurchLines.VALIDATE("Unit of Measure Code", "Unit of Measure Code");
                PurchLines.VALIDATE(Quantity, "Qty. to Transfer to Journal");
                PurchLines.VALIDATE("Direct Unit Cost", "Unit Cost");
                PurchLines.VALIDATE("INTP No.", Job."INTP No.");
                PurchLines.VALIDATE("Job No.", "Job No.");
                PurchLines.VALIDATE("Job Task No.", "Job Task No.");
                PurchLines.VALIDATE("Job Planning Line No.", "Line No.");
                PurchLines."Job Created Entry" := TRUE;
                PurchLines."Request Type" := PurchLines."Request Type"::"Request for Payment";
                PurchLines.INSERT;
              UNTIL JobPlnLines.NEXT = 0;
            END;
            PAGE.RUN(PAGE::"Request for Payment", PurchHeader);
          UNTIL JobPlnLinesTemp.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckJobPlanningLinesIsReadyForRequestForPayment@50(VAR JobPlnLines@1000 : Record 1003);
    VAR
      Item@1001 : Record 27;
      GLAccount@1002 : Record 15;
    BEGIN
      WITH JobPlnLines DO BEGIN
        TESTFIELD("Usage Link", TRUE);
        TESTFIELD("No.");
        CASE Type OF
          Type::Item:
              IF Item.GET("No.") THEN BEGIN
                Item.TESTFIELD(Type, Item.Type::Service);
                Item.TESTFIELD("Request for Payment Account", TRUE);
              END;
          Type::"G/L Account":
            IF GLAccount.GET("No.") THEN
              GLAccount.TESTFIELD("RFP Account", TRUE);
        END;
        TESTFIELD("Unit of Measure Code");
        IF Quantity < 0 THEN
          FIELDERROR(Quantity);
        TESTFIELD("Vendor No.");
        IF "Qty. to Transfer to Journal" <= 0 THEN
          FIELDERROR("Qty. to Transfer to Journal");
      END;
    END;

    PROCEDURE CreateRequestForPurchase@49(VAR JobPlnLines@1000 : Record 1003);
    BEGIN
      JobPlnLines.COPY(JobPlnLines);
      InitRequestForPurchase(JobPlnLines);
      Rec := JobPlnLines;
    END;

    LOCAL PROCEDURE InitRequestForPurchase@43(VAR JobPlnLines@1000 : Record 1003);
    VAR
      PurchHeader@1001 : Record 38;
      PurchLines@1002 : Record 39;
      JobPlnLinesTemp@1004 : TEMPORARY Record 1003;
      LineNos@1003 : Integer;
    BEGIN
      WITH JobPlnLines DO BEGIN
        IF NOT UserSetup.GET(USERID) THEN
          UserSetup.TESTFIELD("User ID", USERID);

        SETFILTER("Line Type", '%1|%2', "Line Type"::Schedule, "Line Type"::"Both Schedule and Contract");
        SETFILTER("No.", '<>''''');
        SETFILTER(Type, '%1|%2',Type::Item, Type::"G/L Account");

        JobPlnLinesTemp.DELETEALL;
        IF JobPlnLines.FINDSET THEN BEGIN
          REPEAT
            CheckJobPlanningLinesIsReadyForRequestForPurchase(JobPlnLines);
            CheckJobPlanningLinesIfAlreadyExistInPurchaseLine(JobPlnLines);

            JobPlnLinesTemp.SETFILTER("Vendor No.", JobPlnLines."Vendor No.");
            IF NOT JobPlnLinesTemp.FINDFIRST THEN BEGIN
              JobPlnLinesTemp.INIT;
              JobPlnLinesTemp := JobPlnLines;
              JobPlnLinesTemp.INSERT(TRUE);
            END;
          UNTIL JobPlnLines.NEXT = 0;
        END;

        CLEAR(JobPlnLinesTemp);
        IF JobPlnLinesTemp.FINDSET THEN BEGIN
          REPEAT
            // Initial Purchase Header
            GetJob;
            CLEAR(PurchHeader);
            PurchHeader.INIT;
            PurchHeader."Document Type" := PurchHeader."Document Type"::Invoice;
            PurchHeader."Request Type" := PurchHeader."Request Type"::"Request for Purchase";
            PurchHeader.VALIDATE("Buy-from Vendor No.", JobPlnLinesTemp."Vendor No.");
            PurchHeader.VALIDATE("INTP No.", Job."INTP No.");
            PurchHeader.INSERT(TRUE);
            JobPlnLines.SETRANGE("Vendor No.", JobPlnLinesTemp."Vendor No.");
            IF JobPlnLines.FINDSET THEN BEGIN
              REPEAT
                CheckJobPlanningLinesIsReadyForRequestForPayment(JobPlnLines);
                CheckJobPlanningLinesIfAlreadyExistInPurchaseLine(JobPlnLines);
                LineNos += 10000;
                PurchLines.INIT;
                PurchLines."Document Type" := PurchHeader."Document Type";
                PurchLines."Document No." := PurchHeader."No.";
                PurchLines."Line No." := LineNos;
                CASE Type OF
                  Type::Item:
                    PurchLines.VALIDATE(Type, PurchLines.Type::Item);
                  Type::"G/L Account":
                    PurchLines.VALIDATE(Type, PurchLines.Type::"G/L Account");
                END;
                PurchLines.VALIDATE("No.", "No.");
                PurchLines.VALIDATE(Description, Description);
                PurchLines.VALIDATE("Unit of Measure Code", "Unit of Measure Code");
                PurchLines.VALIDATE(Quantity, "Qty. to Transfer to Journal");
                PurchLines.VALIDATE("Direct Unit Cost", "Unit Cost");
                PurchLines.VALIDATE("INTP No.", Job."INTP No.");
                PurchLines.VALIDATE("Job No.", "Job No.");
                PurchLines.VALIDATE("Job Task No.", "Job Task No.");
                PurchLines.VALIDATE("Job Planning Line No.", "Line No.");
                PurchLines."Job Created Entry" := TRUE;
                PurchLines."Request Type" := PurchLines."Request Type"::"Request for Purchase";
                PurchLines.INSERT;
              UNTIL JobPlnLines.NEXT = 0;
            END;
            PAGE.RUN(PAGE::"Request for Purchase", PurchHeader);
          UNTIL JobPlnLinesTemp.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckJobPlanningLinesIsReadyForRequestForPurchase@115(VAR JobPlnLines@1000 : Record 1003);
    VAR
      Item@1001 : Record 27;
      GLAccount@1002 : Record 15;
    BEGIN
      WITH JobPlnLines DO BEGIN
        TESTFIELD("Usage Link", TRUE);
        TESTFIELD("No.");
        CASE Type OF
          Type::Item:
              IF Item.GET("No.") THEN BEGIN
                Item.TESTFIELD(Type, Item.Type::Service);
                Item.TESTFIELD("Request for Payment Account", TRUE);
              END;
          Type::"G/L Account":
            IF GLAccount.GET("No.") THEN
              GLAccount.TESTFIELD("RFP Account", TRUE);
        END;
        TESTFIELD("Unit of Measure Code");
        IF Quantity < 0 THEN
          FIELDERROR(Quantity);
        TESTFIELD("Vendor No.");
        IF "Qty. to Transfer to Journal" <= 0 THEN
          FIELDERROR("Qty. to Transfer to Journal");
      END;
    END;

    LOCAL PROCEDURE CheckJobPlanningLinesIfAlreadyExistInPurchaseLine@105(VAR JobPlnLines@1000 : Record 1003);
    VAR
      PurchLines@1001 : Record 39;
      Err001@1002 : TextConst 'ENU=%1 %2, %3 %4 and %5 %6 with value of %7 %8 already exist in %9 %10.';
    BEGIN
      WITH JobPlnLines DO BEGIN
        // Check if Job Planning Lines is already exist in the Purchase Line
        PurchLines.SETRANGE("Job No.", "Job No.");
        PurchLines.SETRANGE("Job Task No.", "Job Task No.");
        PurchLines.SETRANGE("Job Planning Line No.", "Line No.");
        IF PurchLines.FINDFIRST THEN BEGIN
          //PurchLines.CALCFIELDS("Request Type");
          ERROR(Err001, FIELDCAPTION("Job No."), "Job No.",
        FIELDCAPTION("Job Task No."), "Job Task No.", FIELDCAPTION("Line No."), "Line No.",
        "No.", Description, FORMAT(PurchLines."Request Type"), PurchLines."Document No.");
        END;
      END;
    END;

    PROCEDURE CreateTERF@56(VAR JobPlnLines@1000 : Record 1003);
    BEGIN

      JobPlnLines.COPY(JobPlnLines);
      InitTERF(JobPlnLines);
      Rec := JobPlnLines;
    END;

    LOCAL PROCEDURE InitTERF@46(VAR JobPlnLines@1000 : Record 1003);
    VAR
      SalesHeaders@1001 : Record 36;
      SalesLines@1002 : Record 37;
      JobPlnLinesTemp@1004 : TEMPORARY Record 1003;
      LineNos@1003 : Integer;
      Items@1005 : Record 27;
    BEGIN
      WITH JobPlnLines DO BEGIN
        IF NOT UserSetup.GET(USERID) THEN
          UserSetup.TESTFIELD("User ID", USERID);

        SETFILTER("Line Type", '%1|%2', "Line Type"::Schedule, "Line Type"::"Both Schedule and Contract");
        SETFILTER("No.", '<>''''');
        SETRANGE(Type, Type::Item);

        // Initial Sales Header
        GetJob;
        SalesHeaders.INIT;
        SalesHeaders."Document Type" := SalesHeaders."Document Type"::Invoice;
        SalesHeaders."Request type" := SalesHeaders."Request type"::"Tools & Equipment Requisition";
        SalesHeaders.VALIDATE("Employee No.", UserSetup."Employee No.");
        SalesHeaders.VALIDATE("Sell-to Customer No.", Job."Bill-to Customer No.");
        SalesHeaders.VALIDATE("INTP No.", Job."INTP No.");
        SalesHeaders.Purpose := SalesHeaders.Purpose::Project;
        SalesHeaders.INSERT(TRUE);
        IF JobPlnLines.FINDSET THEN BEGIN
          REPEAT
            CheckJobPlanningLinesIsReadyForTERFWithdrawal(JobPlnLines);
            CheckJobPlanningLinesIfAlreadyExistInSalesLine(JobPlnLines);

            LineNos += 10000;
            SalesLines.RESET;
            SalesLines.INIT;
            SalesLines."Document Type" := SalesLines."Document Type"::Invoice;
            SalesLines."Request type" := SalesLines."Request type"::"Tools & Equipment Requisition";
            SalesLines."Document No." := SalesHeaders."No.";
            SalesLines."Line No." := LineNos;
            SalesLines.Type := SalesLines.Type::Item;
            SalesLines.VALIDATE("No.", JobPlnLines."No.");
            IF (Type = Type::Item) AND Items.GET(JobPlnLines."No.") AND (Items.Type = Items.Type::Inventory) THEN
                SalesLines.VALIDATE("Location Code", "Location Code");
            SalesLines.Description := Description;
            SalesLines."Quantity to Request" := "Qty. to Transfer to Journal";
            SalesLines."Unit of Measure" := "Unit of Measure Code";
            SalesLines.VALIDATE("Job No. 2", "Job No.");
            SalesLines.VALIDATE("Job Task No. 2", "Job Task No.");
            SalesLines.VALIDATE("Job Planning Line No.", "Line No.");
            SalesLines."Unit of Measure Code" := "Unit of Measure Code";
            SalesLines."Allow Invoice Disc." := TRUE;
            SalesLines.INSERT(TRUE);
          UNTIL JobPlnLines.NEXT = 0;
          // Open created Tools & Equipment Requisition
          PAGE.RUN(PAGE::"Tools & Equipment Requisition", SalesHeaders);
        END;
      END;
    END;

    PROCEDURE CreateWithdrawal@62(VAR JobPlnLines@1000 : Record 1003);
    BEGIN

      JobPlnLines.COPY(JobPlnLines);
      InitWithdrawal(JobPlnLines);
      Rec := JobPlnLines;
    END;

    LOCAL PROCEDURE InitWithdrawal@61(VAR JobPlnLines@1000 : Record 1003);
    VAR
      SalesHeaders@1001 : Record 36;
      SalesLines@1002 : Record 37;
      JobPlnLinesTemp@1004 : TEMPORARY Record 1003;
      LineNos@1003 : Integer;
      Items@1005 : Record 27;
    BEGIN
      WITH JobPlnLines DO BEGIN
        IF NOT UserSetup.GET(USERID) THEN
          UserSetup.TESTFIELD("User ID", USERID);

        SETFILTER("Line Type", '%1|%2', "Line Type"::Schedule, "Line Type"::"Both Schedule and Contract");
        SETFILTER("No.", '<>''''');
        SETRANGE(Type, Type::Item);

        // Initial Sales Header
        GetJob;
        SalesHeaders.INIT;
        SalesHeaders."Document Type" := SalesHeaders."Document Type"::Invoice;
        SalesHeaders."Request type" := SalesHeaders."Request type"::Withdrawal;
        SalesHeaders.VALIDATE("Employee No.", UserSetup."Employee No.");
        SalesHeaders.VALIDATE("Sell-to Customer No.", Job."Bill-to Customer No.");
        SalesHeaders.VALIDATE("INTP No.", Job."INTP No.");
        SalesHeaders.Purpose := SalesHeaders.Purpose::Project;
        SalesHeaders.INSERT(TRUE);
        IF JobPlnLines.FINDSET THEN BEGIN
          REPEAT
            CheckJobPlanningLinesIsReadyForTERFWithdrawal(JobPlnLines);
            CheckJobPlanningLinesIfAlreadyExistInSalesLine(JobPlnLines);

            LineNos += 10000;
            SalesLines.RESET;
            SalesLines.INIT;
            SalesLines."Document Type" := SalesLines."Document Type"::Invoice;
            SalesLines."Request type" := SalesLines."Request type"::Withdrawal;
            SalesLines."Document No." := SalesHeaders."No.";
            SalesLines."Line No." := LineNos;
            SalesLines.Type := SalesLines.Type::Item;
            SalesLines.VALIDATE("No.", JobPlnLines."No.");
            IF (Type = Type::Item) AND Items.GET(JobPlnLines."No.") AND (Items.Type = Items.Type::Inventory) THEN
                SalesLines.VALIDATE("Location Code", "Location Code");
            SalesLines.Description := Description;
            SalesLines."Quantity to Request" := "Qty. to Transfer to Journal";
            SalesLines."Unit of Measure" := "Unit of Measure Code";
            SalesLines.VALIDATE("Job No. 2", "Job No.");
            SalesLines.VALIDATE("Job Task No. 2", "Job Task No.");
            SalesLines.VALIDATE("Job Planning Line No.", "Line No.");
            SalesLines."Unit of Measure Code" := "Unit of Measure Code";
            SalesLines."Allow Invoice Disc." := TRUE;
            SalesLines.INSERT(TRUE);
          UNTIL JobPlnLines.NEXT = 0;
          // Open created Withdrawal
          PAGE.RUN(PAGE::Withdrawal, SalesHeaders);
        END;
      END;
    END;

    LOCAL PROCEDURE CheckJobPlanningLinesIsReadyForTERFWithdrawal@51(VAR JobPlnLines@1000 : Record 1003);
    VAR
      Item@1001 : Record 27;
      GLAccount@1002 : Record 15;
    BEGIN
      WITH JobPlnLines DO BEGIN
        TESTFIELD("Usage Link", TRUE);
        TESTFIELD("No.");
        CASE Type OF
          Type::Item:
              IF Item.GET("No.") THEN BEGIN
                Item.TESTFIELD(Type, Item.Type::Inventory);
              END;
        END;
        TESTFIELD("Unit of Measure Code");
        IF Quantity < 0 THEN
          FIELDERROR(Quantity);
        IF "Qty. to Transfer to Journal" <= 0 THEN
          FIELDERROR("Qty. to Transfer to Journal");
        IF "Qty. to Transfer to Journal" > (Quantity - "Qty. Posted") THEN
          FIELDERROR("Qty. to Transfer to Journal");
      END;
    END;

    LOCAL PROCEDURE CheckJobPlanningLinesIfAlreadyExistInSalesLine@53(VAR JobPlnLines@1000 : Record 1003);
    VAR
      SalesLines@1001 : Record 37;
      Err001@1002 : TextConst 'ENU=%1 %2, %3 %4 and %5 %6 with value of %7 %8 already exist in %9 %10.';
    BEGIN
      WITH JobPlnLines DO BEGIN
        // Check if Job Planning Lines is already exist in the Sales Line
        SalesLines.SETFILTER("Job No. 2", ("Job No."));
        SalesLines.SETFILTER("Job Task No. 2", ("Job Task No."));
        SalesLines.SETFILTER("Job Planning Line No.", FORMAT("Line No."));
        IF SalesLines.FINDFIRST THEN BEGIN
          SalesLines.CALCFIELDS("Request type");
          ERROR(Err001, FIELDCAPTION("Job No."), "Job No.",
        FIELDCAPTION("Job Task No."), "Job Task No.", FIELDCAPTION("Line No."), "Line No.",
        "No.", Description, FORMAT(SalesLines."Request type"), SalesLines."Document No.");
        END;
      END;
    END;

    PROCEDURE TestJobStatusPlanningQuote@38();
    BEGIN
      TESTFIELD("Job No.");
      Job.GET("Job No.");
      IF Job.Status IN [Job.Status::Completed, Job.Status::Completed] THEN
        Job.FIELDERROR(Status);
    END;

    PROCEDURE UpdateCAAccounts@69();
    VAR
      Itm@1000 : Record 27;
      GL@1002 : Record 15;
      JPL@1001 : Record 1003;
    BEGIN
      Itm.SETRANGE("Cash Advance Account", TRUE);
      Itm.SETRANGE(Type, Itm.Type::Service);

      IF Itm.FINDSET THEN BEGIN
        REPEAT
          JPL.RESET;
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("No.", Itm."No.");
          IF JPL.FINDSET THEN BEGIN
            REPEAT
              JPL.VALIDATE("Cash Advance Account", Itm."Cash Advance Account");
              JPL.MODIFY;
            UNTIL JPL.NEXT = 0;
          END;
        UNTIL Itm.NEXT = 0;
      END;

      GL.SETRANGE("CA Account", TRUE);
      GL.SETRANGE("Account Type", GL."Account Type"::Posting);
      IF GL.FINDSET THEN BEGIN
        REPEAT
          JPL.RESET;
          JPL.SETRANGE(Type, JPL.Type::"G/L Account");
          JPL.SETRANGE("No.", GL."No.");
          IF JPL.FINDSET THEN BEGIN
            REPEAT
              JPL.VALIDATE("Cash Advance Account", GL."CA Account");
              JPL.MODIFY;
            UNTIL JPL.NEXT = 0;
          END;
        UNTIL GL.NEXT = 0;
      END;

      MESSAGE(Msg001);
    END;

    PROCEDURE GetNameOfRequestee@52() : Text;
    VAR
      JobLedgerEntry@1001 : Record 169;
      JobUsageLink@1000 : Record 1020;
      PurchInvHeader@1002 : Record 122;
      Vendor@1003 : Record 23;
    BEGIN
      JobUsageLink.SETRANGE("Job No.","Job No.");
      JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
      JobUsageLink.SETRANGE("Line No.","Line No.");

      IF JobUsageLink.FINDSET THEN
        REPEAT
          JobLedgerEntry.GET(JobUsageLink."Entry No.");
          JobLedgerEntry.MARK := TRUE;
        UNTIL JobUsageLink.NEXT = 0;

      JobLedgerEntry.MARKEDONLY(TRUE);
      IF JobLedgerEntry.FINDLAST AND PurchInvHeader.GET(JobLedgerEntry."Document No.") AND Vendor.GET(PurchInvHeader."Buy-from Vendor No.") THEN BEGIN
        EXIT(Vendor.Name + ' ' + Vendor."Name 2");
      END;

      EXIT('');
    END;

    PROCEDURE GetDateRequested@57() : Date;
    BEGIN

      EXIT(0D);
    END;

    PROCEDURE GetReference@59() : Text;
    VAR
      JobLedgerEntry@1001 : Record 169;
      JobUsageLink@1000 : Record 1020;
      PurchInvHeader@1002 : Record 122;
      Vendor@1003 : Record 23;
    BEGIN
      JobUsageLink.SETRANGE("Job No.","Job No.");
      JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
      JobUsageLink.SETRANGE("Line No.","Line No.");

      IF JobUsageLink.FINDSET THEN
        REPEAT
          JobLedgerEntry.GET(JobUsageLink."Entry No.");
          JobLedgerEntry.MARK := TRUE;
        UNTIL JobUsageLink.NEXT = 0;

      JobLedgerEntry.MARKEDONLY(TRUE);
      IF JobLedgerEntry.FINDLAST AND PurchInvHeader.GET(JobLedgerEntry."Document No.") THEN BEGIN
        EXIT(PurchInvHeader."Pre-Assigned No.");
      END;

      EXIT('');
    END;

    PROCEDURE GetJobOrderNo@55() : Text;
    VAR
      JobLedgerEntry@1001 : Record 169;
      JobUsageLink@1000 : Record 1020;
      PurchInvHeader@1002 : Record 122;
      Vendor@1003 : Record 23;
    BEGIN
      JobUsageLink.SETRANGE("Job No.","Job No.");
      JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
      JobUsageLink.SETRANGE("Line No.","Line No.");

      IF JobUsageLink.FINDSET THEN
        REPEAT
          JobLedgerEntry.GET(JobUsageLink."Entry No.");
          JobLedgerEntry.MARK := TRUE;
        UNTIL JobUsageLink.NEXT = 0;

      JobLedgerEntry.MARKEDONLY(TRUE);
      IF JobLedgerEntry.FINDLAST AND PurchInvHeader.GET(JobLedgerEntry."Document No.") THEN BEGIN
        EXIT(PurchInvHeader."Job Order No.");
      END;

      EXIT('');
    END;

    PROCEDURE GetTotalUsage@76() : Decimal;
    VAR
      JobLedgerEntry@1001 : Record 169;
      JobUsageLink@1000 : Record 1020;
      PurchInvHeader@1002 : Record 122;
      Vendor@1003 : Record 23;
      TotalUsage@1004 : Decimal;
    BEGIN
      TotalUsage := 0;
      JobUsageLink.SETRANGE("Job No.","Job No.");
      JobUsageLink.SETRANGE("Job Task No.","Job Task No.");
      JobUsageLink.SETRANGE("Line No.","Line No.");

      IF JobUsageLink.FINDSET THEN
        REPEAT
          JobLedgerEntry.GET(JobUsageLink."Entry No.");
          JobLedgerEntry.MARK := TRUE;
        UNTIL JobUsageLink.NEXT = 0;

      JobLedgerEntry.MARKEDONLY(TRUE);
      IF JobLedgerEntry.FINDSET THEN BEGIN
        REPEAT
          TotalUsage += JobLedgerEntry."Total Cost (LCY)";
        UNTIL JobLedgerEntry.NEXT = 0;
        EXIT(TotalUsage);
      END;

      EXIT(0);
    END;

    LOCAL PROCEDURE AutoCalculateFixedCost@95(OnDelete@1000 : Boolean);
    BEGIN
      // PHP Start
      CalcFixedCost(OnDelete);
      // PHP End
    END;

    LOCAL PROCEDURE CalcFixedCost@58(OnDelete@1005 : Boolean);
    VAR
      Itm@1004 : Record 27;
      JPL@1001 : Record 1003;
      JobPostingGrp@1000 : Record 208;
      TotalScheduledPrice@1002 : Decimal;
      TotalScheduledBenefits@1003 : Decimal;
      TotalScheduledCommunication@1006 : Decimal;
      TotalScheduledBackroomSupport@1007 : Decimal;
    BEGIN
      // PHP Start
      GetJob;
      IF JobPostingGrp.GET(Job."Job Posting Group") THEN BEGIN
        // Update Backroom Support Account
        IF JobPostingGrp."OSP Backroom Support Account" <> '' THEN BEGIN
          Itm.GET(JobPostingGrp."OSP Backroom Support Account");
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."OSP Backroom Support Account");
          TotalScheduledPrice := GetScheduledTotalPrice(OnDelete) * (Itm."Percentage Calc. (Contract)" / 100);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledPrice);
            JPL.MODIFY;
          END;
        END;

        // Update Barracks Rental Account
        IF JobPostingGrp."Barracks Rental Account" <> '' THEN BEGIN
          Itm.GET(JobPostingGrp."Barracks Rental Account");
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."Barracks Rental Account");
          TotalScheduledPrice := GetScheduledTotalPrice(OnDelete) * (Itm."Percentage Calc. (Contract)" / 100);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledPrice);
            JPL.MODIFY;
          END;
        END;

        // Update Miscelleneous Account
        IF JobPostingGrp."Miscelleneous Account" <> '' THEN BEGIN
          Itm.GET(JobPostingGrp."Miscelleneous Account");
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."Miscelleneous Account");
          TotalScheduledPrice := GetScheduledTotalPrice(OnDelete) * (Itm."Percentage Calc. (Contract)" / 100);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledPrice);
            JPL.MODIFY;
          END;
        END;

        // Update Tools & Equipment Depreciation Account
        IF JobPostingGrp."Tools & Eqpmt. Depr. Account" <> '' THEN BEGIN
          Itm.GET(JobPostingGrp."Tools & Eqpmt. Depr. Account");
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."Tools & Eqpmt. Depr. Account");
          TotalScheduledPrice := GetScheduledTotalPrice(OnDelete) * (Itm."Percentage Calc. (Contract)" / 100);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledPrice);
            JPL.MODIFY;
          END;
        END;

        // Up Permitting Cost
        IF JobPostingGrp."Permitting Account" <> '' THEN BEGIN
          Itm.GET(JobPostingGrp."Permitting Account");
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."Permitting Account");
          TotalScheduledPrice := GetScheduledTotalPrice(OnDelete) * (Itm."Percentage Calc. (Contract)" / 100);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledPrice);
            JPL.MODIFY;
          END;
        END;

        // Update Insurance Cost
        IF JobPostingGrp."Insurance Account" <> '' THEN BEGIN
          Itm.GET(JobPostingGrp."Insurance Account");
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."Insurance Account");
          TotalScheduledPrice := GetScheduledTotalPrice(OnDelete) * (Itm."Percentage Calc. (Contract)" / 100);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledPrice);
            JPL.MODIFY;
          END;
        END;

        // Update In house Benefits Account
        IF (Type = Type::Resource) AND (JobPostingGrp."OSP Inhouse Benefits Account" <> '') THEN BEGIN
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."OSP Inhouse Benefits Account");
          TotalScheduledBenefits := GetScheduledTotalCostInHouseBenefits(OnDelete);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledBenefits);
            JPL.MODIFY;
          END;
        END;

        // Update Communication Account
        IF (Type = Type::Resource) AND (JobPostingGrp."Communication Account" <> '') THEN BEGIN
          JPL.RESET;
          JPL.SETRANGE("Job No.", "Job No.");
          JPL.SETRANGE(Type, JPL.Type::Item);
          JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
          JPL.SETRANGE("No.", JobPostingGrp."Communication Account");
          TotalScheduledCommunication := GetScheduledTotalCostCommunication(OnDelete);
          IF JPL.FINDFIRST THEN BEGIN
            JPL.SetBypassQtyValidation(TRUE);
            JPL.VALIDATE(Quantity, 1);
            JPL.VALIDATE("Unit Cost", TotalScheduledCommunication);
            JPL.MODIFY;
          END;
        END;

        // Update Backroom Support Account
      //  IF (Type = Type::Resource) AND (JobPostingGrp."Backroom Support Account" <> '') THEN BEGIN
      //    JPL.RESET;
      //    JPL.SETRANGE("Job No.", "Job No.");
      //    JPL.SETRANGE(Type, JPL.Type::Item);
      //    JPL.SETRANGE("Job Posting Group ID", Job."Job Posting Group");
      //    JPL.SETRANGE("No.", JobPostingGrp."Backroom Support Account");
      //    TotalScheduledBackroomSupport := GetScheduledTotalCostBackroomSupport(OnDelete);
      //    IF JPL.FINDFIRST THEN BEGIN
      //      JPL.VALIDATE(Quantity, 1);
      //      JPL.VALIDATE("Unit Cost", TotalScheduledBackroomSupport);
      //      JPL.MODIFY;
      //    END;
      //  END;

      END;
      // PHP Start
    END;

    LOCAL PROCEDURE GetScheduledTotalPrice@66(OnDelete@1002 : Boolean) : Decimal;
    VAR
      JPL@1000 : Record 1003;
      TotalLineAmt@1001 : Decimal;
    BEGIN
      // PHP Start
       JPL.RESET;
       JPL.SETRANGE("Job No.", "Job No.");
       JPL.SETRANGE("Schedule Line", TRUE);
       JPL.SETFILTER("Unit Price", '<>0');
       TotalLineAmt := 0;
       IF JPL.FINDSET THEN BEGIN
        REPEAT
          IF NOT((JPL."Job Task No." = "Job Task No.") AND (JPL."Line No." = "Line No.")) THEN
           TotalLineAmt += JPL."Line Amount";
        UNTIL JPL.NEXT = 0;
       END;
       IF "Schedule Line" AND NOT OnDelete THEN BEGIN
        TotalLineAmt += "Line Amount";
       END;
       EXIT(TotalLineAmt);
      // PHP End
    END;

    LOCAL PROCEDURE GetScheduledTotalCostInHouseBenefits@188(OnDelete@1002 : Boolean) : Decimal;
    VAR
      JPL@1000 : Record 1003;
      TotalAmt@1001 : Decimal;
    BEGIN
      // PHP Start
       JPL.RESET;
       JPL.SETRANGE("Job No.", "Job No.");
       JPL.SETRANGE("Schedule Line", TRUE);
       TotalAmt := 0;

       IF JPL.FINDSET THEN BEGIN
        REPEAT
          IF NOT((JPL."Job Task No." = "Job Task No.") AND (JPL."Line No." = "Line No.")) THEN
           TotalAmt += JPL."Total In-House Benefits Cost";
        UNTIL JPL.NEXT = 0;
       END;
       IF "Schedule Line" AND NOT OnDelete THEN BEGIN
        TotalAmt += "Total In-House Benefits Cost";
       END;

       EXIT(TotalAmt);
      // PHP End
    END;

    LOCAL PROCEDURE GetScheduledTotalCostCommunication@196(OnDelete@1002 : Boolean) : Decimal;
    VAR
      JPL@1000 : Record 1003;
      TotalAmt@1001 : Decimal;
    BEGIN
      // PHP Start
       JPL.RESET;
       JPL.SETRANGE("Job No.", "Job No.");
       JPL.SETRANGE("Schedule Line", TRUE);
       TotalAmt := 0;

       IF JPL.FINDSET THEN BEGIN
        REPEAT
          IF NOT((JPL."Job Task No." = "Job Task No.") AND (JPL."Line No." = "Line No.")) THEN
           TotalAmt += JPL."Total Communication Cost";
        UNTIL JPL.NEXT = 0;
       END;
       IF "Schedule Line" AND NOT OnDelete THEN BEGIN
        TotalAmt += "Total Communication Cost";
       END;

       EXIT(TotalAmt);
      // PHP End
    END;

    LOCAL PROCEDURE GetScheduledTotalCostBackroomSupport@63(OnDelete@1002 : Boolean) : Decimal;
    VAR
      JPL@1000 : Record 1003;
      TotalAmt@1001 : Decimal;
    BEGIN
      // PHP Start
       JPL.RESET;
       JPL.SETRANGE("Job No.", "Job No.");
       JPL.SETRANGE("Schedule Line", TRUE);
       TotalAmt := 0;

       IF JPL.FINDSET THEN BEGIN
        REPEAT
          IF NOT((JPL."Job Task No." = "Job Task No.") AND (JPL."Line No." = "Line No.")) THEN
           TotalAmt += JPL."Total Backroom Support Cost";
        UNTIL JPL.NEXT = 0;
       END;
       IF "Schedule Line" AND NOT OnDelete THEN BEGIN
        TotalAmt += "Total Backroom Support Cost";
       END;

       EXIT(TotalAmt);
      // PHP End
    END;

    PROCEDURE OpenPurchaseDocument@71(JobPlanningLines@1000 : Record 1003;PurchaseLineReqType@1001 : Option);
    VAR
      PurchaseHeader@1006 : Record 38;
      PurchaseLine@1007 : Record 39;
      CashAdvancePage@1008 : Page 50021;
      RFPaymentPage@1002 : Page 50554;
      RFPurchasePage@1003 : Page 50031;
      NoRecordFound@1004 : TextConst 'ENU=No record record has been link to this record.';
    BEGIN

      IF JobPlanningLines."Line Type" = JobPlanningLines."Line Type"::Contract THEN
        EXIT;

      PurchaseLine.SETFILTER("Job No.", JobPlanningLines."Job No.");
      PurchaseLine.SETFILTER("Job Task No.", JobPlanningLines."Job Task No.");
      PurchaseLine.SETRANGE("Job Planning Line No.", JobPlanningLines."Line No.");
      PurchaseLine.SETRANGE("Request Type", PurchaseLineReqType);
      IF PurchaseLine.FINDFIRST AND
        (PurchaseHeader.GET(PurchaseLine."Document Type", PurchaseLine."Document No.")) THEN BEGIN
        IF PurchaseLineReqType = PurchaseLine."Request Type"::"Cash Advance" THEN BEGIN
          CashAdvancePage.SETRECORD(PurchaseHeader);
          CashAdvancePage.RUN;
          EXIT;
        END;
        IF PurchaseLineReqType = PurchaseLine."Request Type"::"Request for Payment" THEN BEGIN
          RFPaymentPage.SETRECORD(PurchaseHeader);
          RFPaymentPage.RUN;
          EXIT;
        END;
        IF PurchaseLineReqType = PurchaseLine."Request Type"::"Request for Purchase" THEN BEGIN
          RFPurchasePage.SETRECORD(PurchaseHeader);
          RFPurchasePage.RUN;
          EXIT;
        END;
      END;

      IF PurchaseLineReqType = PurchaseLine."Request Type"::"Cash Advance" THEN BEGIN
        MESSAGE(NoRecordFound, PurchaseLine."Request Type"::"Cash Advance");
      END;

      IF PurchaseLineReqType = PurchaseLine."Request Type"::"Request for Payment" THEN BEGIN
        MESSAGE(NoRecordFound, PurchaseLine."Request Type"::"Request for Payment");
      END;

      IF PurchaseLineReqType = PurchaseLine."Request Type"::"Request for Purchase" THEN BEGIN
        MESSAGE(NoRecordFound, PurchaseLine."Request Type"::"Request for Purchase");
      END;
    END;

    [Integration(TRUE)]
    LOCAL PROCEDURE OnUpdateUnitCost@89();
    BEGIN
    END;

    BEGIN
    {
      How to update the unit cost for addition column for cost.

      Function that needs to be updated
      * UpdateUnitCost
      * UpdateTotalCost
      * DeleteAmounts

      * Add testfield on No column to avoid selecting the No Item Setup.
    }
    END.
  }
}

