OBJECT Table 1516 Dynamic Request Page Field
{
  OBJECT-PROPERTIES
  {
    Date=06/26/18;
    Time=[ 3:28:27 AM];
    Modified=Yes;
    Version List=NAVW19.00,NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Dynamic Request Page Field;
    LookupPageID=Page1536;
  }
  FIELDS
  {
    { 1   ;   ;Table ID            ;Integer       ;TableRelation="Table Metadata".ID;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Table Name","Table Caption");
                                                              END;

                                                   CaptionML=ENU=Table ID;
                                                   NotBlank=Yes }
    { 2   ;   ;Field ID            ;Integer       ;TableRelation=Field.No. WHERE (TableNo=FIELD(Table ID));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Field Name","Field Caption");
                                                              END;

                                                   CaptionML=ENU=Field ID;
                                                   NotBlank=Yes }
    { 3   ;   ;Table Name          ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Table Metadata".Name WHERE (ID=FIELD(Table ID)));
                                                   CaptionML=ENU=Table Name }
    { 4   ;   ;Table Caption       ;Text250       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Table Metadata".Caption WHERE (ID=FIELD(Table ID)));
                                                   CaptionML=ENU=Table Caption }
    { 5   ;   ;Field Name          ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Field.FieldName WHERE (TableNo=FIELD(Table ID),
                                                                                             No.=FIELD(Field ID)));
                                                   CaptionML=ENU=Field Name }
    { 6   ;   ;Field Caption       ;Text250       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Field."Field Caption" WHERE (TableNo=FIELD(Table ID),
                                                                                                   No.=FIELD(Field ID)));
                                                   CaptionML=ENU=Field Caption }
  }
  KEYS
  {
    {    ;Table ID,Field ID                       ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {

    BEGIN
    {
      11:06 AM Thursday, August 1, 2024
        Change the Character Lenght of Table Caption and Field Caption from 30 to 250. To Fix the error in setting up a new company.
    }
    END.
  }
}

OBJECT Table 9001 User Group Member
{
  OBJECT-PROPERTIES
  {
    Date=06/26/18;
    Time=12:15:03 AM;
    Modified=Yes;
    Version List=NAVW19.00.00.46621,NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    DataPerCompany=No;
    OnInsert=VAR
               UserGroupAccessControl@1000 : Record 9002;
             BEGIN
               UserGroupAccessControl.AddUserGroupMember("User Group Code","User Security ID","Company Name");
             END;

    OnModify=BEGIN
               IF ("User Group Code" <> xRec."User Group Code") OR
                  ("User Security ID" <> xRec."User Security ID") OR
                  ("Company Name" <> xRec."Company Name")
               THEN
                 ModifyUserGroupMembership;
             END;

    OnDelete=VAR
               UserGroupAccessControl@1000 : Record 9002;
             BEGIN
               UserGroupAccessControl.RemoveUserGroupMember("User Group Code","User Security ID","Company Name");
               UpdateDefaultProfileOfUser("User Group Code");
             END;

    OnRename=BEGIN
               ModifyUserGroupMembership;
             END;

    CaptionML=ENU=User Group Member;
  }
  FIELDS
  {
    { 1   ;   ;User Group Code     ;Code20        ;TableRelation="User Group";
                                                   CaptionML=ENU=User Group Code;
                                                   NotBlank=Yes }
    { 2   ;   ;User Security ID    ;GUID          ;TableRelation=User;
                                                   CaptionML=ENU=User Security ID }
    { 3   ;   ;Company Name        ;Text30        ;TableRelation=Company;
                                                   CaptionML=ENU=Company Name }
    { 4   ;   ;User Name           ;Code50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(User."User Name" WHERE (User Security ID=FIELD(User Security ID)));
                                                   CaptionML=ENU=User Name;
                                                   Editable=No }
    { 5   ;   ;User Full Name      ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(User."Full Name" WHERE (User Security ID=FIELD(User Security ID)));
                                                   CaptionML=ENU=User Full Name;
                                                   Editable=No }
    { 6   ;   ;User Group Name     ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("User Group".Name WHERE (Code=FIELD(User Group Code)));
                                                   CaptionML=ENU=User Group Name;
                                                   Editable=No }
    { 7   ;   ;Contact Email       ;Text250       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(User."Contact Email" WHERE (User Security ID=FIELD(User Security ID)));
                                                   Editable=No }
    { 50500;  ;State               ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(User.State WHERE (User Security ID=FIELD(User Security ID)));
                                                   OptionCaptionML=ENU=Enabled,Disabled;
                                                   OptionString=Enabled,Disabled;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;User Group Code,User Security ID,Company Name;
                                                   Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {

    PROCEDURE AddUsers@1(SelectedCompany@1002 : Text[30]);
    VAR
      User@1001 : Record 2000000120;
      Users@1000 : Page 9800;
    BEGIN
      IF GETFILTER("User Group Code") = '' THEN
        EXIT;

      Users.LOOKUPMODE := TRUE;
      IF Users.RUNMODAL = ACTION::LookupOK THEN BEGIN
        Users.GetSelectionFilter(User);
        IF User.FINDSET THEN
          REPEAT
            "User Group Code" := GETRANGEMIN("User Group Code");
            "User Security ID" := User."User Security ID";
            "Company Name" := SelectedCompany;
            IF INSERT(TRUE) THEN;
          UNTIL User.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE ModifyUserGroupMembership@5();
    VAR
      UserGroupAccessControl@1001 : Record 9002;
      UserGroupMember@1003 : Record 9001;
      ConfPersonalizationMgt@1002 : Codeunit 9170;
    BEGIN
      IF ISNULLGUID("User Security ID") OR ("User Group Code" = '') THEN
        EXIT;
      UserGroupAccessControl.RemoveUserGroupMember(xRec."User Group Code",xRec."User Security ID",xRec."Company Name");
      UserGroupAccessControl.AddUserGroupMember("User Group Code","User Security ID","Company Name");

      // If there is more than one User group assigned to a user, then use the company default profile
      UserGroupMember.SETRANGE("User Security ID","User Security ID");
      UserGroupMember.SETFILTER("User Group Code",'<>%1',xRec."User Group Code");
      IF NOT UserGroupMember.ISEMPTY THEN BEGIN
        // When there are more than two user groups assigned to this user, assign to him the default profile
        CopyDefaultProfileToUser(ConfPersonalizationMgt.GetProfileHavingDefaultRoleCenter,TRUE);
        EXIT;
      END;

      // Else assign the profile of the current user group
      UpdateDefaultProfileOfUser(xRec."User Group Code");
    END;

    LOCAL PROCEDURE UpdateDefaultProfileOfUser@12(UserGroupCode@1003 : Code[20]);
    VAR
      UserGroupMember@1002 : Record 9001;
      UserPersonalization@1001 : Record 2000000073;
    BEGIN
      UserGroupMember.SETRANGE("User Security ID","User Security ID");
      UserGroupMember.SETFILTER("User Group Code",'<>%1',UserGroupCode);
      IF NOT UserGroupMember.FINDFIRST THEN BEGIN
        IF NOT UserPersonalization.GET("User Security ID") THEN
          EXIT;
        UserPersonalization."Profile ID" := '';
        UserPersonalization.MODIFY(TRUE);
      END;
    END;

    LOCAL PROCEDURE CopyDefaultProfileToUser@9(DefaultProfileID@1003 : Code[30];Force@1000 : Boolean);
    VAR
      UserPersonalization@1002 : Record 2000000073;
    BEGIN
      IF DefaultProfileID = '' THEN
        EXIT;
      // Force = TRUE overwrites the current default profile
      IF NOT UserPersonalization.GET("User Security ID") THEN BEGIN
        UserPersonalization.INIT;
        UserPersonalization."User SID" := "User Security ID";
        UserPersonalization."Profile ID" := DefaultProfileID;
        UserPersonalization.INSERT(TRUE);
      END ELSE
        IF (UserPersonalization."Profile ID" = '') OR Force THEN BEGIN
          UserPersonalization."Profile ID" := DefaultProfileID;
          UserPersonalization.MODIFY(TRUE);
        END;
    END;

    BEGIN
    {
      !! Documentation Table 9001 User Group Member

        12:05 PM Monday, October 14, 2024
          Change the Contact Email Length from 50 to 250.


    }
    END.
  }
}

OBJECT Codeunit 1510 Notification Management
{
  OBJECT-PROPERTIES
  {
    Date=06/26/18;
    Time=10:40:56 PM;
    Modified=Yes;
    Version List=NAVW19.00,NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    Permissions=TableData 458=i,
                TableData 1510=r,
                TableData 1511=rimd;
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      SoftwareNameTxt@1000 : TextConst '@@@={Locked};ENU=Microsoft Dynamics NAV';
      TitleWorkflowNotificationEngineTxt@1001 : TextConst 'ENU=Workflow Notification Engine';
      TitleApprovalSystemTxt@1010 : TextConst 'ENU=Microsoft Dynamics NAV Approval System';
      RTCHyperlinkTxt@1003 : TextConst 'ENU=To view the record in the Windows client, choose this link';
      WebHyperlinkTxt@1004 : TextConst 'ENU=Web client';
      PurchDocTypeTxt@1045 : TextConst '@@@="%1 = Document No.";ENU=Purchase %1';
      SalesDocTypeTxt@1021 : TextConst '@@@="%1 = Document No.";ENU=Sales %1';
      CustomerTypeTxt@1012 : TextConst '@@@="%1 = Customer No.";ENU=Customer %1';
      ActionApproveTxt@1044 : TextConst 'ENU=requires your approval.';
      ActionApproveExtensionOfRFETxt@1018 : TextConst 'ENU=extension of commitment date requires your approval.';
      ActionApprovedTxt@1013 : TextConst 'ENU=has been approved.';
      ActionCreateTxt@1005 : TextConst 'ENU=has been created and successfully completed the approval process.';
      ActionCancelTxt@1007 : TextConst 'ENU=has been canceled.';
      ActionRejectTxt@1006 : TextConst 'ENU=has been rejected.';
      ActionOpenTxt@1030 : TextConst 'ENU=has been reopened.';
      ActionChangeOfINTPStatusTxt@1031 : TextConst 'ENU=status has been changed to <strong>%1</strong>.';
      ActionOverdueTxt@1008 : TextConst '@@@="%1 = date when document was due.";ENU=has a pending approval with due date %1.';
      ActionBeforeDueRFETxt@1014 : TextConst '@@@="%1 = date when document was due.";ENU=has <strong>%1</strong> day/s left to regularize before the deadline.';
      ActionOverdueRFETxt@1015 : TextConst '@@@="%1 = date when document was due.";ENU=is overdue.';
      ActionNoOfDaysOverdueRFETxt@1027 : TextConst 'ENU=is %1 day/s overdue.';
      ActionRFESubjectForNTETxt@1016 : TextConst '@@@="%1 = date when document was due.";ENU=is subject for notice to explain.';
      ActionNOSTxt@1028 : TextConst 'ENU=has generated a Notice of Shipment.';
      ActionNeglectedRFESubjectForNTETxt@1024 : TextConst '@@@="%1 = date when document was due.";ENU=is overdue for <strong>%1</strong> day/s without assesment of notice to explain.';
      ActionReturnedMaterialsTxt@1019 : TextConst 'ENU=has been returned to the warehouse.';
      ActionReleasedMaterialsTxt@1023 : TextConst 'ENU=has been released from the warehouse and ready for pickup.';
      ActionForNoteTxt@1029 : TextConst 'ENU=created a note for you. Please see the details below.';
      ActionStagnantOpportunity@1032 : TextConst 'ENU=This email is to inform that your opportunity has been inactive for almost %1 days.';
      ActionLeadtimeReminderOppEntry@1033 : TextConst 'ENU=This email will serve as a notification that your opportunity is reaching its estimated close date.';
      ActionNewToDoTxt@1034 : TextConst 'ENU=has been added to your to-do list.';
      ActionCompletedToDoTxt@1037 : TextConst 'ENU=has been completed.';
      ActionCanceledToDoTxt@1038 : TextConst 'ENU=has been canceled.';
      ActionReminderTodoTxt@1035 : TextConst 'ENU=is reaching its ending date.';
      ActionOverdueTodoTxt@1036 : TextConst 'ENU=is %1 day/s overdue.';
      ActionNoTxt@1011 : TextConst '@@@="%1 = Document identifier such as ''Sales Invoice 1002''";ENU=No action is required for %1.';
      CustomUrlAndAnchorTxt@1020 : TextConst '@@@="Translate only ""Other link"". The rest needs to stay the same. Eg. (<a href=""http://dynamics.sharepoint.com/"">Other link</a>)";ENU="(<a href=""%1"">other client</a>)"';
      AdditionalHtmlLineTxt@1009 : TextConst '@@@={Locked};ENU="<p><span style=""font-size: 11.0pt; font-family: Calibri"">%1</span></p>"';
      CommentsHdrTxt@1002 : TextConst 'ENU=Comments:';
      PageManagement@1022 : Codeunit 700;
      LinkNotAvailableTxt@1017 : TextConst 'ENU=There is no link for this notification entry, because the related record no longer exists.';
      ClientLinksTok@1025 : TextConst '@@@={Locked};ENU="<a href=""%1"">%2</a> (<a href=""%3"">%4</a>)"';
      OverdueEntriesMsg@1047 : TextConst 'ENU=Overdue approval entries have been created.';
      CustomNotificationManagement@1040 : Codeunit 50581;

    PROCEDURE CreateOverdueNotifications@14(WorkflowStepArgument@1002 : Record 1523);
    VAR
      UserSetup@1006 : Record 91;
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
    BEGIN
      IF UserSetup.FINDSET THEN
        REPEAT
          ApprovalEntry.RESET;
          ApprovalEntry.SETRANGE("Approver ID",UserSetup."User ID");
          ApprovalEntry.SETRANGE(Status,ApprovalEntry.Status::Open);
          ApprovalEntry.SETFILTER("Due Date",'<=%1',TODAY);
          IF ApprovalEntry.FINDSET THEN
            REPEAT
              NotificationEntry.CreateNew(NotificationEntry.Type::Overdue,
                UserSetup."User ID",ApprovalEntry,WorkflowStepArgument."Link Target Page",
                WorkflowStepArgument."Custom Link");
              InsertOverdueEntry(ApprovalEntry);
            UNTIL ApprovalEntry.NEXT = 0;
        UNTIL UserSetup.NEXT = 0;

      MESSAGE(OverdueEntriesMsg);
    END;

    PROCEDURE CreateOverdueRFENotification@6(WorkflowStepArgument@1002 : Record 1523);
    VAR
      UserSetup@1006 : Record 91;
      UserSetup2@1004 : Record 91;
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
      SalesHeader@1001 : Record 36;
      DaysLeft@1005 : Integer;
    BEGIN
      SalesHeader.SETRANGE("Document Type", SalesHeader."Document Type"::Invoice);
      SalesHeader.SETRANGE("Request type", SalesHeader."Request type"::"Request For Exception");
      SalesHeader.SETRANGE(Status, SalesHeader.Status::Released);
      SalesHeader.SETFILTER("Person Incharge", '<>''''');
      SalesHeader.SETFILTER("Status of Regularization",'%1|%2|%3',
        SalesHeader."Status of Regularization"::" ", SalesHeader."Status of Regularization"::"In-Progress", SalesHeader."Status of Regularization"::Overdue);
      SalesHeader.SETFILTER("Date Regularized", '''''');

      // Notification before overdue 4,3,2 & 1 Days
       SalesHeader.SETFILTER("Commitment Date", 'TODAY-1D..TODAY+4D'); // -1D to From Date to get the 1 day overdue RFE.
      // SalesHeader.SETFILTER("Commitment Date", '..TODAY-1D'); // Persistent Notification
      SalesHeader.SETFILTER("Approved Date of Extension", '''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          UserSetup2.SETRANGE("Employee No.", SalesHeader."Person Incharge");
          IF UserSetup2.FINDSET THEN BEGIN
            REPEAT
              NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE",
                UserSetup2."User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
                WorkflowStepArgument."Custom Link");
            UNTIL UserSetup2.NEXT = 0;
          END;
          // Change Status of Regularization
          SalesHeader.SetStatusOfRegularizationToInProgressOverdue;
          SalesHeader.MODIFY;
        UNTIL SalesHeader.NEXT = 0;
      END;

      // Email notification of overdue RFE to person incharge w/o extension
       SalesHeader.SETFILTER("Commitment Date", '<>''''&..TODAY-1D'); // -1D to From Date to get the 1 day overdue RFE.
      SalesHeader.SETFILTER("Approved Date of Extension", '''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          UserSetup2.SETRANGE("Employee No.", SalesHeader."Person Incharge");
          IF UserSetup2.FINDSET THEN BEGIN
            REPEAT
              NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE",
                UserSetup2."User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
                WorkflowStepArgument."Custom Link");
            UNTIL UserSetup2.NEXT = 0;
          END;
          SalesHeader.SetStatusOfRegularizationToInProgressOverdue;
          SalesHeader.MODIFY;
        UNTIL SalesHeader.NEXT = 0;
      END;

      // Notification before overdue 4,3,2 & 1 Days w/ extensions
       SalesHeader.SETFILTER("Approved Date of Extension", '<>''''&TODAY-1D..TODAY+4D'); // -1D to from date to get the 1 day overdue RFE.
      SalesHeader.SETFILTER("Commitment Date", '<>''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          UserSetup2.SETRANGE("Employee No.", SalesHeader."Person Incharge");
          IF UserSetup2.FINDSET THEN BEGIN
            REPEAT
              NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE",
                UserSetup2."User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
                WorkflowStepArgument."Custom Link");
            UNTIL UserSetup2.NEXT = 0;
          END;
          SalesHeader.SetStatusOfRegularizationToInProgressOverdue;
          SalesHeader.MODIFY;

        UNTIL SalesHeader.NEXT = 0;
      END;

      // Email notification of overdue RFE to person incharge w/ extension
       SalesHeader.SETFILTER("Approved Date of Extension", '<>''''&..TODAY-1D'); // -1D to from date to get the 1 day overdue RFE.
      SalesHeader.SETFILTER("Commitment Date", '<>''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          UserSetup2.SETRANGE("Employee No.", SalesHeader."Person Incharge");
          IF UserSetup2.FINDSET THEN BEGIN
            REPEAT
              NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE",
                UserSetup2."User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
                WorkflowStepArgument."Custom Link");
            UNTIL UserSetup2.NEXT = 0;
          END;
          SalesHeader.SetStatusOfRegularizationToInProgressOverdue;
          SalesHeader.MODIFY;

        UNTIL SalesHeader.NEXT = 0;
      END;

      MESSAGE(OverdueEntriesMsg);
    END;

    PROCEDURE CreateOverdueRFEForNTENotification@18(WorkflowStepArgument@1007 : Record 1523);
    VAR
      UserSetup@1006 : Record 91;
      UserSetup2@1004 : Record 91;
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
      SalesHeader@1001 : Record 36;
      DaysLeft@1005 : Integer;
    BEGIN
      SalesHeader.SETRANGE("Document Type", SalesHeader."Document Type"::Invoice);
      SalesHeader.SETRANGE("Request type", SalesHeader."Request type"::"Request For Exception");
      SalesHeader.SETRANGE(Status, SalesHeader.Status::Released);
      SalesHeader.SETFILTER("Person Incharge", '<>''''');
      SalesHeader.SETFILTER("Status of Regularization",'%1|%2|%3',
        SalesHeader."Status of Regularization"::" ", SalesHeader."Status of Regularization"::"In-Progress", SalesHeader."Status of Regularization"::Overdue);
      SalesHeader.SETFILTER("Date Regularized", '''''');
      SalesHeader.SETFILTER("Notice to Explain No.", '''''');

      // RFE that needs to be regularized
      SalesHeader.SETFILTER("Commitment Date", '..TODAY-1D'); // -1D to From Date to get the past due RFE | Persistent notification to Concerned Person
      SalesHeader.SETFILTER("Approved Date of Extension", '''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE-4NTE",
           WorkflowStepArgument."Notification User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
            WorkflowStepArgument."Custom Link");
        UNTIL SalesHeader.NEXT = 0;
      END;

      // PAGE.RUN(PAGE::"Request for Exceptions",SalesHeader);
      SalesHeader.SETFILTER("Approved Date of Extension", '<>''''&..TODAY-1D'); // -1D to Start Date to get the past due RFE.
      SalesHeader.SETFILTER("Commitment Date", '<>''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE-4NTE",
           WorkflowStepArgument."Notification User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
            WorkflowStepArgument."Custom Link");
        UNTIL SalesHeader.NEXT = 0;
      END;
    END;

    PROCEDURE CreateNeglectedRFEForNTENotificationFor@7(WorkflowStepArgument@1007 : Record 1523);
    VAR
      UserSetup@1006 : Record 91;
      UserSetup2@1004 : Record 91;
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
      SalesHeader@1001 : Record 36;
      DaysLeft@1005 : Integer;
    BEGIN
      SalesHeader.SETRANGE("Document Type", SalesHeader."Document Type"::Invoice);
      SalesHeader.SETRANGE("Request type", SalesHeader."Request type"::"Request For Exception");
      SalesHeader.SETRANGE(Status, SalesHeader.Status::Released);
      SalesHeader.SETFILTER("Person Incharge", '<>''''');
      SalesHeader.SETFILTER("Status of Regularization",'%1|%2|%3',
        SalesHeader."Status of Regularization"::" ", SalesHeader."Status of Regularization"::"In-Progress", SalesHeader."Status of Regularization"::Overdue);
      SalesHeader.SETFILTER("Date Regularized", '''''');
      SalesHeader.SETFILTER("Notice to Explain No.", '''''');

      // RFE that needs to be regularized
      SalesHeader.SETFILTER("Commitment Date", '..TODAY-5D'); // -5D to From Date to get 5D and 5D+ past due RFE.
      SalesHeader.SETFILTER("Approved Date of Extension", '''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE-N4NTE",
           WorkflowStepArgument."Notification User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
            WorkflowStepArgument."Custom Link");
        UNTIL SalesHeader.NEXT = 0;
      END;

      // RFE With Approved Date of Extension. run notif 4th, 3rd, 2nd before due and on due of RFE.
      SalesHeader.SETFILTER("Approved Date of Extension", '<>''''&..TODAY-5D'); // -5D to From Date to get 5D & 5D+ past due RFE.
      SalesHeader.SETFILTER("Commitment Date", '<>''''');
      IF SalesHeader.FINDSET THEN BEGIN
        REPEAT
          NotificationEntry.CreateNew(NotificationEntry.Type::"Overdue-RFE-N4NTE",
           WorkflowStepArgument."Notification User ID" ,SalesHeader,WorkflowStepArgument."Link Target Page",
            WorkflowStepArgument."Custom Link");
        UNTIL SalesHeader.NEXT = 0;
      END;
    END;

    PROCEDURE CreateStagnantOpportunityNotification@22(WorkflowStepArgument@1007 : Record 1523);
    VAR
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
      Opportunity@1001 : Record 5092;
      UserSetup@1004 : Record 91;
      Salesperson@1002 : Record 13;
    BEGIN
      // PHP Start
      Opportunity.SETFILTER("Estimated Closing Date", '..TODAY-30D');
      Opportunity.SETRANGE(Status, Opportunity.Status::"In Progress");

      IF Opportunity.FINDSET THEN
        REPEAT
          UserSetup.SETRANGE("Salespers./Purch. Code", Opportunity."Salesperson Code");
          IF UserSetup.FINDFIRST THEN BEGIN
            Salesperson.GET(Opportunity."Salesperson Code");
            NotificationEntry.CreateNew2(NotificationEntry.Type::"Stgnnt-Opp",
              UserSetup."User ID",Opportunity,WorkflowStepArgument."Link Target Page",
              WorkflowStepArgument."Custom Link",Salesperson.GetUserSetupApproverEmail,'','');
          END;
        UNTIL Opportunity.NEXT = 0;
      // PHP End
    END;

    PROCEDURE CreateOpportunityEstimatedCloseDateNotification@24(WorkflowStepArgument@1007 : Record 1523);
    VAR
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
      UserSetup@1004 : Record 91;
      Salesperson@1002 : Record 13;
      Opportunity@1001 : Record 5092;
    BEGIN
      // PHP Start
      Opportunity.SETFILTER("Estimated Closing Date", 'TODAY..TODAY+5D');
      Opportunity.SETRANGE(Status, Opportunity.Status::"In Progress");
       IF Opportunity.FINDSET THEN
        REPEAT
          UserSetup.SETRANGE("Salespers./Purch. Code", Opportunity."Salesperson Code");
          IF UserSetup.FINDFIRST THEN BEGIN
            Salesperson.GET(Opportunity."Salesperson Code");
            NotificationEntry.CreateNew2(NotificationEntry.Type::"LT-OppEty",
              UserSetup."User ID",Opportunity,WorkflowStepArgument."Link Target Page",
              WorkflowStepArgument."Custom Link",Salesperson.GetUserSetupApproverEmail,'','');
          END;
        UNTIL Opportunity.NEXT = 0;
      // PHP End
    END;

    PROCEDURE CreateToDoReminderNotification@27(WorkflowStepArgument@1007 : Record 1523);
    VAR
      ApprovalEntry@1000 : Record 454;
      NotificationEntry@1003 : Record 1511;
      UserSetup@1004 : Record 91;
      Salesperson@1002 : Record 13;
      ToDoOverDue@1001 : Record 5080;
      ToDoBeforeDue@1005 : Record 5080;
    BEGIN
      // PHP Start
      // Send Reminder before due date
      ToDoBeforeDue.SETRANGE(Status, ToDoBeforeDue.Status::"In Progress");
      ToDoBeforeDue.SETRANGE(Type, ToDoBeforeDue.Type::" ");
      ToDoBeforeDue.SETFILTER("Salesperson Code", '<>''''');
      ToDoBeforeDue.SETFILTER("Ending Date", 'TODAY..TODAY+5D'); // Filter Todo 1,2,3,4,5 Days before the deadline
      IF ToDoBeforeDue.FINDSET THEN
       REPEAT
         UserSetup.SETRANGE("Salespers./Purch. Code", ToDoBeforeDue."Salesperson Code");
         IF UserSetup.FINDFIRST THEN BEGIN
           Salesperson.GET(ToDoBeforeDue."Salesperson Code");
           NotificationEntry.CreateNew2(NotificationEntry.Type::"Rem-ToDo",
             UserSetup."User ID",ToDoBeforeDue,WorkflowStepArgument."Link Target Page",
             WorkflowStepArgument."Custom Link",Salesperson.GetUserSetupApproverEmail,'','');
         END;
       UNTIL ToDoBeforeDue.NEXT = 0;

      // Send Overdue reminder
      ToDoOverDue.SETRANGE(Status, ToDoOverDue.Status::"In Progress");
      ToDoOverDue.SETRANGE(Type, ToDoOverDue.Type::" ");
      ToDoOverDue.SETFILTER("Salesperson Code", '<>''''');
      ToDoOverDue.SETFILTER("Ending Date", 'TODAY-2D..TODAY-1D');
       IF ToDoOverDue.FINDSET THEN
        REPEAT
          UserSetup.SETRANGE("Salespers./Purch. Code", ToDoOverDue."Salesperson Code");
          IF UserSetup.FINDFIRST THEN BEGIN
            Salesperson.GET(ToDoOverDue."Salesperson Code");
            NotificationEntry.CreateNew2(NotificationEntry.Type::"Ovrd-ToDo",
              UserSetup."User ID",ToDoOverDue,WorkflowStepArgument."Link Target Page",
              WorkflowStepArgument."Custom Link",Salesperson.GetUserSetupApproverEmail,'','');
          END;
        UNTIL ToDoOverDue.NEXT = 0;
      // PHP End
    END;

    PROCEDURE PopulateNotificationTemplateWithRecIndependentInfo@19(VAR NotificationBody@1002 : Text;NotificationEntry@1007 : Record 1511);
    VAR
      NotificationSetup@1004 : Record 1512;
      Customer@1000 : Record 18;
      Vendor@1006 : Record 23;
      Item@1013 : Record 27;
      INTP@1011 : Record 50040;
      JobOrder@1014 : Record 50012;
      RFQ@1012 : Record 50013;
      PurchaseHeader@1010 : Record 38;
      SalesHeader@1009 : Record 36;
      Ticket@1015 : Record 50562;
      DataTypeManagement@1003 : Codeunit 701;
      RecRef@1001 : RecordRef;
      NotificationBodyString@1005 : DotNet "'mscorlib'.System.String";
      PageID@1008 : Integer;
    BEGIN
      NotificationSetup.INIT;
      NotificationSetup.SETRANGE("User ID",NotificationEntry."Recipient User ID");
      DataTypeManagement.GetRecordRef(NotificationSetup,RecRef);
      PageID := PageManagement.GetPageID(RecRef);

      NotificationBodyString := NotificationBodyString.Copy(NotificationBody);

      NotificationBodyString := NotificationBodyString.Replace('%SoftwareName%',SoftwareNameTxt);
      CASE NotificationEntry.Type OF
        NotificationEntry.Type::Approval, NotificationEntry.Type::Overdue:
          NotificationBodyString := NotificationBodyString.Replace('%Title%',TitleApprovalSystemTxt);
        ELSE
          IF NOT CustomNotificationManagement.PopulateCustomNotificationTemplateWithRecIndependentInfo(NotificationBodyString, NotificationEntry) THEN // PHP Start Code Integration
            NotificationBodyString := NotificationBodyString.Replace('%Title%',TitleWorkflowNotificationEngineTxt);
      END;
      NotificationBodyString := NotificationBodyString.Replace(
          '%RTCChangeSettingsHyperLink%',GETURL(CLIENTTYPE::Windows,COMPANYNAME,OBJECTTYPE::Page,PageID,RecRef,TRUE));
      NotificationBodyString := NotificationBodyString.Replace(
          '%WebChangeSettingsHyperLink%',GETURL(CLIENTTYPE::Web,COMPANYNAME,OBJECTTYPE::Page,PageID,RecRef,TRUE));

      NotificationBody := NotificationBodyString.ToString;
    END;

    PROCEDURE PopulateNotificationTemplateWithRecordInfo@12(VAR NotificationBody@1002 : Text;NotificationEntry@1001 : Record 1511);
    VAR
      DataTypeManagement@1004 : Codeunit 701;
      RecRef@1003 : RecordRef;
      RecRef2@1000 : RecordRef;
      NotificationBodyString@1005 : DotNet "'mscorlib'.System.String";
      ClientLinks@1006 : Text;
      SalesHeader@1007 : Record 36;
      INTP@1009 : Record 50040;
      Opportunity@1010 : Record 5092;
      OpportunityEntry@1011 : Record 5093;
      ToDo@1012 : Record 5080;
      DaysLeft@1008 : Integer;
    BEGIN
      DataTypeManagement.GetRecordRef(NotificationEntry."Triggered By Record",RecRef);

      NotificationBodyString := NotificationBodyString.Copy(NotificationBody);

      IF RecRef.FIND THEN BEGIN
        CASE RecRef.NUMBER OF
          DATABASE::"Approval Entry":
            BEGIN
            ReplaceTokensWithApprovalInfo(NotificationBodyString,RecRef,NotificationEntry.Type);
            END;
          ELSE
            // PHP Start Change the Action
            CASE NotificationEntry.Type OF
              NotificationEntry.Type::"Overdue-RFE":
                BEGIN
                  RecRef2 := RecRef;
                  RecRef2.SETTABLE(SalesHeader);
                  IF SalesHeader."Approved Date of Extension" <> 0D THEN
                    DaysLeft := (SalesHeader."Approved Date of Extension" - TODAY) + 1
                  ELSE
                    DaysLeft := (SalesHeader."Commitment Date" - TODAY) + 1;

                  IF DaysLeft >= 1 THEN BEGIN
                    NotificationBodyString := NotificationBodyString.Replace('%Action%',STRSUBSTNO(ActionBeforeDueRFETxt, DaysLeft))
                  END ELSE BEGIN // change messave if overdue
                    IF SalesHeader.GetNoOfDaysOverdue = 0 THEN
                      NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionOverdueRFETxt) // Overdue
                    ELSE
                      NotificationBodyString := NotificationBodyString.Replace('%Action%',STRSUBSTNO(ActionNoOfDaysOverdueRFETxt, SalesHeader.GetNoOfDaysOverdue)); // More than 1 day overdue message
                  END;
                END;
              NotificationEntry.Type::"Overdue-RFE-4NTE":
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionRFESubjectForNTETxt);
              NotificationEntry.Type::"Overdue-RFE-N4NTE":
                BEGIN
                  RecRef2 := RecRef;
                  RecRef2.SETTABLE(SalesHeader);
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',STRSUBSTNO(ActionNeglectedRFESubjectForNTETxt, SalesHeader.GetNoOfDaysOverdue));
                END;
              NotificationEntry.Type::"Returned-TERF":
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionReturnedMaterialsTxt);
              NotificationEntry.Type::"Released-TERF/WW":
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionReleasedMaterialsTxt);
              NotificationEntry.Type::NOS:
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionNOSTxt);
              NotificationEntry.Type::Note:
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionForNoteTxt);
              NotificationEntry.Type::"Open-Purch":
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionOpenTxt);
              NotificationEntry.Type::"Open-Sales":
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionOpenTxt);
              NotificationEntry.Type::"SC-INTP":
                BEGIN
                  RecRef.SETTABLE(INTP);
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',STRSUBSTNO(ActionChangeOfINTPStatusTxt, INTP.Status));
                END;
              NotificationEntry.Type::"Stgnnt-Opp":
                BEGIN
                  RecRef.SETTABLE(Opportunity);
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',STRSUBSTNO(ActionStagnantOpportunity, Opportunity.GetNoOfDaysInactive));
                END;
              NotificationEntry.Type::"LT-OppEty":
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionLeadtimeReminderOppEntry);
              NotificationEntry.Type::"Not-PI-Opp":
                NotificationBodyString := NotificationBodyString.Replace('%UserID%',NotificationEntry."Recipient User ID");
              NotificationEntry.Type::"New-ToDo": // New ToDo
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionNewToDoTxt);
              NotificationEntry.Type::"Com-ToDo": // Completed ToDo
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionCompletedToDoTxt);
              NotificationEntry.Type::"Can-ToDo": // Canceled ToDo
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionCanceledToDoTxt);
              NotificationEntry.Type::"Rem-ToDo":
                NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionReminderTodoTxt);
              NotificationEntry.Type::"Ovrd-ToDo":
                BEGIN
                  RecRef.SETTABLE(ToDo);
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',STRSUBSTNO(ActionOverdueTodoTxt, ToDo.GetNoOfDaysOverdue));
                END;
              ELSE
                BEGIN
            // PHP End
                  CustomNotificationManagement.PopulateCustomNotificationTemplateWithRecordInfo(NotificationBodyString, NotificationEntry);
                // PHP Start of Original Code
                  NotificationBodyString := NotificationBodyString.Replace('%Action%',ActionCreateTxt);
                // PHP End of Original Code
                END;
            END;
        END;
        ReplaceTokensWithRecInfo(NotificationBodyString,RecRef);
        // PHP Start
        GetNotes(NotificationBodyString,RecRef);
        // PHP End
        NotificationBodyString :=
          NotificationBodyString.Replace('%RTCUrl%',PageManagement.GetRTCUrl(RecRef,NotificationEntry."Link Target Page"));
        NotificationBodyString := NotificationBodyString.Replace('%RTCHyperlink%',RTCHyperlinkTxt);
        NotificationBodyString :=
          NotificationBodyString.Replace('%WebUrl%',PageManagement.GetWebUrl(RecRef,NotificationEntry."Link Target Page"));
        NotificationBodyString := NotificationBodyString.Replace('%WebHyperlink%',WebHyperlinkTxt);
        NotificationBodyString := NotificationBodyString.Replace('%CustomUrl%',GetCustomUrlAndAnchor(NotificationEntry."Custom Link"));
      END ELSE BEGIN
        ReplaceTokensWithBlanks(NotificationBodyString,FORMAT(NotificationEntry."Triggered By Record"));
        ClientLinks := STRSUBSTNO(ClientLinksTok,'%RTCUrl%','%RTCHyperlink%','%WebUrl%','%WebHyperlink%');
        NotificationBodyString := NotificationBodyString.Replace(ClientLinks,LinkNotAvailableTxt);
        NotificationBodyString := NotificationBodyString.Replace('%CustomUrl%','');
      END;

      NotificationBody := NotificationBodyString.ToString;
    END;

    LOCAL PROCEDURE ReplaceTokensWithRecInfo@38(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";RecRef@1000 : RecordRef);
    VAR
      PurchaseHeader@1002 : Record 38;
      PaymentTerms@1035 : Record 3;
      PaymentMethod@1036 : Record 289;
      SalesHeader@1004 : Record 36;
      SalesLine@1005 : Record 37;
      Employee@1017 : Record 5200;
      UserGroup@1018 : Record 9000;
      Item@1037 : Record 27;
      Customer@1020 : Record 18;
      SalesEngineer@1031 : Record 156;
      ProjectManager@1032 : Record 156;
      SalesPerson@1033 : Record 13;
      CostAnalyst@1034 : Record 156;
      Contact@1039 : Record 5050;
      Resource@1040 : Record 156;
      ShippingMethod@1021 : Record 10;
      Currency@1022 : Record 4;
      TransactionType@1023 : Record 258;
      TransactionSpec@1024 : Record 285;
      TransportMethod@1025 : Record 259;
      EntryExitPoint@1026 : Record 282;
      Vend@1045 : Record 23;
      Cust@1046 : Record 18;
      Area@1027 : Record 284;
      UserSetup@1057 : Record 91;
      ChangeLog@1058 : Record 405;
      Purchaser@1050 : Record 13;
      Opportunity@1051 : Record 5092;
      ToDo@1060 : Record 5080;
      Job@1063 : Record 167;
      OpporNotifDispatcher@1059 : Codeunit 50563;
      ToDoNotifDispatcher@1061 : Codeunit 50562;
      ApprovedBudgetTimeline@1016 : Text;
      DescriptionOfRequest@1015 : Text;
      Justification@1014 : Text;
      SiteChange@1013 : Text;
      TeamReassignment@1012 : Text;
      MaterialEquipment@1011 : Text;
      NatureOfChangeOthers@1010 : Text;
      PresentSituation@1009 : Text;
      RecommendedChange@1008 : Text;
      RemarksLoc@1007 : Text;
      GTComments@1006 : Text;
      TermsAndCondition@1043 : Text;
      ShippingInstruction@1044 : Text;
      ShippingMarks@1047 : Text;
      InsuranceTxt@1048 : Text;
      Stream@1042 : InStream;
      BinaryReader@1030 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.BinaryReader";
      Encoding@1029 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.Encoding";
      MemoryStream@1028 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      NoteHeaderText@1055 : TextConst 'ENU="<table border=""1"" width=""54%"" id=""table2"" cellspacing=""0"" cellpadding=""0"" style=""font-size:11.0pt; font-family:Calibri""><tr><td colspan=""2"" valign=""top"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableTextBold""><b>NOTES</font></b></td></tr><tr><td width=""139"" valign=""top"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableTextBold""><b>USER ID</font></b></td><td width=""494"" valign=""top"" style=""width:370.3pt;padding:0in 5.4pt 0in 5.4pt""><p class=""TableTextBold""><b>NOTES</font></b></td></tr>"';
      NoteContentText@1054 : TextConst 'ENU="<tr><td width=""139"" valign=""top"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableTextBold""><b>%1</font></b></td><td width=""494"" valign=""top"" style=""width:370.3pt;padding:0in 5.4pt 0in 5.4pt""><p class=""TableText"">%2</font></td></tr>"';
      NoNotesText@1053 : TextConst 'ENU="<tr><td colspan=""2"" valign=""center"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableText"">No available notes.</font></td></tr>"';
      NoteFooterText@1052 : TextConst 'ENU=</table>';
      RecRef2@1056 : RecordRef;
    BEGIN
      // Special Mappings
      CASE RecRef.NUMBER OF
        DATABASE::"Incoming Document":
          BEGIN
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RecRef.CAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'Entry No.');
          END;
        DATABASE::Item:
          BEGIN
            RecRef.SETTABLE(Item);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RecRef.CAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            ConstructItemDetailsForHTML(NotificationBody, Item);
          END;
        DATABASE::Customer:
          BEGIN
            RecRef.SETTABLE(Customer);
            NotificationBody := NotificationBody.Replace('%DocumentType%',RecRef.CAPTION);
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%',RecRef.CAPTION);
            SetTokenToValueOfField(NotificationBody,'%CustomerVendorNo%',RecRef,'No.');
            SetTokenToValueOfField(NotificationBody,'%CustomerVendorName%',RecRef,'Name');
            ConstructCustomerDetailsForHTML(NotificationBody, Customer);

          END;
        DATABASE::"Approval Entry":
          BEGIN
            NotificationBody := NotificationBody.Replace('%DocumentType%','');
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'Record ID to Approve');
          END;
        // PHP Start
        DATABASE::Opportunity:
          BEGIN
            RecRef.SETTABLE(Opportunity);
            NotificationBody := NotificationBody.Replace('%DocumentType%','');
            NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(RecRef.RECORDID));
            NotificationBody := NotificationBody.Replace('%Details%',Opportunity.Description);
            OpporNotifDispatcher.ConstructOpportunityDetailsForHTML(NotificationBody,Opportunity);
          END;
        DATABASE::"To-do":
          BEGIN
            RecRef.SETTABLE(ToDo);
            NotificationBody := NotificationBody.Replace('%DocumentType%','');
            NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(RecRef.RECORDID));
            NotificationBody := NotificationBody.Replace('%Details%',ToDo.Description);
            NotificationBody := NotificationBody.Replace('%Description%',ToDo.Description);
            ToDoNotifDispatcher.ConstructTodoDetailsForHTML(NotificationBody,ToDo);
          END;
        DATABASE::Job:
          BEGIN
            RecRef.SETTABLE(Job);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(Job.TABLECAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%Details%',ReplaceSpecChar(Job.Description));
            ConstructJobDetailsForHTML(NotificationBody, Job);
          END;
        DATABASE::"User Setup":
          BEGIN
            RecRef.SETTABLE(UserSetup);

            NotificationBody := NotificationBody.Replace('%UserID%',UserSetup."User ID");
            NotificationBody := NotificationBody.Replace('%ApproverIDCaption%',UserSetup.FIELDCAPTION("Approver ID"));
            NotificationBody := NotificationBody.Replace('%ApproverID%',UserSetup."Approver ID");
            ChangeLog.SETCURRENTKEY("Table No.", "Primary Key Field 1 Value");
            ChangeLog.SETRANGE("Table No.", DATABASE::"User Setup");
            ChangeLog.SETRANGE("Primary Key Field 1 Value", UserSetup."User ID");
            IF ChangeLog.FINDLAST THEN BEGIN
              NotificationBody := NotificationBody.Replace('%OldApproverIDCaption%','Old Approver ID');
              NotificationBody := NotificationBody.Replace('%OldApproverID%',ChangeLog."Old Value");
            END ELSE BEGIN
              NotificationBody := NotificationBody.Replace('%OldApproverIDCaption%','Old Approver ID');
              NotificationBody := NotificationBody.Replace('%OldApproverID%','');
            END;
          END;
        // PHP End
        ELSE BEGIN
          CustomNotificationManagement.ReplaceTokensWithRecInfo(NotificationBody, RecRef); // PHP Start
          NotificationBody := NotificationBody.Replace('%DocumentType%','');
          NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(RecRef.RECORDID));
        END;
      END;

      // Generic Mappings
      SetTokenToCaptionOfField(NotificationBody,'%AmountCaption%',RecRef,'Amount');
      SetTokenToValueOfField(NotificationBody,'%Amount%',RecRef,'Amount');

      SetTokenToValueOfField(NotificationBody,'%CurrencyCode%',RecRef,'Currency Code');

      SetTokenToCaptionOfField(NotificationBody,'%AmountLCYCaption%',RecRef,'Amount (LCY)');
      SetTokenToValueOfField(NotificationBody,'%AmountLCY%',RecRef,'Amount (LCY)');

      SetTokenToCaptionOfField(NotificationBody,'%DueDateCaption%',RecRef,'Due Date');
      SetTokenToValueOfField(NotificationBody,'%DueDate%',RecRef,'Due Date');

      NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%','');
      NotificationBody := NotificationBody.Replace('%CustomerVendorNo%','');
      NotificationBody := NotificationBody.Replace('%CustomerVendorName%','');
    END;

    LOCAL PROCEDURE ReplaceTokensWithApprovalInfo@15(VAR NotificationBody@1000 : DotNet "'mscorlib'.System.String";RecRef@1001 : RecordRef;NotificationType@1005 : Option);
    VAR
      Item@1041 : Record 27;
      Customer@1007 : Record 18;
      ApprovalEntry@1004 : Record 454;
      SalesHeader@1009 : Record 36;
      SalesLine@1017 : Record 37;
      PurchaseHeader@1015 : Record 38;
      PaymentTerms@1039 : Record 3;
      PaymentMethod@1040 : Record 289;
      INTP@1010 : Record 50040;
      Employee@1014 : Record 5200;
      UserGroup@1016 : Record 9000;
      NotificationEntry@1038 : Record 1511;
      Contact@1043 : Record 5050;
      Resource@1044 : Record 156;
      ShippingMethod@1034 : Record 10;
      SalesPerson@1047 : Record 13;
      Currency@1033 : Record 4;
      TransactionType@1032 : Record 258;
      TransactionSpec@1031 : Record 285;
      TransportMethod@1030 : Record 259;
      EntryExitPoint@1029 : Record 282;
      Area@1028 : Record 284;
      Vend@1050 : Record 23;
      Cust@1051 : Record 18;
      Job@1053 : Record 167;
      Purchaser@1052 : Record 13;
      StringConversionMgmt@1055 : Codeunit 47;
      CustVendorNo@1003 : Code[20];
      CustVendorName@1002 : Text[50];
      HtmlCommentLines@1006 : Text;
      ApprovedBudget@1012 : Text;
      ApprovedTimeline@1013 : Integer;
      ApprovedBudgetTimeline@1011 : Text;
      DescriptionOfRequest@1018 : Text;
      Justification@1019 : Text;
      SiteChange@1020 : Text;
      TeamReassignment@1021 : Text;
      MaterialEquipment@1022 : Text;
      NatureOfChangeOthers@1023 : Text;
      PresentSituation@1024 : Text;
      RecommendedChange@1025 : Text;
      RemarksLoc@1026 : Text;
      GTComments@1027 : Text;
      TermsAndCondition@1048 : Text;
      ShippingInstruction@1049 : Text;
      Stream@1046 : InStream;
      BinaryReader@1037 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.BinaryReader";
      Encoding@1036 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.Encoding";
      MemoryStream@1035 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
    BEGIN
      RecRef.SETTABLE(ApprovalEntry);

      HtmlCommentLines := GetApprovalCommentLines(ApprovalEntry);

      CASE NotificationType OF
        // PHP Start - NOT-01
        NotificationEntry.Type::"Approval-Job",
        NotificationEntry.Type::"Approval-Vendor", NotificationEntry.Type::"Approval-Item", NotificationEntry.Type::"Approval-Customer",
        NotificationEntry.Type::"Approval-RFQ",
        NotificationEntry.Type::"Approval-JO",
        // !! TODO Transfer the code to Custom Notification Management
        NotificationEntry.Type::"Approval-WCR", NotificationEntry.Type::"Approval-C-RMA",
        // PHP End
        NotificationEntry.Type::Approval:
          CASE ApprovalEntry.Status OF
            ApprovalEntry.Status::Open:
              BEGIN
                // PHP Start
                // !! TODO Transfer the code to Custom Notification Management
                IF ApprovalEntry."Table ID" = DATABASE::"Sales Header" THEN BEGIN
                  SalesHeader.GET(ApprovalEntry."Document Type",ApprovalEntry."Document No.");
                    IF SalesHeader."Extension of Commitment Date" <> 0D THEN // Change the action if extension of RFE is requested
                      NotificationBody := NotificationBody.Replace('%Action%',ActionApproveExtensionOfRFETxt)
                    ELSE
                      NotificationBody := NotificationBody.Replace('%Action%',ActionApproveTxt);
                END ELSE BEGIN
                // PHP End
                  // PHP Start of Original Code
                  NotificationBody := NotificationBody.Replace('%Action%',ActionApproveTxt);
                  // PHP End of Original Code
                END;
              END;
            ApprovalEntry.Status::Canceled:
              NotificationBody := NotificationBody.Replace('%Action%',ActionCancelTxt);
            ApprovalEntry.Status::Rejected:
              NotificationBody := NotificationBody.Replace('%Action%',ActionRejectTxt);
            ApprovalEntry.Status::Created:
              NotificationBody := NotificationBody.Replace('%Action%',ActionCreateTxt);
            ApprovalEntry.Status::Approved:
              NotificationBody := NotificationBody.Replace('%Action%',ActionApprovedTxt);
          END;
        NotificationEntry.Type::Overdue:
          NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionOverdueTxt,FORMAT(ApprovalEntry."Due Date",10)));
        // PHP Start
        // !! TODO Transfer the code to Custom Notification Management
        NotificationEntry.Type::"Overdue-RFE":
          NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionOverdueRFETxt,''));
        NotificationEntry.Type::NOS:
          NotificationBody := NotificationBody.Replace('%Action%',ActionNOSTxt);
        NotificationEntry.Type::"New-Item", NotificationEntry.Type::"New-Vendor", NotificationEntry.Type::"New-Customer":
          NotificationBody := NotificationBody.Replace('%Action%',ActionCreateTxt);
        ELSE
          CustomNotificationManagement.ReplaceTokensWithCustomApprovalInfo(NotificationBody, RecRef, NotificationType); // integration
        // PHP End
      END;

      CASE ApprovalEntry."Limit Type" OF
        ApprovalEntry."Limit Type"::"Request Limits":
          BEGIN
            NotificationBody := NotificationBody.Replace('%CreditLimitCaption%',FORMAT(ApprovalEntry.FIELDCAPTION("Amount (LCY)")));
            NotificationBody := NotificationBody.Replace('%CreditLimit%',FORMAT(ApprovalEntry."Amount (LCY)"));
          END;
        ApprovalEntry."Limit Type"::"Credit Limits":
          BEGIN
            NotificationBody :=
              NotificationBody.Replace('%CreditLimitCaption%',ApprovalEntry.FIELDCAPTION("Available Credit Limit (LCY)"));
            NotificationBody := NotificationBody.Replace('%CreditLimit%',FORMAT(ApprovalEntry."Available Credit Limit (LCY)"));
          END;
        ELSE BEGIN
          NotificationBody := NotificationBody.Replace('%CreditLimitCaption%',' ');
          NotificationBody := NotificationBody.Replace('%CreditLimit%',' ');
        END;
      END;

      ApprovalEntry.GetCustVendorDetails(CustVendorNo,CustVendorName);
      NotificationBody := NotificationBody.Replace('%CustomerVendorNo%',CustVendorNo);
      NotificationBody := NotificationBody.Replace('%CustomerVendorName%',ReplaceSpecChar(CustVendorName));
      NotificationBody := NotificationBody.Replace('%Details%',ApprovalEntry.GetChangeRecordDetails);

      // PHP Start - New set of case statement for record to approve from Request for Approve
      IF RecRef.GET(ApprovalEntry."Record ID to Approve") THEN BEGIN
        CASE ApprovalEntry."Table ID" OF
          DATABASE::Item:
            BEGIN
              RecRef.SETTABLE(Item);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RecRef.CAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              ConstructItemDetailsForHTML(NotificationBody, Item);
            END;
          DATABASE::Customer:
            BEGIN
              RecRef.SETTABLE(Customer);
              ConstructCustomerDetailsForHTML(NotificationBody, Customer);
            END;
          DATABASE::Job:
            BEGIN
              RecRef.SETTABLE(Job);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(Job.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              NotificationBody := NotificationBody.Replace('%Details%',ReplaceSpecChar(Job.Description));
              ConstructJobDetailsForHTML(NotificationBody, Job);
            END;
        DATABASE::"Sales Header":
          BEGIN
            NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%',Customer.TABLECAPTION);
      //      Start of Original Code
      //      NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO(SalesDocTypeTxt,ApprovalEntry."Document Type"));
      //      End of Original Code
      //    PHP Start
            RecRef.SETTABLE(SalesHeader);
            NotificationBody := NotificationBody.Replace('%DocumentDateCaption%',SalesHeader.FIELDCAPTION("Document Date"));
            NotificationBody := NotificationBody.Replace('%DocumentDate%',FORMAT(SalesHeader."Document Date"));
            NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO('%1',ApprovalEntry."Sales Request type"));

            IF SalesHeader."Request type" <> SalesHeader."Request type"::" " THEN BEGIN
              ConstructSalesHeaderDetailsForHTML(NotificationBody, SalesHeader);
            END ELSE BEGIN
              NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO(SalesDocTypeTxt,ApprovalEntry."Document Type"));
            END;
      //    PHP End
            NotificationBody := NotificationBody.Replace('%DocumentNo%',ApprovalEntry."Document No.");
          END;
        END;
      END;
      // PHP End

      CASE ApprovalEntry."Table ID" OF
        DATABASE::Customer:
          BEGIN
            Customer.GET(ApprovalEntry."Record ID to Approve");
            NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%',Customer.TABLECAPTION);
            NotificationBody := NotificationBody.Replace('%DocumentNo%','');
            NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO(CustomerTypeTxt,Customer."No."));
            NotificationBody := NotificationBody.Replace('%CurrencyCode%','');
          END;
        DATABASE::"Gen. Journal Line":
          BEGIN
            NotificationBody := NotificationBody.Replace('%DocumentType%','');
            NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(ApprovalEntry."Record ID to Approve"));
          END;
        DATABASE::"Gen. Journal Batch":
          BEGIN
            NotificationBody := NotificationBody.Replace('%DocumentType%','');
            NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(ApprovalEntry."Record ID to Approve"));
          END;
      END;

      NotificationBody := NotificationBody.Replace('%ApprovalComments%',HtmlCommentLines);
    END;

    LOCAL PROCEDURE ReplaceTokensWithBlanks@3(VAR NotificationBody@1000 : DotNet "'mscorlib'.System.String";RecordIdentifier@1001 : Text);
    BEGIN
      NotificationBody := NotificationBody.Replace('%DocumentType%','');
      NotificationBody := NotificationBody.Replace('%DocumentNo%','');
      NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionNoTxt,RecordIdentifier));
      NotificationBody := NotificationBody.Replace('%Details%','');

      NotificationBody := NotificationBody.Replace('%AmountCaption%','');
      NotificationBody := NotificationBody.Replace('%CurrencyCode%','');
      NotificationBody := NotificationBody.Replace('%Amount%','');

      NotificationBody := NotificationBody.Replace('%AmountLCY%','');
      NotificationBody := NotificationBody.Replace('%AmountLCYCaption%','');

      NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%','');
      NotificationBody := NotificationBody.Replace('%CustomerVendorNo%','');
      NotificationBody := NotificationBody.Replace('%CustomerVendorName%','');

      NotificationBody := NotificationBody.Replace('%DueDateCaption%','');
      NotificationBody := NotificationBody.Replace('%DueDate%','');

      NotificationBody := NotificationBody.Replace('%CreditLimit%','');
      NotificationBody := NotificationBody.Replace('%CreditLimitCaption%','');
      NotificationBody := NotificationBody.Replace('%ApprovalComments%','');

      CustomNotificationManagement.ReplaceTokensWithBlanks(NotificationBody, RecordIdentifier); // PHP Start Code integration
    END;

    LOCAL PROCEDURE SetTokenToValueOfField@5(VAR NotificationBody@1004 : DotNet "'mscorlib'.System.String";Token@1000 : Text;RecRef@1002 : RecordRef;FieldName@1001 : Text);
    VAR
      Field@1005 : Record 2000000041;
      FieldRef@1003 : FieldRef;
      FieldValue@1006 : Text;
    BEGIN
      Field.SETRANGE(TableNo,RecRef.NUMBER);
      Field.SETRANGE(FieldName,FieldName);
      IF Field.FINDFIRST THEN BEGIN
        FieldRef := RecRef.FIELD(Field."No.");
        IF Field.Type = Field.Type::Decimal THEN
          FieldValue := FORMAT(FieldRef.VALUE,0,'<Precision,2:2><Standard Format,0>')
        ELSE
          FieldValue := FORMAT(FieldRef.VALUE);
      END;
      // NotificationBody := NotificationBody.Replace(Token,FieldValue); // Original Code
        NotificationBody := NotificationBody.Replace(Token,ReplaceSpecChar(FieldValue));
    END;

    LOCAL PROCEDURE SetTokenToCaptionOfField@31(VAR NotificationBody@1004 : DotNet "'mscorlib'.System.String";Token@1000 : Text;RecRef@1002 : RecordRef;FieldName@1001 : Text);
    VAR
      Field@1005 : Record 2000000041;
      FieldRef@1003 : FieldRef;
      FieldValue@1006 : Text;
    BEGIN
      Field.SETRANGE(TableNo,RecRef.NUMBER);
      Field.SETRANGE(FieldName,FieldName);
      IF Field.FINDFIRST THEN BEGIN
        FieldRef := RecRef.FIELD(Field."No.");
        FieldValue := FORMAT(FieldRef.CAPTION);
      END;
      NotificationBody := NotificationBody.Replace(Token,FieldValue);
    END;

    LOCAL PROCEDURE GetCustomUrlAndAnchor@26(CustomURL@1000 : Text) : Text;
    BEGIN
      IF CustomURL <> '' THEN
        EXIT(STRSUBSTNO(CustomUrlAndAnchorTxt,CustomURL));
      EXIT('');
    END;

    LOCAL PROCEDURE GetApprovalCommentLines@8(ApprovalEntry@1000 : Record 454) HTMLApprovalComments : Text;
    VAR
      ApprovalCommentLine@1001 : Record 455;
    BEGIN
      ApprovalEntry.CALCFIELDS(Comment);
      IF NOT ApprovalEntry.Comment THEN
        EXIT;

      ApprovalCommentLine.SETRANGE("Table ID",ApprovalEntry."Table ID");
      ApprovalCommentLine.SETRANGE("Record ID to Approve",ApprovalEntry."Record ID to Approve");
      IF ApprovalCommentLine.FINDSET THEN BEGIN
        HTMLApprovalComments := STRSUBSTNO(AdditionalHtmlLineTxt,CommentsHdrTxt);
        REPEAT
          HTMLApprovalComments += STRSUBSTNO(AdditionalHtmlLineTxt,ApprovalCommentLine.Comment);
        UNTIL ApprovalCommentLine.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE InsertOverdueEntry@13(ApprovalEntry@1000 : Record 454);
    VAR
      User@1002 : Record 2000000120;
      OverdueApprovalEntry@1001 : Record 458;
      UserSetup@1003 : Record 91;
    BEGIN
      WITH OverdueApprovalEntry DO BEGIN
        INIT;
        "Approver ID" := ApprovalEntry."Approver ID";
        User.SETRANGE("User Name",ApprovalEntry."Approver ID");
        IF User.FINDFIRST THEN BEGIN
          "Sent to Name" := COPYSTR(User."Full Name",1,MAXSTRLEN("Sent to Name"));
          UserSetup.GET(User."User Name");
        END;

        "Table ID" := ApprovalEntry."Table ID";
        "Document Type" := ApprovalEntry."Document Type";
        "Document No." := ApprovalEntry."Document No.";
        "Sent to ID" := ApprovalEntry."Approver ID";
        "Sent Date" := TODAY;
        "Sent Time" := TIME;
        "E-Mail" := UserSetup."E-Mail";
        "Sequence No." := ApprovalEntry."Sequence No.";
        "Due Date" := ApprovalEntry."Due Date";
        "Approval Code" := ApprovalEntry."Approval Code";
        "Approval Type" := ApprovalEntry."Approval Type";
        "Limit Type" := ApprovalEntry."Limit Type";
        "Record ID to Approve" := ApprovalEntry."Record ID to Approve";
        INSERT;
      END;
    END;

    PROCEDURE CreateDefaultNotificationTemplate@2(VAR NotificationTemplate@1000 : Record 1510;NotificationType@1001 : Option);
    BEGIN
      NotificationTemplate.SETRANGE(Type,NotificationType);
      NotificationTemplate.SETRANGE(Default,TRUE);
      IF NotificationTemplate.FINDFIRST THEN
        EXIT;

      NotificationTemplate.CreateNewDefault(NotificationType);
    END;

    PROCEDURE CreateDefaultNotificationSetup@1(NotificationType@1000 : Option);
    VAR
      NotificationSetup@1001 : Record 1512;
      NotificationTemplate@1002 : Record 1510;
    BEGIN
      IF DefaultNotificationEntryExists(NotificationType) THEN
        EXIT;

      CreateDefaultNotificationTemplate(NotificationTemplate,NotificationType);

      NotificationSetup.INIT;
      NotificationSetup."User ID" := '';
      NotificationSetup.VALIDATE("Notification Type",NotificationType);
      NotificationSetup.VALIDATE("Notification Template Code",NotificationTemplate.Code);
      NotificationSetup.INSERT(TRUE);
    END;

    LOCAL PROCEDURE DefaultNotificationEntryExists@4(NotificationType@1000 : Option) : Boolean;
    VAR
      NotificationSetup@1001 : Record 1512;
    BEGIN
      NotificationSetup.SETRANGE("User ID",'');
      NotificationSetup.SETRANGE("Notification Type",NotificationType);
      EXIT(NOT NotificationSetup.ISEMPTY)
    END;

    LOCAL PROCEDURE GetNotes@9(VAR NotificationBody@1011 : DotNet "'mscorlib'.System.String";RecRef@1000 : RecordRef);
    VAR
      RecordLink@1006 : Record 2000000068;
      RecordLink2@1016 : Record 2000000068;
      NoteText@1005 : Text;
      NoteText2@1004 : Text;
      Stream@1003 : InStream;
      BinaryReader@1002 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.BinaryReader";
      Encoding@1001 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.Encoding";
      NoteHeaderText@1010 : TextConst 'ENU="<table border=""1"" width=""54%"" id=""table2"" cellspacing=""0"" cellpadding=""0"" style=""font-size:11.0pt; font-family:Calibri""><tr><td valign=""top"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableTextBold""><b>NOTES</font></b></td></tr>"';
      NoteContentText@1009 : TextConst 'ENU="<tr><td width=""139"" valign=""top"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableText"">From:&nbsp;<strong>%1&nbsp;</strong>To:&nbsp;<strong>%2&nbsp;</strong>Date Created:&nbsp;<strong>%3</strong></p><p class=""TableText"">%4</p></td></tr>"';
      NoNotesText@1008 : TextConst 'ENU="<tr><td valign=""center"" style=""width:1.45in;padding:0in 5.4pt 0in 5.4pt""><p class=""TableText"">No available notes.</font></td></tr>"';
      NoteFooterText@1007 : TextConst 'ENU=</table>';
      MemoryStream@1012 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      BodyText@1013 : BigText;
      StreamReader@1014 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamReader";
      TempBlob@1015 : Record 99008535;
    BEGIN
      // IF RecRef.NUMBER = DATABASE::"Record Link" THEN BEGIN
      //  RecRef.SETTABLE(RecordLink2);
      //  RecordLink.SETRANGE("Record ID", RecordLink2."Record ID");
      // END ELSE
      //  RecordLink.SETRANGE("Record ID", RecRef.RECORDID);
      //
      // IF RecordLink.FINDSET THEN BEGIN
      //  REPEAT
      //    RecordLink.CALCFIELDS(Note);
      //    IF RecordLink.Note.HASVALUE THEN
      //      CLEAR(NoteText2);
      //    RecordLink.Note.CREATEINSTREAM(Stream);
      //    BinaryReader := BinaryReader.BinaryReader(Stream, Encoding.ASCII, FALSE);
      // //    NoteText2 := CONVERTSTR(BinaryReader.ReadString, '??', '  ');?
      //    NoteText += STRSUBSTNO(NoteContentText, RecordLink."User ID", RecordLink."To User ID", FORMAT(RecordLink.Created), NoteText2);
      //  UNTIL RecordLink.NEXT = 0;
      // END;
      // IF NoteText = '' THEN
      //  NoteText := NoteHeaderText + NoNotesText + NoteFooterText
      // ELSE
      //  NoteText := NoteHeaderText + NoteText + NoteFooterText;
      // NotificationBody := NotificationBody.Replace('%Notes%',NoteText);
      NotificationBody := NotificationBody.Replace('%Notes%','');
    END;

    LOCAL PROCEDURE "2ReplaceSpecialChar"@10(LookupText@1012 : Text;FindWhat@1008 : Text;ReplaceWith@1009 : Text) : Text;
    VAR
      Stream@1007 : InStream;
      BinaryReader@1006 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.BinaryReader";
      Encoding@1005 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.Encoding";
      MemoryStream@1004 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      BodyText@1003 : BigText;
      StreamReader@1002 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamReader";
      TempBlob@1001 : Record 99008535;
      SpecialText@1000 : Text;
      FindPos@1011 : Integer;
      NewString@1010 : Text;
    BEGIN
      FindPos := STRPOS(LookupText, FindWhat);
      WHILE FindPos > 0 DO BEGIN
        NewString += DELSTR(LookupText, FindPos) + ReplaceWith;
        LookupText := COPYSTR(LookupText, FindPos + STRLEN(FindWhat));
        FindPos := STRPOS(LookupText,FindWhat);
      END;
      NewString += LookupText;
      EXIT(NewString);
    END;

    LOCAL PROCEDURE ReplaceSpecChar@47(String@1012 : Text) : Text;
    VAR
      Stream@1007 : InStream;
      BinaryReader@1006 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.BinaryReader";
      Encoding@1005 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.Encoding";
      MemoryStream@1004 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      BodyText@1003 : BigText;
      StreamReader@1002 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamReader";
      TempBlob@1001 : Record 99008535;
      SpecialText@1000 : Text;
      FindPos@1011 : Integer;
      NewString@1010 : Text;
    BEGIN
      String := CONVERTSTR(String, '', '-''"?');
      NewString := String;
      EXIT(NewString);
    END;

    LOCAL PROCEDURE ReduceSpaces@75(String@1012 : Text) : Text;
    VAR
      n@1001 : Integer;
      i@1000 : Integer;
      NewString@1010 : Text;
    BEGIN
      n := STRLEN(String);
      FOR i := 1 TO n DO
        IF (String[i] = ' ') AND (i < n) THEN BEGIN
          IF NOT (String[i+1] IN [32..47,58..63]) THEN //if the next char is special as 'empty space,.,!' etc we do not copy the current space
            NewString += FORMAT(String[i])
        END ELSE
          NewString += FORMAT(String[i]);

      NewString := DELCHR(NewString,'<>',' ');
      EXIT(NewString);
    END;

    LOCAL PROCEDURE SetINTPDetails@53(VAR NotificationBody@1004 : DotNet "'mscorlib'.System.String";INTPNo@1001 : Code[20]);
    VAR
      Field@1005 : Record 2000000041;
      FieldRef@1003 : FieldRef;
      FieldValue@1006 : Text;
      INTP@1000 : Record 50040;
    BEGIN
      IF INTP.GET(INTPNo) THEN BEGIN
        NotificationBody := NotificationBody.Replace('%INTPNoCaption%','INTP No.');
        NotificationBody := NotificationBody.Replace('%INTPNo%',INTP."No.");
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%',INTP.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjectName%',ReplaceSpecChar(INTP."Project Name" + ' ' + INTP."Project Name 2"));
        NotificationBody := NotificationBody.Replace('%PONoCaption%', INTP.FIELDCAPTION("P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%PONo%', ReplaceSpecChar(INTP."P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%CustomerCaption%', INTP.FIELDCAPTION("Customer Name"));
        NotificationBody := NotificationBody.Replace('%Customer%', ReplaceSpecChar(INTP."Customer No." + ' ' + INTP."Customer Name"));
      END ELSE BEGIN
        NotificationBody := NotificationBody.Replace('%INTPNoCaption%',INTP.FIELDCAPTION("No."));
        NotificationBody := NotificationBody.Replace('%INTPNo%','');
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%',INTP.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjectName%','');
        NotificationBody := NotificationBody.Replace('%PONoCaption%', INTP.FIELDCAPTION("P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%PONo%', '');
        NotificationBody := NotificationBody.Replace('%CustomerCaption%', INTP.FIELDCAPTION("Customer Name"));
        NotificationBody := NotificationBody.Replace('%Customer%', '');
      END;
    END;

    LOCAL PROCEDURE ConstructCustomerDetailsForHTML@16(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";Customer@1000 : Record 18);
    BEGIN
      WITH Customer DO BEGIN
        NotificationBody := NotificationBody.Replace('%CurrencyCode%','');
        NotificationBody := NotificationBody.Replace('%AddressCaption%',Customer.FIELDCAPTION(Address));
        NotificationBody := NotificationBody.Replace('%Address%',FORMAT(Customer.Address + ' ' + Customer."Address 2"));
        NotificationBody := NotificationBody.Replace('%PhoneNoCaption%',Customer.FIELDCAPTION("Phone No."));
        NotificationBody := NotificationBody.Replace('%PhoneNo%',Customer."Phone No.");
        NotificationBody := NotificationBody.Replace('%PrimaryContactCaption%',Customer.FIELDCAPTION("Primary Contact No."));
        NotificationBody := NotificationBody.Replace('%PrimaryContact%',Customer."Primary Contact No." + ' ' + Customer.Contact);
        NotificationBody := NotificationBody.Replace('%EmailCaption%',Customer.FIELDCAPTION("E-Mail"));
        NotificationBody := NotificationBody.Replace('%Email%',Customer."E-Mail");
        NotificationBody := NotificationBody.Replace('%HomePageCaption%',Customer.FIELDCAPTION("Home Page"));
        NotificationBody := NotificationBody.Replace('%HomePage%',Customer."Home Page");
        NotificationBody := NotificationBody.Replace('%VatRegistrationNoCaption%',Customer.FIELDCAPTION("VAT Registration No."));
        NotificationBody := NotificationBody.Replace('%VatRegistrationNo%',Customer."VAT Registration No.");
        NotificationBody := NotificationBody.Replace('%CustomerPostingGroupCaption%',Customer.FIELDCAPTION("Customer Posting Group"));
        NotificationBody := NotificationBody.Replace('%CustomerPostingGroup%',Customer."Customer Posting Group");
        NotificationBody := NotificationBody.Replace('%PartnerTypeCaption%',Customer.FIELDCAPTION("Partner Type"));
        NotificationBody := NotificationBody.Replace('%PartnerType%',FORMAT(Customer."Partner Type"));
      END;
    END;

    LOCAL PROCEDURE ConstructItemDetailsForHTML@23(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";Item@1000 : Record 27);
    BEGIN
      WITH Item DO BEGIN
        NotificationBody := NotificationBody.Replace('%DescriptionCaption%',Item.FIELDCAPTION(Description));
        NotificationBody := NotificationBody.Replace('%Description%', ReplaceSpecChar(Item.Description));
        NotificationBody := NotificationBody.Replace('%TypeCaption%',Item.FIELDCAPTION(Type));
        NotificationBody := NotificationBody.Replace('%Type%',FORMAT(Item.Type));
        NotificationBody := NotificationBody.Replace('%ItemCategoryCodeCaption%',Item.FIELDCAPTION("Item Category Code"));
        NotificationBody := NotificationBody.Replace('%ItemCategoryCode%',Item."Item Category Code");
        NotificationBody := NotificationBody.Replace('%ProductGroupCodeCaption%',Item.FIELDCAPTION("Product Group Code"));
        NotificationBody := NotificationBody.Replace('%ProductGroupCode%',Item."Product Group Code");
        NotificationBody := NotificationBody.Replace('%DepartmentGroupCodeCaption%',Item.FIELDCAPTION("Department Code"));
        Item.CALCFIELDS(Department);
        NotificationBody := NotificationBody.Replace('%DepartmentGroupCode%',ReplaceSpecChar(Item."Department Code" + ' ' + Item.Department));
        // Item - Item Tracking
        NotificationBody := NotificationBody.Replace('%ItemTrackingCodeCaption%',Item.FIELDCAPTION("Item Tracking Code"));
        NotificationBody := NotificationBody.Replace('%ItemTrackingCode%',Item."Item Tracking Code");
        NotificationBody := NotificationBody.Replace('%SerialNosCaption%',Item.FIELDCAPTION("Serial Nos."));
        NotificationBody := NotificationBody.Replace('%SerialNos%',Item."Serial Nos.");
        NotificationBody := NotificationBody.Replace('%LotNosCaption%',Item.FIELDCAPTION("Lot Nos."));
        NotificationBody := NotificationBody.Replace('%LotNos%',Item."Lot Nos.");
        // Item - Invoicing
        NotificationBody := NotificationBody.Replace('%CostingMethodCaption%',Item.FIELDCAPTION("Costing Method"));
        NotificationBody := NotificationBody.Replace('%CostingMethod%',FORMAT(Item."Costing Method"));
        NotificationBody := NotificationBody.Replace('%GenProdPostingGroupCaption%',Item.FIELDCAPTION("Gen. Prod. Posting Group"));
        NotificationBody := NotificationBody.Replace('%GenProdPostingGroup%',Item."Gen. Prod. Posting Group");
        NotificationBody := NotificationBody.Replace('%VATProdPostingGRoupCaption%',Item.FIELDCAPTION("VAT Prod. Posting Group"));
        NotificationBody := NotificationBody.Replace('%VATProdPostingGRoup%',Item."VAT Prod. Posting Group");
        NotificationBody := NotificationBody.Replace('%WHTProductPostingGroupCaption%',Item.FIELDCAPTION("WHT Product Posting Group"));
        NotificationBody := NotificationBody.Replace('%WHTProductPostingGroup%',Item."WHT Product Posting Group");
        NotificationBody := NotificationBody.Replace('%IventoryPostingGroupCaption%',Item.FIELDCAPTION("Inventory Posting Group"));
        NotificationBody := NotificationBody.Replace('%IventoryPostingGroup%',Item."Inventory Posting Group");
      END;
    END;

    LOCAL PROCEDURE ConstructSalesHeaderDetailsForHTML@28(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";SalesHeader@1000 : Record 36);
    VAR
      SalesLine@1007 : Record 37;
      INTP@1002 : Record 50040;
      Employee@1003 : Record 5200;
      Customer@1004 : Record 18;
      Resource@1005 : Record 156;
      UserGroup@1006 : Record 9000;
      DescriptionOfRequest@1008 : Text;
      Justification@1009 : Text;
      SiteChange@1010 : Text;
      TeamReassignment@1011 : Text;
      MaterialEquipment@1012 : Text;
      NatureOfChangeOthers@1013 : Text;
      PresentSituation@1014 : Text;
      RecommendedChange@1015 : Text;
      RemarksLoc@1016 : Text;
      GTComments@1017 : Text;
    BEGIN
      WITH SalesHeader DO BEGIN
        // General Setup
        SetINTPDetails(NotificationBody, SalesHeader."INTP No.");

        NotificationBody := NotificationBody.Replace('%EmployeeCaption%', Employee.TABLECAPTION);
        IF Employee.GET(SalesHeader."Employee No.") THEN
          NotificationBody := NotificationBody.Replace('%Employee%',ReplaceSpecChar(Employee."No." + ' ' + Employee."First Name" + ' ' + Employee."Last Name"));
        NotificationBody := NotificationBody.Replace('%DepartmentCaption%', 'Department');
        IF UserGroup.GET(SalesHeader."Department Code") THEN
          NotificationBody := NotificationBody.Replace('%Department%', ReplaceSpecChar(UserGroup.Name));

        // TERF and Withdrawal
        NotificationBody := NotificationBody.Replace('%DateOfReturnCaption%',SalesHeader.FIELDCAPTION("Date of Return"));
        NotificationBody := NotificationBody.Replace('%DateOfReturn%',FORMAT(SalesHeader."Date of Return"));
        NotificationBody := NotificationBody.Replace('%CustomerAddressCaption%',SalesHeader.FIELDCAPTION("Sell-to Address"));
        NotificationBody := NotificationBody.Replace('%CustomerAddress%',FORMAT(SalesHeader."Sell-to Address" + ' ' +SalesHeader."Sell-to Address 2"));
        NotificationBody := NotificationBody.Replace('%SiteNameCaption%','Site Name');
        NotificationBody := NotificationBody.Replace('%SiteName%',SalesHeader."Sell-to Post Code");
        NotificationBody := NotificationBody.Replace('%ARNoCaption%',SalesHeader.FIELDCAPTION("Ack. Receipt No."));
        NotificationBody := NotificationBody.Replace('%ARNo%',SalesHeader."Ack. Receipt No.");
        NotificationBody := NotificationBody.Replace('%DRNoCaption%',SalesHeader.FIELDCAPTION("Deliver Receipt No."));
        NotificationBody := NotificationBody.Replace('%DRNo%',SalesHeader."Deliver Receipt No.");
        NotificationBody := NotificationBody.Replace('%PurposeCaption%',SalesHeader.FIELDCAPTION(Purpose));
        NotificationBody := NotificationBody.Replace('%Purpose%',FORMAT(SalesHeader.Purpose));
        NotificationBody := NotificationBody.Replace('%ReleasedByUserIDCaption%',SalesHeader.FIELDCAPTION("Released By User ID"));
        NotificationBody := NotificationBody.Replace('%ReleasedByUserID%',SalesHeader."Released By User ID");

        SalesLine.SETRANGE("Document Type", SalesHeader."Document Type");
        SalesLine.SETRANGE("Document No.", SalesHeader."No.");
        IF SalesLine.FINDSET THEN BEGIN
          REPEAT
            CASE SalesLine."Line Type" OF
              SalesLine."Line Type"::"Description of Request":
                DescriptionOfRequest += SalesLine.Description + ' ';
              SalesLine."Line Type"::Justification:
              Justification += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Site":
                SiteChange += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Team":
                TeamReassignment += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Mats":
                MaterialEquipment += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Others":
                NatureOfChangeOthers += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Present Situation":
                PresentSituation += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Recommended Changes":
                RecommendedChange += SalesLine.Description + ' ';
              SalesLine."Line Type"::Remarks:
                RemarksLoc += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-GT Repr. Comments":
                GTComments += SalesLine.Description + ' ';
            END;
          UNTIL SalesLine.NEXT = 0;
        END;

        // Request for Exception
        DescriptionOfRequest := ReplaceSpecChar(DescriptionOfRequest);
        Justification := ReplaceSpecChar(Justification);
        NotificationBody := NotificationBody.Replace('%DescriptionOfRequestCaption%','Description of Request');
        NotificationBody := NotificationBody.Replace('%DescriptionOfRequest%',DescriptionOfRequest);
        NotificationBody := NotificationBody.Replace('%JustificationCaption%','Justification');
        NotificationBody := NotificationBody.Replace('%Justification%',Justification);
        NotificationBody := NotificationBody.Replace('%ExceptionToCaption%', SalesHeader.FIELDCAPTION("Type of Exception"));
        NotificationBody := NotificationBody.Replace('%ExceptionTo%', FORMAT(SalesHeader."Type of Exception"));
        NotificationBody := NotificationBody.Replace('%SubjectCaption%',SalesHeader.FIELDCAPTION(Subject));
        NotificationBody := NotificationBody.Replace('%Subject%',SalesHeader.Subject);
        NotificationBody := NotificationBody.Replace('%ApprovedBudgetCaption%',SalesHeader.FIELDCAPTION("Approved Budget"));
        NotificationBody := NotificationBody.Replace('%ApprovedBudget%',FORMAT(SalesHeader."Approved Budget"));
        NotificationBody := NotificationBody.Replace('%ApprovedTimelineCaption%',SalesHeader.FIELDCAPTION("Approved Timeline"));
        NotificationBody := NotificationBody.Replace('%ApprovedTimeline%',FORMAT(SalesHeader."Approved Timeline"));
        NotificationBody := NotificationBody.Replace('%ProposedBudgetCaption%',SalesHeader.FIELDCAPTION("Proposed Budget"));
        NotificationBody := NotificationBody.Replace('%ProposedBudget%',FORMAT(SalesHeader."Proposed Budget"));
        NotificationBody := NotificationBody.Replace('%ProposedTimelineCaption%',SalesHeader.FIELDCAPTION("Proposed Timeline"));
        NotificationBody := NotificationBody.Replace('%ProposedTimeline%',FORMAT(SalesHeader."Proposed Timeline"));

        NotificationBody := NotificationBody.Replace('%WaiverTypeCaption%',SalesHeader.FIELDCAPTION("Waiver Type"));
        NotificationBody := NotificationBody.Replace('%WaiverType%',FORMAT(SalesHeader."Waiver Type"));
        NotificationBody := NotificationBody.Replace('%PersonInchargeCaption%',SalesHeader.FIELDCAPTION("Person Incharge"));
        IF Employee.GET(SalesHeader."Person Incharge") THEN
          NotificationBody := NotificationBody.Replace('%PersonIncharge%',FORMAT(Employee."First Name" + ' ' + Employee."Last Name"))
        ELSE
          NotificationBody := NotificationBody.Replace('%PersonIncharge%','');

        NotificationBody := NotificationBody.Replace('%CommitmentDateCaption%',SalesHeader.FIELDCAPTION("Commitment Date"));
        NotificationBody := NotificationBody.Replace('%CommitmentDate%',FORMAT(SalesHeader."Commitment Date"));
        NotificationBody := NotificationBody.Replace('%ExtendCommitmentDateCaption%',SalesHeader.FIELDCAPTION("Extension of Commitment Date"));
        NotificationBody := NotificationBody.Replace('%ExtendCommitmentDate%',FORMAT(SalesHeader."Extension of Commitment Date"));
        NotificationBody := NotificationBody.Replace('%ApprovedDateOfExtensionCaption%',SalesHeader.FIELDCAPTION("Approved Date of Extension"));
        NotificationBody := NotificationBody.Replace('%ApprovedDateOfExtension%',FORMAT(SalesHeader."Approved Date of Extension"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudgetCaption%',SalesHeader.FIELDCAPTION("Attmt. App. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudget%',FORMAT(SalesHeader."Attmt. App. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimelineCaption%',SalesHeader.FIELDCAPTION("Attmt. App.Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimeline%',FORMAT(SalesHeader."Attmt. App.Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedBudgetCaption%',SalesHeader.FIELDCAPTION("Attmt. Prop. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedBudget%',FORMAT(SalesHeader."Attmt. Prop. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedTimelineCaption%',SalesHeader.FIELDCAPTION("Attmt. Prop. Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedTimeline%',FORMAT(SalesHeader."Attmt. Prop. Timeline"));

        // Work Change Request
        SiteChange := ReplaceSpecChar(SiteChange);
        TeamReassignment := ReplaceSpecChar(TeamReassignment);
        MaterialEquipment := ReplaceSpecChar(MaterialEquipment);
        NatureOfChangeOthers := ReplaceSpecChar(NatureOfChangeOthers);
        PresentSituation := ReplaceSpecChar(PresentSituation);
        RecommendedChange := ReplaceSpecChar(RecommendedChange);
        RemarksLoc := ReplaceSpecChar(RemarksLoc);
        GTComments := ReplaceSpecChar(GTComments);
        NotificationBody := NotificationBody.Replace('%ProgramCaption%',SalesHeader.FIELDCAPTION("Program"));
        NotificationBody := NotificationBody.Replace('%Program%',SalesHeader."Program");
        NotificationBody := NotificationBody.Replace('%AnnexesCaption%',SalesHeader.FIELDCAPTION(Annexes));
        NotificationBody := NotificationBody.Replace('%Annexes%',SalesHeader.Annexes);
        NotificationBody := NotificationBody.Replace('%CMSTicketCaption%',SalesHeader.FIELDCAPTION("CMS Ticket No."));
        NotificationBody := NotificationBody.Replace('%CMSTicket%',SalesHeader."CMS Ticket No.");
        NotificationBody := NotificationBody.Replace('%DateOfOcularInspectionCaption%',SalesHeader.FIELDCAPTION("Date of Ocular Inspection"));
        NotificationBody := NotificationBody.Replace('%DateOfOcularInspection%',FORMAT(SalesHeader."Date of Ocular Inspection"));
        NotificationBody := NotificationBody.Replace('%ChargeableToClientCaption%',SalesHeader.FIELDCAPTION("Chargeable to Client"));
        NotificationBody := NotificationBody.Replace('%ChargeableToClient%',FORMAT(SalesHeader."Chargeable to Client"));
        NotificationBody := NotificationBody.Replace('%AdditionalWorkCaption%',SalesHeader.FIELDCAPTION("Additional Work"));
        NotificationBody := NotificationBody.Replace('%AdditionalWork%', FORMAT(SalesHeader."Additional Work"));
        NotificationBody := NotificationBody.Replace('%SiteChangeCaption%','Site Change');
        NotificationBody := NotificationBody.Replace('%SiteChange%',SiteChange);
        NotificationBody := NotificationBody.Replace('%TeamReassignmentCaption%','Team Reassignment');
        NotificationBody := NotificationBody.Replace('%TeamReassignment%', TeamReassignment);
        NotificationBody := NotificationBody.Replace('%MaterialsEquipmentCaption%','Materials/Equipment/Device Change');
        NotificationBody := NotificationBody.Replace('%MaterialsEquipment%',MaterialEquipment);
        NotificationBody := NotificationBody.Replace('%NatureOfChangeOthersCaption%', 'Others');
        NotificationBody := NotificationBody.Replace('%NatureOfChangeOthers%',NatureOfChangeOthers);
        NotificationBody := NotificationBody.Replace('%PresentSituationCaption%','Present Situation');
        NotificationBody := NotificationBody.Replace('%PresentSituation%',PresentSituation);
        NotificationBody := NotificationBody.Replace('%RecommendedChangeCaption%','Recommended Change');
        NotificationBody := NotificationBody.Replace('%RecommendedChange%',RecommendedChange);
        NotificationBody := NotificationBody.Replace('%OriginalProjectCostCaption%',SalesHeader.FIELDCAPTION("Original PO Amount"));
        NotificationBody := NotificationBody.Replace('%OriginalProjectCost%', FORMAT(SalesHeader."Original PO Amount"));
        NotificationBody := NotificationBody.Replace('%LateAFIAmountBeforeWCICaption%',SalesHeader.FIELDCAPTION("Latest AFI Amt. before WCR"));
        NotificationBody := NotificationBody.Replace('%LateAFIAmountBeforeWCI%',FORMAT(SalesHeader."Latest AFI Amt. before WCR"));
        NotificationBody := NotificationBody.Replace('%ThisWCRCostVariationWCRCaption%',SalesHeader.FIELDCAPTION("This WCR Cost Variation WCR"));
        NotificationBody := NotificationBody.Replace('%ThisWCRCostVariationWCR%',FORMAT(SalesHeader."This WCR Cost Variation WCR"));
        NotificationBody := NotificationBody.Replace('%TotalCostAfterWCRCaption%',SalesHeader.FIELDCAPTION("Total Cost After WCR"));
        NotificationBody := NotificationBody.Replace('%TotalCostAfterWCR%',FORMAT(SalesHeader."Total Cost After WCR"));
        NotificationBody := NotificationBody.Replace('%BalancePOAfterWCRCaption%',SalesHeader.FIELDCAPTION("Total PO After WCR"));
        NotificationBody := NotificationBody.Replace('%BalancePOAfterWCR%',FORMAT(SalesHeader."Total PO After WCR"));
        NotificationBody := NotificationBody.Replace('%CheckVoucherNoCaption%',SalesHeader.FIELDCAPTION("Check Voucher No."));
        NotificationBody := NotificationBody.Replace('%CheckVoucherNo%',SalesHeader."Check Voucher No.");
        NotificationBody := NotificationBody.Replace('%CashAdvanceNoCaption%',SalesHeader.FIELDCAPTION("Cash Advance No."));
        NotificationBody := NotificationBody.Replace('%CashAdvanceNo%',SalesHeader."Cash Advance No.");
        NotificationBody := NotificationBody.Replace('%CheckNoCaption%',SalesHeader.FIELDCAPTION("Check No."));
        NotificationBody := NotificationBody.Replace('%CheckNo%',SalesHeader."Check No.");
        NotificationBody := NotificationBody.Replace('%ReleasedDateCaption%',SalesHeader.FIELDCAPTION("Released Date"));
        NotificationBody := NotificationBody.Replace('%ReleasedDate%',FORMAT(SalesHeader."Released Date"));
        NotificationBody := NotificationBody.Replace('%AmountToBeChargeCaption%',SalesHeader.FIELDCAPTION("Amt. to be Charged"));
        NotificationBody := NotificationBody.Replace('%AmountToBeCharge%',FORMAT(SalesHeader."Amt. to be Charged"));
        NotificationBody := NotificationBody.Replace('%GTRepresentativeCommentCaption%','GT Representative Comment');
        NotificationBody := NotificationBody.Replace('%GTRepresentativeComment%',GTComments);
        NotificationBody := NotificationBody.Replace('%RemarksCaption%','Remarks');
        NotificationBody := NotificationBody.Replace('%Remarks%',RemarksLoc);
      END;
    END;

    LOCAL PROCEDURE ConstructJobDetailsForHTML@29(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";Job@1000 : Record 167);
    VAR
      Employee@1002 : Record 5200;
      Customer@1003 : Record 18;
      Contact@1004 : Record 5050;
      Resource@1005 : Record 156;
    BEGIN
      WITH Job DO BEGIN
        NotificationBody := NotificationBody.Replace('%DescriptionCaption%', Job.FIELDCAPTION(Description));
        NotificationBody := NotificationBody.Replace('%Description%', ReplaceSpecChar(Job.Description + ' ' + Job."Description 2"));
        NotificationBody := NotificationBody.Replace('%BillToNameCaption%', Job.FIELDCAPTION("Bill-to Name"));
        NotificationBody := NotificationBody.Replace('%BillToName%', ReplaceSpecChar(Job."Bill-to Name" + ' ' + Job."Bill-to Name 2"));
        NotificationBody := NotificationBody.Replace('%BillToAddressCaption%', Job.FIELDCAPTION("Bill-to Address"));
        NotificationBody := NotificationBody.Replace('%BillToAddress%', ReplaceSpecChar(Job."Bill-to Address" + ' ' + Job."Bill-to Address 2"));
        Job.CALCFIELDS("Person Responsible");
        NotificationBody := NotificationBody.Replace('%PersonResponsibleCaption%', Job.FIELDCAPTION("Person Responsible"));
        NotificationBody := NotificationBody.Replace('%PersonResponsible%', Job."Person Responsible No." + ' ' + ReplaceSpecChar(Job."Person Responsible"));
        Job.CALCFIELDS("Technical In-charge");
        NotificationBody := NotificationBody.Replace('%TechnicalInChargeCaption%', Job.FIELDCAPTION("Technical In-charge"));
        NotificationBody := NotificationBody.Replace('%TechnicalInCharge%', Job."Technical In-charge No." + ' ' + ReplaceSpecChar(Job."Technical In-charge"));
        Job.CALCFIELDS("Cost Analyst");
        NotificationBody := NotificationBody.Replace('%CostAnalystCaption%', Job.FIELDCAPTION("Cost Analyst"));
        NotificationBody := NotificationBody.Replace('%CostAnalyst%', Job."Cost Analyst No." + ' ' + ReplaceSpecChar(Job."Cost Analyst"));
        SetINTPDetails(NotificationBody, Job."INTP No.");
        NotificationBody := NotificationBody.Replace('%StatusCaption%', Job.FIELDCAPTION(Status));
        NotificationBody := NotificationBody.Replace('%Status%', FORMAT(Job.Status));
      END;
    END;

    BEGIN
    {
      !! Documentation Codeunit 1510 Notification Management

        10:57 AM Tuesday, October 15, 2024
          Code transfer of ReplaceTokenWithApprovalInfo NotificationEntry.Type::"Approval-WW", NotificationEntry.Type::"Approval-TERF"
            to CustomNotificationManagement.ReplaceTokensWithCustomApprovalInfo

          Code transfer of ReplaceTokensWithRecInfo Sales Header to CustomNotificationManagement.ReplaceTokensWithRecInfo

        4:36 PM Thursday, October 17, 2024
          Code transfer of ReplaceTokenWithApprovalInfo NotificationEntry.Type::"Approval-RFE"
            to CustomNotificationManagement.ReplaceTokensWithCustomApprovalInfo
    }
    END.
  }
}

OBJECT Codeunit 50581 Custom Notification Management
{
  OBJECT-PROPERTIES
  {
    Date=07/11/18;
    Time=[ 1:09:14 AM];
    Modified=Yes;
    Version List=NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      ActionApproveTxt@1014 : TextConst 'ENU=requires your approval.';
      ActionApprovedTxt@1013 : TextConst 'ENU=has been approved.';
      ActionCreateTxt@1012 : TextConst 'ENU=has been created and successfully completed the approval process.';
      ActionCancelTxt@1011 : TextConst 'ENU=has been canceled.';
      ActionRejectTxt@1010 : TextConst 'ENU=has been rejected.';
      ActionOpenTxt@1009 : TextConst 'ENU=has been reopened.';
      ActionStartTxt@1000 : TextConst 'ENU=has been started by %1. Please see the updated %2 information below. If you have concern please contact your handler.';
      Action2StartTxt@1031 : TextConst 'ENU=has been started by %1. Please see the updated %2 information below.';
      ActionPostponedTxt@1021 : TextConst 'ENU=has been postponed by %1. Please see the updated %2 information below.';
      ActionCompletedTxt@1028 : TextConst 'ENU=has been completed by %1. Please see the updated %2 information below.';
      ActionResolvedClosedTxt@1003 : TextConst 'ENU=has been %1 by %2. Please see the updated %3 information below. If you have concern please contact your handler.';
      ActionCloseTicketSDRTxt@1027 : TextConst 'ENU=has been closed and transferred to software development request by %1. Please see the updated ticket''s information below. If you have concern please contact your handler.';
      ActionHandlerChangeTxt@1017 : TextConst 'ENU=, handler has been updated. Your new handler is %1. If you have concern please contact your handler.';
      ActionNewRecordLinkTxt@1020 : TextConst 'ENU=: %1 added a %2. Please see the %2 below. If you have concern please contact your handler.';
      ActionReleaseTxt@1006 : TextConst 'ENU="has been released. Please wait for your handler to reply. "';
      ActionReleaseToHandlerTxt@1023 : TextConst 'ENU=has been released. You can start handling the %1.';
      ActionCommitmentChangeTxt@1015 : TextConst 'ENU=commitment date has been changed by %1. Please see the updated %2 details below. If you have concern please contact your handler.';
      Action2CommitmentChangeTxt@1032 : TextConst 'ENU=commitment date has been changed by %1. Please see the updated %2 details below.';
      ActionChangeOfPriorityLevel@1018 : TextConst 'ENU=has been set to %1 priority. Please see the updated %2 information below.';
      ActionChangeOfSizeOfRequirementsLevel@1004 : TextConst 'ENU=: %1 has been set the %2 to %3. Completion of the request may vary depending on the %2. Please see the updated %4 information below.';
      ActionAgingBeforeDueTxt@1024 : TextConst 'ENU=is reaching the deadline. You have <string>%1</strong> day/s left to complete the %2.';
      ActionAgingOverdueTxt@1026 : TextConst 'ENU=<br/>%1 day/s have passed since the due date for this %2. Please tend to this %2 immediately.';
      Action2AgingBeforeDueTxt@1025 : TextConst 'ENU=Expected closing of %1 is on <strong>%2 %3</strong>.';
      Action3AgingBeforeDueTxt@1033 : TextConst 'ENU=Expected closing of %1 is on <strong>%2 </strong>.';
      ActionPercentCompleteUpdate@1034 : TextConst 'ENU="percent complete has been updated to %1. "';
      StatusChangeActionStartedTxt@1001 : TextConst 'ENU=Expected closing of %1 is on <strong>%2</strong>.';
      StatusChangeActionResolvedClosedTxt@1002 : TextConst 'ENU=%1 has been %2 <strong>%3 %4.</strong>';
      StatusChangeAction2ResolvedClosedTxt@1035 : TextConst 'ENU=%1 has been %2 <strong>%3 </strong>';
      StatusChangeActionTicketClosedTxt@1005 : TextConst 'ENU=Ticket has been closed <strong>%1.</strong> Reason for closing, %2.';
      StatusChangeActionReleasedTxt@1007 : TextConst 'ENU=Your %1 has been forwarded to one of our handlers.';
      NotificationManagement@1046 : Codeunit 1510;
      StringConversionManagement@1008 : Codeunit 47;
      StatusChangeActionCommitmentIsUpdatedTxt@1016 : TextConst 'ENU=The updated closing of %1 will be on <strong>%2 %3.</strong>';
      StatusChangeActionNewNoteTxt@1019 : TextConst 'ENU=A new note has been added.';
      StatusChangeActionFieldChangeTxt@1022 : TextConst 'ENU=%1 details had been updated.';
      PurchDocTypeTxt@1029 : TextConst '@@@="%1 = Document No.";ENU=Purchase %1';
      StripoEmailTemplate@1047 : Codeunit 50600;
      InStr@1030 : InStream;
      SalesDocTypeTxt@1048 : TextConst 'ENU=Sales %1';

      StripoContentComment1@1043 : TextConst
        'ENU="<table cellpadding=""0"" cellspacing=""0"" class=""es-content"" align=""center"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%""><tr><td align=""center"" id=""comment-remarks-portion"" style=""padding:0;Margin:0""><table bgcolor=""#ffffff"" class=""es-content-body"" align=""center"" cellpadding=""0"" cellspacing=""0"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#FFFFFF;width:600px""><tr><td align=""left"" style=""padding:0;Margin:0""><table cellpadding=""0"" cellspacing=""0"" width=""100%"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td align=""center"" valign=""top"" style=""padding:0;Margin:0;width:600px""><table cellpadding=""0"" cellspacing=""0"" width=""100%"" role=""presentation"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td align=""center"" style=""padding:10px;Margin:0;font-size:0""><"';

      StripoContentComment2@1042 : TextConst
        'ENU="table border=""0"" width=""100%"" height=""100%"" cellpadding=""0"" cellspacing=""0"" role=""presentation"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td style=""padding:0;Margin:0;border-bottom:1px solid #cccccc;background:unset;height:1px;width:100%;margin:0px""></td></tr></table></td></tr></table></td></tr></table></td></tr><tr><td align=""left"" style=""padding:10px;Margin:0""><table cellpadding=""0"" cellspacing=""0"" width=""100%"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td align=""center"" valign=""top"" style=""padding:0;Margin:0;width:580px""><table cellpadding=""0"" cellspacing=""0"" width=""100%"" role=""presentation"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td align=""left"" style=""padding:0;Margin:0""><p style=""Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif"';
      StripoContentComment3@1041 : TextConst 'ENU=";line-height:24px;color:#333333;font-size:16px""><b>COMMENT/REMARKS:</b></p></td></tr></table></td></tr></table></td></tr>%StripoCommentPart% </table></td></tr></table>"';

      StripoContentBody1@1040 : TextConst
        'ENU="<tr><td class=""esdev-adapt-off"" align=""left"" style=""Margin:0;padding-top:10px;padding-bottom:10px;padding-left:20px;padding-right:20px""><table cellpadding=""0"" cellspacing=""0"" class=""esdev-mso-table"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;width:560px""><tr><td class=""esdev-mso-td"" valign=""top"" style=""padding:0;Margin:0""><table cellpadding=""0"" cellspacing=""0"" class=""es-left"" align=""left"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;float:left""><tr><td class=""es-m-p0r"" align=""center"" style=""padding:0;Margin:0;width:100px""><table cellpadding=""0"" cellspacing=""0"" width=""100%"" role=""presentation"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td align=""center"" style=""padding:0;Margin:0;font-size:0px""><img class=""adapt-img"" src=""https://wreier.stripocdn.email/content/guids/CABINET_9a1892b4e097d70ac9a9b24cd80f650b/images/clipart546487.png"" alt style=""display:block;bor"';

      StripoContentBody2@1039 : TextConst
        'ENU="der:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic"" width=""70""></td></tr></table></td></tr></table></td><td class=""esdev-mso-td"" valign=""top"" style=""padding:0;Margin:0""><table cellpadding=""0"" cellspacing=""0"" class=""es-right"" align=""right"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;float:right""><tr><td align=""center"" style=""padding:0;Margin:0;width:460px""><table cellpadding=""0"" cellspacing=""0"" width=""100%"" role=""presentation"" style=""mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px""><tr><td align=""left"" style=""padding:0;Margin:0""><p style=""Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px""><u><strong>%UserID%</strong></u></p></td></tr><tr><td align=""left"" style=""padding:0;Margin:0""><p style=""Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-"';
      StripoContentBody3@1038 : TextConst 'ENU="line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px""><strong>Datetime:</strong>%Datetime% </p></td></tr>%StripoCommentDetails% </table></td></tr></table></td></tr></table></td></tr>"';
      StripoRecordNote@1037 : TextConst 'ENU="<tr><td align=""left"" style=""padding:0;Margin:0;padding-top:5px;padding-left:10px""><p style=""Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"">%RecordNote%</p></td></tr>"';
      StripoRecordLink@1036 : TextConst 'ENU="<tr><td align=""left"" style=""padding:0;Margin:0;padding-top:5px;padding-left:10px""><p style=""Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px""><a target=""_blank"" href=""%RecordLink%"" style=""-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;text-decoration:underline;color:#5C68E2;font-size:14px"">%RecordLinkText%</a>&nbsp; </p></td></tr>"';
      TitleApprovalSystemTxt@1044 : TextConst 'ENU=Microsoft Dynamics NAV %1 Approval';
      TitleUserCredentialTxt@1045 : TextConst 'ENU=User Credential';

    PROCEDURE PopulateCustomNotificationTemplateWithRecIndependentInfo@19(VAR NotificationBody@1002 : DotNet "'mscorlib'.System.String";NotificationEntry@1007 : Record 1511) : Boolean;
    VAR
      NotificationSetup@1004 : Record 1512;
      Customer@1000 : Record 18;
      Vendor@1006 : Record 23;
      Item@1013 : Record 27;
      INTP@1011 : Record 50040;
      JobOrder@1014 : Record 50012;
      RFQ@1012 : Record 50013;
      PurchaseHeader@1010 : Record 38;
      SalesHeader@1009 : Record 36;
      Ticket@1015 : Record 50562;
      DataTypeManagement@1003 : Codeunit 701;
      NotificationManagement@1008 : Codeunit 1510;
      RecRef@1001 : RecordRef;
    BEGIN
      // Applied to Codeunit 1510 Notification Management > PopulateNotificationTemplateWithRecIndependentInfo
      {
      NotificationManagement.PopulateNotificationTemplateWithRecIndependentInfo
      *** Start of Code
        ELSE
          IF NOT CustomNotificationManagement.PopulateCustomNotificationTemplateWithRecIndependentInfo(NotificationBodyString, NotificationEntry) THEN
            NotificationBodyString := NotificationBodyString.Replace('%Title%',TitleWorkflowNotificationEngineTxt);
      *** End of Code

      *** Replace
        ELSE
          NotificationBodyString := NotificationBodyString.Replace('%Title%',TitleWorkflowNotificationEngineTxt);
      ** End of code to replace
      }
      CASE NotificationEntry.Type OF
        NotificationEntry.Type::"Appvl-Tckt":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, Ticket.TABLECAPTION));
        NotificationEntry.Type::"Approval-INTP":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, INTP.TABLECAPTION));
        NotificationEntry.Type::"Approval-RFQ":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, RFQ.TABLECAPTION));
        NotificationEntry.Type::"Approval-JO":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, JobOrder.TABLECAPTION));
        NotificationEntry.Type::"Approval-CA":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, PurchaseHeader."Request Type"::"Cash Advance"));
        NotificationEntry.Type::"Approval-RFPay":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, PurchaseHeader."Request Type"::"Request for Payment"));
        // Sales Header
        NotificationEntry.Type::"Approval-Sales":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, 'Sales ' + FORMAT(SalesHeader."Document Type")));
        NotificationEntry.Type::"Approval-TERF":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, SalesHeader."Request type"::"Tools & Equipment Requisition"));
        NotificationEntry.Type::"Approval-WW":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, SalesHeader."Request type"::Withdrawal));
        NotificationEntry.Type::"Approval-C-RMA":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, SalesHeader."Request type"::"Return Merchandise Authorization"));
        NotificationEntry.Type::"Approval-RFE":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, SalesHeader."Request type"::"Request For Exception"));
        NotificationEntry.Type::"Approval-WCR":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, SalesHeader."Request type"::"Work Change Request"));
        NotificationEntry.Type::"Approval-Vendor":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, Vendor.TABLECAPTION));
        NotificationEntry.Type::"Approval-Customer":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, Customer.TABLECAPTION));
        NotificationEntry.Type::"Approval-Item":
          NotificationBody := NotificationBody.Replace('%Title%',STRSUBSTNO(TitleApprovalSystemTxt, Item.TABLECAPTION));
        NotificationEntry.Type::"RU-Pass":
          NotificationBody := NotificationBody.Replace('%Title%',TitleUserCredentialTxt);
        ELSE
          EXIT(FALSE);
      END;

      EXIT(TRUE);
    END;

    PROCEDURE PopulateCustomNotificationTemplateWithRecordInfo@12(VAR NotificationBody@1002 : DotNet "'mscorlib'.System.String";NotificationEntry@1001 : Record 1511);
    VAR
      SalesHeader@1012 : Record 36;
      INTP@1011 : Record 50040;
      Opportunity@1010 : Record 5092;
      OpportunityEntry@1009 : Record 5093;
      ToDo@1007 : Record 5080;
      Ticket@1013 : Record 50562;
      SDR@1014 : Record 50555;
      Task@1015 : Record 50556;
      DataTypeManagement@1004 : Codeunit 701;
      RecRef@1003 : RecordRef;
      RecRef2@1000 : RecordRef;
      NotificationBodyString@1005 : DotNet "'mscorlib'.System.String";
      ClientLinks@1006 : Text;
      DaysLeft@1008 : Integer;
    BEGIN
      DataTypeManagement.GetRecordRef(NotificationEntry."Triggered By Record",RecRef);
        CASE NotificationEntry.Type OF
          NotificationEntry.Type::"New-Tckt": // Status Notification of Ticket
            BEGIN
              RecRef.SETTABLE(Ticket);
              CASE NotificationEntry."Ticket Action Type" OF
                NotificationEntry."Ticket Action Type"::"Start Ticket":
                  BEGIN
                    IF Ticket."Handler User ID" = '' THEN
                      NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionStartTxt, NotificationEntry."Created By", LOWERCASE(Ticket.TABLECAPTION)))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionStartTxt, Ticket."Handler User ID", LOWERCASE(Ticket.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, Ticket.TABLECAPTION, FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Ticket Action Type"::"Change of Commitment Date":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionCommitmentChangeTxt, Ticket."Handler User ID", LOWERCASE(Ticket.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionCommitmentIsUpdatedTxt, LOWERCASE(Ticket.TABLECAPTION), FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), Ticket."Finishing Time"));
                  END;
                NotificationEntry."Ticket Action Type"::"Change of Handler":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionHandlerChangeTxt, Ticket."Handler User ID"));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionCommitmentIsUpdatedTxt, LOWERCASE(Ticket.TABLECAPTION), FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), Ticket."Finishing Time"));
                  END;
                NotificationEntry."Ticket Action Type"::"New Note", NotificationEntry."Ticket Action Type"::"New Link":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',
                      STRSUBSTNO(ActionNewRecordLinkTxt, NotificationEntry."Created By",LOWERCASE(FORMAT(NotificationEntry."Ticket Action Type"))));
                    IF Ticket.Status IN [Ticket.Status::Closed, Ticket.Status::Resolved] THEN
                      NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                        STRSUBSTNO(StatusChangeActionResolvedClosedTxt,Ticket.TABLECAPTION,LOWERCASE(FORMAT(Ticket.Status)),FORMAT(Ticket."Date Resolved",0,'<Month Text> <Day,2>, <Year4>'),Ticket."Time Resolved"))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                        STRSUBSTNO(StatusChangeActionStartedTxt, Ticket.TABLECAPTION, FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Ticket Action Type"::Resolved:
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',
                      STRSUBSTNO(ActionResolvedClosedTxt, LOWERCASE(FORMAT(Ticket.Status)), Ticket."Handler User ID", LOWERCASE(Ticket.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionResolvedClosedTxt,Ticket.TABLECAPTION,LOWERCASE(FORMAT(Ticket.Status)),FORMAT(Ticket."Date Resolved",0,'<Month Text> <Day,2>, <Year4>'), FORMAT(Ticket."Time Resolved")));
                  END;
                NotificationEntry."Ticket Action Type"::Closed:
                  BEGIN
                    IF Ticket."SDR No." = '' THEN
                      NotificationBody := NotificationBody.Replace('%Action%',
                        STRSUBSTNO(ActionResolvedClosedTxt, LOWERCASE(FORMAT(Ticket.Status)), Ticket."Handler User ID", LOWERCASE(Ticket.TABLECAPTION)))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionCloseTicketSDRTxt, Ticket."Handler User ID"));

                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionTicketClosedTxt, FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), StringConversionManagement.WindowsToASCII(Ticket."Reason for Closing/Resolution")));
                  END;
                NotificationEntry."Ticket Action Type"::"Change of Priority":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionChangeOfPriorityLevel, FORMAT(Ticket."Priority Level"), Ticket.TABLECAPTION));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',STRSUBSTNO(StatusChangeActionFieldChangeTxt, Ticket.TABLECAPTION));
                  END;
                NotificationEntry."Ticket Action Type"::"Released To Handler":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionReleaseToHandlerTxt, LOWERCASE(Ticket.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%','');
                  END;
                NotificationEntry."Ticket Action Type"::"Aging Before Due":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionAgingBeforeDueTxt, Ticket.GetNoOfDaysLeft, LOWERCASE(Ticket.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(Action2AgingBeforeDueTxt, LOWERCASE(Ticket.TABLECAPTION), FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), FORMAT(Ticket."Finishing Time")));
                  END;
                NotificationEntry."Ticket Action Type"::"Aging Overdue":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionAgingOverdueTxt, (Ticket.GetNoOfDaysLeft), LOWERCASE(Ticket.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(Action2AgingBeforeDueTxt, LOWERCASE(Ticket.TABLECAPTION), FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), FORMAT(Ticket."Finishing Time")));
                  END;
                ELSE BEGIN
                  NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionReleaseTxt));
                  NotificationBody := NotificationBody.Replace('%StatusChangeAction%',STRSUBSTNO(StatusChangeActionReleasedTxt, LOWERCASE(Ticket.TABLECAPTION)));
                END;
              END;

              // Change the StatusChangeAction depending on the status of the table
              IF NOT (Ticket.Status IN [Ticket.Status::Resolved, Ticket.Status::Closed]) THEN
                NotificationBody := NotificationBody.Replace('%StatusChangeAction%',STRSUBSTNO(StatusChangeActionStartedTxt, Ticket.TABLECAPTION,
                    FORMAT(Ticket."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')))
              ELSE
                NotificationBody := NotificationBody.Replace('%StatusChangeAction%', '');
            END;

          NotificationEntry.Type::"New-SDR": // Status Notification of SDR
            BEGIN
              RecRef.SETTABLE(SDR);
              CASE NotificationEntry."Action Type" OF
                NotificationEntry."Action Type"::Started:
                  BEGIN
                    IF SDR."Handler User ID" = '' THEN
                      NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionStartTxt, NotificationEntry."Created By", LOWERCASE(SDR.TABLECAPTION)))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionStartTxt, SDR."Handler User ID", LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(SDR.TABLECAPTION), FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Action Type"::"Change of Commitment Date":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionCommitmentChangeTxt, SDR."Handler User ID", LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionCommitmentIsUpdatedTxt, LOWERCASE(SDR.TABLECAPTION), FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), SDR."Finishing Time"));
                  END;
                NotificationEntry."Action Type"::"Change of Handler":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionHandlerChangeTxt, SDR."Handler User ID"));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionCommitmentIsUpdatedTxt, LOWERCASE(SDR.TABLECAPTION), FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), SDR."Finishing Time"));
                  END;
                NotificationEntry."Action Type"::"New Note",NotificationEntry."Action Type"::"New Link":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',
                      STRSUBSTNO(ActionNewRecordLinkTxt, NotificationEntry."Created By", LOWERCASE(FORMAT(NotificationEntry."Action Type"))));
                    IF SDR.Status IN [SDR.Status::Closed, SDR.Status::Resolved] THEN
                      NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                        STRSUBSTNO(StatusChangeActionResolvedClosedTxt,SDR.TABLECAPTION,LOWERCASE(FORMAT(SDR.Status)),FORMAT(SDR."Date Resolved",0,'<Month Text> <Day,2>, <Year4>'),SDR."Time Resolved"))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                        STRSUBSTNO(StatusChangeActionStartedTxt, SDR.TABLECAPTION, FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Action Type"::Resolved,NotificationEntry."Action Type"::Closed:
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionResolvedClosedTxt,LOWERCASE(FORMAT(SDR.Status)), SDR."Handler User ID", LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionResolvedClosedTxt,SDR.TABLECAPTION,LOWERCASE(FORMAT(SDR.Status)),FORMAT(SDR."Date Resolved",0,'<Month Text> <Day,2>, <Year4>'), SDR."Time Resolved"));
                  END;
                NotificationEntry."Action Type"::"Change of Priority":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionChangeOfPriorityLevel, FORMAT(SDR."Priority Level"), LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',STRSUBSTNO(StatusChangeActionFieldChangeTxt, LOWERCASE(SDR.TABLECAPTION)));
                  END;
                NotificationEntry."Action Type"::"Released To Handler":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionReleaseToHandlerTxt, LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%','');
                  END;
                NotificationEntry."Action Type"::"Aging Before Due":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionAgingBeforeDueTxt, SDR.GetNoOfDaysLeft, LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(Action2AgingBeforeDueTxt, LOWERCASE(SDR.TABLECAPTION), FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), SDR."Finishing Time"));
                  END;
                NotificationEntry."Action Type"::"Aging Overdue":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionAgingOverdueTxt, (SDR.GetNoOfDaysLeft), LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(Action2AgingBeforeDueTxt, LOWERCASE(SDR.TABLECAPTION), FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>'), SDR."Finishing Time"));
                  END;
                NotificationEntry."Action Type"::"Size of Requirements":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',
                      STRSUBSTNO(ActionChangeOfSizeOfRequirementsLevel,NotificationEntry."Created By",LOWERCASE(SDR.FIELDCAPTION("Size of Requirement")), SDR."Size of Requirement",LOWERCASE(SDR.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(SDR.TABLECAPTION), FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                ELSE BEGIN
                  NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionReleaseTxt));
                  NotificationBody := NotificationBody.Replace('%StatusChangeAction%',STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(SDR.TABLECAPTION)));
                END;
              END;

              // Change the StatusChangeAction depending on the status of the table
              IF NOT (Ticket.Status IN [SDR.Status::Resolved, SDR.Status::Closed]) THEN
                NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                  STRSUBSTNO(StatusChangeActionStartedTxt, SDR.TABLECAPTION, FORMAT(SDR."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')))
              ELSE
                NotificationBody := NotificationBody.Replace('%StatusChangeAction%', '');
            END;

          NotificationEntry.Type::"New-Task": // Status Notification of Task
            BEGIN
              RecRef.SETTABLE(Task);
              CASE NotificationEntry."Action Type" OF
                NotificationEntry."Action Type"::Started:
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(Action2StartTxt, Task."Assigned To User ID", LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(Task.TABLECAPTION), FORMAT(Task."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Action Type"::Postponed:
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionPostponedTxt, Task."Assigned To User ID", LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(Task.TABLECAPTION), Task."Assigned To User ID"));
                  END;
                NotificationEntry."Action Type"::Completed:
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionCompletedTxt, Task."Completed By User ID", LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(Task.TABLECAPTION), Task."Assigned To User ID"));
                  END;
                NotificationEntry."Action Type"::"Change of Priority":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionChangeOfPriorityLevel, FORMAT(Task.Priority), LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',STRSUBSTNO(StatusChangeActionFieldChangeTxt, LOWERCASE(Task.TABLECAPTION)));
                  END;
                NotificationEntry."Action Type"::"Change of Commitment Date":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(Action2CommitmentChangeTxt, Task."Assigned To User ID", LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionCommitmentIsUpdatedTxt, LOWERCASE(Task.TABLECAPTION), FORMAT(Task."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Action Type"::"Aging Before Due":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionAgingBeforeDueTxt, Task.GetNoOfDaysLeft, LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(Action3AgingBeforeDueTxt, LOWERCASE(Task.TABLECAPTION), FORMAT(Task."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Action Type"::"Aging Overdue":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionAgingOverdueTxt, (Task.GetNoOfDaysLeft), LOWERCASE(Task.TABLECAPTION)));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(Action3AgingBeforeDueTxt, LOWERCASE(Task.TABLECAPTION), FORMAT(Task."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
                NotificationEntry."Action Type"::"Percent Complete Update":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',STRSUBSTNO(ActionPercentCompleteUpdate, FORMAT(Task."Percent Complete",0,'<precision, 1:0><standard format, 0> %')));
                    NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                      STRSUBSTNO(StatusChangeActionStartedTxt, LOWERCASE(Task.TABLECAPTION), Task."Assigned To User ID"));
                  END;
                NotificationEntry."Action Type"::"New Note",NotificationEntry."Action Type"::"New Link":
                  BEGIN
                    NotificationBody := NotificationBody.Replace('%Action%',
                      STRSUBSTNO(ActionNewRecordLinkTxt, NotificationEntry."Created By", LOWERCASE(FORMAT(NotificationEntry."Action Type"))));
                    IF Task.Status = Task.Status::Completed THEN
                      NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                        STRSUBSTNO(StatusChangeAction2ResolvedClosedTxt,Task.TABLECAPTION,LOWERCASE(FORMAT(Task.Status)),FORMAT(Task."Date Completed")))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%StatusChangeAction%',
                        STRSUBSTNO(StatusChangeActionStartedTxt, Task.TABLECAPTION, FORMAT(Task."Finishing Date",0,'<Month Text> <Day,2>, <Year4>')));
                  END;
              END;

            END;

          ELSE BEGIN
            // End Statement
          END;
        END;
    END;

    PROCEDURE ReplaceTokensWithCustomApprovalInfo@1(VAR NotificationBody@1000 : DotNet "'mscorlib'.System.String";RecRef@1001 : RecordRef;NotificationType@1002 : Option);
    VAR
      Vendor@1016 : Record 23;
      PurchaseHeader@1007 : Record 38;
      SalesHeader@1019 : Record 36;
      ApprovalEntry@1003 : Record 454;
      NotificationEntry@1004 : Record 1511;
      Tickets@1011 : Record 50562;
      SDR@1005 : Record 50555;
      Task@1008 : Record 50556;
      INTP@1015 : Record 50040;
      JobOrder@1017 : Record 50012;
      RFQ@1018 : Record 50013;
      TicketNotifDispatcher@1012 : Codeunit 50579;
      StringConversionMgmt@1013 : Codeunit 47;
      SDRNotifDispatcher@1006 : Codeunit 50585;
      TaskNotifDispatcher@1009 : Codeunit 50588;
      InStr@1010 : InStream;
      DescriptionTxt@1014 : Text;
    BEGIN
      // Record from approval entry
      RecRef.SETTABLE(ApprovalEntry);

      CASE NotificationType OF
        NotificationEntry.Type::"Approval-PO", NotificationEntry.Type::"Approval-CA",NotificationEntry.Type::"Approval-RFPay",NotificationEntry.Type::"Approval-RFPur",
        NotificationEntry.Type::"Appvl-Tckt",NotificationEntry.Type::"Appvl-SDR",NotificationEntry.Type::"Approval-INTP",
        NotificationEntry.Type::"Approval-RFQ", NotificationEntry.Type::"Approval-JO", NotificationEntry.Type::"Approval-WW", NotificationEntry.Type::"Approval-TERF", NotificationEntry.Type::"Approval-RFE":
          BEGIN
            CASE ApprovalEntry.Status OF
              ApprovalEntry.Status::Open:
                BEGIN
                  NotificationBody := NotificationBody.Replace('%Action%',ActionApproveTxt);
                END;
              ApprovalEntry.Status::Canceled:
                NotificationBody := NotificationBody.Replace('%Action%',ActionCancelTxt);
              ApprovalEntry.Status::Rejected:
                NotificationBody := NotificationBody.Replace('%Action%',ActionRejectTxt);
              ApprovalEntry.Status::Created:
                NotificationBody := NotificationBody.Replace('%Action%',ActionCreateTxt);
              ApprovalEntry.Status::Approved:
                NotificationBody := NotificationBody.Replace('%Action%',ActionApprovedTxt);
            END;
          END;
      END;

      IF RecRef.GET(ApprovalEntry."Record ID to Approve") THEN BEGIN
        CASE ApprovalEntry."Table ID" OF
          DATABASE::"Request For Quotation":
            BEGIN
              RecRef.SETTABLE(RFQ);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RFQ.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              NotificationBody := NotificationBody.Replace('%Details%','');
              ReplaceTokenWithRFQDetails(NotificationBody, RFQ);
             StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, RFQ.RECORDID);
            END;
          DATABASE::Vendor:
            BEGIN
              RecRef.SETTABLE(Vendor);
              NotificationBody := NotificationBody.Replace('%DocumentType%',RecRef.CAPTION);
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%',RecRef.CAPTION);
              SetTokenToValueOfField(NotificationBody,'%CustomerVendorNo%',RecRef,'No.');
              SetTokenToValueOfField(NotificationBody,'%CustomerVendorName%',RecRef,'Name');
              ReplaceTokenWithVendorDetails(NotificationBody, Vendor);
            END;
          DATABASE::"Purchase Header":
            BEGIN
              // General Setup
              RecRef.SETTABLE(PurchaseHeader);
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              ReplaceTokenWithPurchaseHeaderDetails(NotificationBody, PurchaseHeader);
            END;
          DATABASE::"Sales Header":
            BEGIN
              RecRef.SETTABLE(SalesHeader);
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              ReplaceTokenWithSalesHeaderDetails(NotificationBody, SalesHeader);
            END;
          DATABASE::Ticket:
            BEGIN
              RecRef.SETTABLE(Tickets);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(Tickets.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              NotificationBody := NotificationBody.Replace('%Details%',StringConversionMgmt.WindowsToASCII(Tickets.Description));
              TicketNotifDispatcher.SetNotificationBody(NotificationBody, Tickets);
            END;
          DATABASE::"Software Development Request":
            BEGIN
              RecRef.SETTABLE(SDR);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(SDR.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              NotificationBody := NotificationBody.Replace('%Details%',StringConversionMgmt.WindowsToASCII(SDR.Description));
              SDRNotifDispatcher.SetNotificationBody(NotificationBody, SDR);
            END;
          DATABASE::"Job Order":
            BEGIN
              RecRef.SETTABLE(JobOrder);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(JobOrder.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              NotificationBody := NotificationBody.Replace('%Details%','');
              ReplaceTokenWithJobOrderDetails(NotificationBody, JobOrder);
              StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, RecRef.RECORDID);
            END;
          DATABASE::Task:
            BEGIN
              RecRef.SETTABLE(Task);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(Task.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              Task.CALCFIELDS(Description);
              IF Task.Description.HASVALUE THEN BEGIN
                Task.Description.CREATEINSTREAM(InStr);
                InStr.READ(DescriptionTxt);
              END;
              NotificationBody := NotificationBody.Replace('%Details%',StringConversionMgmt.WindowsToASCII(DescriptionTxt));
              TaskNotifDispatcher.SetNotificationBody(NotificationBody, Task);
            END;
          DATABASE::"Internal Notice to Proceed":
            BEGIN
              RecRef.SETTABLE(INTP);
              NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(INTP.TABLECAPTION));
              SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
              SetTokenToValueOfField(NotificationBody,'%No%',RecRef,'No.');
              ReplaceTokenWithINTPDetails(NotificationBody, INTP);
              StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, INTP.RECORDID);
            END;
        END;
      END;
    END;

    PROCEDURE ReplaceTokensWithRecInfo@2(VAR NotificationBody@1000 : DotNet "'mscorlib'.System.String";RecRef@1001 : RecordRef);
    VAR
      Vendor@1015 : Record 23;
      JobOrder@1010 : Record 50012;
      SalesHeader@1011 : Record 36;
      RecordLink@1008 : Record 2000000068;
      User@1007 : Record 2000000120;
      PurchaseHeader@1006 : Record 38;
      Ticket@1002 : Record 50562;
      SDR@1004 : Record 50555;
      INTP@1014 : Record 50040;
      RFQ@1016 : Record 50013;
      TicketNotifDispatcher@1003 : Codeunit 50579;
      SDRNotifDispatcher@1005 : Codeunit 50585;
      NoteTxt@1013 : Text;
      RecRef2@1009 : RecordRef;
      InStr@1012 : InStream;
    BEGIN
      CASE RecRef.NUMBER OF
        DATABASE::"Request For Quotation":
          BEGIN
            RecRef.SETTABLE(RFQ);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RFQ.TABLECAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%Details%','');
            ReplaceTokenWithRFQDetails(NotificationBody, RFQ);
            StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, RFQ.RECORDID);
          END;
        DATABASE::Vendor:
          BEGIN
            RecRef.SETTABLE(Vendor);
            NotificationBody := NotificationBody.Replace('%DocumentType%',RecRef.CAPTION);
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%',RecRef.CAPTION);
            SetTokenToValueOfField(NotificationBody,'%CustomerVendorNo%',RecRef,'No.');
            SetTokenToValueOfField(NotificationBody,'%CustomerVendorName%',RecRef,'Name');
            ReplaceTokenWithVendorDetails(NotificationBody, Vendor);
          END;
        DATABASE::"Purchase Header":
          BEGIN
            RecRef.SETTABLE(PurchaseHeader);
            NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(RecRef.RECORDID));
            ReplaceTokenWithPurchaseHeaderDetails(NotificationBody, PurchaseHeader);
          END;
        DATABASE::"Sales Header":
          BEGIN
            RecRef.SETTABLE(SalesHeader);
            SetTokenToValueOfField(NotificationBody, '%DocumentNo%', RecRef, 'No.');
            //NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(RecRef.RECORDID));
            ReplaceTokenWithSalesHeaderDetails(NotificationBody, SalesHeader);
          END;
        DATABASE::User:
          BEGIN
            RecRef.SETTABLE(User);
            ReplaceTokenWithUserDetails(NotificationBody,User);
          END;
        DATABASE::"Internal Notice to Proceed":
          BEGIN
            RecRef.SETTABLE(INTP);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(INTP.TABLECAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            SetTokenToValueOfField(NotificationBody,'%No%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%Details%','');
            ReplaceTokenWithINTPDetails(NotificationBody, INTP);
            StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, INTP.RECORDID);
          END;
        DATABASE::Ticket:
          BEGIN
            RecRef.SETTABLE(Ticket);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(Ticket.TABLECAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%Details%','');
            TicketNotifDispatcher.SetNotificationBody(NotificationBody, Ticket);
          END;
        DATABASE::"Software Development Request":
          BEGIN
            RecRef.SETTABLE(SDR);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(SDR.TABLECAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%Details%','');
            SDRNotifDispatcher.SetNotificationBody(NotificationBody, SDR);
          END;

        DATABASE::"Job Order":
          BEGIN
            RecRef.SETTABLE(JobOrder);
            NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(JobOrder.TABLECAPTION));
            SetTokenToValueOfField(NotificationBody,'%DocumentNo%',RecRef,'No.');
            NotificationBody := NotificationBody.Replace('%Details%','');
            ReplaceTokenWithJobOrderDetails(NotificationBody, JobOrder);
            StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, JobOrder.RECORDID);
          END;
        DATABASE::"Record Link":
          BEGIN
            RecRef.SETTABLE(RecordLink);
            NotificationBody := NotificationBody.Replace('%DocumentNo%',RecordLink."User ID");
            RecordLink.CALCFIELDS(Note);
            IF RecordLink.Note.HASVALUE THEN BEGIN
              CLEAR(NoteTxt);
              RecordLink.Note.CREATEINSTREAM(InStr);
              InStr.READ(NoteTxt);
              NotificationBody := NotificationBody.Replace('%NoteTxt%', StringConversionManagement.WindowsToASCII(NoteTxt));
            END ELSE
              NotificationBody := NotificationBody.Replace('%NoteTxt%', '');

            IF RecRef2.GET(RecordLink."Record ID") THEN BEGIN
              CASE RecRef2.NUMBER OF
                DATABASE::"Job Order":
                  BEGIN
                    RecRef2.SETTABLE(JobOrder);
                    SetTokenToValueOfField(NotificationBody,'%DocumentNo2%',RecRef2,'No.');
                    NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RecRef2.CAPTION));
                    ReplaceTokenWithLinkedINTPDetails(NotificationBody, JobOrder."INTP No.");
                  END;
                DATABASE::"Purchase Header":
                  BEGIN
                    RecRef2.SETTABLE(PurchaseHeader);
                    ReplaceTokenWithLinkedINTPDetails(NotificationBody, PurchaseHeader."INTP No.");
                    SetTokenToValueOfField(NotificationBody,'%DocumentNo2%',RecRef2,'No.');
                    IF (PurchaseHeader."Request Type" IN [PurchaseHeader."Request Type"::" "]) THEN
                      NotificationBody := NotificationBody.Replace('%DocumentType%','Purchase ' + FORMAT(PurchaseHeader."Document Type"))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(PurchaseHeader."Request Type"));
                  END;
                DATABASE::"Sales Header":
                  BEGIN
                    RecRef2.SETTABLE(SalesHeader);
                    ReplaceTokenWithLinkedINTPDetails(NotificationBody,SalesHeader."INTP No.");
                    SetTokenToValueOfField(NotificationBody,'%DocumentNo2%',RecRef2,'No.');
                    IF (SalesHeader."Request type" IN [SalesHeader."Request type"::" "]) THEN
                      NotificationBody := NotificationBody.Replace('%DocumentType%','Sales ' + FORMAT(SalesHeader."Document Type"))
                    ELSE
                      NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(SalesHeader."Request type"));
                  END;
                ELSE
                  BEGIN
                    SetTokenToValueOfField(NotificationBody,'%DocumentNo2%',RecRef2,'No.');
                    NotificationBody := NotificationBody.Replace('%DocumentType%',FORMAT(RecRef2.CAPTION));
                    ReplaceTokenWithLinkedINTPDetails(NotificationBody, '');
                  END;
              END;
              NotificationBody := NotificationBody.Replace('%Details%','');
            END;
          END;
      END;
    END;

    PROCEDURE ReplaceTokensWithBlanks@3(VAR NotificationBody@1000 : DotNet "'mscorlib'.System.String";RecordIdentifier@1001 : Text);
    BEGIN
      // Applied to Codeunit 1510 ReplaceTokensWithBlanks
      {
      NotificationManagement.ReplaceTokensWithBlanks
      }
      // Notes
      NotificationBody := NotificationBody.Replace('%Notes%','');

      NotificationBody := NotificationBody.Replace('%DocumentDateCaption%','');
      NotificationBody := NotificationBody.Replace('%DocumentDate%','');
      NotificationBody := NotificationBody.Replace('%SubjectCaption%','');
      NotificationBody := NotificationBody.Replace('%Subject%','');
      NotificationBody := NotificationBody.Replace('%ProjectNameCaption%','');
      NotificationBody := NotificationBody.Replace('%ProjectName%','');
      NotificationBody := NotificationBody.Replace('%INTPNoCaption%','');
      NotificationBody := NotificationBody.Replace('%INTPNo%','');
      // CASH ADVANCE
      NotificationBody := NotificationBody.Replace('%JobTypeCaption%','');
      NotificationBody := NotificationBody.Replace('%JobType%','');
      NotificationBody := NotificationBody.Replace('%JobOrderNoCaption%','');
      NotificationBody := NotificationBody.Replace('%JobOrderNo%','');
      NotificationBody := NotificationBody.Replace('%DateOfActivityFromCaption%','');
      NotificationBody := NotificationBody.Replace('%DateOfActivityFrom%','');
      NotificationBody := NotificationBody.Replace('%DateOfActivityToCaption%','');
      NotificationBody := NotificationBody.Replace('%DateOfActivityTo%','');
      NotificationBody := NotificationBody.Replace('%CanvassSheetNoCaption%','');
      NotificationBody := NotificationBody.Replace('%CanvassSheetNo%','');
      NotificationBody := NotificationBody.Replace('%AWLCaption%','');
      NotificationBody := NotificationBody.Replace('%AWL%','');
      NotificationBody := NotificationBody.Replace('%PurposeCaption%','');
      NotificationBody := NotificationBody.Replace('%Purpose%','');
      // TERF & WITHDRAWAL
      NotificationBody := NotificationBody.Replace('%DateOfReturnCaption%','');
      NotificationBody := NotificationBody.Replace('%DateOfReturn%','');
      NotificationBody := NotificationBody.Replace('%EmployeeCaption%','');
      NotificationBody := NotificationBody.Replace('%Employee%','');
      NotificationBody := NotificationBody.Replace('%DepartmentCaption%','');
      NotificationBody := NotificationBody.Replace('%Department%','');
      NotificationBody := NotificationBody.Replace('%CustomerAddressCaption%','');
      NotificationBody := NotificationBody.Replace('%CustomerAddress%','');
      NotificationBody := NotificationBody.Replace('%SiteNameCaption%','');
      NotificationBody := NotificationBody.Replace('%SiteName%','');
      NotificationBody := NotificationBody.Replace('%ARNoCaption%','');
      NotificationBody := NotificationBody.Replace('%ARNo%','');
      NotificationBody := NotificationBody.Replace('%DRNoCaption%','');
      NotificationBody := NotificationBody.Replace('%DRNo%','');
      // REQUEST FOR EXCEPTION
      NotificationBody := NotificationBody.Replace('%ExceptionToCaption%','');
      NotificationBody := NotificationBody.Replace('%ExceptionTo%','');
      NotificationBody := NotificationBody.Replace('%ApprovedBudgetCaption%','');
      NotificationBody := NotificationBody.Replace('%ApprovedBudget%','');
      NotificationBody := NotificationBody.Replace('%ApprovedTimelineCaption%','');
      NotificationBody := NotificationBody.Replace('%ApprovedTimeline%','');
      NotificationBody := NotificationBody.Replace('%ProposedBudgetCaption%','');
      NotificationBody := NotificationBody.Replace('%ProposedBudget%','');
      NotificationBody := NotificationBody.Replace('%ProposedTimelineCaption%','');
      NotificationBody := NotificationBody.Replace('%ProposedTimeline%','');
      NotificationBody := NotificationBody.Replace('%WaiverTypeCaption%','');
      NotificationBody := NotificationBody.Replace('%WaiverType%','');
      NotificationBody := NotificationBody.Replace('%DescriptionOfRequestCaption%','Description of Request');
      NotificationBody := NotificationBody.Replace('%DescriptionOfRequest%','');
      NotificationBody := NotificationBody.Replace('%JustificationCaption%','Justification and Assessment of Risk');
      NotificationBody := NotificationBody.Replace('%Justification%','');
      NotificationBody := NotificationBody.Replace('%PersonInchargeCaption%','');
      NotificationBody := NotificationBody.Replace('%PersonIncharge%','');
      NotificationBody := NotificationBody.Replace('%CommitmentDateCaption%','');
      NotificationBody := NotificationBody.Replace('%CommitmentDate%','');
      NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudgetCaption%','');
      NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudget%','');
      NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimelineCaption%','');
      NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimeline%','');
      NotificationBody := NotificationBody.Replace('%AttachementsProposedBudgetCaption%','');
      NotificationBody := NotificationBody.Replace('%AttachementsProposedBudget%','');
      NotificationBody := NotificationBody.Replace('%AttachementsProposedTimelineCaption%','');
      NotificationBody := NotificationBody.Replace('%AttachementsProposedTimeline%','');
      // WORK CHANGE REQUEST
      NotificationBody := NotificationBody.Replace('%ProgramCaption%','');
      NotificationBody := NotificationBody.Replace('%Program%','');
      NotificationBody := NotificationBody.Replace('%AnnexesCaption%','');
      NotificationBody := NotificationBody.Replace('%Annexes%','');
      NotificationBody := NotificationBody.Replace('%CMSTicketCaption%','');
      NotificationBody := NotificationBody.Replace('%CMSTicket%','');
      NotificationBody := NotificationBody.Replace('%DateOfOcularInspectionCaption%','');
      NotificationBody := NotificationBody.Replace('%DateOfOcularInspection%','');
      NotificationBody := NotificationBody.Replace('%ChargeableToClientCaption%','');
      NotificationBody := NotificationBody.Replace('%ChargeableToClient%','');
      NotificationBody := NotificationBody.Replace('%AdditionalWorkCaption%','');
      NotificationBody := NotificationBody.Replace('%AdditionalWork%','');
      NotificationBody := NotificationBody.Replace('%SiteChangeCaption%','');
      NotificationBody := NotificationBody.Replace('%SiteChange%','');
      NotificationBody := NotificationBody.Replace('%TeamReassignmentCaption%','');
      NotificationBody := NotificationBody.Replace('%TeamReassignment%','');
      NotificationBody := NotificationBody.Replace('%MaterialsEquipmentCaption%','');
      NotificationBody := NotificationBody.Replace('%MaterialsEquipment%','');
      NotificationBody := NotificationBody.Replace('%NatureOfChangeOthersCaption%','');
      NotificationBody := NotificationBody.Replace('%NatureOfChangeOthers%','');
      NotificationBody := NotificationBody.Replace('%PresentSituationCaption%','');
      NotificationBody := NotificationBody.Replace('%PresentSituation%','');
      NotificationBody := NotificationBody.Replace('%RecommendedChangeCaption%','');
      NotificationBody := NotificationBody.Replace('%RecommendedChange%','');
      NotificationBody := NotificationBody.Replace('%OriginalProjectCostCaption%','');
      NotificationBody := NotificationBody.Replace('%OriginalProjectCost%','');
      NotificationBody := NotificationBody.Replace('%LateAFIAmountBeforeWCICaption%','');
      NotificationBody := NotificationBody.Replace('%LateAFIAmountBeforeWCI%','');
      NotificationBody := NotificationBody.Replace('%ThisWCRCostVariationWCRCaption%','');
      NotificationBody := NotificationBody.Replace('%ThisWCRCostVariationWCR%','');
      NotificationBody := NotificationBody.Replace('%TotalCostAfterWCRCaption%','');
      NotificationBody := NotificationBody.Replace('%TotalCostAfterWCR%','');
      NotificationBody := NotificationBody.Replace('%BalancePOAfterWCRCaption%','');
      NotificationBody := NotificationBody.Replace('%BalancePOAfterWCR%','');
      NotificationBody := NotificationBody.Replace('%CheckVoucherNoCaption%','');
      NotificationBody := NotificationBody.Replace('%CheckVoucherNo%','');
      NotificationBody := NotificationBody.Replace('%CashAdvanceNoCaption%','');
      NotificationBody := NotificationBody.Replace('%CashAdvanceNo%','');
      NotificationBody := NotificationBody.Replace('%CheckNoCaption%','');
      NotificationBody := NotificationBody.Replace('%CheckNo%','');
      NotificationBody := NotificationBody.Replace('%ReleasedDateCaption%','');
      NotificationBody := NotificationBody.Replace('%ReleasedDate%','');
      NotificationBody := NotificationBody.Replace('%AmountToBeChargeCaption%','');
      NotificationBody := NotificationBody.Replace('%AmountToBeCharge%','');
      NotificationBody := NotificationBody.Replace('%GTRepresentativeCommentCaption%','');
      NotificationBody := NotificationBody.Replace('%GTRepresentativeComment%','');
      NotificationBody := NotificationBody.Replace('%RemarksCaption%','');
      NotificationBody := NotificationBody.Replace('%Remarks%','');

      // INTERNAL NOTICE TO PROCEED
      NotificationBody := NotificationBody.Replace('%NoticeToMobilizeCaption%', '');
      NotificationBody := NotificationBody.Replace('%NoticeToMobilize%', '');
      NotificationBody := NotificationBody.Replace('%NoticeToProceedCaption%', '');
      NotificationBody := NotificationBody.Replace('%NoticeToProceed%', '');
      NotificationBody := NotificationBody.Replace('%ClusterMobilizationCaption%', '');
      NotificationBody := NotificationBody.Replace('%ClusterMobilization%', '');
      NotificationBody := NotificationBody.Replace('%SupplyOnlyCaption%', '');
      NotificationBody := NotificationBody.Replace('%SupplyOnly%', '');
      NotificationBody := NotificationBody.Replace('%PerSiteMobilizationCaption%', '');
      NotificationBody := NotificationBody.Replace('%PerSiteMobilization%', '');
      NotificationBody := NotificationBody.Replace('%DemoPOCCaption%', '');
      NotificationBody := NotificationBody.Replace('%DemoPOC%', '');
      NotificationBody := NotificationBody.Replace('%WithPOCaption%', '');
      NotificationBody := NotificationBody.Replace('%WithPO%', '');
      NotificationBody := NotificationBody.Replace('%WithOutPOCaption%', '');
      NotificationBody := NotificationBody.Replace('%WithOutPO%', '');
      NotificationBody := NotificationBody.Replace('%PONoFromCustomerCaption%', '');
      NotificationBody := NotificationBody.Replace('%PONoFromCustomer%', '');
      NotificationBody := NotificationBody.Replace('%PODateFromCustomerCaption%', '');
      NotificationBody := NotificationBody.Replace('%PODateFromCustomer%', '');
      NotificationBody := NotificationBody.Replace('%NoOfSitesCaption%', '');
      NotificationBody := NotificationBody.Replace('%NoOfSites%', '');
      NotificationBody := NotificationBody.Replace('%SiteNamesCaption%', '');
      NotificationBody := NotificationBody.Replace('%SiteNames%', '');
      NotificationBody := NotificationBody.Replace('%CustomerNameCaption%', '');
      NotificationBody := NotificationBody.Replace('%CustomerName%', '');
      NotificationBody := NotificationBody.Replace('%ProjectNameCaption%', '');
      NotificationBody := NotificationBody.Replace('%ProjectName%', '');
      NotificationBody := NotificationBody.Replace('%ReleasedDateOfPOCaption%', '');
      NotificationBody := NotificationBody.Replace('%ReleasedDateOfPO%', '');
      NotificationBody := NotificationBody.Replace('%SalesEngineerCaption%', '');
      NotificationBody := NotificationBody.Replace('%SalesEngineer%', '');
      NotificationBody := NotificationBody.Replace('%ProjectManagerCaption%', '');
      NotificationBody := NotificationBody.Replace('%ProjectManager%', '');
      NotificationBody := NotificationBody.Replace('%SalesPersonCaption%', '');
      NotificationBody := NotificationBody.Replace('%SalesPerson%', '');
      NotificationBody := NotificationBody.Replace('%CostAnalystCaption%', '');
      NotificationBody := NotificationBody.Replace('%CostAnalyst%', '');
      NotificationBody := NotificationBody.Replace('%DateOfCompleteEquipmentsReadyCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateOfCompleteEquipmentsReady%', '');
      NotificationBody := NotificationBody.Replace('%ProjectTargetCompletionDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%ProjectTargetCompletionDate%', '');
      NotificationBody := NotificationBody.Replace('%DeliveryToCustomerWarehouseCaption%', '');
      NotificationBody := NotificationBody.Replace('%DeliveryToCustomerWarehouse%', '');
      // INTP - PERSON TO NOTIFY
      NotificationBody := NotificationBody.Replace('%PersonToNotifyHumanResourceCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyHumanResource%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyAccountingCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyAccounting%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyAuditCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyAudit%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyInventoryCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyInventory%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyLogisticsCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyLogistics%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyOutsitePlantCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyOutsitePlant%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectManagementCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectManagement%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyPurchasingCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyPurchasing%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyQualityAssuranceCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyQualityAssurance%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifySalesCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifySales%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectControlCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectControl%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyTelecomAuditCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyTelecomAudit%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyWarehouseManagementCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyWarehouseManagement%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceAPCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceAP%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceARCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceAR%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyDeviceManagementCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyDeviceManagement%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyICTCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyICT%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyPowerCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyPower%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWiredCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWired%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWirelessCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWireless%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess1Caption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess1%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess2Caption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess2%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyOtheresCaption%', '');
      NotificationBody := NotificationBody.Replace('%PersonToNotifyOtheres%', '');
      // INTP ENGINEERING ACTIVITIES
      NotificationBody := NotificationBody.Replace('%EngActSiteAcquisitionCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActSiteAcquisition%', '');
      NotificationBody := NotificationBody.Replace('%EngActSiteSurveyCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActSiteSurvey%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedMOACaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedMOA%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedRAAWACaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedRAAWA%', '');
      NotificationBody := NotificationBody.Replace('%EngActFloorPlansFromCustomerCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActFloorPlansFromCustomer%', '');
      NotificationBody := NotificationBody.Replace('%EngActContactedStructuredCablingSubconCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActContactedStructuredCablingSubcon%', '');
      NotificationBody := NotificationBody.Replace('%EngActInstallationCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActInstallation%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedBOQCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedBOQ%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedHDLAndTSSRDesignCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedHDLAndTSSRDesign%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedWorkPermitRAAWACaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActApprovedWorkPermitRAAWA%', '');
      NotificationBody := NotificationBody.Replace('%EngActSignedNoticeToInstallCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActSignedNoticeToInstall%', '');
      NotificationBody := NotificationBody.Replace('%EngActTroubleshootingCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActTroubleshooting%', '');
      NotificationBody := NotificationBody.Replace('%EngActMaintenanceCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActMaintenance%', '');
      NotificationBody := NotificationBody.Replace('%EngActQualityAuditTrialPOCCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActQualityAuditTrialPOC%', '');
      NotificationBody := NotificationBody.Replace('%EngActBuildingClearanceCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActBuildingClearance%', '');
      NotificationBody := NotificationBody.Replace('%EngActCommissioningCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActCommissioning%', '');
      NotificationBody := NotificationBody.Replace('%EngActDeliveryToCustomerWarehouseCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActDeliveryToCustomerWarehouse%', '');
      NotificationBody := NotificationBody.Replace('%EngActFinalAcceptanceCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActFinalAcceptance%', '');
      NotificationBody := NotificationBody.Replace('%EngActPreliminaryAcceptanceCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActPreliminaryAcceptance%', '');
      NotificationBody := NotificationBody.Replace('%EngActTestingCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActTesting%', '');
      NotificationBody := NotificationBody.Replace('%EngActRectificationCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActRectification%', '');
      NotificationBody := NotificationBody.Replace('%EngActShipmentAirFreightCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActShipmentAirFreight%', '');
      NotificationBody := NotificationBody.Replace('%EngActShipmentSeeFreightCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActShipmentSeeFreight%', '');
      NotificationBody := NotificationBody.Replace('%EngActQOthersPleaseSpecifyCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActQOthersPleaseSpecify%', '');
      NotificationBody := NotificationBody.Replace('%EngActQOthersRemarksCaption%', '');
      NotificationBody := NotificationBody.Replace('%EngActQOthersRemarks%', '');
      // INTP - ATTACHMENTS
      NotificationBody := NotificationBody.Replace('%AttachementNoticeToProceedCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementNoticeToProceed%', '');
      NotificationBody := NotificationBody.Replace('%AttachementTP_CTFCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementTP_CTF%', '');
      NotificationBody := NotificationBody.Replace('%AttachementSignedTrialCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementSignedTrial%', '');
      NotificationBody := NotificationBody.Replace('%AttachementPOFromCustomerCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementPOFromCustomer%', '');
      NotificationBody := NotificationBody.Replace('%AttachementPOToVendorCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementPOToVendor%', '');
      NotificationBody := NotificationBody.Replace('%AttachementExceptionReportCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementExceptionReport%', '');
      NotificationBody := NotificationBody.Replace('%AttachementExceptionReportNoCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementExceptionReportNo%', '');
      NotificationBody := NotificationBody.Replace('%AttachementBillOfMaterialsCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementBillOfMaterials%', '');
      NotificationBody := NotificationBody.Replace('%AttachementAllocatedBudgetCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementAllocatedBudget%', '');
      NotificationBody := NotificationBody.Replace('%AttachementOthersPleaseSpecifyCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementOthersPleaseSpecify%', '');
      NotificationBody := NotificationBody.Replace('%AttachementOtherRemarksCaption%', '');
      NotificationBody := NotificationBody.Replace('%AttachementOtherRemarks%', '');
      // INTP - WARRANTY
      NotificationBody := NotificationBody.Replace('%WithinWarrantyCaption%', '');
      NotificationBody := NotificationBody.Replace('%WithinWarranty%', '');
      NotificationBody := NotificationBody.Replace('%WithMaintenanceServiceCaption%', '');
      NotificationBody := NotificationBody.Replace('%WithMaintenanceService%', '');
      NotificationBody := NotificationBody.Replace('%ExpiredWarrantyCaption%', '');
      NotificationBody := NotificationBody.Replace('%ExpiredWarranty%', '');
      NotificationBody := NotificationBody.Replace('%RemarksCaption%', '');
      NotificationBody := NotificationBody.Replace('%Remarks%', '');

      //TICKET
      NotificationBody := NotificationBody.Replace('%TicketNoCaption%', '');
      NotificationBody := NotificationBody.Replace('%TicketNo%', '');
      NotificationBody := NotificationBody.Replace('%TypeCaption%', '');
      NotificationBody := NotificationBody.Replace('%Type%', '');
      NotificationBody := NotificationBody.Replace('%DescriptionCaption%', '');
      NotificationBody := NotificationBody.Replace('%Description%', '');
      NotificationBody := NotificationBody.Replace('%DateReleasedCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateReleased%', '');
      NotificationBody := NotificationBody.Replace('%TimeReleasedCaption%', '');
      NotificationBody := NotificationBody.Replace('%TimeReleased%', '');
      NotificationBody := NotificationBody.Replace('%StatusCaption%', '');
      NotificationBody := NotificationBody.Replace('%Status%', '');
      NotificationBody := NotificationBody.Replace('%DateHandledCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateHandled%', '');
      NotificationBody := NotificationBody.Replace('%TimeHandledCaption%', '');
      NotificationBody := NotificationBody.Replace('%TimeHandled%', '');
      NotificationBody := NotificationBody.Replace('%HandlerUserIDCaption%', '');
      NotificationBody := NotificationBody.Replace('%HandlerUserID%', '');
      NotificationBody := NotificationBody.Replace('%PriorityLevelCaption%', '');
      NotificationBody := NotificationBody.Replace('%PriorityLevel%', '');
      NotificationBody := NotificationBody.Replace('%PageName%', '');
      NotificationBody := NotificationBody.Replace('%PageName%', '');
      NotificationBody := NotificationBody.Replace('%StartingDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%StartingDate%', '');
      NotificationBody := NotificationBody.Replace('%StartingTimeCaption%', '');
      NotificationBody := NotificationBody.Replace('%StartingTime%', '');
      NotificationBody := NotificationBody.Replace('%FinishingDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%FinishingDate%', '');
      NotificationBody := NotificationBody.Replace('%FormatedFinishingDate%', '');
      NotificationBody := NotificationBody.Replace('%FinishingTimeCaption%', '');
      NotificationBody := NotificationBody.Replace('%FinishingTime%', '');
      NotificationBody := NotificationBody.Replace('%ResponseDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%ResponseDate%', '');
      NotificationBody := NotificationBody.Replace('%ResponseTimeCaption%', '');
      NotificationBody := NotificationBody.Replace('%ResponseTime%', '');
      NotificationBody := NotificationBody.Replace('%DateCreatedCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateCreated%', '');
      NotificationBody := NotificationBody.Replace('%TimeCreatedCaption%', '');
      NotificationBody := NotificationBody.Replace('%TimeCreated%', '');
      NotificationBody := NotificationBody.Replace('%CreatedByUserIDCaption%', '');
      NotificationBody := NotificationBody.Replace('%CreatedByUserID%', '');
      NotificationBody := NotificationBody.Replace('%ReasonForClosingCaption%', '');
      NotificationBody := NotificationBody.Replace('%ReasonForClosing%', '');
      NotificationBody := NotificationBody.Replace('%RecipientsCaption%', '');
      NotificationBody := NotificationBody.Replace('%Recipients%', '');
      NotificationBody := NotificationBody.Replace('%AdditionalInformationCaption%', '');
      NotificationBody := NotificationBody.Replace('%AdditionalInformation%', '');
      NotificationBody := NotificationBody.Replace('%ErrorCodeCaption%', '');
      NotificationBody := NotificationBody.Replace('%ErrorCode%', '');
      NotificationBody := NotificationBody.Replace('%ErrorTextCaption%', '');
      NotificationBody := NotificationBody.Replace('%ErrorText%', '');
      NotificationBody := NotificationBody.Replace('%UserFromCaption%', '');
      NotificationBody := NotificationBody.Replace('%UserFrom%', '');
      NotificationBody := NotificationBody.Replace('%UserToCaption%', '');
      NotificationBody := NotificationBody.Replace('%UserTo%', '');
      NotificationBody := NotificationBody.Replace('%TicketLinks%', '');
      NotificationBody := NotificationBody.Replace('%TicketNotes%', '');

      //SDR
      NotificationBody := NotificationBody.Replace('%SDRNoCaption%', '');
      NotificationBody := NotificationBody.Replace('%SDRNo%', '');
      NotificationBody := NotificationBody.Replace('%ServiceRequestCaption%', '');
      NotificationBody := NotificationBody.Replace('%ServiceRequest%', '');
      NotificationBody := NotificationBody.Replace('%ApplicationNameCaption%', '');
      NotificationBody := NotificationBody.Replace('%ApplicationName%', '');
      NotificationBody := NotificationBody.Replace('%DescriptionCaption%', '');
      NotificationBody := NotificationBody.Replace('%Description%', '');
      NotificationBody := NotificationBody.Replace('%DateCreatedCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateCreated%', '');
      NotificationBody := NotificationBody.Replace('%TimeCreatedCaption%', '');
      NotificationBody := NotificationBody.Replace('%TimeCreated%', '');
      NotificationBody := NotificationBody.Replace('%CreatedByUserIDCaption%', '');
      NotificationBody := NotificationBody.Replace('%CreatedByUserID%', '');
      NotificationBody := NotificationBody.Replace('%SizeofRequirementCaption%', '');
      NotificationBody := NotificationBody.Replace('%SizeofRequirement%', '');
      NotificationBody := NotificationBody.Replace('%RequestorUserIDCaption%', '');
      NotificationBody := NotificationBody.Replace('%RequestorUserID%', '');
      NotificationBody := NotificationBody.Replace('%StartingDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%StartingDate%', '');
      NotificationBody := NotificationBody.Replace('%StartingTimeCaption%', '');
      NotificationBody := NotificationBody.Replace('%StartingTime%', '');
      NotificationBody := NotificationBody.Replace('%FinishingDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%FinishingDate%', '');
      NotificationBody := NotificationBody.Replace('%FormatedFinishingDate%', '');
      NotificationBody := NotificationBody.Replace('%FinishingTimeCaption%', '');
      NotificationBody := NotificationBody.Replace('%FinishingTime%', '');
      NotificationBody := NotificationBody.Replace('%AdditionalInformationCaption%', '');
      NotificationBody := NotificationBody.Replace('%AdditionalInformation%', '');
      NotificationBody := NotificationBody.Replace('%StatusCaption%', '');
      NotificationBody := NotificationBody.Replace('%Status%', '');
      NotificationBody := NotificationBody.Replace('%DurationCaption%', '');
      NotificationBody := NotificationBody.Replace('%Duration%', '');
      NotificationBody := NotificationBody.Replace('%DateResolvedCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateResolved%', '');
      NotificationBody := NotificationBody.Replace('%TimeResolvedCaption%', '');
      NotificationBody := NotificationBody.Replace('%TimeResolved%', '');
      NotificationBody := NotificationBody.Replace('%ResolvedDurationCaption%', '');
      NotificationBody := NotificationBody.Replace('%ResolvedDuration%', '');
      NotificationBody := NotificationBody.Replace('%ResponseDateCaption%', '');
      NotificationBody := NotificationBody.Replace('%ResponseDate%', '');
      NotificationBody := NotificationBody.Replace('%ResponseTimeCaption%', '');
      NotificationBody := NotificationBody.Replace('%ResponseTime%', '');
      NotificationBody := NotificationBody.Replace('%DateReleasedCaption%', '');
      NotificationBody := NotificationBody.Replace('%DateReleased%', '');
      NotificationBody := NotificationBody.Replace('%TimeReleasedCaption%', '');
      NotificationBody := NotificationBody.Replace('%TimeReleased%', '');
      NotificationBody := NotificationBody.Replace('%UserGroupCodeCaption%', '');
      NotificationBody := NotificationBody.Replace('%UserGroupCode%', '');
      NotificationBody := NotificationBody.Replace('%UserGroupCaption%', '');
      NotificationBody := NotificationBody.Replace('%UserGroup%', '');
      NotificationBody := NotificationBody.Replace('%HandlerUserIDCaption%', '');
      NotificationBody := NotificationBody.Replace('%HandlerUserID%', '');
      NotificationBody := NotificationBody.Replace('%PriorityLevelCaption%', '');
      NotificationBody := NotificationBody.Replace('%PriorityLevel%', '');
      NotificationBody := NotificationBody.Replace('%HandlerRemarksCaption%', '');
      NotificationBody := NotificationBody.Replace('%HandlerRemarks%', '');
      NotificationBody := NotificationBody.Replace('%TitlePositionCaption%', '');
      NotificationBody := NotificationBody.Replace('%TitlePosition%', '');
      NotificationBody := NotificationBody.Replace('%HandlerTitlePositionCaption%', '');
      NotificationBody := NotificationBody.Replace('%HandlerTitlePosition%', '');
      NotificationBody := NotificationBody.Replace('%TicketNoCaption%', '');
      NotificationBody := NotificationBody.Replace('%TicketNo%', '');
      NotificationBody := NotificationBody.Replace('%SDRLinks%', '');
      NotificationBody := NotificationBody.Replace('%SDRNotes%', '');

      //INTP - CPC
      NotificationBody := NotificationBody.Replace('%CPCHumanResource%','');
      NotificationBody := NotificationBody.Replace('%CPCAccounting%','');
      NotificationBody := NotificationBody.Replace('%CPCQualityAssurance%','');
      NotificationBody := NotificationBody.Replace('%CPCDeviceManagement%','');
      NotificationBody := NotificationBody.Replace('%CPCAuditDepartment%','');
      NotificationBody := NotificationBody.Replace('%CPCSales%','');
      NotificationBody := NotificationBody.Replace('%CPCInfoCommSystem%','');
      NotificationBody := NotificationBody.Replace('%CPCInventory%','');
      NotificationBody := NotificationBody.Replace('%CPCProjectControl%','');
      NotificationBody := NotificationBody.Replace('%CPCPowerSystem%','');
      NotificationBody := NotificationBody.Replace('%CPCLogistics%','');
      NotificationBody := NotificationBody.Replace('%CPCTelecomAudit%','');
      NotificationBody := NotificationBody.Replace('%CPCTransmissionWired%','');
      NotificationBody := NotificationBody.Replace('%CPCOutsidePlantOSP%','');
      NotificationBody := NotificationBody.Replace('%CPCWarehouseManagementUnit%','');
      NotificationBody := NotificationBody.Replace('%CPCTransmissionWireless%','');
      NotificationBody := NotificationBody.Replace('%CPCProjectManagement%','');
      NotificationBody := NotificationBody.Replace('%CPCFinanceAP%','');
      NotificationBody := NotificationBody.Replace('%CPCWirelessAccess1%','');
      NotificationBody := NotificationBody.Replace('%CPCPurchasing%','');
      NotificationBody := NotificationBody.Replace('%CPCFinanceAR%','');
      NotificationBody := NotificationBody.Replace('%CPCWirelessAccess2%','');
      NotificationBody := NotificationBody.Replace('%CPCDocumentationTeam%','');
      NotificationBody := NotificationBody.Replace('%CPCPassiveUnit%','');
    END;

    LOCAL PROCEDURE ReplaceTokenWithPurchaseHeaderDetails@25(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";PurchaseHeader@1000 : Record 38);
    VAR
      SalesLine@1007 : Record 37;
      INTP@1002 : Record 50040;
      Employee@1003 : Record 5200;
      Vendor@1018 : Record 23;
      Customer@1004 : Record 18;
      Resource@1005 : Record 156;
      PaymentTerms@1019 : Record 3;
      PaymentMethod@1020 : Record 289;
      UserGroup@1006 : Record 9000;
      Contact@1021 : Record 5050;
      SalesPerson@1022 : Record 13;
      ShippingMethod@1023 : Record 10;
      TransactionType@1028 : Record 258;
      TransactionSpec@1027 : Record 285;
      TransportMethod@1026 : Record 259;
      EntryExitPoint@1025 : Record 282;
      ChangeLog@1030 : Record 405;
      Purchaser@1029 : Record 13;
      DescriptionOfRequest@1008 : Text;
      Justification@1009 : Text;
      SiteChange@1010 : Text;
      TeamReassignment@1011 : Text;
      MaterialEquipment@1012 : Text;
      NatureOfChangeOthers@1013 : Text;
      PresentSituation@1014 : Text;
      RecommendedChange@1015 : Text;
      RemarksLoc@1016 : Text;
      GTComments@1017 : Text;
      TermsAndCondition@1024 : Text;
      ShipingInstruction@1031 : Text;
    BEGIN
      WITH PurchaseHeader DO BEGIN
        NotificationBody := NotificationBody.Replace('%Details%','');
        ReplaceTokenWithLinkedINTPDetails(NotificationBody, PurchaseHeader."INTP No.");
        IF PurchaseHeader."Request Type" <> PurchaseHeader."Request Type"::" " THEN
          NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO('%1',"Request Type"))
        ELSE
          NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO(PurchDocTypeTxt, FORMAT("Document Type")));

        NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT("No."));
        NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%', Vendor.TABLECAPTION);
        NotificationBody := NotificationBody.Replace('%CustomerVendorNo%',"Pay-to Vendor No.");
        NotificationBody := NotificationBody.Replace('%CustomerVendorName%',StringConversionManagement.WindowsToASCII("Pay-to Name" + ' ' + "Pay-to Name 2"));
        // Cash Advance
        NotificationBody := NotificationBody.Replace('%JobTypeCaption%',FIELDCAPTION("Job Type"));
        NotificationBody := NotificationBody.Replace('%JobType%',FORMAT("Job Type"));
        NotificationBody := NotificationBody.Replace('%JobOrderNoCaption%',FIELDCAPTION("Job Order No."));
        NotificationBody := NotificationBody.Replace('%JobOrderNo%',"Job Order No.");
        NotificationBody := NotificationBody.Replace('%DateOfActivityFromCaption%', FIELDCAPTION("Date of Activity From"));
        NotificationBody := NotificationBody.Replace('%DateOfActivityFrom%', FORMAT("Date of Activity From"));
        NotificationBody := NotificationBody.Replace('%DateOfActivityToCaption%',FIELDCAPTION("Date of Activity To"));
        NotificationBody := NotificationBody.Replace('%DateOfActivityTo%', FORMAT("Date of Activity To"));
        NotificationBody := NotificationBody.Replace('%CanvassSheetNoCaption%',FIELDCAPTION("Canvass Sheet No."));
        NotificationBody := NotificationBody.Replace('%CanvassSheetNo%',StringConversionManagement.WindowsToASCII("Canvass Sheet No."));
        NotificationBody := NotificationBody.Replace('%AWLCaption%',FIELDCAPTION("AWL/BL No."));
        NotificationBody := NotificationBody.Replace('%AWL%',StringConversionManagement.WindowsToASCII("AWL/BL No."));
        NotificationBody := NotificationBody.Replace('%PurposeCaption%',FIELDCAPTION(Purpose));
        NotificationBody := NotificationBody.Replace('%Purpose%',StringConversionManagement.WindowsToASCII(Purpose));
        CALCFIELDS(Amount);
        NotificationBody := NotificationBody.Replace('%AmountCaption%',FIELDCAPTION(Amount));
        NotificationBody := NotificationBody.Replace('%Amount%',FORMAT(Amount));
        NotificationBody := NotificationBody.Replace('%CurrencyCode%',"Currency Code");

        // Request for Payment
        NotificationBody := NotificationBody.Replace('%CanvassSheetNoCaption%',FIELDCAPTION("Canvass Sheet No."));
        NotificationBody := NotificationBody.Replace('%CanvassSheetNo%',StringConversionManagement.WindowsToASCII("Canvass Sheet No."));
        NotificationBody := NotificationBody.Replace('%YourReferenceCaption%',FIELDCAPTION("Your Reference"));
        NotificationBody := NotificationBody.Replace('%YourReference%',StringConversionManagement.WindowsToASCII("Your Reference"));
        NotificationBody := NotificationBody.Replace('%PaymentTermsCodeCaption%',FIELDCAPTION("Payment Terms Code"));
        IF PaymentTerms.GET("Payment Terms Code") THEN
          NotificationBody := NotificationBody.Replace('%PaymentTermsCode%',StringConversionManagement.WindowsToASCII("Payment Terms Code" + ': ' + PaymentTerms.Description))
        ELSE
        NotificationBody := NotificationBody.Replace('%PaymentTermsCode%','');

        NotificationBody := NotificationBody.Replace('%PaymentMethodCodeCaption%',FIELDCAPTION("Payment Method Code"));
        IF PaymentMethod.GET("Payment Method Code") THEN
          NotificationBody := NotificationBody.Replace('%PaymentMethodCode%',StringConversionManagement.WindowsToASCII("Payment Method Code" + ' ' + PaymentMethod.Description))
        ELSE
          NotificationBody := NotificationBody.Replace('%PaymentMethodCode%','');

        // Purchaser Order
        NotificationBody := NotificationBody.Replace('%VendorTypeCaption%', FIELDCAPTION("Vendor Type"));
        NotificationBody := NotificationBody.Replace('%VendorType%', FORMAT("Vendor Type"));
        NotificationBody := NotificationBody.Replace('%BuyFromVendorNameCaption%', FIELDCAPTION("Buy-from Vendor Name"));
        NotificationBody := NotificationBody.Replace('%BuyFromVendorName%', StringConversionManagement.WindowsToASCII("Buy-from Vendor Name" + ' ' + "Buy-from Vendor Name 2"));
        NotificationBody := NotificationBody.Replace('%BuyFromAddressCaption%', FIELDCAPTION("Buy-from Address"));
        NotificationBody := NotificationBody.Replace('%BuyFromAddress%', StringConversionManagement.WindowsToASCII("Buy-from Address" + ' ' + "Buy-from Address 2"));
        NotificationBody := NotificationBody.Replace('%BuyFromContactNameCaption%', 'Buy-from Contact Name');
        IF Contact.GET("Buy-from Contact No.") THEN
          NotificationBody := NotificationBody.Replace('%BuyFromContactName%', StringConversionManagement.WindowsToASCII("Buy-from Contact No." + ' ' + Contact.Name))
        ELSE
          NotificationBody := NotificationBody.Replace('%BuyFromContactName%', '');
        NotificationBody := NotificationBody.Replace('%BeneficiaryCaption%', 'Beneficiary');
        NotificationBody := NotificationBody.Replace('%Beneficiary%', StringConversionManagement.WindowsToASCII("Pay-to Name" + ' ' + "Pay-to Name 2"));
        NotificationBody := NotificationBody.Replace('%NoOfArchvdVrsnCaption%', FIELDCAPTION("No. of Archived Versions"));
        NotificationBody := NotificationBody.Replace('%NoOfArchvdVrsn%', FORMAT("No. of Archived Versions"));
        NotificationBody := NotificationBody.Replace('%PostingDateCaption%', FIELDCAPTION("Posting Date"));
        NotificationBody := NotificationBody.Replace('%PostingDate%', FORMAT("Posting Date"));
        NotificationBody := NotificationBody.Replace('%OrderDateCaption%', FIELDCAPTION("Order Date"));
        NotificationBody := NotificationBody.Replace('%OrderDate%', FORMAT("Order Date"));
        NotificationBody := NotificationBody.Replace('%DocumentDateCaption%', FIELDCAPTION("Document Date"));
        NotificationBody := NotificationBody.Replace('%DocumentDate%', FORMAT("Document Date"));
        NotificationBody := NotificationBody.Replace('%QuoteNoCaption%', FIELDCAPTION("Quote No."));
        NotificationBody := NotificationBody.Replace('%QuoteNo%', StringConversionManagement.WindowsToASCII("Quote No."));
        NotificationBody := NotificationBody.Replace('%VendorOrderNoCaption%', FIELDCAPTION("Vendor Order No."));
        NotificationBody := NotificationBody.Replace('%VendorOrderNo%', StringConversionManagement.WindowsToASCII("Vendor Order No."));
        NotificationBody := NotificationBody.Replace('%VendorShipmentNoCaption%', FIELDCAPTION("Vendor Shipment No."));
        NotificationBody := NotificationBody.Replace('%VendorShipmentNo%', StringConversionManagement.WindowsToASCII("Vendor Shipment No."));
        NotificationBody := NotificationBody.Replace('%VendorInvoiceNoCaption%', FIELDCAPTION("Vendor Invoice No."));
        NotificationBody := NotificationBody.Replace('%VendorInvoiceNo%', StringConversionManagement.WindowsToASCII("Vendor Invoice No."));
        NotificationBody := NotificationBody.Replace('%PurchaserNameCaption%', 'Purchaser Name');
        IF SalesPerson.GET("Purchaser Code") THEN
          NotificationBody := NotificationBody.Replace('%PurchaserName%', StringConversionManagement.WindowsToASCII("Purchaser Code" + ' ' + SalesPerson.Name))
        ELSE
          NotificationBody := NotificationBody.Replace('%PurchaserName%', '');
      //  NotificationBody := NotificationBody.Replace('%JobDescriptionCaption%', 'Job Description');
      //  IF INTP.GET("INTP No.") THEN
      //    NotificationBody := NotificationBody.Replace('%JobDescription%', STRSUBSTNO("INTP No." + ' ' + INTP."Project Name" + ' ' + INTP."Project Name 2"))
      //  ELSE
      //    NotificationBody := NotificationBody.Replace('%JobDescription%', '');
        NotificationBody := NotificationBody.Replace('%RefRFPNoCaption%', FIELDCAPTION("Reference RFP No."));
        NotificationBody := NotificationBody.Replace('%RefRFPNo%', StringConversionManagement.WindowsToASCII("Reference RFP No."));
        NotificationBody := NotificationBody.Replace('%StatusCaption%', FIELDCAPTION(Status));
        NotificationBody := NotificationBody.Replace('%Status%', FORMAT(Status));
        NotificationBody := NotificationBody.Replace('%PayToNameCaption%', FIELDCAPTION("Pay-to Name"));
        NotificationBody := NotificationBody.Replace('%PayToName%', StringConversionManagement.WindowsToASCII("Pay-to Vendor No." + ' ' + "Pay-to Name" + ' ' + "Pay-to Name 2"));
        NotificationBody := NotificationBody.Replace('%PayToAddressCaption%', FIELDCAPTION("Pay-to Address"));
        NotificationBody := NotificationBody.Replace('%PayToAddress%', StringConversionManagement.WindowsToASCII("Pay-to Address" + ' ' + "Pay-to Address 2"));
        NotificationBody := NotificationBody.Replace('%DueDateCaption%', FIELDCAPTION("Due Date"));
        NotificationBody := NotificationBody.Replace('%DueDate%', FORMAT("Due Date"));
        NotificationBody := NotificationBody.Replace('%PaymentDiscountCaption%', FIELDCAPTION("Payment Discount %"));
        NotificationBody := NotificationBody.Replace('%PaymentDiscount%', FORMAT("Payment Discount %"));
        NotificationBody := NotificationBody.Replace('%PaymentReferenceCaption%', FIELDCAPTION("Payment Reference"));
        NotificationBody := NotificationBody.Replace('%PaymentReference%', StringConversionManagement.WindowsToASCII("Payment Reference"));
        NotificationBody := NotificationBody.Replace('%CreditorNoCaption%', FIELDCAPTION("Creditor No."));
        NotificationBody := NotificationBody.Replace('%CreditorNo%', StringConversionManagement.WindowsToASCII("Creditor No."));
        NotificationBody := NotificationBody.Replace('%OnHoldCaption%', FIELDCAPTION("On Hold"));
        NotificationBody := NotificationBody.Replace('%OnHold%', StringConversionManagement.WindowsToASCII("On Hold"));
        NotificationBody := NotificationBody.Replace('%PricesInclVATCaption%', FIELDCAPTION("Prices Including VAT"));
        NotificationBody := NotificationBody.Replace('%PricesInclVAT%', FORMAT("Prices Including VAT"));
        NotificationBody := NotificationBody.Replace('%ShipToNameCaption%', FIELDCAPTION("Ship-to Name"));
        NotificationBody := NotificationBody.Replace('%ShipToName%', StringConversionManagement.WindowsToASCII("Ship-to Name" + ' ' + "Ship-to Name 2"));
        NotificationBody := NotificationBody.Replace('%ShipToAddressCaption%', FIELDCAPTION("Ship-to Address"));
        NotificationBody := NotificationBody.Replace('%ShipToAddress%', StringConversionManagement.WindowsToASCII("Ship-to Address" + ' ' + "Ship-to Address 2"));
        NotificationBody := NotificationBody.Replace('%ShipToContactCaption%', FIELDCAPTION("Ship-to Contact"));
        NotificationBody := NotificationBody.Replace('%ShipToContact%', StringConversionManagement.WindowsToASCII("Ship-to Contact"));
        NotificationBody := NotificationBody.Replace('%ShipToEmailCaption%', FIELDCAPTION("Ship-to Email Address"));
        NotificationBody := NotificationBody.Replace('%ShipToEmail%', StringConversionManagement.WindowsToASCII("Ship-to Email Address"));
        NotificationBody := NotificationBody.Replace('%ShippingMethodCaption%', FIELDCAPTION("Shipment Method"));
        IF ShippingMethod.GET("Shipment Method Code") THEN
          NotificationBody := NotificationBody.Replace('%ShippingMethod%', StringConversionManagement.WindowsToASCII(ShippingMethod.Code + ' - ' + "Shipment Method"))
        ELSE
          NotificationBody := NotificationBody.Replace('%ShippingMethod%', '');
        NotificationBody := NotificationBody.Replace('%LeadTimeCalculationCaption%', FIELDCAPTION("Lead Time Calculation"));
        NotificationBody := NotificationBody.Replace('%LeadTimeCalculation%', FORMAT("Lead Time Calculation"));
        NotificationBody := NotificationBody.Replace('%RequestedRcptDateCaption%', FIELDCAPTION("Requested Receipt Date"));
        NotificationBody := NotificationBody.Replace('%RequestedRcptDate%', FORMAT("Requested Receipt Date"));
        NotificationBody := NotificationBody.Replace('%PromisedRcptDateCaption%', FIELDCAPTION("Promised Receipt Date"));
        NotificationBody := NotificationBody.Replace('%PromisedRcptDate%', FORMAT("Promised Receipt Date"));
        NotificationBody := NotificationBody.Replace('%ExpectedRcptDateCaption%', FIELDCAPTION("Expected Receipt Date"));
        NotificationBody := NotificationBody.Replace('%ExpectedRcptDate%', FORMAT("Expected Receipt Date"));
        NotificationBody := NotificationBody.Replace('%SellToCustomerNameCaption%', 'Sell-to Customer Name');
        IF Customer.GET("Sell-to Customer No.") THEN
          NotificationBody := NotificationBody.Replace('%SellToCustomerName%', StringConversionManagement.WindowsToASCII(Customer.Name + ' ' + Customer."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%SellToCustomerName%', '');
        NotificationBody := NotificationBody.Replace('%CurrencyCaption%', 'Currency');
        NotificationBody := NotificationBody.Replace('%Currency%', "Currency Code");
        NotificationBody := NotificationBody.Replace('%TransactionTypeCaption%', FIELDCAPTION("Transaction Type"));
        IF TransactionType.GET("Transaction Type") THEN
          NotificationBody := NotificationBody.Replace('%TransactionType%', StringConversionManagement.WindowsToASCII("Transaction Type" + ' ' + TransactionType.Description))
        ELSE
          NotificationBody := NotificationBody.Replace('%TransactionType%', '');
        NotificationBody := NotificationBody.Replace('%TransactionSpecCaption%', FIELDCAPTION("Transaction Specification"));
        IF TransactionSpec.GET("Transaction Specification") THEN
          NotificationBody := NotificationBody.Replace('%TransactionSpec%', StringConversionManagement.WindowsToASCII("Transaction Specification" + ' ' + TransactionSpec.Text))
        ELSE
          NotificationBody := NotificationBody.Replace('%TransactionSpec%', '');
        NotificationBody := NotificationBody.Replace('%TransportMethodCaption%', FIELDCAPTION("Transport Method"));
        IF TransportMethod.GET("Transport Method") THEN
          NotificationBody := NotificationBody.Replace('%TransportMethod%', StringConversionManagement.WindowsToASCII(TransportMethod.Description))
        ELSE
          NotificationBody := NotificationBody.Replace('%TransportMethod%', '');
        NotificationBody := NotificationBody.Replace('%EntryPointCaption%', FIELDCAPTION("Entry Point"));
        IF EntryExitPoint.GET("Entry Point") THEN
          NotificationBody := NotificationBody.Replace('%EntryPoint%', StringConversionManagement.WindowsToASCII(("Entry Point" + ' ' + EntryExitPoint.Description)))
        ELSE
          NotificationBody := NotificationBody.Replace('%EntryPoint%', '');
        NotificationBody := NotificationBody.Replace('%AreaCaption%', FIELDCAPTION(Area));
        IF EntryExitPoint.GET("Entry Point") THEN
          NotificationBody := NotificationBody.Replace('%Area%', StringConversionManagement.WindowsToASCII("Entry Point" + ' ' + EntryExitPoint.Description))
        ELSE
          NotificationBody := NotificationBody.Replace('%Area%', '');
        NotificationBody := NotificationBody.Replace('%PrepaymentCaption%', FIELDCAPTION("Prepayment %"));
        NotificationBody := NotificationBody.Replace('%Prepayment%', FORMAT("Prepayment %"));
        NotificationBody := NotificationBody.Replace('%CompressPrepaymentCaption%', FIELDCAPTION("Compress Prepayment"));
        NotificationBody := NotificationBody.Replace('%CompressPrepayment%', FORMAT("Compress Prepayment"));
        NotificationBody := NotificationBody.Replace('%PrepmtPaymentTermsCodeCaption%', 'Prepmt. Payment Terms');
        IF PaymentTerms.GET("Prepmt. Payment Terms Code") THEN
          NotificationBody := NotificationBody.Replace('%PrepmtPaymentTermsCode%', StringConversionManagement.WindowsToASCII("Prepmt. Payment Terms Code" + ' ' + PaymentTerms.Description))
        ELSE
          NotificationBody := NotificationBody.Replace('%PrepmtPaymentTermsCode%', '');
        NotificationBody := NotificationBody.Replace('%PrepaymentDueDateCaption%', FIELDCAPTION("Prepayment Due Date"));
        NotificationBody := NotificationBody.Replace('%PrepaymentDueDate%', FORMAT("Prepayment Due Date"));
        NotificationBody := NotificationBody.Replace('%PrepmtPaymentDiscountCaption%', FIELDCAPTION("Prepmt. Payment Discount %"));
        NotificationBody := NotificationBody.Replace('%PrepmtPaymentDiscount%', FORMAT("Prepmt. Payment Discount %"));
        NotificationBody := NotificationBody.Replace('%PrepmtPmtDiscDateCaption%', FIELDCAPTION("Prepmt. Pmt. Discount Date"));
        NotificationBody := NotificationBody.Replace('%PrepmtPmtDiscDate%', FORMAT("Prepmt. Pmt. Discount Date"));
        NotificationBody := NotificationBody.Replace('%VendorCrMemoNoCaption%', FIELDCAPTION("Vendor Cr. Memo No."));
        NotificationBody := NotificationBody.Replace('%VendorCrMemoNo%', FORMAT("Vendor Cr. Memo No."));
        NotificationBody := NotificationBody.Replace('%WarrantyCaption%', FIELDCAPTION(Warranty));
        NotificationBody := NotificationBody.Replace('%Warranty%', StringConversionManagement.WindowsToASCII(Warranty));
        NotificationBody := NotificationBody.Replace('%SpecialInstructionCaption%', FIELDCAPTION("Special Instruction"));
        NotificationBody := NotificationBody.Replace('%SpecialInstruction%', StringConversionManagement.WindowsToASCII("Special Instruction"));

        // Start Terms and Condition
        NotificationBody := NotificationBody.Replace('%TermsAndConditionCaption%', FIELDCAPTION("Terms and Condition"));
        CALCFIELDS("Terms and Condition");
        IF "Terms and Condition".HASVALUE THEN BEGIN
          CLEAR(TermsAndCondition);
          "Terms and Condition".CREATEINSTREAM(InStr);
          InStr.READ(TermsAndCondition);
          NotificationBody := NotificationBody.Replace('%TermsAndCondition%', StringConversionManagement.WindowsToASCII(TermsAndCondition));
        END ELSE
          NotificationBody := NotificationBody.Replace('%TermsAndCondition%', '');

        // Start of Shipping Instruction
        NotificationBody := NotificationBody.Replace('%ShippingInstructionCaption%', FIELDCAPTION("Shipping Instruction"));
        CALCFIELDS("Shipping Instruction");
        IF "Shipping Instruction".HASVALUE THEN BEGIN
          CLEAR(ShipingInstruction);
          "Shipping Instruction".CREATEINSTREAM(InStr);
          InStr.READ(ShipingInstruction);
          NotificationBody := NotificationBody.Replace('%ShippingInstruction%', StringConversionManagement.WindowsToASCII(ShipingInstruction));
        END ELSE
          NotificationBody := NotificationBody.Replace('%ShippingInstruction%', '');

        NotificationBody := NotificationBody.Replace('%ProjectManagerCaption%', 'Project Manager');
        IF Resource.GET("Project Manager No.") THEN
          NotificationBody := NotificationBody.Replace('%ProjectManager%', StringConversionManagement.WindowsToASCII("Project Manager No." + ' ' + Resource.Name + ' ' + Resource."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%ProjectManager%', '');

        // Notice of Shipment
        NotificationBody := NotificationBody.Replace('%FreightBudgetCaption%', FIELDCAPTION("Freight Budget"));
        NotificationBody := NotificationBody.Replace('%FreightBudget%', FORMAT("Freight Budget"));
        NotificationBody := NotificationBody.Replace('%ShipperCaption%', 'Shipper');
        IF Vendor.GET("Shipper No.") THEN
          NotificationBody := NotificationBody.Replace('%Shipper%', StringConversionManagement.WindowsToASCII(Vendor."No." + ' ' + Vendor.Name + ' ' + Vendor."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%Shipper%', '');
        NotificationBody := NotificationBody.Replace('%ConsigneeCaption%', 'Consignee');
        IF Customer.GET("Consignee Code") THEN
          NotificationBody := NotificationBody.Replace('%Consignee%', StringConversionManagement.WindowsToASCII(Customer."No." + ' ' + Customer.Name + ' ' + Customer."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%Consignee%', '');

        // End of Shipping Marks Blob
        NotificationBody := NotificationBody.Replace('%ShippingMarksCaption%', FIELDCAPTION("Shipping Marks"));
        //      CALCFIELDS("Shipping Marks");
        //      IF "Shipping Marks".HASVALUE THEN BEGIN
        //        CLEAR(ShippingMarks);
        //        "Shipping Marks".CREATEINSTREAM(Stream);
        //        BinaryReader := BinaryReader.BinaryReader(Stream, Encoding.ASCII, FALSE);
        //        ShippingMarks := CONVERTSTR(BinaryReader.ReadString, '??', '  ');
        //      END;
        //      NotificationBody := NotificationBody.Replace('%ShippingMarks%', (ShippingMarks));
          // End of Shipping Marks Blob

        // Start of Insurance Blob
        NotificationBody := NotificationBody.Replace('%InsuranceCaption%', FIELDCAPTION(Insurance));
        //      CALCFIELDS(Insurance);
        //      IF Insurance.HASVALUE THEN BEGIN
        //        CLEAR(ShippingMarks);
        //        Insurance.CREATEINSTREAM(Stream);
        //        BinaryReader := BinaryReader.BinaryReader(Stream, Encoding.ASCII, FALSE);
        //        InsuranceTxt := CONVERTSTR(BinaryReader.ReadString, '??', '  ');
        //      END;
        //      NotificationBody := NotificationBody.Replace('%Insurance%', (InsuranceTxt));
        // End of Insurance Blob


        NotificationBody := NotificationBody.Replace('%TechnicalInchargeCaption%', FIELDCAPTION("Technical In-Charge"));
        IF Resource.GET("Technical In-Charge") THEN
          NotificationBody := NotificationBody.Replace('%TechnicalIncharge%', StringConversionManagement.WindowsToASCII(Resource."No." + ' ' + Resource.Name + ' ' + Resource."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%TechnicalIncharge%', '');

        NotificationBody := NotificationBody.Replace('%EmployeeNameCaption%', 'Employee Name');
        IF Employee.GET("Employee No.") THEN
          NotificationBody := NotificationBody.Replace('%EmployeeName%', StringConversionManagement.WindowsToASCII(Employee."No." + ' ' + Employee.FullName))
        ELSE
          NotificationBody := NotificationBody.Replace('%EmployeeName%', '');

        NotificationBody := NotificationBody.Replace('%PurchaserCaption%', 'Purchaser');
        IF Purchaser.GET("Purchaser Code") THEN
          NotificationBody := NotificationBody.Replace('%Purchaser%', StringConversionManagement.WindowsToASCII(Purchaser.Code + ' ' + Purchaser.Name))
        ELSE
          NotificationBody := NotificationBody.Replace('%Purchaser%', '');
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithSalesHeaderDetails@4(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";SalesHeader@1000 : Record 36);
    VAR
      Employee@1002 : Record 5200;
      Customer@1003 : Record 18;
      INTP@1007 : Record 50040;
      UserGroup@1004 : Record 9000;
      SalesLine@1005 : Record 37;
      DescriptionOfRequest@1016 : Text;
      Justification@1015 : Text;
      SiteChange@1014 : Text;
      TeamReassignment@1013 : Text;
      MaterialEquipment@1012 : Text;
      NatureOfChangeOthers@1011 : Text;
      PresentSituation@1010 : Text;
      RecommendedChange@1009 : Text;
      RemarksLoc@1008 : Text;
      GTComments@1006 : Text;
      JustificationTxt@1017 : Text;
      DescriptionOfRequestTxt@1018 : Text;
    BEGIN
      WITH SalesHeader DO BEGIN

        ReplaceTokenWithLinkedINTPDetails(NotificationBody, SalesHeader."INTP No.");
        IF SalesHeader."Request type" <> SalesHeader."Request type"::" " THEN
          NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO('%1',"Request type"))
        ELSE
          NotificationBody := NotificationBody.Replace('%DocumentType%',STRSUBSTNO(PurchDocTypeTxt, FORMAT("Document Type")));

        // Headers
        NotificationBody := NotificationBody.Replace('%NoCaption%', SalesHeader.FIELDCAPTION("No."));
        NotificationBody := NotificationBody.Replace('%DocumentNo%',FORMAT(SalesHeader."No."));
        NotificationBody := NotificationBody.Replace('%Details%','');
        NotificationBody := NotificationBody.Replace('%CustomerVendorCaption%', Customer.TABLECAPTION);
        NotificationBody := NotificationBody.Replace('%CustomerVendorNo%', SalesHeader."Sell-to Customer No.");
        NotificationBody := NotificationBody.Replace('%CustomerVendorName%', StringConversionManagement.WindowsToASCII("Sell-to Customer Name" + ' ' + "Sell-to Customer Name 2"));

        NotificationBody := NotificationBody.Replace('%CustomerNoCaption%', SalesHeader.FIELDCAPTION("Sell-to Customer No."));
        NotificationBody := NotificationBody.Replace('%CustomerNo%', SalesHeader."Sell-to Customer No.");
        NotificationBody := NotificationBody.Replace('%DocumentDateCaption%', SalesHeader.FIELDCAPTION("Document Date"));
        NotificationBody := NotificationBody.Replace('%DocumentDate%', FORMAT(SalesHeader."Document Date"));
        NotificationBody := NotificationBody.Replace('%ClientsPONOCaption%', 'Client P.O. No.');
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%', SalesHeader.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ReleasedDateCaption%', SalesHeader.FIELDCAPTION("Released Date"));
        NotificationBody := NotificationBody.Replace('%ReleasedDate%', FORMAT(SalesHeader."Released Date"));
        NotificationBody := NotificationBody.Replace('%StatusCaption%', SalesHeader.FIELDCAPTION(Status));
        NotificationBody := NotificationBody.Replace('%Status%', FORMAT(SalesHeader.Status));
        NotificationBody := NotificationBody.Replace('%CustomerAddressCaption%',SalesHeader.FIELDCAPTION("Sell-to Address"));
        NotificationBody := NotificationBody.Replace('%CustomerAddress%',FORMAT(SalesHeader."Sell-to Address" + ' ' +SalesHeader."Sell-to Address 2"));
        NotificationBody := NotificationBody.Replace('%ReleasedByUserIDCaption%',SalesHeader.FIELDCAPTION("Released By User ID"));
        NotificationBody := NotificationBody.Replace('%ReleasedByUserID%',SalesHeader."Released By User ID");

        NotificationBody := NotificationBody.Replace('%CustomerNameCaption%', 'Customer Name');
        IF Customer.GET(SalesHeader."Sell-to Customer No.") THEN
          NotificationBody := NotificationBody.Replace('%CustomerName%', StringConversionManagement.WindowsToASCII(Customer."No." + ' ' + Customer.Name + ' ' + Customer."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%CustomerName%', '');

        NotificationBody := NotificationBody.Replace('%EmployeeCaption%', Employee.TABLECAPTION);
        NotificationBody := NotificationBody.Replace('%EmployeeNameCaption%', 'Employee Name');
        IF Employee.GET(SalesHeader."Employee No.") THEN BEGIN
          NotificationBody := NotificationBody.Replace('%Employee%',StringConversionManagement.WindowsToASCII(Employee."No." + ' ' + Employee."First Name" + ' ' + Employee."Last Name"));
          NotificationBody := NotificationBody.Replace('%EmployeeName%', StringConversionManagement.WindowsToASCII(Employee."No." + ' ' + Employee.FullName));
        END ELSE BEGIN
          NotificationBody := NotificationBody.Replace('%EmployeeName%', '');
          NotificationBody := NotificationBody.Replace('%Employee%', '');
        END;

        NotificationBody := NotificationBody.Replace('%DepartmentCaption%', 'Department');
        IF UserGroup.GET(SalesHeader."Department Code") THEN
          NotificationBody := NotificationBody.Replace('%Department%', StringConversionManagement.WindowsToASCII(UserGroup.Name));

        IF INTP.GET(SalesHeader."INTP No.") THEN BEGIN
          NotificationBody := NotificationBody.Replace('%ClientsPONO%', FORMAT(INTP."P.O No. (Customer)"));
          NotificationBody := NotificationBody.Replace('%ProjectName%', StringConversionManagement.WindowsToASCII(INTP."Project Name" +' '+ INTP."Project Name 2"));
        END ELSE BEGIN
          NotificationBody := NotificationBody.Replace('%ClientsPONO%', '');
          NotificationBody := NotificationBody.Replace('%ProjectName%', '');
        END;

        NotificationBody := NotificationBody.Replace('%CostAnalystCaption%', SalesHeader.FIELDCAPTION("Cost Analyst"));
        IF Employee.GET(SalesHeader."Cost Analyst") THEN
          NotificationBody := NotificationBody.Replace('%CostAnalyst%',  StringConversionManagement.WindowsToASCII(Employee."No." + ' ' + Employee."First Name" + ' ' + Employee."Last Name"))
        ELSE
          NotificationBody := NotificationBody.Replace('%CostAnalyst%', '');


        // TERF and Withdrawal
        NotificationBody := NotificationBody.Replace('%DateOfReturnCaption%',SalesHeader.FIELDCAPTION("Date of Return"));
        NotificationBody := NotificationBody.Replace('%DateOfReturn%',FORMAT(SalesHeader."Date of Return"));
        NotificationBody := NotificationBody.Replace('%DeliveryAddressCaption%', 'Delivery Address');
        NotificationBody := NotificationBody.Replace('%DeliveryAddress%', StringConversionManagement.WindowsToASCII(SalesHeader."Sell-to Address" + ' ' + SalesHeader."Sell-to Address 2"));
        NotificationBody := NotificationBody.Replace('%SiteNameCaption%', SalesHeader.FIELDCAPTION("Sell-to Post Code"));
        NotificationBody := NotificationBody.Replace('%SiteName%', FORMAT(SalesHeader."Sell-to Post Code"));
        NotificationBody := NotificationBody.Replace('%ARNoCaption%', SalesHeader.FIELDCAPTION("Ack. Receipt No."));
        NotificationBody := NotificationBody.Replace('%ARNo%', FORMAT(SalesHeader."Ack. Receipt No."));
        NotificationBody := NotificationBody.Replace('%DRNoCaption%', SalesHeader.FIELDCAPTION("Deliver Receipt No."));
        NotificationBody := NotificationBody.Replace('%DRNo%', FORMAT(SalesHeader."Deliver Receipt No."));
        NotificationBody := NotificationBody.Replace('%PurposeCaption%', SalesHeader.FIELDCAPTION(Purpose));
        NotificationBody := NotificationBody.Replace('%Purpose%', FORMAT(SalesHeader.Purpose));
        NotificationBody := NotificationBody.Replace('%ReleasedByCaption%', SalesHeader.FIELDCAPTION("Released By User ID"));
        NotificationBody := NotificationBody.Replace('%ReleasedBy%', FORMAT(SalesHeader."Released By User ID"));

        SalesLine.SETRANGE("Document Type", SalesHeader."Document Type");
        SalesLine.SETRANGE("Document No.", SalesHeader."No.");
        IF SalesLine.FINDSET THEN BEGIN
          REPEAT
            CASE SalesLine."Line Type" OF
              SalesLine."Line Type"::"Description of Request":
                DescriptionOfRequest += SalesLine.Description + ' ';
              SalesLine."Line Type"::Justification:
              Justification += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Site":
                SiteChange += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Team":
                TeamReassignment += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Mats":
                MaterialEquipment += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Nature of Work Change-Others":
                NatureOfChangeOthers += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Present Situation":
                PresentSituation += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-Recommended Changes":
                RecommendedChange += SalesLine.Description + ' ';
              SalesLine."Line Type"::Remarks:
                RemarksLoc += SalesLine.Description + ' ';
              SalesLine."Line Type"::"WCR-GT Repr. Comments":
                GTComments += SalesLine.Description + ' ';
            END;
          UNTIL SalesLine.NEXT = 0;
        END;
        // Request for Exception
        DescriptionOfRequest := StringConversionManagement.WindowsToASCII(DescriptionOfRequest);
        Justification := StringConversionManagement.WindowsToASCII(Justification);
        NotificationBody := NotificationBody.Replace('%DescriptionOfRequestCaption%','Description of Request');
        NotificationBody := NotificationBody.Replace('%DescriptionOfRequest%',DescriptionOfRequest);
        NotificationBody := NotificationBody.Replace('%JustificationCaption%','Justification');
        NotificationBody := NotificationBody.Replace('%Justification%',Justification);
        NotificationBody := NotificationBody.Replace('%ExceptionToCaption%', SalesHeader.FIELDCAPTION("Type of Exception"));
        NotificationBody := NotificationBody.Replace('%ExceptionTo%', FORMAT(SalesHeader."Type of Exception"));
        NotificationBody := NotificationBody.Replace('%SubjectCaption%',SalesHeader.FIELDCAPTION(Subject));
        NotificationBody := NotificationBody.Replace('%Subject%',SalesHeader.Subject);
        NotificationBody := NotificationBody.Replace('%ApprovedBudgetCaption%',SalesHeader.FIELDCAPTION("Approved Budget"));
        NotificationBody := NotificationBody.Replace('%ApprovedBudget%',FORMAT(SalesHeader."Approved Budget"));
        NotificationBody := NotificationBody.Replace('%ApprovedTimelineCaption%',SalesHeader.FIELDCAPTION("Approved Timeline"));
        NotificationBody := NotificationBody.Replace('%ApprovedTimeline%',FORMAT(SalesHeader."Approved Timeline"));
        NotificationBody := NotificationBody.Replace('%ProposedBudgetCaption%',SalesHeader.FIELDCAPTION("Proposed Budget"));
        NotificationBody := NotificationBody.Replace('%ProposedBudget%',FORMAT(SalesHeader."Proposed Budget"));
        NotificationBody := NotificationBody.Replace('%ProposedTimelineCaption%',SalesHeader.FIELDCAPTION("Proposed Timeline"));
        NotificationBody := NotificationBody.Replace('%ProposedTimeline%',FORMAT(SalesHeader."Proposed Timeline"));
        NotificationBody := NotificationBody.Replace('%WaiverTypeCaption%',SalesHeader.FIELDCAPTION("Waiver Type"));
        NotificationBody := NotificationBody.Replace('%WaiverType%',FORMAT(SalesHeader."Waiver Type"));
        NotificationBody := NotificationBody.Replace('%PersonInchargeCaption%',SalesHeader.FIELDCAPTION("Person Incharge"));
        NotificationBody := NotificationBody.Replace('%ProjectStatusCaption%',SalesHeader.FIELDCAPTION("Project Status"));
        NotificationBody := NotificationBody.Replace('%ProjectStatus%',SalesHeader."Project Status");
        NotificationBody := NotificationBody.Replace('%PlannedNoOfDaysCaption%', SalesHeader.FIELDCAPTION("Planned No. of Days"));
        NotificationBody := NotificationBody.Replace('%PlannedNoOfDays%', FORMAT(SalesHeader."Planned No. of Days"));
        NotificationBody := NotificationBody.Replace('%TotalNoOfExtentionCaption%', SalesHeader.FIELDCAPTION("Total No. of Extension"));
        NotificationBody := NotificationBody.Replace('%TotalNoOfExtention%', FORMAT(SalesHeader."Total No. of Extension"));
        NotificationBody := NotificationBody.Replace('%ActivityStatusCaption%', SalesHeader.FIELDCAPTION("Activity Status"));
        NotificationBody := NotificationBody.Replace('%ActivityStatus%', FORMAT(SalesHeader."Activity Status"));
        NotificationBody := NotificationBody.Replace('%NoOfMobilizationCaption%', SalesHeader.FIELDCAPTION("No. of Mobilization"));
        NotificationBody := NotificationBody.Replace('%NoOfMobilization%', FORMAT(SalesHeader."No. of Mobilization"));
        NotificationBody := NotificationBody.Replace('%Mobilization%',  ReplaceTokenToChecked(SalesHeader.Mobilization));
        NotificationBody := NotificationBody.Replace('%NoOfRemobilizationCaption%', SalesHeader.FIELDCAPTION("No. of Remobilization"));
        NotificationBody := NotificationBody.Replace('%NoOfRemobilization%',  FORMAT(SalesHeader."No. of Remobilization"));
        NotificationBody := NotificationBody.Replace('%Remobilization%',  ReplaceTokenToChecked(SalesHeader.Remobilization));
        NotificationBody := NotificationBody.Replace('%RectificationCaption%', SalesHeader.FIELDCAPTION(Rectification));
        NotificationBody := NotificationBody.Replace('%Rectification%', ReplaceTokenToChecked(SalesHeader.Rectification));
        NotificationBody := NotificationBody.Replace('%TroubleshootingCaption%', SalesHeader.FIELDCAPTION(Troubleshooting));
        NotificationBody := NotificationBody.Replace('%Troubleshooting%', ReplaceTokenToChecked(SalesHeader.Troubleshooting));
        NotificationBody := NotificationBody.Replace('%WaiverTypeCaption%', SalesHeader.FIELDCAPTION("Waiver Type"));
        NotificationBody := NotificationBody.Replace('%WaiverType%', FORMAT(SalesHeader."Waiver Type"));
        NotificationBody := NotificationBody.Replace('%ForRegularizationCaption%', 'For Regularization');
        NotificationBody := NotificationBody.Replace('%StatusOfRegularizationCaption%',  SalesHeader.FIELDCAPTION("Status of Regularization"));
        NotificationBody := NotificationBody.Replace('%StatusOfRegularization%',  FORMAT(SalesHeader."Status of Regularization"));
        NotificationBody := NotificationBody.Replace('%DateRegularizedCaption%',  SalesHeader.FIELDCAPTION("Date Regularized"));
        NotificationBody := NotificationBody.Replace('%DateRegularized%',  FORMAT(SalesHeader."Date Regularized"));
        NotificationBody := NotificationBody.Replace('%OthersCaption%',  SalesHeader.FIELDCAPTION(Others));
        NotificationBody := NotificationBody.Replace('%Others%',  StringConversionManagement.WindowsToASCII(SalesHeader.Others));
        NotificationBody := NotificationBody.Replace('%ProjectInChargeNoCaption%', SalesHeader.FIELDCAPTION("Project In-Charge No."));
        NotificationBody := NotificationBody.Replace('%ProjectInChargeNo%', FORMAT(SalesHeader."Project In-Charge No."));
        NotificationBody := NotificationBody.Replace('%ProjectInChargeNameCaption%', 'Project In-Charge Name');
        NotificationBody := NotificationBody.Replace('%ProposedTimelineFormatted%', FORMAT(SalesHeader."Proposed Timeline", 0,'<Month Text> <Closing><Day>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%ApprovedTimelineFormatted%', FORMAT(SalesHeader."Approved Timeline", 0,'<Month Text> <Closing><Day>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%CommitmentDateFormatted%', FORMAT(SalesHeader."Commitment Date", 0,'<Month Text> <Closing><Day>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%ExtendCommitmentDateFormatted%', FORMAT(SalesHeader."Extension of Commitment Date", 0,'<Month Text> <Closing><Day>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%ApprovedDateOfExtensionFormatted%', FORMAT(SalesHeader."Approved Date of Extension", 0,'<Month Text> <Closing><Day>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%DateRegularizedFormatted%', FORMAT(SalesHeader."Date Regularized", 0,'<Month Text> <Closing><Day>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%DocumentDateFormatted%', FORMAT(SalesHeader."Document Date", 0,'<Month Text> <Closing><Day>, <Year4>'));

        IF SalesHeader."Description of Req. Background".HASVALUE THEN BEGIN
          CLEAR(DescriptionOfRequest);
          SalesHeader.CALCFIELDS("Description of Req. Background");
          SalesHeader."Description of Req. Background".CREATEINSTREAM(InStr);
          InStr.READ(DescriptionOfRequestTxt);
          NotificationBody := NotificationBody.Replace('%DescriptionOfRequestTxt%', StringConversionManagement.WindowsToASCII(DescriptionOfRequestTxt));
        END ELSE
          NotificationBody := NotificationBody.Replace('%DescriptionOfRequestTxt%', '');

        IF SalesHeader."Justif. Assessment of Risk".HASVALUE THEN BEGIN
          CLEAR(JustificationTxt);
          SalesHeader.CALCFIELDS("Justif. Assessment of Risk");
          SalesHeader."Justif. Assessment of Risk".CREATEINSTREAM(InStr);
          InStr.READ(JustificationTxt);
          NotificationBody := NotificationBody.Replace('%JustificationTxt%', StringConversionManagement.WindowsToASCII(JustificationTxt));
        END ELSE
          NotificationBody := NotificationBody.Replace('%JustificationTxt%', '');

        IF Employee.GET(SalesHeader."Project In-Charge No.") THEN
          NotificationBody := NotificationBody.Replace('%ProjectInChargeName%', StringConversionManagement.WindowsToASCII("Employee No." + ' ' + Employee."First Name" + ' ' + Employee."Last Name"))
        ELSE
          NotificationBody := NotificationBody.Replace('%ProjectInChargeName%', '');

        IF SalesHeader.Others <> '' THEN
          NotificationBody := NotificationBody.Replace('%OthersCb%', 'checked')
        ELSE
          NotificationBody := NotificationBody.Replace('%OthersCb%', '');

        IF SalesHeader."Status of Regularization" <> SalesHeader."Status of Regularization"::" " THEN
          NotificationBody := NotificationBody.Replace('%ForRegularization%', 'checked')
        ELSE
          NotificationBody := NotificationBody.Replace('%ForRegularization%', '');

        IF Employee.GET(SalesHeader."Person Incharge") THEN
          NotificationBody := NotificationBody.Replace('%PersonIncharge%',FORMAT(Employee."No." + ' ' + Employee."First Name" + ' ' + Employee."Last Name"))
        ELSE
          NotificationBody := NotificationBody.Replace('%PersonIncharge%','');

        NotificationBody := NotificationBody.Replace('%CommitmentDateCaption%',SalesHeader.FIELDCAPTION("Commitment Date"));
        NotificationBody := NotificationBody.Replace('%CommitmentDate%',FORMAT(SalesHeader."Commitment Date"));
        NotificationBody := NotificationBody.Replace('%ExtendCommitmentDateCaption%',SalesHeader.FIELDCAPTION("Extension of Commitment Date"));
        NotificationBody := NotificationBody.Replace('%ExtendCommitmentDate%',FORMAT(SalesHeader."Extension of Commitment Date"));
        NotificationBody := NotificationBody.Replace('%ApprovedDateOfExtensionCaption%',SalesHeader.FIELDCAPTION("Approved Date of Extension"));
        NotificationBody := NotificationBody.Replace('%ApprovedDateOfExtension%',FORMAT(SalesHeader."Approved Date of Extension"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudgetCaption%',SalesHeader.FIELDCAPTION("Attmt. App. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudget%',FORMAT(SalesHeader."Attmt. App. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedBudgetCb%',ReplaceTokenToChecked(SalesHeader."Attmt. App. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimelineCaption%',SalesHeader.FIELDCAPTION("Attmt. App.Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimeline%',FORMAT(SalesHeader."Attmt. App.Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsApprovedTimelineCb%',ReplaceTokenToChecked(SalesHeader."Attmt. App.Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedBudgetCaption%',SalesHeader.FIELDCAPTION("Attmt. Prop. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedBudget%',FORMAT(SalesHeader."Attmt. Prop. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedBudgetCb%',ReplaceTokenToChecked(SalesHeader."Attmt. Prop. Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedTimelineCaption%',SalesHeader.FIELDCAPTION("Attmt. Prop. Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedTimeline%',FORMAT(SalesHeader."Attmt. Prop. Timeline"));
        NotificationBody := NotificationBody.Replace('%AttachementsProposedTimelineCb%',ReplaceTokenToChecked(SalesHeader."Attmt. Prop. Timeline"));

        // Work Change Request
        SiteChange := StringConversionManagement.WindowsToASCII(SiteChange);
        TeamReassignment := StringConversionManagement.WindowsToASCII(TeamReassignment);
        MaterialEquipment := StringConversionManagement.WindowsToASCII(MaterialEquipment);
        NatureOfChangeOthers := StringConversionManagement.WindowsToASCII(NatureOfChangeOthers);
        PresentSituation := StringConversionManagement.WindowsToASCII(PresentSituation);
        RecommendedChange := StringConversionManagement.WindowsToASCII(RecommendedChange);
        RemarksLoc := StringConversionManagement.WindowsToASCII(RemarksLoc);
        GTComments := StringConversionManagement.WindowsToASCII(GTComments);
        NotificationBody := NotificationBody.Replace('%ProgramCaption%',SalesHeader.FIELDCAPTION("Program"));
        NotificationBody := NotificationBody.Replace('%Program%',SalesHeader."Program");
        NotificationBody := NotificationBody.Replace('%AnnexesCaption%',SalesHeader.FIELDCAPTION(Annexes));
        NotificationBody := NotificationBody.Replace('%Annexes%',SalesHeader.Annexes);
        NotificationBody := NotificationBody.Replace('%CMSTicketCaption%',SalesHeader.FIELDCAPTION("CMS Ticket No."));
        NotificationBody := NotificationBody.Replace('%CMSTicket%',SalesHeader."CMS Ticket No.");
        NotificationBody := NotificationBody.Replace('%DateOfOcularInspectionCaption%',SalesHeader.FIELDCAPTION("Date of Ocular Inspection"));
        NotificationBody := NotificationBody.Replace('%DateOfOcularInspection%',FORMAT(SalesHeader."Date of Ocular Inspection"));
        NotificationBody := NotificationBody.Replace('%ChargeableToClientCaption%',SalesHeader.FIELDCAPTION("Chargeable to Client"));
        NotificationBody := NotificationBody.Replace('%ChargeableToClient%',FORMAT(SalesHeader."Chargeable to Client"));
        NotificationBody := NotificationBody.Replace('%AdditionalWorkCaption%',SalesHeader.FIELDCAPTION("Additional Work"));
        NotificationBody := NotificationBody.Replace('%AdditionalWork%', FORMAT(SalesHeader."Additional Work"));
        NotificationBody := NotificationBody.Replace('%SiteChangeCaption%','Site Change');
        NotificationBody := NotificationBody.Replace('%SiteChange%',SiteChange);
        NotificationBody := NotificationBody.Replace('%TeamReassignmentCaption%','Team Reassignment');
        NotificationBody := NotificationBody.Replace('%TeamReassignment%', TeamReassignment);
        NotificationBody := NotificationBody.Replace('%MaterialsEquipmentCaption%','Materials/Equipment/Device Change');
        NotificationBody := NotificationBody.Replace('%MaterialsEquipment%',MaterialEquipment);
        NotificationBody := NotificationBody.Replace('%NatureOfChangeOthersCaption%', 'Others');
        NotificationBody := NotificationBody.Replace('%NatureOfChangeOthers%',NatureOfChangeOthers);
        NotificationBody := NotificationBody.Replace('%PresentSituationCaption%','Present Situation');
        NotificationBody := NotificationBody.Replace('%PresentSituation%',PresentSituation);
        NotificationBody := NotificationBody.Replace('%RecommendedChangeCaption%','Recommended Change');
        NotificationBody := NotificationBody.Replace('%RecommendedChange%',RecommendedChange);
        NotificationBody := NotificationBody.Replace('%OriginalProjectCostCaption%',SalesHeader.FIELDCAPTION("Original PO Amount"));
        NotificationBody := NotificationBody.Replace('%OriginalProjectCost%', FORMAT(SalesHeader."Original PO Amount"));
        NotificationBody := NotificationBody.Replace('%LateAFIAmountBeforeWCICaption%',SalesHeader.FIELDCAPTION("Latest AFI Amt. before WCR"));
        NotificationBody := NotificationBody.Replace('%LateAFIAmountBeforeWCI%',FORMAT(SalesHeader."Latest AFI Amt. before WCR"));
        NotificationBody := NotificationBody.Replace('%ThisWCRCostVariationWCRCaption%',SalesHeader.FIELDCAPTION("This WCR Cost Variation WCR"));
        NotificationBody := NotificationBody.Replace('%ThisWCRCostVariationWCR%',FORMAT(SalesHeader."This WCR Cost Variation WCR"));
        NotificationBody := NotificationBody.Replace('%TotalCostAfterWCRCaption%',SalesHeader.FIELDCAPTION("Total Cost After WCR"));
        NotificationBody := NotificationBody.Replace('%TotalCostAfterWCR%',FORMAT(SalesHeader."Total Cost After WCR"));
        NotificationBody := NotificationBody.Replace('%BalancePOAfterWCRCaption%',SalesHeader.FIELDCAPTION("Total PO After WCR"));
        NotificationBody := NotificationBody.Replace('%BalancePOAfterWCR%',FORMAT(SalesHeader."Total PO After WCR"));
        NotificationBody := NotificationBody.Replace('%CheckVoucherNoCaption%',SalesHeader.FIELDCAPTION("Check Voucher No."));
        NotificationBody := NotificationBody.Replace('%CheckVoucherNo%',SalesHeader."Check Voucher No.");
        NotificationBody := NotificationBody.Replace('%CashAdvanceNoCaption%',SalesHeader.FIELDCAPTION("Cash Advance No."));
        NotificationBody := NotificationBody.Replace('%CashAdvanceNo%',SalesHeader."Cash Advance No.");
        NotificationBody := NotificationBody.Replace('%CheckNoCaption%',SalesHeader.FIELDCAPTION("Check No."));
        NotificationBody := NotificationBody.Replace('%CheckNo%',SalesHeader."Check No.");
        NotificationBody := NotificationBody.Replace('%AmountToBeChargeCaption%',SalesHeader.FIELDCAPTION("Amt. to be Charged"));
        NotificationBody := NotificationBody.Replace('%AmountToBeCharge%',FORMAT(SalesHeader."Amt. to be Charged"));
        NotificationBody := NotificationBody.Replace('%GTRepresentativeCommentCaption%','GT Representative Comment');
        NotificationBody := NotificationBody.Replace('%GTRepresentativeComment%',GTComments);
        NotificationBody := NotificationBody.Replace('%RemarksCaption%','Remarks');
        NotificationBody := NotificationBody.Replace('%Remarks%',RemarksLoc);

        // Sales lines
        StripoEmailTemplate.ReplaceTokenWithSalesHeaderLines(NotificationBody, SalesHeader);

        // Remarks/Notes
        StripoEmailTemplate.ReplaceTokenWithRemarksNotesV2(NotificationBody, SalesHeader.RECORDID);

        // Approval/Comment
        StripoEmailTemplate.ReplaceTokenWithApprovalCommentsV2(NotificationBody, SalesHeader.RECORDID);

        // Approval Entries
        StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, SalesHeader.RECORDID);
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithINTPDetails@11(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";INTP@1000 : Record 50040);
    VAR
      InStr@1003 : InStream;
      CommentsText@1002 : Text;
    BEGIN
      WITH INTP DO BEGIN
        NotificationBody := NotificationBody.Replace('%DocumentDateCaption%',FIELDCAPTION("Document Date"));
        NotificationBody := NotificationBody.Replace('%DocumentDate%',FORMAT("Document Date"));
        NotificationBody := NotificationBody.Replace('%Date%',FORMAT(DT2DATE("Document Date"), 0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%Time%',FORMAT("Document Time"));
        NotificationBody := NotificationBody.Replace('%StatusCaption%',FIELDCAPTION(Status));
        NotificationBody := NotificationBody.Replace('%Status%',FORMAT(Status));
        NotificationBody := NotificationBody.Replace('%ApprovalStatusCaption%',FIELDCAPTION("Approval Status"));
        NotificationBody := NotificationBody.Replace('%ApprovalStatus%',FORMAT("Approval Status"));
        NotificationBody := NotificationBody.Replace('%Approval StatusCaption%',FIELDCAPTION("Approval Status"));
        NotificationBody := NotificationBody.Replace('%Approval Status%',FORMAT("Approval Status"));
        NotificationBody := NotificationBody.Replace('%NoticeToMobilizeCaption%',FIELDCAPTION("Notice To Mobilize"));
        NotificationBody := NotificationBody.Replace('%NoticeToMobilize%',FORMAT("Notice To Mobilize"));
        NotificationBody := NotificationBody.Replace('%NoticeToProceedCaption%',FIELDCAPTION("Notice To Proceed"));
        NotificationBody := NotificationBody.Replace('%NoticeToProceed%',FORMAT("Notice To Proceed"));
        NotificationBody := NotificationBody.Replace('%ClusterMobilizationCaption%',FIELDCAPTION("Clustering Mobilization"));
        NotificationBody := NotificationBody.Replace('%ClusterMobilization%',FORMAT("Clustering Mobilization"));
        NotificationBody := NotificationBody.Replace('%SupplyOnlyCaption%',FIELDCAPTION("Supply Only"));
        NotificationBody := NotificationBody.Replace('%SupplyOnly%',FORMAT("Supply Only"));
        NotificationBody := NotificationBody.Replace('%PerSiteMobilizationCaption%',FIELDCAPTION("Per Site Mobilization"));
        NotificationBody := NotificationBody.Replace('%PerSiteMobilization%',FORMAT("Per Site Mobilization"));
        NotificationBody := NotificationBody.Replace('%DemoPOCCaption%',FIELDCAPTION("Demo POC"));
        NotificationBody := NotificationBody.Replace('%DemoPOC%',FORMAT("Demo POC"));
        NotificationBody := NotificationBody.Replace('%WithPOCaption%',FIELDCAPTION("w/ P.O"));
        NotificationBody := NotificationBody.Replace('%WithPO%',FORMAT("w/ P.O"));
        NotificationBody := NotificationBody.Replace('%WithOutPOCaption%',FIELDCAPTION("w/o P.O"));
        NotificationBody := NotificationBody.Replace('%WithOutPO%',FORMAT("w/o P.O"));
        NotificationBody := NotificationBody.Replace('%PONoFromCustomerCaption%',FIELDCAPTION("P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%PONoFromCustomer%',StringConversionManagement.WindowsToASCII("P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%PODateFromCustomerCaption%',FIELDCAPTION("P.O Date (Customer)"));
        NotificationBody := NotificationBody.Replace('%PODateFromCustomer%',FORMAT("P.O Date (Customer)", 0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%PODateCaption%',FIELDCAPTION("P.O Date (Customer)"));
        NotificationBody := NotificationBody.Replace('%PODate%',FORMAT("P.O Date (Customer)", 0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%NoOfSitesCaption%',FIELDCAPTION("No of Sites"));
        NotificationBody := NotificationBody.Replace('%NoOfSites%',FORMAT("No of Sites"));
        NotificationBody := NotificationBody.Replace('%SiteNamesCaption%',FIELDCAPTION("Site Names"));
        NotificationBody := NotificationBody.Replace('%SiteNames%',StringConversionManagement.WindowsToASCII("Site Names"));
        NotificationBody := NotificationBody.Replace('%CustomerNameCaption%',FIELDCAPTION("Customer Name"));
        NotificationBody := NotificationBody.Replace('%CustomerName%',StringConversionManagement.WindowsToASCII("Customer No." + ' ' + "Customer Name"));
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%',FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjectName%',StringConversionManagement.WindowsToASCII("Project Name" + ' ' + "Project Name 2"));
        NotificationBody := NotificationBody.Replace('%ReleasedDateOfPOCaption%',FIELDCAPTION("Release Date of P.O"));
        NotificationBody := NotificationBody.Replace('%ReleasedDateOfPO%',FORMAT("Release Date of P.O", 0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%SalesEngineerCaption%',FIELDCAPTION("Sales Engineer"));
        CALCFIELDS("Sales Engineer", "Project Manager", Salesperson, "Cost Analyst");
        NotificationBody := NotificationBody.Replace('%SalesEngineer%',StringConversionManagement.WindowsToASCII("Sales Engineer"));
        NotificationBody := NotificationBody.Replace('%ProjectManagerCaption%',FIELDCAPTION("Project Manager"));
        NotificationBody := NotificationBody.Replace('%ProjectManager%',StringConversionManagement.WindowsToASCII("Project Manager"));
        NotificationBody := NotificationBody.Replace('%SalesPersonCaption%',FIELDCAPTION(Salesperson));
        NotificationBody := NotificationBody.Replace('%SalesPerson%',StringConversionManagement.WindowsToASCII(Salesperson));
        NotificationBody := NotificationBody.Replace('%SalesAccountManager%',StringConversionManagement.WindowsToASCII(Salesperson));
        NotificationBody := NotificationBody.Replace('%CostAnalystCaption%',FIELDCAPTION("Cost Analyst"));
        NotificationBody := NotificationBody.Replace('%CostAnalyst%',StringConversionManagement.WindowsToASCII("Cost Analyst No." + ' ' + "Cost Analyst"));
        NotificationBody := NotificationBody.Replace('%DateOfCompleteEquipmentsReadyCaption%',FIELDCAPTION("Complete Equip. Date"));
        NotificationBody := NotificationBody.Replace('%DateOfCompleteEquipmentsReady%',FORMAT("Complete Equip. Date", 0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%ProjectTargetCompletionDateCaption%',FIELDCAPTION("Proj. Target Complete Date"));
        NotificationBody := NotificationBody.Replace('%ProjectTargetCompletionDate%',FORMAT("Proj. Target Complete Date", 0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%DeliveryToCustomerWarehouseCaption%',FIELDCAPTION("xrec. Delivery To Client Whse."));
        NotificationBody := NotificationBody.Replace('%DeliveryToCustomerWarehouse%',StringConversionManagement.WindowsToASCII("xrec. Delivery To Client Whse."));
        NotificationBody := NotificationBody.Replace('%CostProfitCenterNo%',"Global Dimension 1 Code" + '/' + "Global Dimension 2 Code");
        NotificationBody := NotificationBody.Replace('%ServiceReportNo%',"SR No.");
        NotificationBody := NotificationBody.Replace('%JobOrderNoCaption%',FIELDCAPTION("Job Order No."));
        NotificationBody := NotificationBody.Replace('%JobOrderNo%',"Job Order No.");
        NotificationBody := NotificationBody.Replace('%VendorNoCaption%',FIELDCAPTION("Vendor No."));
        NotificationBody := NotificationBody.Replace('%VendorNo%',"Vendor No.");

        NotificationBody := NotificationBody.Replace('%PONoToSupplierCaption%',FIELDCAPTION("P.O No. To Supplier"));
        NotificationBody := NotificationBody.Replace('%PONoToSupplier%',StringConversionManagement.WindowsToASCII("P.O No. To Supplier"));
        NotificationBody := NotificationBody.Replace('%DateOfDeliveryToCustomerWarehouseCaption%',FIELDCAPTION("Date of Dlvr.-Cust. Whse."));
        NotificationBody := NotificationBody.Replace('%DateOfDeliveryToCustomerWarehouse%',FORMAT("Date of Dlvr.-Cust. Whse.", 0,'<Month Text> <Day,2>, <Year4>'));

        // Person to notify
        NotificationBody := NotificationBody.Replace('%PersonToNotifyHumanResourceCaption%',FIELDCAPTION("HRD-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyHumanResource%',"HRD-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyAccountingCaption%',FIELDCAPTION("ACC-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyAccounting%',"ACC-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyAuditCaption%',FIELDCAPTION("AUD-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyAudit%',"AUD-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyInventoryCaption%',FIELDCAPTION("INV-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyInventory%',"INV-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyLogisticsCaption%',FIELDCAPTION("LOG-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyLogistics%',"LOG-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyOutsitePlantCaption%',FIELDCAPTION("OSP-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyOutsitePlant%',"OSP-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectManagementCaption%',FIELDCAPTION("PMD-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectManagement%',"PMD-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyPurchasingCaption%',FIELDCAPTION("PUR-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyPurchasing%',"PUR-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyQualityAssuranceCaption%',FIELDCAPTION("QAU-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyQualityAssurance%',"QAU-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifySalesCaption%',FIELDCAPTION("SAL-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifySales%',"SAL-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectControlCaption%',FIELDCAPTION("PMO-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyProjectControl%',"PMO-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyTelecomAuditCaption%',FIELDCAPTION("TAU-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyTelecomAudit%',"TAU-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyWarehouseManagementCaption%',FIELDCAPTION("WMU-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyWarehouseManagement%',"WMU-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceAPCaption%',FIELDCAPTION("FIN-AP Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceAP%',"Fin-AP PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceARCaption%',FIELDCAPTION("FIN-AR Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyFinanceAR%',"FIN-AR PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyDeviceManagementCaption%',FIELDCAPTION("CPE-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyDeviceManagement%',"CPE-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyICTCaption%',FIELDCAPTION("ICT-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyICT%',"ICT-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyPowerCaption%',FIELDCAPTION("POW-00 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyPower%',"POW-00 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWiredCaption%',FIELDCAPTION("TRM-WRD Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWired%',"TRM-WRD PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWirelessCaption%',FIELDCAPTION("TRM-WRL Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyTransmissionWireless%',"TRM-WRL PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess1Caption%',FIELDCAPTION("WRL-A1 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess1%',"WRL-A1 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess2Caption%',FIELDCAPTION("WRL-A2 Dept."));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyWirelessAccess2%',"WRL-A2 PTN");
        NotificationBody := NotificationBody.Replace('%PersonToNotifyOtheresCaption%',FIELDCAPTION(Others));
        NotificationBody := NotificationBody.Replace('%PersonToNotifyOtheres%',StringConversionManagement.WindowsToASCII(Others));
        // Engineering Activities
        NotificationBody := NotificationBody.Replace('%EngActSiteAcquisitionCaption%',FIELDCAPTION("Site Acquisition"));
        NotificationBody := NotificationBody.Replace('%EngActSiteAcquisition%',FORMAT("Site Acquisition"));
        NotificationBody := NotificationBody.Replace('%EngActSiteSurveyCaption%',FIELDCAPTION("Site Survey"));
        NotificationBody := NotificationBody.Replace('%EngActSiteSurvey%',FORMAT("Site Survey"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedMOACaption%',FIELDCAPTION("Approved MOA/MOU"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedMOA%',FORMAT("Approved MOA/MOU"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedRAAWACaption%',FIELDCAPTION("Approved RAAWA/Work Permit"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedRAAWA%',FORMAT("Approved RAAWA/Work Permit"));
        NotificationBody := NotificationBody.Replace('%EngActFloorPlansFromCustomerCaption%',FIELDCAPTION("Floor Plans from Customer"));
        NotificationBody := NotificationBody.Replace('%EngActFloorPlansFromCustomer%',FORMAT("Floor Plans from Customer"));
        NotificationBody := NotificationBody.Replace('%EngActContactedStructuredCablingSubconCaption%',FIELDCAPTION("Ctctd. Strctrd. Cblng Subcon"));
        NotificationBody := NotificationBody.Replace('%EngActContactedStructuredCablingSubcon%',FORMAT("Ctctd. Strctrd. Cblng Subcon"));
        NotificationBody := NotificationBody.Replace('%EngActInstallationCaption%',FIELDCAPTION(Installation));
        NotificationBody := NotificationBody.Replace('%EngActInstallation%',FORMAT(Installation));
        NotificationBody := NotificationBody.Replace('%EngActApprovedBOQCaption%',FIELDCAPTION("Approved BOQ"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedBOQ%',FORMAT("Approved BOQ"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedHDLAndTSSRDesignCaption%',FIELDCAPTION("Approved HLD and TSSR Design"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedHDLAndTSSRDesign%',FORMAT("Approved HLD and TSSR Design"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedWorkPermitRAAWACaption%',FIELDCAPTION("Approved Work Permit/RAAWA"));
        NotificationBody := NotificationBody.Replace('%EngActApprovedWorkPermitRAAWA%',FORMAT("Approved Work Permit/RAAWA"));
        NotificationBody := NotificationBody.Replace('%EngActSignedNoticeToInstallCaption%',FIELDCAPTION("Signed Notice to Install"));
        NotificationBody := NotificationBody.Replace('%EngActSignedNoticeToInstall%',FORMAT("Signed Notice to Install"));
        NotificationBody := NotificationBody.Replace('%EngActTroubleshootingCaption%',FIELDCAPTION(Troubleshooting));
        NotificationBody := NotificationBody.Replace('%EngActTroubleshooting%',FORMAT(Troubleshooting));
        NotificationBody := NotificationBody.Replace('%EngActMaintenanceCaption%',FIELDCAPTION(Maintenance));
        NotificationBody := NotificationBody.Replace('%EngActMaintenance%',FORMAT(Maintenance));
        NotificationBody := NotificationBody.Replace('%EngActQualityAuditTrialPOCCaption%',FIELDCAPTION("Quality Audit/Trial/POC"));
        NotificationBody := NotificationBody.Replace('%EngActQualityAuditTrialPOC%',FORMAT("Quality Audit/Trial/POC"));
        NotificationBody := NotificationBody.Replace('%EngActBuildingClearanceCaption%',FIELDCAPTION("Building Clearance"));
        NotificationBody := NotificationBody.Replace('%EngActBuildingClearance%',FORMAT("Building Clearance"));
        NotificationBody := NotificationBody.Replace('%EngActCommissioningCaption%',FIELDCAPTION(Commissioning));
        NotificationBody := NotificationBody.Replace('%EngActCommissioning%',FORMAT(Commissioning));
        NotificationBody := NotificationBody.Replace('%EngActDeliveryToCustomerWarehouseCaption%',FIELDCAPTION("Delivery To Customers Whse."));
        NotificationBody := NotificationBody.Replace('%EngActDeliveryToCustomerWarehouse%',FORMAT("Delivery To Customers Whse."));
        NotificationBody := NotificationBody.Replace('%EngActFinalAcceptanceCaption%',FIELDCAPTION("Final Acceptance"));
        NotificationBody := NotificationBody.Replace('%EngActFinalAcceptance%',FORMAT("Final Acceptance"));
        NotificationBody := NotificationBody.Replace('%EngActPreliminaryAcceptanceCaption%',FIELDCAPTION("Preliminary Acceptance"));
        NotificationBody := NotificationBody.Replace('%EngActPreliminaryAcceptance%',FORMAT("Preliminary Acceptance"));
        NotificationBody := NotificationBody.Replace('%EngActTestingCaption%',FIELDCAPTION(Testing));
        NotificationBody := NotificationBody.Replace('%EngActTesting%',FORMAT(Testing));
        NotificationBody := NotificationBody.Replace('%EngActRectificationCaption%',FIELDCAPTION(Rectification));
        NotificationBody := NotificationBody.Replace('%EngActRectification%',FORMAT(Rectification));
        NotificationBody := NotificationBody.Replace('%EngActShipmentAirFreightCaption%',FIELDCAPTION("Shipment (Air Freight)"));
        NotificationBody := NotificationBody.Replace('%EngActShipmentAirFreight%',FORMAT("Shipment (Air Freight)"));
        NotificationBody := NotificationBody.Replace('%EngActShipmentSeeFreightCaption%',FIELDCAPTION("Shipment (Sea Freight)"));
        NotificationBody := NotificationBody.Replace('%EngActShipmentSeeFreight%',FORMAT("Shipment (Sea Freight)"));
        NotificationBody := NotificationBody.Replace('%EngActQOthersPleaseSpecifyCaption%',FIELDCAPTION("Q. Others Please Specify"));
        NotificationBody := NotificationBody.Replace('%EngActQOthersPleaseSpecify%',FORMAT("Q. Others Please Specify"));
        NotificationBody := NotificationBody.Replace('%EngActQOthersRemarksCaption%',FIELDCAPTION("Q. Others Remarks"));
        NotificationBody := NotificationBody.Replace('%EngActQOthersRemarks%',StringConversionManagement.WindowsToASCII("Q. Others Remarks"));
        // Attachments
        NotificationBody := NotificationBody.Replace('%AttachementNoticeToProceedCaption%',FIELDCAPTION("A. Notice To Proceed"));
        NotificationBody := NotificationBody.Replace('%AttachementNoticeToProceed%',FORMAT("A. Notice To Proceed"));
        NotificationBody := NotificationBody.Replace('%AttachementTP_CTFCaption%',FIELDCAPTION("ATP/CTF"));
        NotificationBody := NotificationBody.Replace('%AttachementTP_CTF%',FORMAT("ATP/CTF"));
        NotificationBody := NotificationBody.Replace('%AttachementSignedTrialCaption%',FIELDCAPTION("A. Signed Trial"));
        NotificationBody := NotificationBody.Replace('%AttachementSignedTrial%',FORMAT("A. Signed Trial"));
        NotificationBody := NotificationBody.Replace('%AttachementPOFromCustomerCaption%',FIELDCAPTION("A. P.O. From Client"));
        NotificationBody := NotificationBody.Replace('%AttachementPOFromCustomer%',FORMAT("A. P.O. From Client"));
        NotificationBody := NotificationBody.Replace('%AttachementPOToVendorCaption%',FIELDCAPTION("A. P.O. To Supplier"));
        NotificationBody := NotificationBody.Replace('%AttachementPOToVendor%',FORMAT("A. P.O. To Supplier"));
        NotificationBody := NotificationBody.Replace('%AttachementExceptionReportCaption%',FIELDCAPTION("Exception Report"));
        NotificationBody := NotificationBody.Replace('%AttachementExceptionReport%',FORMAT("Exception Report"));
        NotificationBody := NotificationBody.Replace('%AttachementExceptionReportNoCaption%',FIELDCAPTION("Exception Report No."));
        NotificationBody := NotificationBody.Replace('%AttachementExceptionReportNo%',FORMAT("Exception Report No."));
        NotificationBody := NotificationBody.Replace('%AttachementBillOfMaterialsCaption%',FIELDCAPTION("A. Bill Of Materials"));
        NotificationBody := NotificationBody.Replace('%AttachementBillOfMaterials%',FORMAT("A. Bill Of Materials"));
        NotificationBody := NotificationBody.Replace('%AttachementAllocatedBudgetCaption%',FIELDCAPTION("A. Allocated Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementAllocatedBudget%',FORMAT("A. Allocated Budget"));
        NotificationBody := NotificationBody.Replace('%AttachementOthersPleaseSpecifyCaption%',FIELDCAPTION("A. Others Please Specify"));
        NotificationBody := NotificationBody.Replace('%AttachementOthersPleaseSpecify%',FORMAT("A. Others Please Specify"));
        NotificationBody := NotificationBody.Replace('%AttachementOtherRemarksCaption%',FIELDCAPTION("A. Others Remarks"));
        NotificationBody := NotificationBody.Replace('%AttachementOtherRemarks%',StringConversionManagement.WindowsToASCII("A. Others Remarks"));
        //Warranty
        NotificationBody := NotificationBody.Replace('%WithinWarrantyCaption%',FIELDCAPTION("Within Warranty"));
        NotificationBody := NotificationBody.Replace('%WithinWarranty%',FORMAT("Within Warranty"));
        NotificationBody := NotificationBody.Replace('%WithMaintenanceServiceCaption%',FIELDCAPTION("With Maintenance Service"));
        NotificationBody := NotificationBody.Replace('%WithMaintenanceService%',FORMAT("With Maintenance Service"));
        NotificationBody := NotificationBody.Replace('%ExpiredWarrantyCaption%',FIELDCAPTION("Expired Warranty"));
        NotificationBody := NotificationBody.Replace('%ExpiredWarranty%',FORMAT("Expired Warranty"));
        NotificationBody := NotificationBody.Replace('%RemarksCaption%',FIELDCAPTION(Remarks));
        NotificationBody := NotificationBody.Replace('%Remarks%',StringConversionManagement.WindowsToASCII(Remarks));
        NotificationBody := NotificationBody.Replace('%RFENo%',"Exception Report No.");

        //Stripo Engineering Activities Checkbox
        IF "Clustering Mobilization" THEN
          NotificationBody := NotificationBody.Replace('%GCClusterMobilization%','checked');
        IF "Per Site Mobilization" THEN
          NotificationBody := NotificationBody.Replace('%GCPerSiteMobilization%','checked');
        IF "Supply Only" = "Supply Only"::Yes THEN
          NotificationBody := NotificationBody.Replace('%GCSupplyOnly%','checked');
        IF "Demo POC" THEN
          NotificationBody := NotificationBody.Replace('%GCDemoProofOfConcept%','checked');
        IF "w/ P.O" THEN
          NotificationBody := NotificationBody.Replace('%GCWithPurchaseOrder%','checked');
        IF "w/o P.O" THEN
          NotificationBody := NotificationBody.Replace('%GCWithoutPurchaseOrder%','checked');
        IF "Site Acquisition" THEN
          NotificationBody := NotificationBody.Replace('%EACSiteAcquisition%','checked');
        IF "Site Survey" THEN
          NotificationBody := NotificationBody.Replace('%EACSiteSurvey%','checked');
        IF "Approved MOA/MOU" THEN
          NotificationBody := NotificationBody.Replace('%EACApprovedMOA%','checked');
        IF "Approved RAAWA/Work Permit" THEN
          NotificationBody := NotificationBody.Replace('%EACApprovedRAAWA%','checked');
        IF "Floor Plans from Customer" THEN
          NotificationBody := NotificationBody.Replace('%EACFloorPlansFromCustomer%','checked');
        IF "Ctctd. Strctrd. Cblng Subcon" THEN
          NotificationBody := NotificationBody.Replace('%EACContactedStructuredCablingSubcon%','checked');
        IF Installation THEN
          NotificationBody := NotificationBody.Replace('%EACInstallation%','checked');
        IF "Approved BOQ" THEN
          NotificationBody := NotificationBody.Replace('%EACApprovedBOQ%','checked');
        IF "Approved HLD and TSSR Design" THEN
          NotificationBody := NotificationBody.Replace('%EACApprovedHDLAndTSSRDesign%','checked');
        IF "Approved Work Permit/RAAWA" THEN
          NotificationBody := NotificationBody.Replace('%EACApprovedWorkPermitRAAWA%','checked');
        IF "Signed Notice to Install" THEN
          NotificationBody := NotificationBody.Replace('%EACSignedNoticeToInstall%','checked');
        IF Troubleshooting THEN
          NotificationBody := NotificationBody.Replace('%EACTroubleshooting%','checked');
        IF Maintenance THEN
          NotificationBody := NotificationBody.Replace('%EACMaintenance%','checked');
        IF "Quality Audit/Trial/POC" THEN
          NotificationBody := NotificationBody.Replace('%EACQualityAuditTrialPOC%','checked');
        IF "Building Clearance" THEN
          NotificationBody := NotificationBody.Replace('%EACBuildingClearance%','checked');
        IF Commissioning THEN
          NotificationBody := NotificationBody.Replace('%EACCommissioning%','checked');
        IF "Delivery To Customers Whse." THEN
          NotificationBody := NotificationBody.Replace('%EACDeliveryToCustomerWarehouse%','checked');
        IF "Final Acceptance" THEN
          NotificationBody := NotificationBody.Replace('%EACFinalAcceptance%','checked');
        IF "Preliminary Acceptance" THEN
          NotificationBody := NotificationBody.Replace('%EACPreliminaryAcceptance%','checked');
        IF Testing THEN
          NotificationBody := NotificationBody.Replace('%EACTesting%','checked');
        IF Rectification THEN
          NotificationBody := NotificationBody.Replace('%EACRectification%','checked');
        IF "Shipment (Air Freight)" THEN
          NotificationBody := NotificationBody.Replace('%EACShipmentAirFreight%','checked');
        IF "Shipment (Sea Freight)" THEN
          NotificationBody := NotificationBody.Replace('%EACShipmentSeeFreight%','checked');
        IF "Q. Others Please Specify" THEN
          NotificationBody := NotificationBody.Replace('%EACQOthersPleaseSpecify%','checked');
        //StripO Attachments Checkbox
        IF "ATP/CTF" THEN
          NotificationBody := NotificationBody.Replace('%CPATP_CTF%','checked');
        IF "A. Notice To Proceed" THEN
          NotificationBody := NotificationBody.Replace('%CPANoticeToProceed%','checked');
        IF "A. P.O. From Client" THEN
          NotificationBody := NotificationBody.Replace('%CPAPOFromCustomer%','checked');
        IF "A. P.O. To Supplier" THEN
          NotificationBody := NotificationBody.Replace('%CPAPOToVendor%','checked');
        IF "Exception Report" THEN
          NotificationBody := NotificationBody.Replace('%CPAExceptionReport%','checked');
        IF "A. Signed Trial" THEN
          NotificationBody := NotificationBody.Replace('%CPASignedTrial%','checked');
        IF "A. Others Please Specify" THEN
          NotificationBody := NotificationBody.Replace('%CPAOthersPleaseSpecify%','checked');

        IF "A. Bill Of Materials" THEN
          NotificationBody := NotificationBody.Replace('%CPABillOfMaterials%','checked');
        IF "A. Allocated Budget" THEN
          NotificationBody := NotificationBody.Replace('%CPAAllocatedBudget%','checked');

        //StripO Warranty Checkbox
        IF "Within Warranty" THEN
          NotificationBody := NotificationBody.Replace('%CPWWithinWarranty%','checked');
        IF "Expired Warranty" THEN
          NotificationBody := NotificationBody.Replace('%CPWExpiredWarranty%','checked');
        IF "With Maintenance Service" THEN
          NotificationBody := NotificationBody.Replace('%CPWWithMaintenanceService%','checked');
        //StripO Concerned Personnel Checkbox
        IF "ACC-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCAccounting%','checked');
        IF "QAU-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCQualityAssurance%','checked');
        IF "CPE-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCDeviceManagement%','checked');
        IF "AUD-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCAuditDepartment%','checked');
        IF "SAL-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCSales%','checked');
        IF "ICT-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCInfoCommSystem%','checked');
        IF "INV-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCInventory%','checked');
        IF "PMO-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCProjectControl%','checked');
        IF "POW-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCPowerSystem%','checked');
        IF "LOG-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCLogistics%','checked');
        IF "TAU-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCTelecomAudit%','checked');
        IF "TRM-WRD Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCTransmissionWired%','checked');
        IF "OSP-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCOutsidePlantOSP%','checked');
        IF "WMU-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCWarehouseManagementUnit%','checked');
        IF "TRM-WRL Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCTransmissionWireless%','checked');
        IF "PMD-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCProjectManagement%','checked');
        IF "FIN-AP Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCFinanceAP%','checked');
        IF "WRL-A1 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCWirelessAccess1%','checked');
        IF "PUR-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCPurchasing%','checked');
        IF "FIN-AR Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCFinanceAR%','checked');
        IF "WRL-A2 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCWirelessAccess2%','checked');
        IF "RMS-DT Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCDocumentationTeam%','checked');
        IF "SCU-01 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCPassiveUnit%','checked');
        IF "HRD-00 Dept." THEN
          NotificationBody := NotificationBody.Replace('%CPCHumanResource%','checked');

        //Comments
        CALCFIELDS(Comments);
        IF Comments.HASVALUE THEN BEGIN
          Comments.CREATEINSTREAM(InStr);
          InStr.READ(CommentsText);
        END;
        NotificationBody := NotificationBody.Replace('%CommentsCaption%', FIELDCAPTION(Comments));
        NotificationBody := NotificationBody.Replace('%Comments%', StringConversionManagement.WindowsToASCII(Remarks));

        ReplaceTokenWithStripoRecordLink(NotificationBody, INTP.RECORDID);
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithLinkedINTPDetails@53(VAR NotificationBody@1004 : DotNet "'mscorlib'.System.String";INTPNo@1001 : Code[20]);
    VAR
      Field@1005 : Record 2000000041;
      FieldRef@1003 : FieldRef;
      FieldValue@1006 : Text;
      INTP@1000 : Record 50040;
    BEGIN
      IF INTP.GET(INTPNo) THEN BEGIN
        NotificationBody := NotificationBody.Replace('%INTPNoCaption%','INTP No.');
        NotificationBody := NotificationBody.Replace('%INTPNo%',INTP."No.");
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%',INTP.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjectName%',StringConversionManagement.WindowsToASCII(INTP."Project Name" + ' ' + INTP."Project Name 2"));
        NotificationBody := NotificationBody.Replace('%ProjNameCaption%',INTP.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjName%',StringConversionManagement.WindowsToASCII(INTP."Project Name" + ' ' + INTP."Project Name 2"));
        NotificationBody := NotificationBody.Replace('%PONoCaption%', INTP.FIELDCAPTION("P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%PONo%', StringConversionManagement.WindowsToASCII(INTP."P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%CustomerCaption%', INTP.FIELDCAPTION("Customer Name"));
        NotificationBody := NotificationBody.Replace('%Customer%', StringConversionManagement.WindowsToASCII(INTP."Customer No." + ' ' + INTP."Customer Name"));
      END ELSE BEGIN
        NotificationBody := NotificationBody.Replace('%INTPNoCaption%',INTP.FIELDCAPTION("No."));
        NotificationBody := NotificationBody.Replace('%INTPNo%','');
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%',INTP.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjectName%','');
        NotificationBody := NotificationBody.Replace('%PONoCaption%', INTP.FIELDCAPTION("P.O No. (Customer)"));
        NotificationBody := NotificationBody.Replace('%PONo%', '');
        NotificationBody := NotificationBody.Replace('%CustomerCaption%', INTP.FIELDCAPTION("Customer Name"));
        NotificationBody := NotificationBody.Replace('%Customer%', '');
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithUserDetails@32(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";VAR User@1000 : Record 2000000120);
    VAR
      UserProperty@1002 : Record 2000000121;
    BEGIN
      WITH User DO BEGIN
        UserProperty.GET(User."User Security ID");
        NotificationBody := NotificationBody.Replace('%UserID%', User."User Name");
        NotificationBody := NotificationBody.Replace('%Password%', UserProperty."NAV Password Log");
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithStripoRecordLink@20(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";RecID@1000 : RecordID);
    VAR
      RecordLink@1033 : Record 2000000068;
      StringConversionMgt@1032 : Codeunit 47;
      NoteText@1031 : Text;
      CommentBody@1030 : Text;
      TempStripoHTML@1029 : Text;
      StripoHTML@1028 : Text;
      StripoCommentBodyDotNet@1027 : DotNet "'mscorlib'.System.String";
    BEGIN
       RecordLink.SETRANGE("Record ID", RecID);
        IF RecordLink.FINDSET THEN BEGIN
          REPEAT
            StripoCommentBodyDotNet := StripoCommentBodyDotNet.Copy(StripoContentBody1 + StripoContentBody2 + StripoContentBody3);
            StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%UserID%', RecordLink."User ID");
            StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%Datetime%', FORMAT(RecordLink.Created));
            IF RecordLink.Type = RecordLink.Type::Note THEN BEGIN
              StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%StripoCommentDetails%',StripoRecordNote);
              RecordLink.CALCFIELDS(Note);
              IF RecordLink.Note.HASVALUE THEN BEGIN
                RecordLink.Note.CREATEINSTREAM(InStr);
                InStr.READ(NoteText);
                StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%RecordNote%', StringConversionMgt.WindowsToASCII(NoteText));
              END ELSE
                StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%RecordNote%', '');
            END ELSE BEGIN
              StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%StripoCommentDetails%',StripoRecordLink);
              StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%RecordLink%', RecordLink.URL1 + RecordLink.URL2 + RecordLink.URL3 + RecordLink.URL4);
              StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%RecordLinkText%', StringConversionMgt.WindowsToASCII(RecordLink.Description));
            END; ;
            TempStripoHTML += StripoCommentBodyDotNet.ToString;
          UNTIL RecordLink.NEXT = 0;
          StripoCommentBodyDotNet := StripoCommentBodyDotNet.Copy(StripoContentComment1 + StripoContentComment2 + StripoContentComment3);
          StripoCommentBodyDotNet := StripoCommentBodyDotNet.Replace('%StripoCommentPart%', TempStripoHTML);
          StripoHTML := StripoCommentBodyDotNet.ToString;
          NotificationBody := NotificationBody.Replace('%StripoRecordLink%', StripoHTML);
        END;
       NotificationBody := NotificationBody.Replace('%StripoRecordLink%', '');
    END;

    LOCAL PROCEDURE ReplaceTokenWithVendorDetails@23(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";Vendor@1000 : Record 23);
    BEGIN
      WITH Vendor DO BEGIN
        NotificationBody := NotificationBody.Replace('%CurrencyCode%','');
        NotificationBody := NotificationBody.Replace('%AddressCaption%',FIELDCAPTION(Address));
        NotificationBody := NotificationBody.Replace('%Address%',StringConversionManagement.WindowsToASCII(Address + ' ' + "Address 2"));
        NotificationBody := NotificationBody.Replace('%PhoneNoCaption%',FIELDCAPTION("Phone No."));
        NotificationBody := NotificationBody.Replace('%PhoneNo%',"Phone No.");
        NotificationBody := NotificationBody.Replace('%PrimaryContactCaption%',FIELDCAPTION("Primary Contact No."));
        NotificationBody := NotificationBody.Replace('%PrimaryContact%',"Primary Contact No." + ' ' + Contact);
        NotificationBody := NotificationBody.Replace('%EmailCaption%',FIELDCAPTION("E-Mail"));
        NotificationBody := NotificationBody.Replace('%Email%',"E-Mail");
        NotificationBody := NotificationBody.Replace('%HomePageCaption%',FIELDCAPTION("Home Page"));
        NotificationBody := NotificationBody.Replace('%HomePage%',"Home Page");
        NotificationBody := NotificationBody.Replace('%VatRegistrationNoCaption%',FIELDCAPTION("VAT Registration No."));
        NotificationBody := NotificationBody.Replace('%VatRegistrationNo%',"VAT Registration No.");
        NotificationBody := NotificationBody.Replace('%CustomerPostingGroupCaption%',FIELDCAPTION("Vendor Posting Group"));
        NotificationBody := NotificationBody.Replace('%CustomerPostingGroup%',"Vendor Posting Group");
        NotificationBody := NotificationBody.Replace('%PartnerTypeCaption%',FIELDCAPTION("Partner Type"));
        NotificationBody := NotificationBody.Replace('%PartnerType%',FORMAT("Partner Type"));
        NotificationBody := NotificationBody.Replace('%GenBusPostingGroupCaption%',FIELDCAPTION("Gen. Bus. Posting Group"));
        NotificationBody := NotificationBody.Replace('%GenBusPostingGroup%',"Gen. Bus. Posting Group");
        NotificationBody := NotificationBody.Replace('%VatBusPostingGroupCaption%',FIELDCAPTION("VAT Bus. Posting Group"));
        NotificationBody := NotificationBody.Replace('%VatBusPostingGroup%',"VAT Bus. Posting Group");
        NotificationBody := NotificationBody.Replace('%VendorPostingGroupCaption%',FIELDCAPTION("Vendor Posting Group"));
        NotificationBody := NotificationBody.Replace('%VendorPostingGroup%',FORMAT("Vendor Posting Group"));
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithJobOrderDetails@21(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";JobOrder@1000 : Record 50012);
    VAR
      Employee@1002 : Record 5200;
      Customer@1003 : Record 18;
      Contact@1004 : Record 5050;
      Resource@1005 : Record 156;
      UserGroup@1006 : Record 9000;
    BEGIN
      WITH JobOrder DO BEGIN
        ReplaceTokenWithLinkedINTPDetails(NotificationBody, JobOrder."INTP No.");

        // Headers
        NotificationBody := NotificationBody.Replace('%NoCaption%', JobOrder.FIELDCAPTION("No."));
        NotificationBody := NotificationBody.Replace('%No.%', FORMAT(JobOrder."No."));
        NotificationBody := NotificationBody.Replace('%JobTypeCaption%', JobOrder.FIELDCAPTION("Job Type"));
        NotificationBody := NotificationBody.Replace('%JobType%', FORMAT(JobOrder."Job Type"));
        NotificationBody := NotificationBody.Replace('%ReqForExceptionNoCaption%', JobOrder.FIELDCAPTION("Request for Exception No."));
        NotificationBody := NotificationBody.Replace('%RequestForExceptionNo%', FORMAT(JobOrder."Request for Exception No."));
        NotificationBody := NotificationBody.Replace('%INTPNoCaption%', JobOrder.FIELDCAPTION("INTP No."));
        NotificationBody := NotificationBody.Replace('%INTPNo%', FORMAT(JobOrder."INTP No."));
        NotificationBody := NotificationBody.Replace('%ProjectNameCaption%', JobOrder.FIELDCAPTION("Project Name"));
        NotificationBody := NotificationBody.Replace('%ProjectName%', StringConversionManagement.WindowsToASCII(JobOrder."Project Name" + ' ' + JobOrder."Project Name 2"));

        NotificationBody := NotificationBody.Replace('%EmployeeNameCaption%', 'Employee Name');
        IF Employee.GET(JobOrder."Employee No.") THEN
          NotificationBody := NotificationBody.Replace('%EmployeeName%', StringConversionManagement.WindowsToASCII(Employee."No." + ' ' + Employee.FullName))
        ELSE
          NotificationBody := NotificationBody.Replace('%EmployeeName%', '');

        NotificationBody := NotificationBody.Replace('%DepartmentCaption%', 'Department');
        IF UserGroup.GET(JobOrder."Department Code") THEN
          NotificationBody := NotificationBody.Replace('%Department%', StringConversionManagement.WindowsToASCII(UserGroup.Code + ' ' + UserGroup.Name))
        ELSE
          NotificationBody := NotificationBody.Replace('%Department%', '');

        NotificationBody := NotificationBody.Replace('%GroundManagerCaption%', 'Ground Manager');
        IF Resource.GET(JobOrder."Ground Manager No.") THEN
          NotificationBody := NotificationBody.Replace('%GroundManager%', StringConversionManagement.WindowsToASCII(Resource."No." + ' ' + Resource.Name))
        ELSE
          NotificationBody := NotificationBody.Replace('%GroundManager%', '');

        NotificationBody := NotificationBody.Replace('%ProjectManagerCaption%', 'Project Manager');
        IF Resource.GET(JobOrder."Ground Manager No.") THEN
          NotificationBody := NotificationBody.Replace('%ProjectManager%', StringConversionManagement.WindowsToASCII(Resource."No." + ' ' + Resource.Name))
        ELSE
          NotificationBody := NotificationBody.Replace('%ProjectManager%', '');

        NotificationBody := NotificationBody.Replace('%CustomerNameCaption%', 'Customer Name');
        IF Customer.GET(JobOrder."Customer No.") THEN
          NotificationBody := NotificationBody.Replace('%CustomerName%', StringConversionManagement.WindowsToASCII(Customer."No." + ' ' + Customer.Name + ' ' + Customer."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%CustomerName%', '');

        NotificationBody := NotificationBody.Replace('%PurchaseOrderNoCaption%', JobOrder.FIELDCAPTION("P.O No."));
        NotificationBody := NotificationBody.Replace('%PurchaseOrderNo%', FORMAT(JobOrder."P.O No."));
        NotificationBody := NotificationBody.Replace('%RemarksCaption%', JobOrder.FIELDCAPTION(Remarks));
        NotificationBody := NotificationBody.Replace('%Remarks%', StringConversionManagement.WindowsToASCII(JobOrder.Remarks));
        NotificationBody := NotificationBody.Replace('%StatusCaption%', JobOrder.FIELDCAPTION(Status));
        NotificationBody := NotificationBody.Replace('%Status%', FORMAT(JobOrder.Status));
        NotificationBody := NotificationBody.Replace('%DateRequestedCaption%', JobOrder.FIELDCAPTION("Date Requested"));
        NotificationBody := NotificationBody.Replace('%DateRequested%', FORMAT(JobOrder."Date Requested"));

        // Meeting
        NotificationBody := NotificationBody.Replace('%MeetingCaption%', JobOrder.FIELDCAPTION(Meeting));
        NotificationBody := NotificationBody.Replace('%Meeting%', ReplaceTokenToChecked(JobOrder.Meeting));
        NotificationBody := NotificationBody.Replace('%MeetingEmailSMSConfirmationCaption%', JobOrder.FIELDCAPTION("Meeting Email/SMS Conf."));
        NotificationBody := NotificationBody.Replace('%MeetingEmailSMSConfirmation%', ReplaceTokenToChecked(JobOrder."Meeting Email/SMS Conf."));

        // Product Presentation
        NotificationBody := NotificationBody.Replace('%ProdPresentationCaption%', JobOrder.FIELDCAPTION("Product Presentation"));
        NotificationBody := NotificationBody.Replace('%ProdPresentation%', ReplaceTokenToChecked(JobOrder."Product Presentation"));
        NotificationBody := NotificationBody.Replace('%ProdPresentationEmailSMSCaption%', JobOrder.FIELDCAPTION("Prod. Prstn. Email/SMS Conf."));
        NotificationBody := NotificationBody.Replace('%ProdPresentationEmailSMS%', ReplaceTokenToChecked(JobOrder."Prod. Prstn. Email/SMS Conf."));

        // Onsite Audit
        NotificationBody := NotificationBody.Replace('%OnsiteAuditCaption%', JobOrder.FIELDCAPTION("On-Site Audit"));
        NotificationBody := NotificationBody.Replace('%OnsiteAudit%', ReplaceTokenToChecked(JobOrder."On-Site Audit"));
        NotificationBody := NotificationBody.Replace('%AuditChecklistCaption%', JobOrder.FIELDCAPTION("Audit Checklist"));
        NotificationBody := NotificationBody.Replace('%AuditChecklist%', ReplaceTokenToChecked(JobOrder."Audit Checklist"));

        // Trial/POC
        NotificationBody := NotificationBody.Replace('%TrialPOCCaption%', JobOrder.FIELDCAPTION("Trial/POC"));
        NotificationBody := NotificationBody.Replace('%TrialPOC%', ReplaceTokenToChecked(JobOrder."Trial/POC"));
        NotificationBody := NotificationBody.Replace('%APCTFormCaption%', JobOrder.FIELDCAPTION("APCT Form"));
        NotificationBody := NotificationBody.Replace('%APCTForm%', ReplaceTokenToChecked(JobOrder."APCT Form"));
        NotificationBody := NotificationBody.Replace('%RFEFormCaption%', JobOrder.FIELDCAPTION("RFE Form"));
        NotificationBody := NotificationBody.Replace('%RFEForm%', ReplaceTokenToChecked(JobOrder."RFE Form"));

        // Site Survey
        NotificationBody := NotificationBody.Replace('%SiteSurveyCaption%', JobOrder.FIELDCAPTION("Site Survey"));
        NotificationBody := NotificationBody.Replace('%SiteSurvey%', ReplaceTokenToChecked(JobOrder."Site Survey"));
        NotificationBody := NotificationBody.Replace('%SiteSurveyRTPSCaption%', JobOrder.FIELDCAPTION("RTPS No."));
        NotificationBody := NotificationBody.Replace('%SiteSurveyRTPS%', FORMAT(JobOrder."RTPS No."));

        IF JobOrder."RTPS No." <> '' THEN
          NotificationBody := NotificationBody.Replace('%SiteSurveyRTPSCheckbox%', 'checked')
        ELSE
          NotificationBody := NotificationBody.Replace('%SiteSurveyRTPSCheckbox%', '');

        NotificationBody := NotificationBody.Replace('%SiteSurveySRNFormCaption%', JobOrder.FIELDCAPTION("Site Srvy. SR Form"));
        NotificationBody := NotificationBody.Replace('%SiteSurveySRNForm%', ReplaceTokenToChecked(JobOrder."Site Srvy. SR Form"));
        NotificationBody := NotificationBody.Replace('%SiteSurveySRNCaption%', JobOrder.FIELDCAPTION("Site Srvy. SR No."));
        NotificationBody := NotificationBody.Replace('%SiteSurveySRN%', StringConversionManagement.WindowsToASCII(JobOrder."Site Srvy. SR No."));

        // Permitting
        NotificationBody := NotificationBody.Replace('%PermittingCaption%', JobOrder.FIELDCAPTION(Permitting));
        NotificationBody := NotificationBody.Replace('%Permitting%', ReplaceTokenToChecked(JobOrder.Permitting));
        NotificationBody := NotificationBody.Replace('%PrmtgTimelineOfROWCaption%', JobOrder.FIELDCAPTION("Prmtg. Timeline of ROW"));
        NotificationBody := NotificationBody.Replace('%PrmtgTimelineOfROW%', ReplaceTokenToChecked(JobOrder."Prmtg. Timeline of ROW"));
        NotificationBody := NotificationBody.Replace('%PrmtgAFICaption%', JobOrder.FIELDCAPTION("Prmtg. AFI"));
        NotificationBody := NotificationBody.Replace('%PrmtgAFI%', ReplaceTokenToChecked(JobOrder."Prmtg. AFI"));
        NotificationBody := NotificationBody.Replace('%PermittingSRNoCaption%', JobOrder.FIELDCAPTION("Service Report No."));
        NotificationBody := NotificationBody.Replace('%PermittingSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."Service Report No."));

        // Installation and Commissioning
        NotificationBody := NotificationBody.Replace('%InsAndCommCaption%', JobOrder.FIELDCAPTION("Installation and Commissioning"));
        NotificationBody := NotificationBody.Replace('%InsAndComm%', ReplaceTokenToChecked(JobOrder."Installation and Commissioning"));
        NotificationBody := NotificationBody.Replace('%InsCommRFEFormCaption%', JobOrder.FIELDCAPTION("InsComm. RFE Form"));
        NotificationBody := NotificationBody.Replace('%InsCommRFEForm%', ReplaceTokenToChecked(JobOrder."InsComm. RFE Form"));
        NotificationBody := NotificationBody.Replace('%InsAndCommSRNoCaption%', JobOrder.FIELDCAPTION("InsComm. SR No."));
        NotificationBody := NotificationBody.Replace('%InsAndCommSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."InsComm. SR No."));
        NotificationBody := NotificationBody.Replace('%InsCommAFICaption%', JobOrder.FIELDCAPTION("InsComm. AFI"));
        NotificationBody := NotificationBody.Replace('%InsCommAFI%', ReplaceTokenToChecked(JobOrder."InsComm. AFI"));
        NotificationBody := NotificationBody.Replace('%InsCommLineOfSightCaption%', JobOrder.FIELDCAPTION("InsComm. Line of Sight"));
        NotificationBody := NotificationBody.Replace('%InsCommLineOfSight%', ReplaceTokenToChecked(JobOrder."InsComm. Line of Sight"));
        NotificationBody := NotificationBody.Replace('%InsCommNonLineOfSightCaption%', JobOrder.FIELDCAPTION("InsComm. Non-Line of Sight"));
        NotificationBody := NotificationBody.Replace('%InsCommNonLineOfSight%', ReplaceTokenToChecked(JobOrder."InsComm. Non-Line of Sight"));
        NotificationBody := NotificationBody.Replace('%InsCommPermittingCaption%', JobOrder.FIELDCAPTION("InsComm. Permitting"));
        NotificationBody := NotificationBody.Replace('%InsCommPermitting%', ReplaceTokenToChecked(JobOrder."InsComm. Permitting"));
        NotificationBody := NotificationBody.Replace('%InsCommTrafficCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. Traffic"));
        NotificationBody := NotificationBody.Replace('%InsCommTraffic%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. Traffic"));
        NotificationBody := NotificationBody.Replace('%InsCommMMDACaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. MMDA"));
        NotificationBody := NotificationBody.Replace('%InsCommMMDA%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. MMDA"));
        NotificationBody := NotificationBody.Replace('%InsCommRAAWACaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. RAAWA"));
        NotificationBody := NotificationBody.Replace('%InsCommRAAWA%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. RAAWA"));
        NotificationBody := NotificationBody.Replace('%InsCommLGUCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. LGU Permit"));
        NotificationBody := NotificationBody.Replace('%InsCommLGU%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. LGU Permit"));
        NotificationBody := NotificationBody.Replace('%InsCommBuildingCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. Bldg. Permit"));
        NotificationBody := NotificationBody.Replace('%InsCommBuilding%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. Bldg. Permit"));
        NotificationBody := NotificationBody.Replace('%InsCommBarangayCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. Brgy. Permit"));
        NotificationBody := NotificationBody.Replace('%InsCommBarangay%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. Brgy. Permit"));
        NotificationBody := NotificationBody.Replace('%InsCommDPWHCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. DPWH"));
        NotificationBody := NotificationBody.Replace('%InsCommDPWH%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. DPWH"));
        NotificationBody := NotificationBody.Replace('%InsCommServiceOrderCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. SO"));
        NotificationBody := NotificationBody.Replace('%InsCommServiceOrder%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. SO"));
        NotificationBody := NotificationBody.Replace('%InsCommAccessLetterCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. ALP"));
        NotificationBody := NotificationBody.Replace('%InsCommAccessLetter%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. ALP"));
        NotificationBody := NotificationBody.Replace('%InsCommALOCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. ALO"));
        NotificationBody := NotificationBody.Replace('%InsCommALO%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. ALO"));
        NotificationBody := NotificationBody.Replace('%InsCommFIOCaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. FIO"));
        NotificationBody := NotificationBody.Replace('%InsCommFIO%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. FIO"));
        NotificationBody := NotificationBody.Replace('%InsCommHOACaption%', JobOrder.FIELDCAPTION("InsComm. Prmt. HOA"));
        NotificationBody := NotificationBody.Replace('%InsCommHOA%', ReplaceTokenToChecked(JobOrder."InsComm. Prmt. HOA"));
        NotificationBody := NotificationBody.Replace('%InsCommOthersCaption%', JobOrder.FIELDCAPTION("InsComm. Others"));

        IF JobOrder."InsComm. Others" <> '' THEN
          NotificationBody := NotificationBody.Replace('%InsCommOthersCheckbox%', 'checked')
        ELSE
          NotificationBody := NotificationBody.Replace('%InsCommOthersCheckbox%', '');

        NotificationBody := NotificationBody.Replace('%InsCommOthers%', FORMAT(JobOrder."InsComm. Others"));

        // Testing
        NotificationBody := NotificationBody.Replace('%TestingCaption%', JobOrder.FIELDCAPTION(Testing));
        NotificationBody := NotificationBody.Replace('%Testing%', ReplaceTokenToChecked(JobOrder.Testing));
        NotificationBody := NotificationBody.Replace('%TestingSRNFormCaption%', JobOrder.FIELDCAPTION("Testing SR Form"));
        NotificationBody := NotificationBody.Replace('%TestingSRNForm%', ReplaceTokenToChecked(JobOrder."Testing SR Form"));
        NotificationBody := NotificationBody.Replace('%TestingSRNoCaption%', JobOrder.FIELDCAPTION("Testing SR No."));
        NotificationBody := NotificationBody.Replace('%TestingSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."Testing SR No."));
        NotificationBody := NotificationBody.Replace('%TestingTestProceduresCaption%', JobOrder.FIELDCAPTION("Testing Test Procedures"));
        NotificationBody := NotificationBody.Replace('%TestingTestProcedures%', ReplaceTokenToChecked(JobOrder."Testing Test Procedures"));

        // Preliminary Acceptance
        NotificationBody := NotificationBody.Replace('%PreAcceptanceCaption%', JobOrder.FIELDCAPTION("Preliminary Acceptance"));
        NotificationBody := NotificationBody.Replace('%PreAcceptance%', ReplaceTokenToChecked(JobOrder."Preliminary Acceptance"));
        NotificationBody := NotificationBody.Replace('%PreAcceptanceSNRFormCaption%', JobOrder.FIELDCAPTION("Pre-Accpt. SR Form"));
        NotificationBody := NotificationBody.Replace('%PreAcceptanceSNRForm%', ReplaceTokenToChecked(JobOrder."Pre-Accpt. SR Form"));
        NotificationBody := NotificationBody.Replace('%PreAcceptanceSRNoCaption%', JobOrder.FIELDCAPTION("Pre-Accpt. SR No."));
        NotificationBody := NotificationBody.Replace('%PreAcceptanceSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."Pre-Accpt. SR No."));
        NotificationBody := NotificationBody.Replace('%PreAcceptanceSchedByCustomerCaption%', JobOrder.FIELDCAPTION("Pre-Accpt. Sched. by Customer"));
        NotificationBody := NotificationBody.Replace('%PreAcceptanceSchedByCustomer%', ReplaceTokenToChecked(JobOrder."Pre-Accpt. Sched. by Customer"));

        // Final Acceptance
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceCaption%', JobOrder.FIELDCAPTION("Final Acceptance"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptance%', ReplaceTokenToChecked(JobOrder."Final Acceptance"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceSNRFormCaption%', JobOrder.FIELDCAPTION("Fnl. Accpt. SR Form"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceSNRForm%', ReplaceTokenToChecked(JobOrder."Fnl. Accpt. SR Form"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceSRNoCaption%', JobOrder.FIELDCAPTION("Fnl. Accpt. SR No."));
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."Fnl. Accpt. SR No."));
        NotificationBody := NotificationBody.Replace('%FinalAcceptancePACCaption%', JobOrder.FIELDCAPTION("Fnl. Accpt. PAC"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptancePAC%', ReplaceTokenToChecked(JobOrder."Fnl. Accpt. PAC"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceSchedByCustCaption%', JobOrder.FIELDCAPTION("Fnl. Accpt. Schd. by Cust."));
        NotificationBody := NotificationBody.Replace('%FinalAcceptanceSchedByCust%', ReplaceTokenToChecked(JobOrder."Fnl. Accpt. Schd. by Cust."));
        NotificationBody := NotificationBody.Replace('%FinalAcceptancePunchReportCaption%', JobOrder.FIELDCAPTION("Fnl. Accpt. Punchlist Report"));
        NotificationBody := NotificationBody.Replace('%FinalAcceptancePunchReport%', ReplaceTokenToChecked(JobOrder."Fnl. Accpt. Punchlist Report"));

        // Rectification
        NotificationBody := NotificationBody.Replace('%RectificationCaption%', JobOrder.FIELDCAPTION(Rectification));
        NotificationBody := NotificationBody.Replace('%Rectification%', ReplaceTokenToChecked(JobOrder.Rectification));
        NotificationBody := NotificationBody.Replace('%RectificationSRNFormCaption%', JobOrder.FIELDCAPTION("Rectification SR Form"));
        NotificationBody := NotificationBody.Replace('%RectificationSRNForm%', ReplaceTokenToChecked(JobOrder."Rectification SR Form"));
        NotificationBody := NotificationBody.Replace('%RectificationSRNoCaption%', JobOrder.FIELDCAPTION("Rectification SR No."));
        NotificationBody := NotificationBody.Replace('%RectificationSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."Rectification SR No."));
        NotificationBody := NotificationBody.Replace('%RectificationPunchReportCaption%', JobOrder.FIELDCAPTION("Rectification Punchlist Report"));
        NotificationBody := NotificationBody.Replace('%RectificationPunchReport%', ReplaceTokenToChecked(JobOrder."Rectification Punchlist Report"));

        // Troubleshooting
        NotificationBody := NotificationBody.Replace('%TroubleshootingCaption%', JobOrder.FIELDCAPTION(Troubleshooting));
        NotificationBody := NotificationBody.Replace('%Troubleshooting%',ReplaceTokenToChecked(JobOrder.Troubleshooting));
        NotificationBody := NotificationBody.Replace('%TroubleshootingSRNFormCaption%', JobOrder.FIELDCAPTION("Trbltng. SR Form"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingSRNForm%',ReplaceTokenToChecked(JobOrder."Trbltng. SR Form"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingSRNoCaption%', JobOrder.FIELDCAPTION("Trbltng. SR No."));
        NotificationBody := NotificationBody.Replace('%TroubleshootingSRNo%', StringConversionManagement.WindowsToASCII(JobOrder."Trbltng. SR No."));
        NotificationBody := NotificationBody.Replace('%TroubleshootingNCCFNoCaption%', JobOrder.FIELDCAPTION("Trbltng. NCCF No."));
        NotificationBody := NotificationBody.Replace('%TroubleshootingNCCFNo%', StringConversionManagement.WindowsToASCII(JobOrder."Trbltng. NCCF No."));
        IF JobOrder."Trbltng. NCCF No." <> '' THEN
          NotificationBody := NotificationBody.Replace('%TroubleshootingNCCFCheckbox%', 'checked')
        ELSE
          NotificationBody := NotificationBody.Replace('%TroubleshootingNCCFCheckbox%', '');

        NotificationBody := NotificationBody.Replace('%TroubleshootingUnderWarrantyCaption%', JobOrder.FIELDCAPTION("Trbltng. Under Warranty"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingUnderWarranty%',ReplaceTokenToChecked(JobOrder."Trbltng. Under Warranty"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingDeliveryRcptDateCaption%', JobOrder.FIELDCAPTION("Trbltng. DR Date"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingDeliveryRcptDate%',FORMAT(JobOrder."Trbltng. DR Date"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingAcceptDateCaption%', JobOrder.FIELDCAPTION("Trbltng. Date of Acceptance"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingAcceptDate%',FORMAT(JobOrder."Trbltng. Date of Acceptance"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingOutOfWarrantyCaption%', JobOrder.FIELDCAPTION("Trbltng. Out of Warranty"));
        NotificationBody := NotificationBody.Replace('%TroubleshootingOutOfWarranty%',ReplaceTokenToChecked(JobOrder."Trbltng. Out of Warranty"));

        // Special Project of CEO
        NotificationBody := NotificationBody.Replace('%SpecialProjectOfCEOCaption%', JobOrder.FIELDCAPTION("Special Project of CEO"));
        NotificationBody := NotificationBody.Replace('%SpecialProjectOfCEO%',ReplaceTokenToChecked(JobOrder."Special Project of CEO"));

        // Activity
        NotificationBody := NotificationBody.Replace('%ActivityCaption%', JobOrder.FIELDCAPTION(Activity));
        NotificationBody := NotificationBody.Replace('%Activity%', StringConversionManagement.WindowsToASCII(JobOrder.Activity));

        // Vehicle Request
        StripoEmailTemplate.ReplaceTokenWithJOVehicleRequest(NotificationBody, JobOrder);

        // Public Transportation Request
        StripoEmailTemplate.ReplaceTokenWithJOPublicTranspoRequest(NotificationBody, JobOrder);

        // Airplane Ticket Request
        StripoEmailTemplate.ReplaceTokenWithJOAirplaneTicketRequest(NotificationBody, JobOrder);

        // Remarks/Notes
        StripoEmailTemplate.ReplaceTokenWithRemarksNotes(NotificationBody, JobOrder.RECORDID);

        // Approval/Comment
        StripoEmailTemplate.ReplaceTokenWithApprovalComments(NotificationBody, JobOrder.RECORDID);

        // Approval Entries
        StripoEmailTemplate.ReplaceTokenWithStripoApprovalEntry(NotificationBody, JobOrder.RECORDID);
      END;
    END;

    LOCAL PROCEDURE ReplaceTokenWithRFQDetails@17(VAR NotificationBody@1001 : DotNet "'mscorlib'.System.String";RFQ@1000 : Record 50013);
    VAR
      Employee@1002 : Record 5200;
      Customer@1003 : Record 18;
      Contact@1004 : Record 5050;
      Resource@1005 : Record 156;
    BEGIN
      WITH RFQ DO BEGIN
        NotificationBody := NotificationBody.Replace('%QuotationTypeCaption%', RFQ.FIELDCAPTION("Quotation Type"));
        NotificationBody := NotificationBody.Replace('%QuotationType%', FORMAT(RFQ."Quotation Type"));
        NotificationBody := NotificationBody.Replace('%PurposeCaption%', RFQ.FIELDCAPTION(Purpose));
        NotificationBody := NotificationBody.Replace('%Purpose%', FORMAT(RFQ.Purpose));
        NotificationBody := NotificationBody.Replace('%RequestedByCaption%', RFQ.FIELDCAPTION("Requested By"));
        IF Employee.GET(RFQ."Requested By") THEN
          NotificationBody := NotificationBody.Replace('%RequestedBy%', StringConversionManagement.WindowsToASCII(RFQ."Requested By" + ' ' + Employee.FullName))
        ELSE
          NotificationBody := NotificationBody.Replace('%RequestedBy%', '');
        NotificationBody := NotificationBody.Replace('%CustomerNameCaption%', 'Customer Name');
        IF Customer.GET(RFQ."Customer No.") THEN
          NotificationBody := NotificationBody.Replace('%CustomerName%',RFQ."Customer No." + ' ' + Customer.Name + ' ' + Customer."Name 2")
        ELSE
          NotificationBody := NotificationBody.Replace('%CustomerName%', '');
        NotificationBody := NotificationBody.Replace('%DateCreatedCaption%','Date Created');
        NotificationBody := NotificationBody.Replace('%DateCreated%',FORMAT(RFQ."Date Created",0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%TimeCreatedCaption%','Time Created');
        NotificationBody := NotificationBody.Replace('%TimeCreated%',FORMAT(RFQ."Time Created"));
        NotificationBody := NotificationBody.Replace('%DocumentDateCaption%',RFQ.FIELDCAPTION("Document Date"));
        NotificationBody := NotificationBody.Replace('%DocumentDate%', FORMAT(RFQ."Document Date",0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%StatusCaption%', RFQ.FIELDCAPTION(Status));
        NotificationBody := NotificationBody.Replace('%Status%', FORMAT(RFQ.Status));
        NotificationBody := NotificationBody.Replace('%ContactNameCaption%', 'Contact Name');
        IF Contact.GET(RFQ."Addressee No.") THEN
          NotificationBody := NotificationBody.Replace('%ContactName%', RFQ."Addressee No." + ' ' + Contact.Name + ' ' + Contact."Name 2")
        ELSE
          NotificationBody := NotificationBody.Replace('%ContactName%', '');
        NotificationBody := NotificationBody.Replace('%ContactDesignationCaption%', 'Contact Designation');
        IF Contact.GET(RFQ."Addressee No.") THEN
          NotificationBody := NotificationBody.Replace('%ContactDesignation%',StringConversionManagement.WindowsToASCII(Contact."Job Title"))
        ELSE
          NotificationBody := NotificationBody.Replace('%ContactDesignation%', '');
        NotificationBody := NotificationBody.Replace('%ContactEmailCaption%', 'Contact Email');
        IF Contact.GET(RFQ."Addressee No.") THEN
          NotificationBody := NotificationBody.Replace('%ContactEmail%',StringConversionManagement.WindowsToASCII(Contact."E-Mail"))
        ELSE
          NotificationBody := NotificationBody.Replace('%ContactEmail%', '');
        NotificationBody := NotificationBody.Replace('%BudgetCaption%', RFQ.FIELDCAPTION(Budget));
        NotificationBody := NotificationBody.Replace('%Budget%', FORMAT(RFQ.Budget,0,'<Precision,2:2><Sign><Integer Thousand><1000Character,,><Decimals><Comma,.>'));
        NotificationBody := NotificationBody.Replace('%CostAnalystNameCaption%', RFQ.FIELDCAPTION("Cost Analyst No."));
        IF Resource.GET(RFQ."Cost Analyst No.") THEN
          NotificationBody := NotificationBody.Replace('%CostAnalystName%', StringConversionManagement.WindowsToASCII(RFQ."Cost Analyst No." + ' ' + Resource.Name + ' ' + Resource."Name 2"))
        ELSE
          NotificationBody := NotificationBody.Replace('%CostAnalystName%', '');
        NotificationBody := NotificationBody.Replace('%RelatedRFQNoCaption%', RFQ.FIELDCAPTION("Related RFQ No."));
        NotificationBody := NotificationBody.Replace('%RelatedRFQNo%', FORMAT(RFQ."Related RFQ No."));
        NotificationBody := NotificationBody.Replace('%CompletedDateCaption%', RFQ.FIELDCAPTION("Completed Date"));
        NotificationBody := NotificationBody.Replace('%CompletedDate%', FORMAT(RFQ."Completed Date"));
        NotificationBody := NotificationBody.Replace('%CompletedByCaption%', RFQ.FIELDCAPTION("Completed By"));
        NotificationBody := NotificationBody.Replace('%CompletedBy%', RFQ."Completed By");
        NotificationBody := NotificationBody.Replace('%PersonInchargeNameCaption%', RFQ.FIELDCAPTION("Cost Analyst No."));
        IF Resource.GET(RFQ."Technical Lead No.") THEN
          NotificationBody := NotificationBody.Replace('%PersonInchargeName%', STRSUBSTNO(RFQ."Technical Lead No." + ' ' + FORMAT(Resource.Name) + ' ' + FORMAT(Resource."Name 2")))
        ELSE
          NotificationBody := NotificationBody.Replace('%PersonInchargeName%', '');
        NotificationBody := NotificationBody.Replace('%TechnologyHouseCaption%', RFQ.FIELDCAPTION("Technology House"));
        NotificationBody := NotificationBody.Replace('%TechnologyHouse%', StringConversionManagement.WindowsToASCII(RFQ."Technology House"));
        NotificationBody := NotificationBody.Replace('%IsEqpmntTypeApprovedByClientCaption%', RFQ.FIELDCAPTION("Client Type Approve"));
        NotificationBody := NotificationBody.Replace('%IsEqpmntTypeApprovedByClient%', FORMAT(RFQ."Client Type Approve"));
        NotificationBody := NotificationBody.Replace('%DoesItReqNTCTypeApprovalCaption%', RFQ.FIELDCAPTION("NTC Type Approval"));
        NotificationBody := NotificationBody.Replace('%DoesItReqNTCTypeApproval%', FORMAT(RFQ."NTC Type Approval"));
        NotificationBody := NotificationBody.Replace('%IsEqpmntFreqRelCaption%',RFQ.FIELDCAPTION("Equipment Freq. Related"));
        NotificationBody := NotificationBody.Replace('%IsEqpmntFreqRel%', FORMAT(RFQ."Equipment Freq. Related"));
        NotificationBody := NotificationBody.Replace('%PermitToImportCaption%', RFQ.FIELDCAPTION("Permit To Import"));
        NotificationBody := NotificationBody.Replace('%PermitToImport%', FORMAT(RFQ."Permit To Import"));
        NotificationBody := NotificationBody.Replace('%PermitToPurchaseCaption%', RFQ.FIELDCAPTION("Permit To Purchase"));
        NotificationBody := NotificationBody.Replace('%PermitToPurchase%', FORMAT(RFQ."Permit To Purchase"));
        NotificationBody := NotificationBody.Replace('%PermitToPossessCaption%', RFQ.FIELDCAPTION("Permit To Possess"));
        NotificationBody := NotificationBody.Replace('%PermitToPossess%', FORMAT(RFQ."Permit To Possess"));
        NotificationBody := NotificationBody.Replace('%ConstructionPermitCaption%', RFQ.FIELDCAPTION("Construction Permit"));
        NotificationBody := NotificationBody.Replace('%ConstructionPermit%', FORMAT(RFQ."Construction Permit"));
        NotificationBody := NotificationBody.Replace('%RadioStationLicenseCaption%', RFQ.FIELDCAPTION("Radio Station License"));
        NotificationBody := NotificationBody.Replace('%RadioStationLicense%', FORMAT(RFQ."Radio Station License"));
        NotificationBody := NotificationBody.Replace('%OthersCaption%', RFQ.FIELDCAPTION("ASD Others"));
        IF Others = '' THEN
        NotificationBody := NotificationBody.Replace('%Others%','&nbsp');

        NotificationBody := NotificationBody.Replace('%Others%', FORMAT(RFQ.Others));
        NotificationBody := NotificationBody.Replace('%RepeatOrderCaption%', RFQ.FIELDCAPTION("Repeat Order"));
        NotificationBody := NotificationBody.Replace('%RepeatOrder%', FORMAT(RFQ."Repeat Order"));
        NotificationBody := NotificationBody.Replace('%EquipmentCaption%', RFQ.FIELDCAPTION("QTP Equipment"));
        NotificationBody := NotificationBody.Replace('%Equipment%', StringConversionManagement.WindowsToASCII((RFQ."QTP Equipment")));
        NotificationBody := NotificationBody.Replace('%ServicesCaption%', RFQ.FIELDCAPTION("QTP Services"));
        NotificationBody := NotificationBody.Replace('%Services%', StringConversionManagement.WindowsToASCII((RFQ."QTP Services")));
        NotificationBody := NotificationBody.Replace('%Competitor1Caption%', RFQ.FIELDCAPTION("Competitor 1"));
        NotificationBody := NotificationBody.Replace('%Competitor1%', StringConversionManagement.WindowsToASCII((RFQ."Competitor 1")));
        NotificationBody := NotificationBody.Replace('%CompetitorPrice1Caption%', RFQ.FIELDCAPTION("Competitor Price 1"));
        NotificationBody := NotificationBody.Replace('%CompetitorPrice1%', FORMAT(RFQ."Competitor Price 1",0,'<Precision,2:2><Sign><Integer Thousand><1000Character,,><Decimals><Comma,.>'));
        NotificationBody := NotificationBody.Replace('%Competitor2Caption%', RFQ.FIELDCAPTION("Competitor 2"));
        NotificationBody := NotificationBody.Replace('%Competitor2%', StringConversionManagement.WindowsToASCII(RFQ."Competitor 2"));
        NotificationBody := NotificationBody.Replace('%CompetitorPrice2Caption%', RFQ.FIELDCAPTION("Competitor Price 2"));
        NotificationBody := NotificationBody.Replace('%CompetitorPrice2%', FORMAT(RFQ."Competitor Price 2",0,'<Precision,2:2><Sign><Integer Thousand><1000Character,,><Decimals><Comma,.>'));
        NotificationBody := NotificationBody.Replace('%Competitor3Caption%', RFQ.FIELDCAPTION("Competitor 3"));
        NotificationBody := NotificationBody.Replace('%Competitor3%', StringConversionManagement.WindowsToASCII((RFQ."Competitor 3")));
        NotificationBody := NotificationBody.Replace('%CompetitorPrice3Caption%', RFQ.FIELDCAPTION("Competitor Price 3"));
        NotificationBody := NotificationBody.Replace('%CompetitorPrice3%', FORMAT(RFQ."Competitor Price 3",0,'<Precision,2:2><Sign><Integer Thousand><1000Character,,><Decimals><Comma,.>'));
        NotificationBody := NotificationBody.Replace('%DeadlineForSubmissionCaption%', RFQ.FIELDCAPTION("Deadline for Submission"));
        NotificationBody := NotificationBody.Replace('%DeadlineForSubmission%', FORMAT(RFQ."Deadline for Submission",0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%TimelineOfTheProjCaption%', RFQ.FIELDCAPTION("Timeline of the Project"));
        NotificationBody := NotificationBody.Replace('%TimelineOfTheProj%', FORMAT(RFQ."Timeline of the Project",0,'<Month Text> <Day,2>, <Year4>'));
        NotificationBody := NotificationBody.Replace('%RemarksCaption%', RFQ.FIELDCAPTION(Remarks));
        NotificationBody := NotificationBody.Replace('%Remarks%', (RFQ.Remarks));
        NotificationBody := NotificationBody.Replace('%IfRevisedCancelledWhyCaption%', RFQ.FIELDCAPTION("If Revised/Cancelled Why"));
        NotificationBody := NotificationBody.Replace('%IfRevisedCancelledWhy%', (RFQ."If Revised/Cancelled Why"));
        // NEW CODES
        NotificationBody := NotificationBody.Replace('%AddressCaption%',FIELDCAPTION(Address));
        NotificationBody := NotificationBody.Replace('%Address%', FORMAT(RFQ.Address));
        NotificationBody := NotificationBody.Replace('%QuotationCodeCaption%',RFQ.FIELDCAPTION("No."));
        NotificationBody := NotificationBody.Replace('%RFQNo%', FORMAT(RFQ."No."));
        NotificationBody := NotificationBody.Replace('%NameOfTheProject%',RFQ.FIELDCAPTION("Project Description"));
        NotificationBody := NotificationBody.Replace('%ProjectDescription%', StringConversionManagement.WindowsToASCII((RFQ."Project Description")));
        NotificationBody := NotificationBody.Replace('%AddresseeCaption%',FIELDCAPTION(Addressee));
        NotificationBody := NotificationBody.Replace('%Addressee%', StringConversionManagement.WindowsToASCII(RFQ.Addressee));
        NotificationBody := NotificationBody.Replace('%AddresseeDesignationCaption%',FIELDCAPTION("Addressee Designation"));
        NotificationBody := NotificationBody.Replace('%AddresseeDesignation%', StringConversionManagement.WindowsToASCII(RFQ."Addressee Designation"));
        NotificationBody := NotificationBody.Replace('%EmailCaption%','Email');
        NotificationBody := NotificationBody.Replace('%Email%', (RFQ.Email));
        NotificationBody := NotificationBody.Replace('%QTPEquipmentCaption%',RFQ.FIELDCAPTION("QTP Equipment"));
        NotificationBody := NotificationBody.Replace('%QTPEquipment%', StringConversionManagement.WindowsToASCII((RFQ."QTP Equipment")));
        NotificationBody := NotificationBody.Replace('%QTPServicesCaption%',RFQ.FIELDCAPTION("QTP Services"));
        NotificationBody := NotificationBody.Replace('%QTPServices%', StringConversionManagement.WindowsToASCII((RFQ."QTP Services")));
        NotificationBody := NotificationBody.Replace('%OtherAttachmentCaption%',RFQ.FIELDCAPTION("ASD Others"));
        NotificationBody := NotificationBody.Replace('%OtherAttachment%', StringConversionManagement.WindowsToASCII((RFQ."ASD Others Text")));
        NotificationBody := NotificationBody.Replace('%BOMCaption%',RFQ.FIELDCAPTION("ASD BOM"));
        NotificationBody := NotificationBody.Replace('%DesignCaption%',RFQ.FIELDCAPTION("ASD Design"));

        NotificationBody := NotificationBody.Replace('%ServiceCaption%',RFQ.FIELDCAPTION("ASD Service Engineering"));
        NotificationBody := NotificationBody.Replace('%InstallationCaption%',RFQ.FIELDCAPTION("ASD Installation Material"));
        NotificationBody := NotificationBody.Replace('%IsWhyCaption%',RFQ.FIELDCAPTION("If Revised/Cancelled Why"));
        NotificationBody := NotificationBody.Replace('%IsWhy%', FORMAT(RFQ."If Revised/Cancelled Why"));
        // CHECKED BOX
        IF "ASD BOM" THEN
          NotificationBody := NotificationBody.Replace('%BOMChecked%','checked');
        IF "ASD Design" THEN
          NotificationBody := NotificationBody.Replace('%DesignChecked%','checked');
        IF "ASD Installation Material" THEN
          NotificationBody := NotificationBody.Replace('%InstallationChecked%','checked');
        IF "ASD Service Engineering" THEN
          NotificationBody := NotificationBody.Replace('%ServiceChecked%','checked');
        IF "ASD Others" THEN
          NotificationBody := NotificationBody.Replace('%OthersChecked%','checked');
      END;
    END;

    LOCAL PROCEDURE SetTokenToValueOfField@5(VAR NotificationBody@1004 : DotNet "'mscorlib'.System.String";Token@1000 : Text;RecRef@1002 : RecordRef;FieldName@1001 : Text);
    VAR
      Field@1005 : Record 2000000041;
      StringConversionMgmt@1007 : Codeunit 47;
      FieldRef@1003 : FieldRef;
      FieldValue@1006 : Text;
    BEGIN
      Field.SETRANGE(TableNo,RecRef.NUMBER);
      Field.SETRANGE(FieldName,FieldName);
      IF Field.FINDFIRST THEN BEGIN
        FieldRef := RecRef.FIELD(Field."No.");
        IF Field.Type = Field.Type::Decimal THEN
          FieldValue := FORMAT(FieldRef.VALUE,0,'<Precision,2:2><Standard Format,0>')
        ELSE
          FieldValue := FORMAT(FieldRef.VALUE);
      END;
      NotificationBody := NotificationBody.Replace(Token,StringConversionMgmt.WindowsToASCII(FieldValue));
    END;

    LOCAL PROCEDURE SetTokenToCaptionOfField@31(VAR NotificationBody@1004 : DotNet "'mscorlib'.System.String";Token@1000 : Text;RecRef@1002 : RecordRef;FieldName@1001 : Text);
    VAR
      Field@1005 : Record 2000000041;
      FieldRef@1003 : FieldRef;
      FieldValue@1006 : Text;
    BEGIN
      Field.SETRANGE(TableNo,RecRef.NUMBER);
      Field.SETRANGE(FieldName,FieldName);
      IF Field.FINDFIRST THEN BEGIN
        FieldRef := RecRef.FIELD(Field."No.");
        FieldValue := FORMAT(FieldRef.CAPTION);
      END;
      NotificationBody := NotificationBody.Replace(Token,FieldValue);
    END;

    LOCAL PROCEDURE ReplaceTokenToChecked@34(VAR FieldBoolean@1000 : Boolean) : Text;
    BEGIN
      IF FieldBoolean THEN
        EXIT('checked');
      EXIT('');
    END;

    BEGIN
    {
      !! Documentation Codeunit 50581 Custom Notification Management

        9:40 AM Thursday, August 15, 2024
          Modify ReplaceTokenWithJobOrderDetails function,  add other job order details and job order lines.
          Add ReplaceTokenToChecked function for boolean fields to set checkbox value in the email template.

        12:43 PM Friday, August 16, 2024
          Add blank table row if there's no data.

        11:10 PM Tuesday, August 20, 2024
          Add approval entry table based on stripo approval entry template.

        2:26 PM Tuesday,  September 10, 2024
          Add function ReplaceTokenSalesHeaderDetails

        3:33 PM Wednesday, October 16, 2024
          Add Approval-WW and Approval-TERF in ReplaceTokensWithCustomApprovalInfo function.

        1:17 PM, thursday October 17, 2024
          Migrate script from Code unit 1510 function ConstructSalesHeaderDetailsForHTML to ReplaceTokenSalesHeaderDetails.
          Migrate Sales Header ReplaceTokensWithRecInfo to ReplaceTokensWithCustomApprovalInfo

        1:42 PM Friday, October 18, 2024
          Add script in ReplaceTokenWithSalesHeaderDetails function for REquest for Exception.
    }
    END.
  }
}

OBJECT Codeunit 50582 Custom Approval Management
{
  OBJECT-PROPERTIES
  {
    Date=06/27/18;
    Time=10:32:10 PM;
    Modified=Yes;
    Version List=NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      NoWorkflowEnabledErr@1000 : TextConst 'ENU=This record is not supported by related approval workflow.';
      CustomWorkflowEvents@1001 : Codeunit 50580;
      WorkflowEventHandling@1003 : Codeunit 1520;
      WorkflowManagement@1002 : Codeunit 1501;
      UserIdNotInSetupErr@1009 : TextConst '@@@=User ID NAVUser does not exist in the Approval User Setup window.;ENU=User ID %1 does not exist in the Approval User Setup window.';
      EmployeeNoNotInSetupErr@1004 : TextConst 'ENU=Employee No. %1 does not exist in the Approval User Setup window.';
      ErrTableNotIncluded@1005 : TextConst 'ENU=This record is not supported by related approval workflow. %1 must be setup.';
      ApproverUserIdNotInSetupErr@1006 : TextConst '@@@=You must set up an approver for user ID NAVUser in the Approval User Setup window.;ENU=You must set up an approver for user ID %1 in the Approval User Setup window.';
      ApprovalsMgmt@1007 : Codeunit 1535;

    [Integration]
    PROCEDURE OnSendTicketForApproval@145(VAR Ticket@1000 : Record 50562);
    BEGIN
    END;

    [Integration]
    PROCEDURE OnSendSDRForApproval@3(VAR SDR@1000 : Record 50555);
    BEGIN
    END;

    [Integration]
    PROCEDURE OnCancelTicketApprovalRequest@146(VAR Ticket@1000 : Record 50562);
    BEGIN
    END;

    [Integration]
    PROCEDURE OnCancelSDRApprovalRequest@5(VAR SDR@1000 : Record 50555);
    BEGIN
    END;

    [Integration]
    PROCEDURE OnStartTicket@1(VAR Ticket@1000 : Record 50562);
    BEGIN
    END;

    PROCEDURE IsTicketApprovalsWorkflowEnabled@144(VAR Ticket@1002 : Record 50562) : Boolean;
    BEGIN
      EXIT(WorkflowManagement.CanExecuteWorkflow(Ticket,CustomWorkflowEvents.RunWorkflowOnSendTicketApprovalCode));
    END;

    PROCEDURE IsSDRApprovalsWorkflowEnabled@9(VAR SDR@1002 : Record 50555) : Boolean;
    BEGIN
      EXIT(WorkflowManagement.CanExecuteWorkflow(SDR,CustomWorkflowEvents.RunWorkflowOnSendSDRApprovalCode));
    END;

    PROCEDURE CheckTicketApprovalsWorkflowEnabled@151(VAR Ticket@1002 : Record 50562) : Boolean;
    BEGIN
      IF NOT IsTicketApprovalsWorkflowEnabled(Ticket) THEN
        ERROR(NoWorkflowEnabledErr);

      EXIT(TRUE);
    END;

    PROCEDURE CheckSDRApprovalsWorkflowEnabled@10(VAR SDR@1002 : Record 50555) : Boolean;
    BEGIN
       IF NOT IsSDRApprovalsWorkflowEnabled(SDR) THEN
        ERROR(NoWorkflowEnabledErr);

      EXIT(TRUE);
    END;

    PROCEDURE IsTicketFieldChangeWorkflowEnabled@7(VAR Ticket@1002 : Record 50562) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(Ticket,CustomWorkflowEvents.RunWorkflowOnTicketFieldChangedCode));
    END;

    PROCEDURE IsTicketAgingWorkflowEnabled@2(VAR Ticket@1002 : Record 50562) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(Ticket,CustomWorkflowEvents.RunWorkflowOnTicketAgingNotificationCode));
    END;

    PROCEDURE IsSDRFieldChangeWorkflowEnabled@8(VAR SDR@1002 : Record 50555) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(SDR,CustomWorkflowEvents.RunWorkflowOnSDRFieldChangedCode));
    END;

    PROCEDURE IsSDRAgingWorkflowEnabled@4(VAR SDR@1002 : Record 50555) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(SDR,CustomWorkflowEvents.RunWorkflowOnSDRAgingNotificationCode));
    END;

    PROCEDURE IsTaskFieldChangeWorkflowEnabled@11(VAR Task@1002 : Record 50556) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(Task,CustomWorkflowEvents.RunWorkflowOnTaskFieldChangedCode));
    END;

    PROCEDURE IsTaskAgingWorkflowEnabled@6(VAR Task@1002 : Record 50556) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(Task,CustomWorkflowEvents.RunWorkflowOnTaskAgingNotificationCode));
    END;

    PROCEDURE CustomPopulateApprovalEntryArgument@80(RecRef@1000 : RecordRef;VAR ApprovalEntryArgument@1001 : Record 454);
    VAR
      RTPSDocument@1005 : Record 50010;
      INTP@1004 : Record 50040;
      Job@1003 : Record 167;
      Ticket@1002 : Record 50562;
      RFPur@1006 : Record 50030;
      DDR@1007 : Record 50005;
      JobOrder@1008 : Record 50012;
      RequestForQuotation@1009 : Record 50013;
      CashAdvanceHdr@1010 : Record 50017;
      TERFHeader@1011 : Record 50034;
      SDR@1012 : Record 50555;
      ApprovalsMgmt@1013 : Codeunit 1535;
    BEGIN
      { ******************
      Applied to Codeunit 1535 Approvals Mgmt. > PopulateApprovalEntryArgument function
      To change the document number of approval entry argument based from record reference
      ApprovalsMgmt.PopulateApprovalEntryArgument
      ****************** }
      CASE RecRef.NUMBER OF
        DATABASE::"TERF Header":
          BEGIN
            RecRef.SETTABLE(TERFHeader);
            ApprovalEntryArgument."Document No." := TERFHeader."No.";
            IF TERFHeader."Document Type" = TERFHeader."Document Type"::Withdrawal THEN
              ApprovalEntryArgument."Document Type" := 7;
            IF TERFHeader."Document Type" = TERFHeader."Document Type"::TERF THEN
              ApprovalEntryArgument."Document Type" := 8;
          END;
          DATABASE::"Cash Advance Header":
            BEGIN
              RecRef.SETTABLE( CashAdvanceHdr );
              ApprovalEntryArgument."Document No." := CashAdvanceHdr."No.";
            END;
          DATABASE::"Request For Quotation":
            BEGIN
              RecRef.SETTABLE( RequestForQuotation );
              ApprovalEntryArgument."Document No." := RequestForQuotation."No.";
            END;
          DATABASE::"Job Order":
            BEGIN
              RecRef.SETTABLE(JobOrder);
              ApprovalEntryArgument."Document No." := JobOrder."No.";
            END;
          DATABASE::"Daily Deployment Report":
            BEGIN
              RecRef.SETTABLE(DDR);
              ApprovalEntryArgument."Document No." := DDR."No.";
            END;
          DATABASE::"Request for Purchase":
            BEGIN
              RecRef.SETTABLE(RFPur);
              ApprovalEntryArgument."Document No." := RFPur."No.";
            END;
          DATABASE::"RTPS Document":
            BEGIN
              RecRef.SETTABLE(RTPSDocument);
              ApprovalEntryArgument."Document No." := RTPSDocument."No.";
            END;
        DATABASE::"Internal Notice to Proceed":
          BEGIN
            RecRef.SETTABLE(INTP);
            ApprovalEntryArgument."Document No." := INTP."No.";
          END;
        DATABASE::Job:
          BEGIN
            RecRef.SETTABLE(Job);
            ApprovalEntryArgument."Document No." := Job."No.";
          END;
        DATABASE::Ticket:
          BEGIN
            RecRef.SETTABLE(Ticket);
            ApprovalEntryArgument."Document No." := Ticket."No.";
          END;
        DATABASE::"Software Development Request":
          BEGIN
            RecRef.SETTABLE(SDR);
            ApprovalEntryArgument."Document No." := SDR."No.";
          END;
      END;
    END;

    PROCEDURE CreateApprovalEntryNotification@50(ApprovalEntry@1000 : Record 454;WorkflowStepInstance@1001 : Record 1504) : Boolean;
    VAR
      WorkflowStepArgument@1002 : Record 1523;
      NotificationEntry@1003 : Record 1511;
      SalesHeader@1005 : Record 36;
      PurchaseHeader@1007 : Record 38;
      NotifTemplate@1006 : Record 1510;
      INTP@1013 : Record 50040;
      JobOrder@1016 : Record 50012;
      RFQ@1022 : Record 50013;
      Job@1018 : Record 167;
      Tickets@1023 : Record 50562;
      TaskerSMSLogs@1026 : Record 51002;
      JobOrderReportPrinter@1017 : Report 50012;
      INTPReportPrinter@1015 : Report 50041;
      RFQReport@1019 : Report 50013;
      SalesHeaderReportPrinter@1021 : Codeunit 228;
      PurchDocPrinter@1020 : Codeunit 229;
      UserSetupMgt@1008 : Codeunit 5700;
      FileManagement@1009 : Codeunit 419;
      DataTypeManagement@1011 : Codeunit 701;
      CustomNotifEntryMgmt@1024 : Codeunit 50583;
      ApprovalsMgmt@1025 : Codeunit 1535;
      FilePath@1010 : Text;
      FileName@1014 : Text;
      RecRef@1012 : RecordRef;
      RecRef2@1004 : RecordRef;
    BEGIN
      { ******************
      Applied to Codeunit 1535 Approvals Mgmt. > CreateApprovalEntryNotification function
      To create a notification for the approval of documents, sending and approval.
      ApprovalsMgmt.CreateApprovalEntryNotification
      ****************** }

      IF NOT WorkflowStepArgument.GET(WorkflowStepInstance.Argument) THEN
        EXIT(TRUE);

      IF NOT RecRef.GET(ApprovalEntry."Record ID to Approve") THEN
        EXIT(TRUE);

      IF WorkflowStepArgument."Notification User ID" = '' THEN
        WorkflowStepArgument.VALIDATE("Notification User ID",ApprovalEntry."Approver ID");

      // Log SMS Notification
      // TaskerSMSLogs.LogApprovalSMSNotification(ApprovalEntry);

      ApprovalEntry.RESET;
      CASE ApprovalEntry."Table ID" OF
        DATABASE::Item:
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-Item",WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
        DATABASE::Vendor:
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-Vendor",WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
        DATABASE::Customer:
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-Customer",WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
        DATABASE::"Job Order":
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-JO",WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
        DATABASE::Job:
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-Job", WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
        DATABASE::Ticket:
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Appvl-Tckt", WorkflowStepArgument."Notification User ID",ApprovalEntry,
            WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
        DATABASE::"Software Development Request":
          CustomNotifEntryMgmt.CreateNewEntryWithCustomActionForSDR(NotificationEntry.Type::"Appvl-SDR", WorkflowStepArgument."Notification User ID",ApprovalEntry,
            WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",0,UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"));
        DATABASE::"Request For Quotation":
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-RFQ",WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
        DATABASE::"Internal Notice to Proceed":
          CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-INTP",WorkflowStepArgument."Notification User ID",
            ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
        DATABASE::"Sales Header":
          BEGIN
            RecRef.SETTABLE(SalesHeader);
            CASE SalesHeader."Request type" OF
              SalesHeader."Request type"::"Tools & Equipment Requisition":
                CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-TERF",WorkflowStepArgument."Notification User ID",
                  ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
              SalesHeader."Request type"::Withdrawal:
                CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-WW",WorkflowStepArgument."Notification User ID",
                  ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
              SalesHeader."Request type"::"Return Merchandise Authorization":
                CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-C-RMA",WorkflowStepArgument."Notification User ID",
                  ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"),'','');
              SalesHeader."Request type"::"Request For Exception":
                CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-RFE",WorkflowStepArgument."Notification User ID",
                  ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
              SalesHeader."Request type"::"Work Change Request":
                BEGIN
                  IF ApprovalEntry.Status = ApprovalEntry.Status::Open THEN BEGIN
                    FilePath := SalesHeaderReportPrinter.SaveAsPDFSalesHeader(SalesHeader);
                    FileName := FORMAT(SalesHeader."Request type") + ' ' + SalesHeader."No." + '.pdf';
                  END;
                  CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-WCR",WorkflowStepArgument."Notification User ID",
                    ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), FilePath, FileName);
                END;
            END;
          END;
        DATABASE::"Purchase Header":
          BEGIN
            RecRef.SETTABLE(PurchaseHeader);
            CASE PurchaseHeader."Document Type" OF
              PurchaseHeader."Document Type"::Order:
                BEGIN
                  IF ApprovalEntry.Status = ApprovalEntry.Status::Open THEN BEGIN
                    FilePath := PurchDocPrinter.SavePurchaseHeaderReportAsPdf(PurchaseHeader);
                    FileName := 'Purchase ' + FORMAT(PurchaseHeader."Document Type") + ' ' + PurchaseHeader."No." + '.pdf';
                  END;
                  CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-PO",WorkflowStepArgument."Notification User ID",
                    ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), FilePath, FileName);
                END;
              PurchaseHeader."Document Type"::Invoice:
                BEGIN
                  CASE PurchaseHeader."Request Type" OF
                    PurchaseHeader."Request Type"::"Request for Payment":
                        CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-RFPay",WorkflowStepArgument."Notification User ID",
                          ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
                    PurchaseHeader."Request Type"::"Cash Advance":
                        CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-CA",WorkflowStepArgument."Notification User ID",
                          ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
                    PurchaseHeader."Request Type"::"Request for Purchase":
                        CustomNotifEntryMgmt.CreateNewEntryCcAttachment(NotificationEntry.Type::"Approval-RFPur",WorkflowStepArgument."Notification User ID",
                          ApprovalEntry,WorkflowStepArgument."Link Target Page",WorkflowStepArgument."Custom Link",UserSetupMgt.GetUserEmail(ApprovalEntry."Sender ID"), '', '');
                  END;
                END;
            END;
          END;
        ELSE
          EXIT(FALSE);
      END;

      EXIT(TRUE);
    END;

    PROCEDURE IsOnSaveNotesNotificationWorkflowEnabled@161(VAR RecordLink@1002 : Record 2000000068) : Boolean;
    BEGIN
      EXIT(WorkflowManagement.CanExecuteWorkflow(RecordLink,CustomWorkflowEvents.RunWorkflowOnSaveNotesNotificationCode));
    END;

    PROCEDURE CheckOnSaveNotesNotificationWorkflowEnabled@163(RecordLink@1000 : Record 2000000068) : Boolean;
    BEGIN
      IF NOT IsOnSaveNotesNotificationWorkflowEnabled(RecordLink) THEN
        ERROR(NoWorkflowEnabledErr);
      EXIT(TRUE);
    END;

    PROCEDURE IsINTPFieldChangeWorkflowEnabled@12(VAR INTP@1002 : Record 50040) : Boolean;
    BEGIN
       EXIT(WorkflowManagement.CanExecuteWorkflow(INTP,CustomWorkflowEvents.RunWorkflowOnINTPFieldChangedCode));
    END;

    PROCEDURE CustomCreateApprovalRequest@18(WorkflowStepArgument@1001 : Record 1523;ApprovalEntryArgument@1000 : Record 454);
    BEGIN
      CASE WorkflowStepArgument."Approver Type" OF
        WorkflowStepArgument."Approver Type"::"Cost Analyst Incharge":
          CreateApprovalRequestForCostAnalyst(WorkflowStepArgument, ApprovalEntryArgument);
        WorkflowStepArgument."Approver Type"::"Project Manager Incharge":
          CreateApprovalRequestForProjectManager(WorkflowStepArgument, ApprovalEntryArgument);
        WorkflowStepArgument."Approver Type"::"Endorse To":
          CreateApprovalRequestForEndorseTo(WorkflowStepArgument, ApprovalEntryArgument);
        WorkflowStepArgument."Approver Type"::"Ground Manager":
          CreateApprovalRequestForGroundManager(WorkflowStepArgument, ApprovalEntryArgument);
        WorkflowStepArgument."Approver Type"::Employee:
          CreateApprovalRequestForEmployee(WorkflowStepArgument, ApprovalEntryArgument);
      END;
    END;

    LOCAL PROCEDURE GetLastSequenceNo@14(ApprovalEntryArgument@1000 : Record 454) : Integer;
    VAR
      ApprovalEntry@1001 : Record 454;
    BEGIN
      WITH ApprovalEntry DO BEGIN
        SETCURRENTKEY("Record ID to Approve","Workflow Step Instance ID","Sequence No.");
        SETRANGE("Table ID",ApprovalEntryArgument."Table ID");
        SETRANGE("Record ID to Approve",ApprovalEntryArgument."Record ID to Approve");
        SETRANGE("Workflow Step Instance ID",ApprovalEntryArgument."Workflow Step Instance ID");
        IF FINDLAST THEN
          EXIT("Sequence No.");
      END;
      EXIT(0);
    END;

    LOCAL PROCEDURE CreateApprovalRequestForCostAnalyst@172(WorkflowStepArgument@1001 : Record 1523;ApprovalEntryArgument@1000 : Record 454);
    VAR
      UserSetup@1006 : Record 91;
      Res@1003 : Record 156;
      PurchHeader@1008 : Record 38;
      SalesHeader@1010 : Record 36;
      RFQ@1009 : Record 50013;
      Job@1011 : Record 167;
      UsrId@1005 : Code[50];
      SequenceNo@1004 : Integer;
      UserSetupMgt@1002 : Codeunit 5700;
      RecRef@1007 : RecordRef;
    BEGIN
      // PHP start
      UsrId := USERID;

      SequenceNo := GetLastSequenceNo(ApprovalEntryArgument);

      IF NOT UserSetup.GET(USERID) THEN
        ERROR(UserIdNotInSetupErr,UsrId);


      CASE ApprovalEntryArgument."Table ID" OF
        DATABASE::"Purchase Header":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(PurchHeader);
            IF NOT Res.GET(PurchHeader."Cost Analyst No.") THEN
              PurchHeader.TESTFIELD("Cost Analyst No.");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        DATABASE::"Sales Header":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(SalesHeader);
            IF NOT Res.GET(SalesHeader."Cost Analyst") THEN
              SalesHeader.TESTFIELD("Cost Analyst");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        DATABASE::"Request For Quotation":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(RFQ);
            IF NOT Res.GET(RFQ."Cost Analyst No.") THEN
              RFQ.TESTFIELD("Cost Analyst No.");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        DATABASE::Job:
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(Job);
            IF NOT Res.GET(Job."Cost Analyst No.") THEN
              ERROR(ErrTableNotIncluded, Job.FIELDNAME("Cost Analyst No."));
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        ELSE
          ERROR(NoWorkflowEnabledErr);

      END;

      IF NOT UserSetup.GET(UsrId) THEN BEGIN
        IF NOT UserSetup."Approval Administrator" THEN
          ERROR(ApproverUserIdNotInSetupErr,UserSetup."User ID");
        UsrId := USERID;
      END;

      SequenceNo += 1;
      ApprovalsMgmt.ExtendMakeApprovalEntry(ApprovalEntryArgument,SequenceNo,UsrId,WorkflowStepArgument);
    END;

    LOCAL PROCEDURE CreateApprovalRequestForProjectManager@171(WorkflowStepArgument@1001 : Record 1523;ApprovalEntryArgument@1000 : Record 454);
    VAR
      UserSetup@1006 : Record 91;
      Res@1003 : Record 156;
      PurchHeader@1008 : Record 38;
      JobOrder@1009 : Record 50012;
      UsrId@1005 : Code[50];
      SequenceNo@1004 : Integer;
      UserSetupMgt@1002 : Codeunit 5700;
      RecRef@1007 : RecordRef;
    BEGIN
      UsrId := USERID;

      SequenceNo := GetLastSequenceNo(ApprovalEntryArgument);

      IF NOT UserSetup.GET(USERID) THEN
        ERROR(UserIdNotInSetupErr,UsrId);


      CASE ApprovalEntryArgument."Table ID" OF
        DATABASE::"Purchase Header":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(PurchHeader);
            IF NOT Res.GET(PurchHeader."Project Manager No.") THEN
              PurchHeader.TESTFIELD("Project Manager No.");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        DATABASE::"Job Order":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(JobOrder);
            IF NOT Res.GET(JobOrder."Project Manager No.") THEN
              JobOrder.TESTFIELD("Project Manager No.");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        ELSE
          ERROR(NoWorkflowEnabledErr);
      END;

      IF NOT UserSetup.GET(UsrId) THEN BEGIN
        IF NOT UserSetup."Approval Administrator" THEN
          ERROR(ApproverUserIdNotInSetupErr,UserSetup."User ID");
        UsrId := USERID;
      END;

      SequenceNo += 1;
      ApprovalsMgmt.ExtendMakeApprovalEntry(ApprovalEntryArgument,SequenceNo,UsrId,WorkflowStepArgument);
    END;

    LOCAL PROCEDURE CreateApprovalRequestForEndorseTo@174(WorkflowStepArgument@1001 : Record 1523;ApprovalEntryArgument@1000 : Record 454);
    VAR
      UserSetup@1006 : Record 91;
      Res@1003 : Record 156;
      PurchHeader@1008 : Record 38;
      UsrId@1005 : Code[50];
      SequenceNo@1004 : Integer;
      UserSetupMgt@1002 : Codeunit 5700;
      RecRef@1007 : RecordRef;
    BEGIN
      UsrId := USERID;

      SequenceNo := GetLastSequenceNo(ApprovalEntryArgument);

      IF NOT UserSetup.GET(USERID) THEN
        ERROR(UserIdNotInSetupErr,UsrId);


      CASE ApprovalEntryArgument."Table ID" OF
        DATABASE::"Purchase Header":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(PurchHeader);
            IF NOT Res.GET(PurchHeader."Endorse To") THEN
              PurchHeader.TESTFIELD("Endorse To");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        ELSE
          ERROR(ErrTableNotIncluded, PurchHeader.FIELDNAME("Endorse To"));
      END;

      IF NOT UserSetup.GET(UsrId) THEN BEGIN
        IF NOT UserSetup."Approval Administrator" THEN
          ERROR(ApproverUserIdNotInSetupErr,UserSetup."User ID");
        UsrId := USERID;
      END;

      SequenceNo += 1;
      ApprovalsMgmt.ExtendMakeApprovalEntry(ApprovalEntryArgument,SequenceNo,UsrId,WorkflowStepArgument);
    END;

    LOCAL PROCEDURE CreateApprovalRequestForGroundManager@176(WorkflowStepArgument@1001 : Record 1523;ApprovalEntryArgument@1000 : Record 454);
    VAR
      UserSetup@1006 : Record 91;
      Res@1003 : Record 156;
      PurchHeader@1008 : Record 38;
      JobOrder@1009 : Record 50012;
      UsrId@1005 : Code[50];
      SequenceNo@1004 : Integer;
      UserSetupMgt@1002 : Codeunit 5700;
      RecRef@1007 : RecordRef;
    BEGIN
      UsrId := USERID;

      SequenceNo := GetLastSequenceNo(ApprovalEntryArgument);

      IF NOT UserSetup.GET(USERID) THEN
        ERROR(UserIdNotInSetupErr,UsrId);


      CASE ApprovalEntryArgument."Table ID" OF
        DATABASE::"Purchase Header":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(PurchHeader);
            IF NOT Res.GET(PurchHeader."Ground Manager No.") THEN
              PurchHeader.TESTFIELD("Ground Manager No.");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        DATABASE::"Job Order":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(JobOrder);
            IF NOT Res.GET(JobOrder."Ground Manager No.") THEN
              JobOrder.TESTFIELD("Ground Manager No.");
            Res.TESTFIELD("Time Sheet Owner User ID");
            UsrId := Res."Time Sheet Owner User ID";
          END;
        ELSE
          ERROR(NoWorkflowEnabledErr);
      END;

      IF NOT UserSetup.GET(UsrId) THEN BEGIN
        IF NOT UserSetup."Approval Administrator" THEN
          ERROR(ApproverUserIdNotInSetupErr,UserSetup."User ID");
        UsrId := USERID;
      END;

      SequenceNo += 1;
      ApprovalsMgmt.ExtendMakeApprovalEntry(ApprovalEntryArgument,SequenceNo,UsrId,WorkflowStepArgument);
    END;

    LOCAL PROCEDURE CreateApprovalRequestForEmployee@21(WorkflowStepArgument@1001 : Record 1523;ApprovalEntryArgument@1000 : Record 454);
    VAR
      UserSetup@1006 : Record 91;
      JobOrder@1009 : Record 50012;
      UserSetupMgt@1002 : Codeunit 5700;
      UsrId@1005 : Code[50];
      SequenceNo@1004 : Integer;
      RecRef@1007 : RecordRef;
    BEGIN
      SequenceNo := GetLastSequenceNo(ApprovalEntryArgument);

      IF NOT UserSetup.GET(USERID) THEN
        ERROR(UserIdNotInSetupErr,USERID);

      CASE ApprovalEntryArgument."Table ID" OF
        DATABASE::"Job Order":
          BEGIN
            RecRef.GET(ApprovalEntryArgument."Record ID to Approve");
            RecRef.SETTABLE(JobOrder);

            UserSetup.RESET;
            UserSetup.SETRANGE("Employee No.", JobOrder."Employee No.");
            IF NOT UserSetup.FINDFIRST THEN
              ERROR(EmployeeNoNotInSetupErr, JobOrder."Employee No.");

            CASE TRUE OF
              (UserSetup."Approver ID" <> ''):
                UsrId := UserSetup."Approver ID";
              UserSetup."Approval Administrator",UserSetup."Unlimited Request Approval":
                UsrId := UserSetup."User ID";
              ELSE
                ERROR(ApproverUserIdNotInSetupErr,UserSetup."User ID");
            END;
          END;
        ELSE
          ERROR(NoWorkflowEnabledErr);
      END;

      SequenceNo += 1;
      ApprovalsMgmt.ExtendMakeApprovalEntry(ApprovalEntryArgument,SequenceNo,UsrId,WorkflowStepArgument);
    END;

    BEGIN
    {
      !! Documentation Codeunit 50582 Custom Approval Management

        10:33 PM Monday, July 29, 2024
          Migrated the functions from Codeunit 1535 Approvals Mgmt. for Create an approval request for the record using approver.

        10:38 AM Wednesday, August 21, 2024
          Update the CreateApprovalEntryNotification: Remove the attachment on the email notification of Job Order.

        4:41 PM Tuesday, October 15, 2024
          Remove the withdrawal email attachment on function CreateApprovalEntryNotification
          Remove the Tools & Equipment Requisition email attachment on function CreateApprovalEntryNotification
          Remove the Request for Exception email attachment on function CreateApprovalEntryNotification
          Disable the SMS Email Log
    }
    END.
  }
}

OBJECT Page 119 User Setup
{
  OBJECT-PROPERTIES
  {
    Date=06/26/18;
    Time=12:02:41 AM;
    Modified=Yes;
    Version List=NAVW17.00,PHL0.01,NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=User Setup;
    SourceTable=Table91;
    PageType=List;
    PromotedActionCategoriesML=ENU=New,Process,Report,Approve,Release,Posting,Prepare,Details,Request Approval;
    OnOpenPage=BEGIN
                 SETRANGE(State, State::Enabled);
               END;

    OnAfterGetRecord=BEGIN
                       IF "Resource No." <> '' THEN BEGIN
                           EnableResBtn := TRUE;
                         END ELSE BEGIN
                           EnableResBtn := FALSE;
                       END;

                       IF "Employee No." <> '' THEN BEGIN
                         EnableEmpBtn := TRUE;
                       END ELSE BEGIN
                         EnableEmpBtn := FALSE;
                       END;
                     END;

    ActionList=ACTIONS
    {
      { 74      ;    ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 75      ;1   ;Action    ;
                      Name=ChangeLogs;
                      CaptionML=ENU=Change Logs;
                      PromotedIsBig=Yes;
                      Image=ChangeLog;
                      OnAction=VAR
                                 ChangeLogPage@1000 : Page 595;
                                 TableIds@1001 : Text;
                                 DocType@1002 : Integer;
                               BEGIN
                                 TableIds := FORMAT(DATABASE::"User Setup");
                                 ChangeLogPage.SetPageFilter(TableIds,Rec."User ID");
                                 ChangeLogPage.RUN;
                               END;
                                }
      { 30      ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 43      ;1   ;ActionGroup;
                      CaptionML=ENU=Process }
      { 31      ;2   ;Action    ;
                      Name=Auto Setup Users;
                      Image=CoupledUser;
                      OnAction=BEGIN
                                 UserMgmt.OnInsertUserSetup;
                               END;
                                }
      { 32      ;2   ;Action    ;
                      Name=Update User Email;
                      Image=Email;
                      OnAction=BEGIN
                                 UserMgmt.UpdateUserSetupEmails;
                               END;
                                }
      { 33      ;2   ;Action    ;
                      Name=Update User Group Code;
                      OnAction=BEGIN
                                 User.RESET;
                                 IF User.FINDSET THEN BEGIN
                                     REPEAT
                                       UserMember.RESET;
                                       UserMember.SETFILTER("User Security ID", User."User Security ID");
                                       IF UserMember.FINDFIRST THEN BEGIN
                                         UserSetup.RESET;
                                         UserSetup.SETRANGE("User ID", User."User Name");
                                         IF UserSetup.FINDFIRST THEN BEGIN
                                           UserSetup."User Group Code" := UserMember."User Group Code";
                                           UserSetup.MODIFY(TRUE);
                                         END;
                                       END;
                                     UNTIL User.NEXT = 0;
                                     MESSAGE('User setup User group has been successfully updated.');
                                 END;
                               END;
                                }
      { 41      ;2   ;Action    ;
                      Name=UpdateEmployeesEmail;
                      CaptionML=ENU=Update Employee's Email;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=MailSetup;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 UserSetup.RESET;
                                 UserSetup.COPY(Rec);
                                 CurrPage.SETSELECTIONFILTER(UserSetup);

                                 Counter := 0;
                                 IF UserSetup.FINDSET THEN BEGIN
                                   REPEAT
                                     IF Employees.GET(UserSetup."Employee No.") THEN BEGIN
                                       Employees."Company E-Mail" := UserSetup."E-Mail";
                                       Employees.MODIFY(TRUE);
                                       Counter += 1;
                                     END;
                                   UNTIL UserSetup.NEXT = 0;
                                   MESSAGE(Text001, Counter, Employees.TABLENAME);
                                 END;
                               END;
                                }
      { 42      ;2   ;Action    ;
                      Name=UpdateResourceEmail;
                      CaptionML=ENU=Update Resource's Email;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=MailSetup;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 UserSetup.RESET;
                                 UserSetup.COPY(Rec);
                                 CurrPage.SETSELECTIONFILTER(UserSetup);

                                 Counter := 0;
                                 IF UserSetup.FINDSET THEN BEGIN
                                   REPEAT
                                     IF Resources.GET(UserSetup."Resource No.") THEN BEGIN
                                       Resources."E-Mail" := UserSetup."E-Mail";
                                       Resources.MODIFY(TRUE);
                                       Counter += 1;
                                     END;
                                   UNTIL UserSetup.NEXT = 0;
                                   MESSAGE(Text001,Counter,Resources.TABLENAME);
                                 END;
                               END;
                                }
      { 83      ;1   ;ActionGroup;
                      CaptionML=ENU=Disable Accounts;
                      ActionContainerType=NewDocumentItems }
      { 82      ;2   ;Action    ;
                      Name=DisableAllRelatedAccount;
                      AccessByPermission=TableData 2000000120=D;
                      Ellipsis=Yes;
                      CaptionML=ENU=Disable All Related Account;
                      OnAction=VAR
                                 UserSetup@1000 : Record 91;
                               BEGIN
                                 // PHP Start
                                 UserSetup.COPY(Rec);
                                 CurrPage.SETSELECTIONFILTER(UserSetup);
                                 DisableEnableRelatedAccount(TRUE, UserSetup);
                                 // PHP End
                               END;
                                }
      { 84      ;2   ;Action    ;
                      Name=EnableAllRelatedAccount;
                      AccessByPermission=TableData 2000000120=D;
                      Ellipsis=Yes;
                      CaptionML=ENU=Enable All Related Account;
                      OnAction=VAR
                                 UserSetup@1000 : Record 91;
                               BEGIN
                                 // PHP Start
                                 UserSetup.COPY(Rec);
                                 CurrPage.SETSELECTIONFILTER(UserSetup);
                                 DisableEnableRelatedAccount(FALSE, UserSetup);
                                 // PHP End
                               END;
                                }
      { 44      ;1   ;ActionGroup;
                      CaptionML=ENU=Details }
      { 45      ;2   ;Action    ;
                      Name=EmployeeDetails;
                      CaptionML=ENU=Employee Details;
                      RunObject=Page 5200;
                      RunPageLink=No.=FIELD(Employee No.);
                      Promoted=Yes;
                      Enabled=EnableEmpBtn;
                      PromotedIsBig=Yes;
                      Image=Employee;
                      PromotedCategory=Category8;
                      RunPageMode=View }
      { 46      ;2   ;Action    ;
                      Name=ResourceDetails;
                      CaptionML=ENU=Resource Details;
                      RunObject=Page 76;
                      RunPageLink=No.=FIELD(Resource No.);
                      Promoted=Yes;
                      Enabled=EnableResBtn;
                      PromotedIsBig=Yes;
                      Image=Resource;
                      PromotedCategory=Category8;
                      RunPageMode=View }
      { 92      ;1   ;ActionGroup;
                      CaptionML=ENU=Image }
      { 91      ;2   ;Action    ;
                      Name=ViewSignature;
                      AccessByPermission=TableData 91=MD;
                      CaptionML=ENU=View Signature;
                      RunObject=Page 50660;
                      RunPageLink=User ID=FIELD(User ID);
                      Image=Picture;
                      RunPageMode=Edit }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                GroupType=Repeater }

    { 2   ;2   ;Field     ;
                SourceExpr="User ID";
                Style=Strong;
                StyleExpr=TRUE }

    { 68  ;2   ;Field     ;
                SourceExpr=State }

    { 34  ;2   ;Field     ;
                SourceExpr="User Group Code" }

    { 81  ;2   ;Field     ;
                SourceExpr="Resource No." }

    { 11  ;2   ;Field     ;
                SourceExpr="Base Resource Group" }

    { 29  ;2   ;Field     ;
                SourceExpr="Employee No." }

    { 40  ;2   ;Field     ;
                Lookup=No;
                DrillDown=No;
                SourceExpr="Employee Status";
                LookupPageID=Page0;
                DrillDownPageID=Page0 }

    { 57  ;2   ;Field     ;
                SourceExpr="Salespers./Purch. Code" }

    { 66  ;2   ;Field     ;
                SourceExpr="Vendor Individual No." }

    { 9   ;2   ;Field     ;
                SourceExpr="Customer Individual No." }

    { 88  ;2   ;Field     ;
                SourceExpr="Approver ID" }

    { 10  ;2   ;Field     ;
                SourceExpr=Substitute }

    { 18  ;2   ;Field     ;
                SourceExpr="E-Mail" }

    { 4   ;2   ;Field     ;
                SourceExpr="Allow Posting From" }

    { 6   ;2   ;Field     ;
                SourceExpr="Allow Posting To" }

    { 8   ;2   ;Field     ;
                SourceExpr="Register Time" }

    { 12  ;2   ;Field     ;
                SourceExpr="Sales Amount Approval Limit" }

    { 13  ;2   ;Field     ;
                SourceExpr="Purchase Amount Approval Limit" }

    { 14  ;2   ;Field     ;
                SourceExpr="Unlimited Sales Approval" }

    { 16  ;2   ;Field     ;
                SourceExpr="Unlimited Purchase Approval" }

    { 19  ;2   ;Field     ;
                SourceExpr="Request Amount Approval Limit" }

    { 20  ;2   ;Field     ;
                SourceExpr="Unlimited Request Approval" }

    { 22  ;2   ;Field     ;
                SourceExpr="Approval Administrator" }

    { 3   ;2   ;Field     ;
                SourceExpr="Time Sheet Admin." }

    { 23  ;2   ;Field     ;
                SourceExpr="Allow FA Posting From" }

    { 24  ;2   ;Field     ;
                SourceExpr="Allow FA Posting To" }

    { 80  ;2   ;Field     ;
                SourceExpr="Base Resp. Center" }

    { 15  ;2   ;Field     ;
                SourceExpr="Sales Resp. Ctr. Filter" }

    { 17  ;2   ;Field     ;
                SourceExpr="Purchase Resp. Ctr. Filter" }

    { 21  ;2   ;Field     ;
                SourceExpr="Service Resp. Ctr. Filter" }

    { 77  ;2   ;Field     ;
                SourceExpr="Campaign Ctr. Filter" }

    { 78  ;2   ;Field     ;
                SourceExpr="Opportunity Ctr. Filter" }

    { 26  ;2   ;Field     ;
                SourceExpr="RTPS Ctr. Filter" }

    { 27  ;2   ;Field     ;
                SourceExpr="RFQ Ctr. Filter" }

    { 28  ;2   ;Field     ;
                SourceExpr="CA Ctr. Filter" }

    { 65  ;2   ;Field     ;
                SourceExpr="Cash Adv. Liq. Ctr. Filter" }

    { 36  ;2   ;Field     ;
                SourceExpr="Item Ctr. Filter" }

    { 37  ;2   ;Field     ;
                SourceExpr="Contact Ctr. Filter" }

    { 48  ;2   ;Field     ;
                SourceExpr="JO Ctr. Filter" }

    { 50  ;2   ;Field     ;
                SourceExpr="RFPur Ctr. Filter" }

    { 60  ;2   ;Field     ;
                SourceExpr="TERF Ctr. Filter" }

    { 58  ;2   ;Field     ;
                SourceExpr="Withdrawal Ctr. Filter" }

    { 59  ;2   ;Field     ;
                SourceExpr="My Document Ctr. Filter" }

    { 39  ;2   ;Field     ;
                SourceExpr="Job Ctr. Filter" }

    { 53  ;2   ;Field     ;
                SourceExpr="RFPay Ctr. Filter" }

    { 70  ;2   ;Field     ;
                SourceExpr="RFE Ctr. Filter" }

    { 71  ;2   ;Field     ;
                SourceExpr="WCR Ctr. Filter" }

    { 73  ;2   ;Field     ;
                SourceExpr="Incoming Sub Att. Crt. Filter" }

    { 7   ;2   ;Field     ;
                SourceExpr="Title/Position" }

    { 5   ;2   ;Field     ;
                SourceExpr="WHT Registration ID" }

    { 35  ;2   ;Field     ;
                SourceExpr="Job Admin" }

    { 49  ;2   ;Field     ;
                SourceExpr="Job Order Vehicle Admin" }

    { 64  ;2   ;Field     ;
                SourceExpr="JO Admin" }

    { 51  ;2   ;Field     ;
                SourceExpr="RTPS Admin" }

    { 52  ;2   ;Field     ;
                SourceExpr="RFQ Admin" }

    { 61  ;2   ;Field     ;
                SourceExpr="Withdrawal Admin" }

    { 62  ;2   ;Field     ;
                SourceExpr="Incoming Docs. Admin" }

    { 63  ;2   ;Field     ;
                SourceExpr="CA Admin" }

    { 67  ;2   ;Field     ;
                SourceExpr="RFPay Admin" }

    { 76  ;2   ;Field     ;
                SourceExpr="RFPur Admin" }

    { 69  ;2   ;Field     ;
                SourceExpr="Warehouse Admin" }

    { 55  ;2   ;Field     ;
                SourceExpr="RTPS Executive" }

    { 56  ;2   ;Field     ;
                SourceExpr="RFQ Executive" }

    { 72  ;2   ;Field     ;
                SourceExpr="RFE Admin" }

    { 54  ;2   ;Field     ;
                SourceExpr="INTP Admin" }

    { 38  ;2   ;Field     ;
                SourceExpr="Accounting Admin" }

    { 89  ;2   ;Field     ;
                AccessByPermission=TableData 50562=D;
                SourceExpr="Ticket Admin" }

    { 90  ;2   ;Field     ;
                SourceExpr="SDR Admin" }

    { 79  ;2   ;Field     ;
                SourceExpr="Viber ID";
                Visible=FALSE }

    { 25  ;2   ;Field     ;
                SourceExpr="Viber No." }

    { 1900000007;0;Container;
                ContainerType=FactBoxArea }

    { 47  ;1   ;Part      ;
                PagePartID=Page50638;
                PartType=Page }

    { 87  ;1   ;Part      ;
                AccessByPermission=TableData 50006=MD;
                SubPageLink=EmployeeCode=FIELD(Employee No.);
                PagePartID=Page50622;
                PartType=Page }

    { 85  ;1   ;Part      ;
                CaptionML=ENU=Employee Details;
                SubPageLink=No.=FIELD(Employee No.);
                PagePartID=Page50620;
                PartType=Page;
                ShowFilter=No }

    { 86  ;1   ;Part      ;
                SubPageLink=No.=FIELD(Resource No.);
                PagePartID=Page50621;
                PartType=Page }

    { 1900383207;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 1905767507;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=Notes }

  }
  CODE
  {
    VAR
      UserMgmt@1000 : Codeunit 418;
      UserMember@1001 : Record 9001;
      UserGroup@1002 : Record 9000;
      UserSetup@1003 : Record 91;
      User@1004 : Record 2000000120;
      Employees@1005 : Record 5200;
      Resources@1008 : Record 156;
      JobOrder@1011 : Record 50012;
      Counter@1006 : Integer;
      Text001@1007 : TextConst 'ENU=%1 record from %2 has been modified.';
      EnableResBtn@1009 : Boolean;
      EnableEmpBtn@1010 : Boolean;

    LOCAL PROCEDURE UpdateJobOrderRespCenter@2();
    BEGIN
      JobOrder.RESET;
      JobOrder.SETRANGE("Responsibility Center", Rec."User ID");

      IF JobOrder.FINDSET THEN
        REPEAT
          IF xRec."JO Ctr. Filter" <> Rec."Job Ctr. Filter" THEN BEGIN
            JobOrder."Responsibility Center" := Rec."JO Ctr. Filter";
            JobOrder.MODIFY(TRUE);
          END;

        UNTIL JobOrder.NEXT = 0;
    END;

    LOCAL PROCEDURE DisableEnableRelatedAccount@11(Disable@1000 : Boolean;VAR UserSetup@1005 : Record 91);
    VAR
      Msg001@1007 : TextConst 'ENU="Do you want to disable the related account? \\Continuing this action will set the status of %1, %2, %3 record to disabled. "';
      Msg002@1008 : TextConst 'ENU="Do you want to enable the related account? \\Continuing this action will set the status of %1, %2, %3 record to enabled. "';
      Msg003@1006 : TextConst 'ENU=Record has been successfully updated.';
      Msg004@1001 : TextConst 'ENU="Do you want to disable the related account of this %1 records? \\Continuing this action will set the status of %2, %3, %4 record to disabled. "';
      Employee@1002 : Record 5200;
      Resource@1003 : Record 156;
      User@1004 : Record 2000000120;
      ConfirmAction@1009 : Boolean;
      Msg005@1010 : TextConst 'ENU="Do you want to enable the related account of this %1 records? \\Continuing this action will set the status of %2, %3, %4 record to enabled. "';
    BEGIN
      // PHP Start
        IF UserSetup.COUNT > 1 THEN BEGIN
          IF Disable THEN
            ConfirmAction := CONFIRM(Msg004, FALSE, UserSetup.COUNT, Employee.TABLECAPTION, Resource.TABLECAPTION, User.TABLECAPTION)
          ELSE
            ConfirmAction := CONFIRM(Msg005, FALSE, UserSetup.COUNT, Employee.TABLECAPTION, Resource.TABLECAPTION, User.TABLECAPTION);

          IF NOT ConfirmAction THEN
            EXIT;

          IF UserSetup.FINDSET THEN
            REPEAT
              DisableEnableUser(Disable, UserSetup."User ID");
              DisableEnableResource(Disable, UserSetup."Resource No.");
              DisableEnableEmployee(Disable, UserSetup."Employee No.");
            UNTIL UserSetup.NEXT = 0;

          MESSAGE(Msg003);
        END ELSE BEGIN
          IF Disable THEN
            ConfirmAction := CONFIRM(Msg001, FALSE, Employee.TABLECAPTION, Resource.TABLECAPTION, User.TABLECAPTION)
          ELSE
            ConfirmAction := CONFIRM(Msg002, FALSE, Employee.TABLECAPTION, Resource.TABLECAPTION, User.TABLECAPTION);
          IF NOT ConfirmAction THEN
            EXIT;

          DisableEnableUser(Disable, UserSetup."User ID");
          DisableEnableResource(Disable, UserSetup."Resource No.");
          DisableEnableEmployee(Disable, UserSetup."Employee No.");
          MESSAGE(Msg003);
        END;

      // PHP End
    END;

    LOCAL PROCEDURE DisableEnableResource@14(Disable@1000 : Boolean;ResourceCode@1001 : Code[20]);
    VAR
      Res@1002 : Record 156;
    BEGIN
      // PHP Start
      IF Res.GET(ResourceCode) THEN BEGIN
        IF Disable THEN
          Res.VALIDATE(Blocked, TRUE)
        ELSE
          Res.VALIDATE(Blocked, FALSE);
        Res.MODIFY(TRUE);
      END;
      // PHP End
    END;

    LOCAL PROCEDURE DisableEnableEmployee@15(Disable@1000 : Boolean;VAR EmployeeCode@1001 : Code[20]);
    VAR
      Emp@1002 : Record 5200;
    BEGIN
      // PHP Start
      IF Emp.GET(EmployeeCode) THEN BEGIN
        IF Disable THEN
          Emp.VALIDATE(Status, Emp.Status::Inactive)
        ELSE
          Emp.VALIDATE(Status, Emp.Status::Active);
        Emp.MODIFY(TRUE);
      END;
      // PHP End
    END;

    LOCAL PROCEDURE DisableEnableUser@16(Disable@1000 : Boolean;UserNameID@1001 : Code[50]);
    VAR
      User@1002 : Record 2000000120;
    BEGIN
      // PHP Start
      User.SETRANGE("User Name", UserNameID);
      IF User.FINDFIRST THEN BEGIN
        IF Disable THEN
          User.State := User.State::Disabled
        ELSE
          User.State := User.State::Enabled;
        User.MODIFY(TRUE);
      END;
      // PHP End
    END;

    BEGIN
    {
      !! Documentation Page 119 User Setup

      10:53 PM Monday, August 12, 2024
        Change the property of uploading of signature.
    }
    END.
  }
}

OBJECT Page 8614 Config. Package Card
{
  OBJECT-PROPERTIES
  {
    Date=06/28/18;
    Time=[ 9:37:03 PM];
    Modified=Yes;
    Version List=NAVW19.00,NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Config. Package Card;
    SourceTable=Table8623;
    PageType=Document;
    ActionList=ACTIONS
    {
      { 11      ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 24      ;1   ;ActionGroup;
                      CaptionML=ENU=Package }
      { 23      ;2   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=ENU=Export Package;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Export;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 TESTFIELD(Code);
                                 ConfigXMLExchange.ExportPackage(Rec);
                               END;
                                }
      { 22      ;2   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=ENU=Import Package;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Import;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ConfigXMLExchange.ImportPackageXMLFromClient;
                               END;
                                }
      { 21      ;2   ;Action    ;
                      CaptionML=ENU=Export to Excel;
                      Image=ExportToExcel;
                      OnAction=VAR
                                 ConfigPackageTable@1000 : Record 8613;
                                 ConfigExcelExchange@1001 : Codeunit 8618;
                               BEGIN
                                 TESTFIELD(Code);

                                 ConfigPackageTable.SETRANGE("Package Code",Code);
                                 IF CONFIRM(Text004,TRUE,Code,ConfigPackageTable.COUNT) THEN
                                   ConfigExcelExchange.ExportExcelFromTables(ConfigPackageTable);
                               END;
                                }
      { 20      ;2   ;Action    ;
                      CaptionML=ENU=Import from Excel;
                      Image=ImportExcel;
                      OnAction=VAR
                                 ConfigExcelExchange@1000 : Codeunit 8618;
                               BEGIN
                                 ConfigExcelExchange.ImportExcelFromPackage;
                               END;
                                }
      { 19      ;1   ;ActionGroup;
                      CaptionML=ENU=F&unctions }
      { 17      ;2   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=ENU=Get Tables;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=GetLines;
                      PromotedCategory=New;
                      OnAction=VAR
                                 GetPackageTables@1000 : Report 8616;
                               BEGIN
                                 CurrPage.SAVERECORD;
                                 GetPackageTables.Set(Code);
                                 GetPackageTables.RUNMODAL;
                                 CLEAR(GetPackageTables);
                               END;
                                }
      { 15      ;2   ;Action    ;
                      CaptionML=ENU=Apply Package;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Apply;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ConfigPackageTable@1002 : Record 8613;
                                 ConfigPackageMgt@1000 : Codeunit 8611;
                               BEGIN
                                 TESTFIELD(Code);
                                 IF CONFIRM(Text003,TRUE,Code) THEN BEGIN
                                   ConfigPackageTable.SETRANGE("Package Code",Code);
                                   ConfigPackageMgt.ApplyPackage(Rec,ConfigPackageTable,TRUE);
                                 END;
                               END;
                                }
      { 13      ;2   ;Action    ;
                      CaptionML=ENU=Copy Package;
                      Image=CopyWorksheet;
                      OnAction=VAR
                                 CopyPackage@1000 : Report 8615;
                               BEGIN
                                 TESTFIELD(Code);
                                 CopyPackage.Set(Rec);
                                 CopyPackage.RUNMODAL;
                                 CLEAR(CopyPackage);
                               END;
                                }
      { 8       ;2   ;Action    ;
                      CaptionML=ENU=Validate Package;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=CheckRulesSyntax;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ConfigPackageTable@1000 : Record 8613;
                                 TempConfigPackageTable@1001 : TEMPORARY Record 8613;
                                 ConfigPackageMgt@1002 : Codeunit 8611;
                               BEGIN
                                 IF CONFIRM(Text002,TRUE,"Package Name") THEN BEGIN
                                   ConfigPackageTable.SETRANGE("Package Code",Code);
                                   ConfigPackageMgt.ValidatePackageRelations(ConfigPackageTable,TempConfigPackageTable,TRUE);
                                 END;
                               END;
                                }
      { 7       ;2   ;Separator  }
      { 6       ;2   ;Action    ;
                      CaptionML=ENU=Export to Translation;
                      Visible=FALSE;
                      Image=Export;
                      OnAction=VAR
                                 ConfigPackageTable@1001 : Record 8613;
                               BEGIN
                                 TESTFIELD(Code);

                                 ConfigXMLExchange.SetAdvanced(TRUE);
                                 ConfigPackageTable.SETRANGE("Package Code",Code);
                                 IF CONFIRM(Text004,TRUE,Code,ConfigPackageTable.COUNT) THEN
                                   ConfigXMLExchange.ExportPackageXML(ConfigPackageTable,'');
                               END;
                                }
      { 12      ;2   ;Action    ;
                      Name=ProcessData;
                      CaptionML=ENU=Process Data;
                      Image=DataEntry;
                      OnAction=BEGIN
                                 ProcessPackageTablesWithDefaultProcessingReport;
                                 ProcessPackageTablesWithCustomProcessingReports;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;0   ;Container ;
                ContainerType=ContentArea }

    { 2   ;1   ;Group     ;
                CaptionML=ENU=General;
                GroupType=Group }

    { 3   ;2   ;Field     ;
                SourceExpr=Code;
                ShowMandatory=TRUE }

    { 4   ;2   ;Field     ;
                SourceExpr="Package Name";
                ShowMandatory=TRUE }

    { 5   ;2   ;Field     ;
                SourceExpr="Product Version" }

    { 14  ;2   ;Field     ;
                SourceExpr="Language ID" }

    { 18  ;2   ;Field     ;
                SourceExpr="Processing Order" }

    { 9   ;2   ;Field     ;
                SourceExpr="Exclude Config. Tables" }

    { 10  ;1   ;Part      ;
                SubPageView=SORTING(Package Code,Table ID);
                SubPageLink=Package Code=FIELD(Code);
                PagePartID=Page8625;
                PartType=Page }

    { 27  ;0   ;Container ;
                ContainerType=FactBoxArea }

    { 16  ;1   ;Part      ;
                PartType=System;
                SystemPartID=Notes }

    { 25  ;1   ;Part      ;
                PartType=System;
                SystemPartID=RecordLinks }

  }
  CODE
  {
    VAR
      ConfigXMLExchange@1001 : Codeunit 8614;
      Text002@1005 : TextConst 'ENU=Validate package %1?';
      Text003@1004 : TextConst 'ENU=Apply data from package %1?';
      Text004@1003 : TextConst 'ENU=Export package %1 with %2 tables?';

    LOCAL PROCEDURE ProcessPackageTablesWithDefaultProcessingReport@2();
    VAR
      ConfigPackageTable@1000 : Record 8613;
    BEGIN
      ConfigPackageTable.SETRANGE("Package Code",Code);
      ConfigPackageTable.SETRANGE("Processing Report ID",0);
      IF NOT ConfigPackageTable.ISEMPTY THEN
        REPORT.RUNMODAL(REPORT::"Config. Package - Process",FALSE,FALSE,ConfigPackageTable);
    END;

    LOCAL PROCEDURE ProcessPackageTablesWithCustomProcessingReports@3();
    VAR
      ConfigPackageTable@1000 : Record 8613;
    BEGIN
      ConfigPackageTable.SETRANGE("Package Code",Code);
      ConfigPackageTable.SETFILTER("Processing Report ID",'<>0',0);
      IF ConfigPackageTable.FINDSET THEN
        REPEAT
          REPORT.RUNMODAL(ConfigPackageTable."Processing Report ID",FALSE,FALSE,ConfigPackageTable)
        UNTIL ConfigPackageTable.NEXT = 0;
    END;

    BEGIN
    {
      !! Documentation Page 8614 Config. Package Card

      12:00 PM Monday, August 12, 2024
        Show the Notes and Links
    }
    END.
  }
}

OBJECT Page 50049 Trigger Approval Service
{
  OBJECT-PROPERTIES
  {
    Date=06/26/18;
    Time=12:16:18 AM;
    Modified=Yes;
    Version List=NAVOC1.00.02.00;
  }
  PROPERTIES
  {
    InsertAllowed=Yes;
    DeleteAllowed=No;
    ModifyAllowed=No;
    SourceTable=Table99008535;
    DelayedInsert=No;
    PageType=Card;
    SourceTableTemporary=Yes;
    OnModifyRecord=VAR
                     JobOrder@1000 : Record 50012;
                   BEGIN
                     CASE Document OF
                       Document::"Job Order":
                         BEGIN
                           JobOrder.GET(DocumentNo);
                           CASE ApprovalAction OF
                             ApprovalAction::"Send Approval":
                               BEGIN
                                 IF ApprovalsMgmt.CheckJOApprovalsWorkflowEnabled(JobOrder) THEN
                                   ApprovalsMgmt.OnSendJOForApproval(JobOrder);
                               END;
                             ApprovalAction::"Cancel Approval":
                               IF JobOrder.Status = JobOrder.Status::"Pending Approval" THEN
                                 ApprovalsMgmt.OnCancelJOApprovalRequest(JobOrder);
                             ELSE
                               ERROR(Txt01);
                           END;
                         END;
                       ELSE
                         ERROR(Txt01);
                     END;
                   END;

  }
  CONTROLS
  {
    { 1   ;    ;Container ;
                ContainerType=ContentArea }

    { 5   ;1   ;Group     ;
                Name=General;
                CaptionML=ENU=General;
                GroupType=Group }

    { 2   ;2   ;Field     ;
                Name=Document;
                SourceExpr=Document }

    { 3   ;2   ;Field     ;
                Name=DocumentNo;
                SourceExpr=DocumentNo }

    { 4   ;2   ;Field     ;
                Name=ApprovalAction;
                SourceExpr=ApprovalAction }

  }
  CODE
  {
    VAR
      ApprovalsMgmt@1002 : Codeunit 1535;
      ReleaseMgmt@1004 : Codeunit 50551;
      Document@1000 : 'Job Order';
      DocumentNo@1001 : Code[20];
      ApprovalAction@1003 : 'Send Approval,Cancel Approval';
      Txt01@1005 : TextConst 'ENU=Invalid request sent. Please select a valid request or contact your system administrator.';

    BEGIN
    {
      !! Documentation Page 50049 Trigger Approval Process
    }
    END.
  }
}

